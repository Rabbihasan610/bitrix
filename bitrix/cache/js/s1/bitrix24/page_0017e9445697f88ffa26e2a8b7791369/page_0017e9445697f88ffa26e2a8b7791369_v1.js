
; /* Start:"a:4:{s:4:"full";s:86:"/bitrix/components/bitrix/mail.client/templates/.default/script.min.js?169925803019042";s:6:"source";s:66:"/bitrix/components/bitrix/mail.client/templates/.default/script.js";s:3:"min";s:70:"/bitrix/components/bitrix/mail.client/templates/.default/script.min.js";s:3:"map";s:70:"/bitrix/components/bitrix/mail.client/templates/.default/script.map.js";}"*/
(function(){if(window.BXMailMessageController)return;var e={};e.init=function(e){if(this.__inited)return;this.options=e;this.__dummyNode=document.createElement("DIV");if("edit"!=this.options.type){if(this.options.pageSize<1||this.options.pageSize>100)this.options.pageSize=5;this.__log={a:0,b:0};var t=BX("mail-msg-view-details-"+this.options.messageId);var i=BX.findChildByClassName(t.parentNode,"mail-msg-view-log-more-a",true);BX.bind(i,"click",this.handleLogClick.bind(this,"a"));var s=BX.findChildByClassName(t.parentNode,"mail-msg-view-log-more-b",true);BX.bind(s,"click",this.handleLogClick.bind(this,"b"));var o=BX.findChildrenByClassName(t.parentNode,"mail-msg-view-log-item",true);for(var a in o){var l=o[a].getAttribute("data-log").toLowerCase();if(typeof this.__log[l]!="undefined")this.__log[l]++;BX.bind(o[a],"click",this.handleLogItemClick.bind(this,o[a].getAttribute("data-id")))}BX.Event.EventEmitter.subscribe("BXMailMessageActions:CRM_ACTIVITY",(function(e){BX.show(BX.findChildByClassName(BX("mail-msg-view-details-"+e.getData().messageId),"js-msg-view-control-skip",true))}));BX.Event.EventEmitter.subscribe("BXMailMessageActions:CRM_EXCLUDE",(function(e){BX.hide(BX.findChildByClassName(BX("mail-msg-view-details-"+e.getData().messageId),"js-msg-view-control-skip",true))}))}this.__inited=true};e.initScrollable=function(){if(!this.__scrollable){if(document.scrollingElement)this.__scrollable=document.scrollingElement}if(!this.__scrollable){if(document.documentElement.scrollTop>0||document.documentElement.scrollLeft>0)this.__scrollable=document.documentElement;else if(document.body.scrollTop>0||document.body.scrollLeft>0)this.__scrollable=document.body}if(!this.__scrollable){window.scrollBy(1,1);if(document.documentElement.scrollTop>0||document.documentElement.scrollLeft>0)this.__scrollable=document.documentElement;else if(document.body.scrollTop>0||document.body.scrollLeft>0)this.__scrollable=document.body;window.scrollBy(-1,-1)}return this.__scrollable};e.scrollWrapper=function(e){var t=this;if(!this.initScrollable())return;if(this.__scrollable.__animation){clearInterval(this.__scrollable.__animation);this.__scrollable.__animation=null}var i=this.__scrollable.scrollTop;var s=e-i;var o=0;this.__scrollable.__animation=setInterval((function(){o++;t.__scrollable.scrollTop=i+s*o/8;if(o>=8){clearInterval(t.__scrollable.__animation);t.__scrollable.__animation=null}}),20)};e.scrollTo=function(e,t){if(!this.initScrollable())return;var i=BX.pos(this.__scrollable);i.top+=this.__scrollable.scrollTop;i.bottom+=this.__scrollable.scrollTop;var s=BX.pos(e);var o=typeof t=="undefined"||t===e?s:BX.pos(t);if(s.top<i.top){this.scrollWrapper(this.__scrollable.scrollTop-(i.top-s.top))}else if(o.bottom>i.bottom){this.scrollWrapper(Math.min(this.__scrollable.scrollTop-(i.top-s.top),this.__scrollable.scrollTop+(o.bottom-i.bottom)))}};e.handleLogClick=function(e,t){BX.PreventDefault(t);var i=BX.findChildByClassName(BX("mail-msg-view-details-"+this.options.messageId).parentNode,"mail-msg-view-log-more-"+e,true);this.loadLog(e,i)};e.loadLog=function(e,t){var i=this;var s=t.parentNode;if(this["__loadingLog"+e])return;this["__loadingLog"+e]=true;var o={sessid:BX.bitrix_sessid(),action:"log",id:this.options.messageId,log:e+this.__log[e],size:this.options.pageSize};if(this.options.mail_uf_message_token){o.mail_uf_message_token=this.options.mail_uf_message_token}BX.ajax({method:"POST",url:BX.util.add_url_param(this.options.ajaxUrl,{action:"log"}),data:o,dataType:"json",onsuccess:function(t){i["__loadingLog"+e]=false;if(t.status=="success"){i.__dummyNode.innerHTML=t.data.html;var o=e=="a"?BX.findNextSibling(s,{tag:"div"}):s;while(i.__dummyNode.childNodes.length>0){var a=s.parentNode.insertBefore(i.__dummyNode.childNodes[0],o);if(a.nodeType==1&&BX.hasClass(a,"mail-msg-view-log-item")){i.__log[e]++;BX.addClass(a,"mail-msg-show-animation-rev");BX.bind(a,"click",i.handleLogItemClick.bind(i,a.getAttribute("data-id")))}}if(t.data.count<i.options.pageSize)s.style.display="none";if(e=="b"&&i.initScrollable()){i.scrollWrapper(i.__scrollable.scrollHeight)}i.__dummyNode.innerHTML=""}},onfailure:function(){i["__loadingLog"+e]=false}})};e.handleLogItemClick=function(e,t){t=t||window.event;if(t.target&&t.target.tagName&&t.target.tagName.toUpperCase()=="A")return;if(window.getSelection){if(window.getSelection().toString().trim()!="")return}else if(document.selection){if(document.selection.createRange().htmlText.trim()!="")return}BX.PreventDefault(t);this.toggleLogItem(e)};e.toggleLogItem=function(e){var t=this;var i=BX("mail-msg-view-details-"+this.options.messageId).parentNode;var s=BX.findChildByClassName(i,"mail-msg-view-logitem-"+e,false);var o=BX.findChildByClassName(i,"mail-msg-view-details-"+e,false);var a=BX.hasClass(s,"mail-msg-view-item-open");BX.removeClass(s,"mail-msg-show-animation-rev");BX.toggleClass(s,"mail-msg-view-item-open");if(a){o.style.display="none";BX.addClass(s,"mail-msg-show-animation-rev");s.style.display=""}else{BX.removeClass(o,"mail-msg-show-animation-rev");BX.addClass(o,"mail-msg-show-animation");o.style.display="";if(o.getAttribute("data-empty")){var l={sessid:BX.bitrix_sessid(),action:"logitem",id:e};if(this.options.mail_uf_message_token){l.mail_uf_message_token=this.options.mail_uf_message_token}BX.ajax({method:"POST",url:BX.util.add_url_param(this.options.ajaxUrl,{action:"logitem"}),data:l,dataType:"json",onsuccess:function(i){if(i.status!="success"){i.errors=i.errors.map((function(e){return e.message}));o.innerHTML='<div class="mail-msg-view-log-item-error mail-msg-view-border-bottom">'+i.errors.join("<br>")+"</div>";return}var a=BX.processHTML(i.data);BX.removeClass(o,"mail-msg-show-animation");BX.removeClass(o,"mail-msg-show-animation-rev");setTimeout((function(){o.style.textAlign="";o.innerHTML=a.HTML;if(o.offsetHeight>0)s.style.display="none";BX.ajax.processScripts(a.SCRIPT);BX.addClass(o,"mail-msg-show-animation-rev");var i=BX.findChildByClassName(o,"mail-msg-view-header",true);BX.bind(i,"click",t.handleLogItemClick.bind(t,e));t.scrollTo(o)}),10);o.removeAttribute("data-empty")}});this.scrollTo(s,o)}else{s.style.display="none";this.scrollTo(o)}}};e.removeLogItem=function(e){var t=BX("mail-msg-view-details-"+this.options.messageId).parentNode;var i=BX.findChildByClassName(t,"mail-msg-view-logitem-"+e,false);var s=BX.findChildByClassName(t,"mail-msg-view-details-"+e,false);var o=i.getAttribute("data-log").toLowerCase();if(typeof this.__log[o]!="undefined")this.__log[o]--;setTimeout((function(){t.removeChild(s);t.removeChild(i)}),200);s.style.maxHeight=s.offsetHeight*1.5+"px";s.style.transition="max-height .2s ease-in";s.offsetHeight;s.style.maxHeight="0px";BX.removeClass(s,"mail-msg-show-animation");BX.removeClass(s,"mail-msg-show-animation-rev");BX.addClass(s,"mail-msg-close-animation")};e.close=function(e){var t=top.BX.SidePanel.Instance.getSliderByWindow(window);if(t){t.setCacheable(!e);t.close()}else{window.location.href=BX.util.add_url_param(this.options.pathList,{strict:"N"})}};var t=function(i){var s=this;this.ctrl=e;this.options=i;this.__dummyNode=document.createElement("DIV");this.htmlForm=BX(this.options.formId);this.htmlForm.__wrapper=this.htmlForm.parentNode;if(this.htmlForm.__inited)return;if("edit"!=this.ctrl.options.type){this.__wrapper=BX("mail-msg-view-details-"+this.ctrl.options.messageId);if(this.options.messageId!=this.ctrl.options.messageId)this.__wrapper=BX.findChildByClassName(this.__wrapper.parentNode,"mail-msg-view-details-"+this.options.messageId,false);BX.addCustomEvent("MailMessage:replyButtonClick",(function(e){if(e!==s)s.hideReplyForm()}));top.BX.SidePanel.Instance.postMessage(window,"mail-message-view",{id:this.options.messageId});var o="mail_msg_"+this.options.messageId+"_body";var a=typeof document.querySelectorAll!="undefined"?document.querySelectorAll("#"+o+" a"):BX.findChildren(BX(o),{tag:"a"},true);for(var l in a){if(!a.hasOwnProperty(l))continue;if(a[l]&&a[l].setAttribute)a[l].setAttribute("target","_blank")}var n=typeof document.querySelectorAll!="undefined"?document.querySelectorAll("#"+o+" blockquote"):BX.findChildren(BX(o),{tag:"blockquote"},true);for(var l in n){if(!n.hasOwnProperty(l))continue;BX.bind(n[l],"click",(function(){BX.addClass(this,"mail-msg-view-quote-unfolded")}))}var r=BX.findChildrenByClassName(this.__wrapper,"mail-msg-view-rcpt-more");for(var l in r){BX.bind(r[l],"click",(function(e){BX.findChildByClassName(this.parentNode,"mail-msg-view-rcpt-list-hidden",false).style.display="inline";this.style.display="none";BX.PreventDefault(e)}))}var d=BX.findChildByClassName(this.__wrapper,"js-msg-view-reply-panel",true);var m=BX.findChildByClassName(this.__wrapper,"js-msg-view-control-reply",true);var c=BX.findChildByClassName(this.__wrapper,"js-msg-view-control-replyall",true);var h=BX.findChildByClassName(this.__wrapper,"js-msg-view-control-forward",true);var p=BX.findChildByClassName(this.__wrapper,"js-msg-view-control-skip",true);var u=BX.findChildByClassName(this.__wrapper,"js-msg-view-control-spam",true);var f=BX.findChildByClassName(this.__wrapper,"js-msg-view-control-delete",true);BX.bind(d,"click",this.showReplyForm.bind(this));BX.bind(c,"click",this.showReplyForm.bind(this));BX.bind(m,"click",this.showReplyForm.bind(this,true));BX.bind(h,"click",(function(){var e={forward:s.options.messageId};if(s.ctrl.options.mail_uf_message_token){e.mail_uf_message_token=s.ctrl.options.mail_uf_message_token}window.location.href=BX.util.add_url_param(s.ctrl.options.pathNew,e)}));BX.bind(p,"click",(function(e){BXMailMessageActions&&BXMailMessageActions.createAction(e,{messageId:s.options.messageId,value:"CRM_EXCLUDE",disable:BX.addClass.bind(BX,p,"mail-msg-view-control-disabled"),enable:BX.removeClass.bind(BX,p,"mail-msg-view-control-disabled")})}));var g=document.querySelector("[data-uid-key]");var _=0;if(g){_=g.dataset.uidKey}BX.bind(u,"click",this.markAsSpam.bind(this,u,_));BX.bind(f,"click",this.delete.bind(this,f,_))}var B=BXMainMailForm.getForm(this.options.formId);BX.addCustomEvent(B,"MailForm:footer:buttonClick",t.handleFooterButtonClick.bind(this));BX.addCustomEvent(B,"MailForm:submit",t.handleFormSubmit.bind(this));BX.addCustomEvent(B,"MailForm:submit:ajaxSuccess",t.handleFormSubmitSuccess.bind(this));BX.PULL&&BX.PULL.extendWatch("mail_mailbox_"+this.options.messageId);BX.addCustomEvent("onPullEvent-mail",BX.proxy((function(e,t){if(e!=="onMessageRead"){return}var i=BX("mail-msg-view-details-"+t.messageId);if(!i){i=BX.findChildByClassName(document,"mail-msg-view-logitem-"+t.messageId,true)}if(!i){return}var s=BX.findChildrenByClassName(i,"read-confirmed-datetime",true);if(s&&s.length>0){for(var o in s)BX.adjust(s[o],{text:BX.message("MAIL_MESSAGE_READ_CONFIRMED_SHORT")})}}),this));this.htmlForm.__inited=true};t.handleFooterButtonClick=function(e,t){if(BX.hasClass(t,"main-mail-form-cancel-button")){if("edit"==this.ctrl.options.type){this.ctrl.close()}else{this.hideReplyForm()}}};t.handleFormSubmit=function(e,t){var i=this.htmlForm.elements;var s=true;var o=0;var a=0;var l=0;for(var n=0;n<i.length;n++){if("data[to][]"===i[n].name&&i[n].value.length){s=false;l++}if("data[cc][]"===i[n].name&&i[n].value.length){o++}if("data[bcc][]"===i[n].name&&i[n].value.length){a++}}var r=Number(BX.message("EMAILS_LIMIT_TO_SEND_MESSAGE"));if(r!==-1&&(l>r||o>r||a>r)){console.log(r);e.showError(BX.message("MAIL_MESSAGE_NEW_TARIFF_RESTRICTION"));return BX.PreventDefault(t)}if(s){e.showError(BX.message("MAIL_MESSAGE_NEW_EMPTY_RCPT"));return BX.PreventDefault(t)}var d,m,c=0;for(var n in e.postForm.controllers){if(!e.postForm.controllers.hasOwnProperty(n))continue;if(e.postForm.controllers[n].storage!="disk")continue;try{d=0;d=e.postForm.controllers[n].handler.agent.upload.filesCount}catch(e){}if(d>0){e.showError(BX.message("MAIL_MESSAGE_NEW_UPLOADING"));return BX.PreventDefault(t)}if(BX.message("MAIL_MESSAGE_MAX_SIZE")>0){try{m=e.postForm.controllers[n].handler.agent.queue.items.items;c=Object.keys(m).reduce((function(e,t){return e+(m[t].file?parseInt(m[t].file.sizeInt||m[t].file.size):0)}),c)}catch(e){}}}if(BX.message("MAIL_MESSAGE_MAX_SIZE")>0&&BX.message("MAIL_MESSAGE_MAX_SIZE")<=Math.ceil(c/3)*4){e.showError(BX.message("MAIL_MESSAGE_MAX_SIZE_EXCEED"));return BX.PreventDefault(t)}};t.handleFormSubmitSuccess=function(e,t){if(t.status!="success"){var i=document.createElement("DIV");if(!t.errors||!BX.type.isArray(t.errors)){t.errors=[{message:BX.message("MAIL_CLIENT_AJAX_ERROR"),code:0}]}for(var s=0;s<t.errors.length;s++){i.innerHTML+=t.errors[s].message+"</br>"}e.showError(i.innerHTML)}else{if("edit"!=this.ctrl.options.type){this.hideReplyForm()}top.BX.SidePanel.Instance.postMessage(window,"Mail.Client.MessageCreatedSuccess",t);top.BX.UI.Notification.Center.notify({autoHideDelay:2e3,content:BX.message("MAIL_MESSAGE_SEND_SUCCESS")});this.ctrl.close(true)}};t.prototype.showReplyForm=function(e){var t=BXMainMailForm.getForm(this.options.formId);var i=BX.findChildByClassName(this.__wrapper,"js-msg-view-reply-panel",true);if(this.htmlForm.parentNode===this.__dummyNode){this.htmlForm.__wrapper.appendChild(this.htmlForm)}t.init();if(e===true){t.getField("data[to]").setValue(this.options.rcptSelected);t.getField("data[cc]").setValue()}else{t.getField("data[to]").setValue(this.options.rcptAllSelected);t.getField("data[cc]").setValue(this.options.rcptCcSelected)}t.getField("data[bcc]").setValue();BX.onCustomEvent("MailMessage:replyButtonClick",[this]);BX.addClass(this.htmlForm,"mail-msg-show-animation");this.htmlForm.style.display="";i.style.display="none";BX.onCustomEvent(t,"MailForm:show",[]);this.ctrl.scrollTo(this.htmlForm)};t.prototype.hideReplyForm=function(){var e=BXMainMailForm.getForm(this.options.formId);var t=BX.findChildByClassName(this.__wrapper,"js-msg-view-reply-panel",true);BX.addClass(t,"mail-msg-show-animation-rev");t.style.display="";this.htmlForm.style.display="none";BX.onCustomEvent(e,"MailForm:hide",[]);this.__dummyNode.appendChild(this.htmlForm)};t.prototype.markAsSpam=function(e,t){e.classList.add("mail-msg-view-control-disabled");BX.ajax.runComponentAction("bitrix:mail.client","markAsSpam",{mode:"ajax",data:{ids:[t]}}).then(this.onMessageActionSuccess.bind(this,e),function(e){this.onMessageActionError.bind(this,e)()}.bind(this))};t.prototype.delete=function(e,t){if(e.dataset&&e.dataset.isTrash){if(!this.popupDeleteConfirm){var i=[new BX.PopupWindowButton({text:BX.message("MAIL_MESSAGE_LIST_CONFIRM_CANCEL_BTN"),className:"popup-window-button-cancel",events:{click:BX.delegate((function(){this.popupDeleteConfirm.close()}),this)}}),new BX.PopupWindowButton({text:BX.message("MAIL_MESSAGE_LIST_CONFIRM_DELETE_BTN"),className:"popup-window-button-decline",events:{click:BX.delegate((function(){this.processDelete(e,t);this.popupDeleteConfirm.close()}),this)}})];this.popupDeleteConfirm=new BX.PopupWindow("bx-mail-message-list-popup-delete-confirm",null,{zIndex:1e3,autoHide:true,buttons:i,closeByEsc:true,titleBar:{content:BX.create("div",{html:'<span class="popup-window-titlebar-text">'+BX.message("MAIL_MESSAGE_LIST_CONFIRM_TITLE")+"</span>"})},events:{onPopupClose:function(){this.destroy()},onPopupDestroy:BX.delegate((function(){this.popupDeleteConfirm=null}),this)},content:BX.create("div",{html:BX.message("MAIL_MESSAGE_LIST_CONFIRM_DELETE")})})}this.popupDeleteConfirm.show()}else{this.processDelete(e,t)}};t.prototype.processDelete=function(e,t){e.classList.add("mail-msg-view-control-disabled");BX.ajax.runComponentAction("bitrix:mail.client","delete",{mode:"ajax",data:{ids:[t]}}).then(this.onMessageActionSuccess.bind(this,e),function(e){this.onMessageActionError.bind(this,e)()}.bind(this))};t.prototype.onMessageActionError=function(e){top.BX.UI.Notification.Center.notify({autoHideDelay:4e3,content:e.errors[0].message})};t.prototype.onMessageActionSuccess=function(e){top.BX.SidePanel.Instance.postMessage(window,"mail-message-reload-grid",{});this.ctrl.close(true)};var i={syncData:{}};i.init=function(e){this.mailbox=e||{};return this};i.sync=function(e,t,s,o){var a=this;if(o){i.updateStepper(e,0,-1)}if(a.syncLock){return}a.syncLock=true;var l=BX.Main.filterManager.getById(t);var n=l.getFilterFieldsValues()["DIR"];var r=BX.ajax.runComponentAction("bitrix:mail.client","syncMailbox",{mode:"ajax",data:{id:a.mailbox.ID,dir:n||a.mailbox.OPTIONS.inboxDir,onlySyncCurrent:s===undefined?false:s}});r.then((function(s){i.syncProgress(e,t,s.data)}),(function(s){if(!s.errors.indexOf("Network error")){i.syncProgress(e,t,{complete:false,status:-1,errors:s.errors,is_fatal_error:s.data.is_fatal_error})}else{i.syncProgress(e,t,{complete:true,status:1,errors:[]})}}))};i.syncProgress=function(e,t,s){var o=this;if(s.timestamp<o.syncData.timestamp){return}o.syncData.timestamp=s.timestamp;if(!BX.type.isNotEmptyString(s.sessid)){s.sessid="dummy"}if(typeof o.syncData[s.sessid]=="undefined"){o.syncData[s.sessid]={}}if(s.new>0){o.syncData[s.sessid].new=s.new}if(!o.syncData[s.sessid].complete){if(o.syncData[s.sessid].new>0||s.updated>0||s.deleted>0){var a=new BX.Mail.MessageGrid;a.setGridId(t);a.reloadTable()}if(s.final>0){delete o.syncData[s.sessid]}else{o.syncData[s.sessid].complete=true}}i.updateStepper(e,s.complete,s.status,s.errors,s.is_fatal_error);this.syncLock=false;if(!s.complete&&s.status>=0){i.sync(e,t,true)}};i.toggleStepper=function(e,t){if(t){e.show()}else{e.hide()}};i.updateStepper=function(e,t,s,o,a){e.hideTimeout=clearTimeout(e.hideTimeout);s=parseFloat(s);var l=e.getErrorTitleNode();var n=e.getErrorTextNode();var r=e.getErrorHintNode();if(t===false&&s<0){l&&(l.innerText=BX.message("MAIL_CLIENT_MAILBOX_SYNC_BAR_INTERRUPTED"));if(n){var d=[];if(o&&o.length>0){for(var m=0;m<o.length;m++){if(o[m].code<0){d.push(o[m].message);o.splice(m--,1)}else{o[m]=o[m].message}}var c=(o.length>0?o:d).join(": ")}else{var c=BX.message("MAIL_CLIENT_AJAX_ERROR")}n.innerText=c;if(d.length>0&&o.length>0){while(r.firstChild){r.removeChild(r.firstChild)}r.appendChild(BX.UI.Hint.createNode(d.join(": ")))}e.showErrorBox()}if(!n||a){i.toggleStepper(e,false)}}else{e.hideErrorBox();if(t){e.hideTimeout=setTimeout(i.toggleStepper.bind(this,e,false),2e3)}else{i.toggleStepper(e,true)}}var h=document.createEvent("Event");h.initEvent("resize",true,true);window.dispatchEvent(h)};window.BXMailMessageController=e;window.BXMailMessage=t;window.BXMailMailbox=i})();(function(){if(window!==window.top){return;BX.bind(window,"beforeunload",(function(){document.body.style.opacity="0.4"}))}var e=("/"+(BX.message.SITE_DIR||"/").replace(/[\\*+?.()|[\]{}]/g,"\\$&")+"/").replace(/\/+/g,"/");this.mailLoader=BX.create("div",{props:{className:"mail-loader-node"}});top.BX.SidePanel.Instance.bindAnchors({rules:[{condition:[e+"mail(/|$)"],options:{contentClassName:"mail-loader-modifier",loader:this.mailLoader,cacheable:false,customLeftBoundary:0}},{condition:["^"+e+"mail/config/(new|edit)"],options:{width:760,cacheable:false}},{condition:["^"+e+"mail/(blacklist|signature|addressbook)"],options:{width:1080,cacheable:false}},{condition:["^"+e+"mail/(message)"],options:{width:1080}}]})})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.min.js?16992580965071";s:6:"source";s:77:"/bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.js";s:3:"min";s:81:"/bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.map.js";}"*/
(function(){BX.namespace("BX.UI.SidePanel");if(BX.UI.SidePanel.Wrapper){return}function t(t){}t.prototype.init=function(t){this.container=BX(t.containerId);this.isCloseAfterSave=t.isCloseAfterSave||false;this.isReloadGridAfterSave=t.isReloadGridAfterSave||false;this.isReloadPageAfterSave=t.isReloadPageAfterSave||false;this.skipNotification=t.skipNotification||false;this.useLinkTargetsReplacing=t.useLinkTargetsReplacing||false;this.notification=t.notification||{};var e=BX.SidePanel.Instance.getPreviousSlider(BX.SidePanel.Instance.getSliderByWindow(window));this.parentWindow=e?e.getWindow():top;this.initEditableTitle(t);if(this.isReloadGridAfterSave){if(this.getParam("reloadGridAfterSave")){this.reloadGridOnParentPage()}this.setParam("reloadGridAfterSave",true)}if(this.isCloseAfterSave){if(this.getParam("closeAfterSave")){var i;if(this.notification.content&&top.BX&&!this.getParam("skipNotification")){i=function(){top.BX.loadExt("ui.notification").then(function(){top.BX.UI.Notification.Center.notify(this.notification)}.bind(this))}.bind(this)}else if(this.isReloadPageAfterSave){i=function(){this.parentWindow.location.reload()}.bind(this)}BX.SidePanel.Instance.close(false,i)}if(this.skipNotification){this.setParam("skipNotification",true)}this.setParam("closeAfterSave",true)}if(this.useLinkTargetsReplacing){this.initLinkTargetsReplacing()}};t.prototype.initEditableTitle=function(t){if(!t.title||!t.title.selector||!t.title.defaultTitle){return}var i=this.container.querySelector(t.title.selector);if(!i){return}var n=i.querySelector('input[type="text"]');if(!n){return}i.style.display="none";e.init({dataContainer:i,dataNode:n,defaultTitle:t.title.defaultTitle})};t.prototype.initLinkTargetsReplacing=function(){this.replaceLinkTargets();if(!window.MutationObserver){return}var t=new MutationObserver(this.domMutationHandler.bind(this));t.observe(this.container,{childList:true,subtree:true})};t.prototype.domMutationHandler=function(t){t.forEach(function(t){for(var e=0;e<t.addedNodes.length;++e){var i=t.addedNodes.item(e);if(!i){continue}this.replaceLinkTargets(i)}},this)};t.prototype.replaceLinkTargets=function(t){if(!t){t=document.body}var e=[];if(t.tagName==="A"){e=[t]}else if(t.nodeName!=="#text"){e=BX.convert.nodeListToArray(t.querySelectorAll("a"))}if(e.length===0){return}BX.convert.nodeListToArray(e).filter(function(t){return!t.target}).forEach(function(t){t.target="_top"})};t.prototype.setParam=function(t,e){var i=BX.SidePanel.Instance.getSliderByWindow(window);if(i){i.getData().set(t,e)}};t.prototype.getParam=function(t){var e=BX.SidePanel.Instance.getSliderByWindow(window);if(e){return e.getData().get(t)}return undefined};t.prototype.removeParam=function(t){var e=BX.SidePanel.Instance.getSliderByWindow(window);if(e){e.getData().delete(t)}};t.prototype.reloadGridOnParentPage=function(){var t=this.parentWindow;var e=BX.type.isString(this.isReloadGridAfterSave)?this.isReloadGridAfterSave:null;if(!t.BX.Main||!t.BX.Main.gridManager){return}if(e==="all"){t.BX.Main.gridManager.data.forEach(function(t){t.instance.reload()});return}if(!e&&t.BX.Main.gridManager.data){var i=t.BX.Main.gridManager.data;e=i.length>0?i[0].id:null}if(!e){return}var n=t.BX.Main.gridManager.getById(e);if(!n){return}n.instance.reload()};var e={isInit:false,init:function(t){this.dataNode=t.dataNode;this.titleNode=document.querySelector(".ui-side-panel-wrap-title-name");this.inputNode=document.querySelector(".ui-side-panel-wrap-title-input");this.buttonNode=document.querySelector(".ui-side-panel-wrap-title-edit-button");this.initialTitle=this.titleNode.textContent;this.defaultTitle=t.defaultTitle;BX.bind(this.dataNode,"bxchange",this.onDataNodeChange.bind(this));BX.bind(this.buttonNode,"click",this.startEdit.bind(this));BX.bind(this.inputNode,"keyup",this.onKeyUp.bind(this));BX.bind(this.inputNode,"blur",this.endEdit.bind(this));this.isInit=true;if(!t.disabled){this.enable()}if(!this.dataNode.value){this.dataNode.value=this.defaultTitle}},enable:function(t){t=t||false;if(!this.isInit){return}this.changeDisplay(this.buttonNode,!t);this.titleNode.textContent=!t?this.dataNode.value?this.dataNode.value:this.defaultTitle:this.initialTitle},disable:function(){this.enable(true)},onDataNodeChange:function(){this.titleNode.textContent=this.dataNode.value},onKeyUp:function(t){t=t||window.event;if(t.keyCode===10||t.keyCode===13){this.endEdit();t.preventDefault();return false}},getTitle:function(){var t=this.dataNode.value;if(!t){t=this.titleNode.textContent}return t},startEdit:function(){this.inputNode.value=this.getTitle();this.changeDisplay(this.titleNode,false);this.changeDisplay(this.buttonNode,false);this.changeDisplay(this.inputNode,true);this.inputNode.focus()},endEdit:function(){this.dataNode.value=this.inputNode.value;this.titleNode.textContent=this.inputNode.value;this.changeDisplay(this.inputNode,false);this.changeDisplay(this.buttonNode,true);this.changeDisplay(this.titleNode,true)},changeDisplay:function(t,e){return t.style.display=e?"":"none"}};BX.UI.SidePanel.Wrapper=new t})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:84:"/bitrix/components/bitrix/ui.toolbar/templates/.default/script.min.js?16992580966985";s:6:"source";s:65:"/bitrix/components/bitrix/ui.toolbar/templates/.default/script.js";s:3:"min";s:69:"/bitrix/components/bitrix/ui.toolbar/templates/.default/script.min.js";s:3:"map";s:69:"/bitrix/components/bitrix/ui.toolbar/templates/.default/script.map.js";}"*/
(function(){"use strict";BX.namespace("BX.UI");BX.UI.ToolbarManager={toolbars:{},create:function(t){var e=new BX.UI.Toolbar(t);if(this.get(e.getId())){throw new Error("The toolbar instance with the same 'id' already exists.")}this.toolbars[e.getId()]=e;return e},getDefaultToolbar:function(){return this.get("default-toolbar")},get:function(t){return t in this.toolbars?this.toolbars[t]:null}};BX.UI.Toolbar=function(t){t=BX.type.isPlainObject(t)?t:{};this.titleMinWidth=BX.type.isNumber(t.titleMinWidth)?t.titleMinWidth:158;this.titleMaxWidth=BX.type.isNumber(t.titleMaxWidth)?t.titleMaxWidth:"";this.filterMinWidth=BX.type.isNumber(t.filterMinWidth)?t.filterMinWidth:300;this.filterMaxWidth=BX.type.isNumber(t.filterMaxWidth)?t.filterMaxWidth:748;this.id=BX.Type.isStringFilled(t.id)?t.id:BX.Text.getRandom();this.toolbarContainer=t.target;if(!BX.Type.isDomNode(this.toolbarContainer)){throw new Error('BX.UI.Toolbar: "target" parameter is required.')}this.titleContainer=this.toolbarContainer.querySelector(".ui-toolbar-title-box");this.filterContainer=this.toolbarContainer.querySelector(".ui-toolbar-filter-box");this.filterButtons=this.toolbarContainer.querySelector(".ui-toolbar-filter-buttons");this.rightButtons=this.toolbarContainer.querySelector(".ui-toolbar-right-buttons");this.afterTitleButtons=this.toolbarContainer.querySelector(".ui-toolbar-after-title-buttons");if(!this.filterContainer){this.filterMinWidth=0;this.filterMaxWidth=0}this.buttons=Object.create(null);this.buttonIds=BX.Type.isArray(t.buttonIds)?t.buttonIds:[];if(!this.buttonIds.length){return}this.buttonIds.forEach(function(t){var e=BX.UI.ButtonManager.createByUniqId(t);if(e){e.getContainer().originalWidth=e.getContainer().offsetWidth;if(!e.getIcon()&&!BX.Type.isStringFilled(e.getDataSet()["toolbarCollapsedIcon"])){if(e.getColor()===BX.UI.ButtonColor.PRIMARY){e.setDataSet({toolbarCollapsedIcon:BX.UI.ButtonIcon.ADD})}else{console.warn('BX.UI.Toolbar: the button "'+e.getText()+'" '+"doesn't have an icon for collapsed mode. "+'Use the "data-toolbar-collapsed-icon" attribute.')}}this.buttons[t]=e}else{console.warn('BX.UI.Toolbar: the button "'+t+"\" wasn't initialized.")}},this);this.windowWidth=document.body.offsetWidth;this.reduceItemsWidth();window.addEventListener("resize",function(){if(this.isWindowIncreased()){this.increaseItemsWidth()}else{this.reduceItemsWidth()}}.bind(this))};BX.UI.Toolbar.prototype={getButtons:function(){return this.buttons},getButton:function(t){return t in this.buttons?this.buttons[t]:null},getId:function(){return this.id},isWindowIncreased:function(){var t=this.windowWidth;var e=document.body.offsetWidth;this.windowWidth=e;return e>t},getContainerSize:function(){return this.toolbarContainer.offsetWidth},getInnerTotalWidth:function(){return this.toolbarContainer.scrollWidth},reduceItemsWidth:function(){if(this.getInnerTotalWidth()<=this.getContainerSize()){return}var t=Object.values(this.getButtons());for(var e=t.length-1;e>=0;e--){var i=t[e];if(!i.getIcon()&&!BX.Type.isStringFilled(i.getDataSet()["toolbarCollapsedIcon"])){continue}if(i.isCollapsed()){continue}i.setCollapsed(true);if(!i.getIcon()){i.setIcon(i.getDataSet()["toolbarCollapsedIcon"])}if(this.getInnerTotalWidth()<=this.getContainerSize()){return}}},increaseItemsWidth:function(){var t=Object.values(this.getButtons());for(var e=0;e<t.length;e++){var i=t[e];var o=i.getContainer();if(!i.isCollapsed()){continue}var n=this.titleMinWidth+this.filterMinWidth+(this.afterTitleButtons?this.afterTitleButtons.offsetWidth:0)+(this.filterButtons?this.filterButtons.offsetWidth:0)+(this.rightButtons?this.rightButtons.offsetWidth:0)+(o.originalWidth-o.offsetWidth);if(n>this.getContainerSize()){break}i.setCollapsed(false);if(i.getIcon()===i.getDataSet()["toolbarCollapsedIcon"]){i.setIcon(null)}}}};BX.UI.Toolbar.Star=function(){this.initialized=false;this.currentPageInMenu=false;this.starContNode=null;BX.ready(function(){this.init()}.bind(this));BX.addCustomEvent("onFrameDataProcessed",function(){this.init()}.bind(this))};BX.UI.Toolbar.Star.prototype={init:function(){this.starContNode=document.getElementById("uiToolbarStar");if(!this.starContNode){return false}if(this.initialized){return false}this.initialized=true;var t=this.starContNode.getAttribute("data-bx-url");if(!BX.type.isNotEmptyString(t)){t=document.location.pathname+document.location.search}t=BX.Uri.removeParam(t,["IFRAME","IFRAME_TYPE"]);top.BX.addCustomEvent("BX.Bitrix24.LeftMenuClass:onSendMenuItemData",function(t){this.processMenuItemData(t)}.bind(this));top.BX.addCustomEvent("BX.Bitrix24.LeftMenuClass:onStandardItemChangedSuccess",function(t){this.onStandardItemChangedSuccess(t)}.bind(this));top.BX.onCustomEvent("UI.Toolbar:onRequestMenuItemData",[{currentFullPath:t,context:window}]);return true},processMenuItemData:function(t){if(t.context&&t.context!==window){return}this.currentPageInMenu=t.currentPageInMenu;if(BX.type.isNotEmptyObject(t.currentPageInMenu)){BX.addClass(this.starContNode,"ui-toolbar-star-active")}this.starContNode.title=BX.message(this.starContNode.classList.contains("ui-toolbar-star-active")?"UI_TOOLBAR_DELETE_PAGE_FROM_LEFT_MENU":"UI_TOOLBAR_ADD_PAGE_TO_LEFT_MENU");if(BX.type.isDomNode(this.currentPageInMenu)&&this.currentPageInMenu.getAttribute("data-type")!=="standard"){this.starContNode.title=BX.message("UI_TOOLBAR_STAR_TITLE_DEFAULT_PAGE");BX.bind(this.starContNode,"click",function(){this.showMessage(BX.message("UI_TOOLBAR_STAR_TITLE_DEFAULT_PAGE_DELETE_ERROR"))}.bind(this));return true}BX.bind(this.starContNode,"click",function(){var t=document.getElementById("pagetitle").innerText;var e=this.starContNode.getAttribute("data-bx-title-template");if(BX.type.isNotEmptyString(e)){t=e.replace(/#page_title#/i,t)}var i=this.starContNode.getAttribute("data-bx-url");if(!BX.type.isNotEmptyString(i)){i=document.location.pathname+document.location.search}i=BX.Uri.removeParam(i,["IFRAME","IFRAME_TYPE"]);top.BX.onCustomEvent("UI.Toolbar:onStarClick",[{isActive:BX.hasClass(this.starContNode,"ui-toolbar-star-active"),context:window,pageTitle:t,pageLink:i}])}.bind(this))},onStandardItemChangedSuccess:function(t){if(!BX.type.isBoolean(t.isActive)||!this.starContNode){return}if(t.context&&t.context!==window){return}if(t.isActive){this.showMessage(BX.message("UI_TOOLBAR_ITEM_WAS_ADDED_TO_LEFT"));this.starContNode.title=BX.message("UI_TOOLBAR_DELETE_PAGE_FROM_LEFT_MENU");BX.addClass(this.starContNode,"ui-toolbar-star-active")}else{this.showMessage(BX.message("UI_TOOLBAR_ITEM_WAS_DELETED_FROM_LEFT"));this.starContNode.title=BX.message("UI_TOOLBAR_ADD_PAGE_TO_LEFT_MENU");BX.removeClass(this.starContNode,"ui-toolbar-star-active")}},showMessage:function(t){var e=BX.PopupWindowManager.create("left-menu-message",this.starContNode,{content:t,darkMode:true,offsetTop:2,offsetLeft:0,angle:true,events:{onPopupClose:function(){if(e){e.destroy();e=null}}},autoHide:true});e.show();setTimeout(function(){if(e){e.destroy();e=null}},3e3)}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:92:"/bitrix/components/bitrix/mail.client.config/templates/.default/script.min.js?16992580301659";s:6:"source";s:73:"/bitrix/components/bitrix/mail.client.config/templates/.default/script.js";s:3:"min";s:77:"/bitrix/components/bitrix/mail.client.config/templates/.default/script.min.js";s:3:"map";s:77:"/bitrix/components/bitrix/mail.client.config/templates/.default/script.map.js";}"*/
BX.namespace("BX.MailClientConfig");BX.MailClientConfig.Edit={isForbiddenToShare:false,init:function(e){if(BX.type.isNotEmptyObject(e)){this.isForbiddenToShare=e.isForbiddenToShare||false}var i=BX.findChildrenByClassName(document,"mail-set-singleselect",true);for(var t in i){if(!i.hasOwnProperty(t)){continue}this.singleselect(i[t])}BX.bind(BX("mail_connect_mb_crm_new_lead_for_link"),"click",function(e){var i=BX("mail_connect_mb_crm_new_lead_for");var t=i.offsetHeight>0;i.style.display=t?"none":"";BX[t?"removeClass":"addClass"](this,"mail-set-textarea-show-open")})},singleselect:function(e){var i=BX.findChildren(e,{tag:"input",attr:{type:"radio"}},true);for(var t in i){if(!i.hasOwnProperty(t)){continue}BX.bind(i[t],"change",function(){if(this.checked){if(this.value==0){var i=BX(e.getAttribute("data-checked"));if(i){var t=BX.findNextSibling(this,{tag:"label",attr:{for:this.id}});var n=BX.findNextSibling(i,{tag:"label",attr:{for:i.id}});if(t&&n)BX.adjust(t,{text:n.innerHTML})}}else{e.setAttribute("data-checked",this.id)}}})}BX.bind(e,"click",function(i){i=i||window.event;i.skip_singleselect=e});BX.bind(document,"click",function(i){i=i||window.event;if(i.skip_singleselect!==e){BX(e.getAttribute("data-checked")).checked=true}})},beforeOpenDialog:function(){return new Promise(function(e,i){if(BX.MailClientConfig.Edit.isForbiddenToShare){BX.MailClientConfig.Edit.alertForbiddenToShare();return i()}return e()})},alertForbiddenToShare:function(){B24.licenseInfoPopup.show("mail-shared-mailbox-limit",BX.message("MAIL_MAILBOX_LICENSE_SHARED_LIMIT_TITLE"),BX.message("MAIL_MAILBOX_LICENSE_SHARED_LIMIT_BODY"))}};
/* End */
;; /* /bitrix/components/bitrix/mail.client/templates/.default/script.min.js?169925803019042*/
; /* /bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.min.js?16992580965071*/
; /* /bitrix/components/bitrix/ui.toolbar/templates/.default/script.min.js?16992580966985*/
; /* /bitrix/components/bitrix/mail.client.config/templates/.default/script.min.js?16992580301659*/

//# sourceMappingURL=page_0017e9445697f88ffa26e2a8b7791369.map.js