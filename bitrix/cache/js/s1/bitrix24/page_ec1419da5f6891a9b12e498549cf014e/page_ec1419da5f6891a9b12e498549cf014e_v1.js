
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js?16992580712527";s:6:"source";s:78:"/bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
var waitDiv = null;
var waitPopup = null;
var waitTimeout = null;
var waitTime = 500;

function __SASSetAdmin()
{
	__SASShowWait();
	BX.ajax({
		url: '/bitrix/components/bitrix/socialnetwork.admin.set/ajax.php',
		method: 'POST',
		dataType: 'json',
		data: {'ACTION': 'SET', 'sessid': BX.bitrix_sessid(), 'site': BX.util.urlencode(BX.message('SASSiteId'))},
		onsuccess: function(data) { __SASProcessAJAXResponse(data); }
	});
}

function __SASProcessAJAXResponse(data)
{
	if (data["SUCCESS"] != "undefined" && data["SUCCESS"] == "Y")
	{
		BX.reload();
		return false;
	}
	else if (data["ERROR"] != "undefined" && data["ERROR"].length > 0)
	{
		if (data["ERROR"].indexOf("SESSION_ERROR", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorSessionWrong'));
			BX.reload();
		}
		else if (data["ERROR"].indexOf("CURRENT_USER_NOT_ADMIN", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorNotAdmin'));
			return false;
		}
		else if (data["ERROR"].indexOf("CURRENT_USER_NOT_AUTH", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorCurrentUserNotAuthorized'));
			return false;
		}
		else if (data["ERROR"].indexOf("SONET_MODULE_NOT_INSTALLED", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorModuleNotInstalled'));
			return false;
		}
		else
		{
			__SASShowError(data["ERROR"]);
			return false;		
		}
	}
}
				
function __SASShowError(errorText) 
{
	__SASCloseWait();

	var errorPopup = new BX.PopupWindow('sas-error' + Math.random(), window, {
		autoHide: true,
		lightShadow: false,
		zIndex: 2,
		content: BX.create('DIV', {props: {'className': 'sonet-adminset-error-text-block'}, html: errorText}),
		closeByEsc: true,
		closeIcon: true
	});
	errorPopup.show();

}

function __SASShowWait(timeout)
{
	if (timeout !== 0)
	{
		return (waitTimeout = setTimeout(function(){
			__SASShowWait(0)
		}, 50));
	}

	if (!waitPopup)
	{
		waitPopup = new BX.PopupWindow('sas_wait', window, {
			autoHide: true,
			lightShadow: true,
			zIndex: 2,
			content: BX.create('DIV', {
				props: {
					className: 'sonet-adminset-wait-cont'
				},
				children: [
					BX.create('DIV', {
						props: {
							className: 'sonet-adminset-wait-icon'
						}
					}),
					BX.create('DIV', {
						props: {
							className: 'sonet-adminset-wait-text'
						},
						html: BX.message('SASWaitTitle')
					})
				]
			})
		});
	}
	else
		waitPopup.setBindElement(window);

	waitPopup.show();
}

function __SASCloseWait()
{
	if (waitTimeout)
	{
		clearTimeout(waitTimeout);
		waitTimeout = null;
	}

	if (waitPopup)
		waitPopup.close();
}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/disk.file.view/templates/.default/script.min.js?169925797415822";s:6:"source";s:69:"/bitrix/components/bitrix/disk.file.view/templates/.default/script.js";s:3:"min";s:73:"/bitrix/components/bitrix/disk.file.view/templates/.default/script.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/disk.file.view/templates/.default/script.map.js";}"*/
BX.namespace("BX.Disk");BX.Disk.FileViewClass=function(){var e=false;var t=false;var i=function(e){this.componentName=e.componentName;this.signedParameters=e.signedParameters;this.selectorId=e.selectorId;this.object=e.object||{};this.uf=e.uf||{};this.canDelete=!!e.canDelete;if(e.externalLinkInfo){this.buildExternalLinkByState(e.externalLinkInfo)}this.layout=e.layout;this.urls=e.urls;this.gridId=e.gridId;this.grid=this.gridId?BX.Main.gridManager.getById(this.gridId):null;this.ajaxUrl="/bitrix/components/bitrix/disk.file.view/ajax.php";this.ajaxCurrentPageUrl=document.location.href;this.popupOuterLink=null;this.selectorInitialized=false;if(!e.withoutEventBinding)this.setEvents();this.render();this.workWithLocationHash();BX.ajax.runAction("disk.api.file.showSharingEntities",{analyticsLabel:"file.view",data:{fileId:this.object.id}}).then(function(e){if(BX.type.isArray(e.data)){e.data.forEach(function(e){var t=new BX.Disk.Model.SharingItem({state:{entity:e.entity,sharing:e.sharing,object:{id:this.object.id}}});t.render();document.querySelector(".disk-detail-sidebar-user-access-section").appendChild(t.getContainer());var i=BX.UI.SelectorManager.instances[this.selectorId];if(i){i.itemsSelected[e.entity.id]=BX.UI.SelectorManager.convertEntityType(e.entity.type)}BX.onCustomEvent("Disk.FileView:onShowSharingEntities",[{id:this.selectorId,openDialogWhenInit:false}]);this.selectorInitialized=true}.bind(this))}}.bind(this))};i.prototype.buildExternalLinkByState=function(e){this.externalLink=new BX.Disk.Model.ExternalLink.Input({state:e,data:{objectId:this.object.id},models:{externalLinkSettings:new BX.Disk.Model.ExternalLink.Settings({state:e}),externalLinkDescription:new BX.Disk.Model.ExternalLink.Description({state:e})}})};i.prototype.setUrlToAjaxCurrentPage=function(e){this.ajaxCurrentPageUrl=e};i.prototype.getUrlToAjaxCurrentPage=function(){return this.ajaxCurrentPageUrl.replace(document.location.hash,"")};i.prototype.render=function(){if(this.externalLink&&this.layout.externalLink){this.externalLink.render();this.layout.externalLink.parentNode.replaceChild(this.externalLink.getContainer(),this.layout.externalLink);this.adjustExternalLinkBlockHeight()}};i.prototype.setEvents=function(){BX.bind(BX("disk-detail-sidebar-public-link-copy-link"),"click",this.copyInternalLink.bind(this));if(this.layout.deleteButton){BX.bind(this.layout.deleteButton,"click",this.openDeleteConfirm.bind(this))}if(this.layout.restoreButton){BX.bind(this.layout.restoreButton,"click",this.openConfirmRestoreFromTrash.bind(this))}if(this.layout.addSharingButton){BX.bind(this.layout.addSharingButton,"click",this.openSelector.bind(this))}if(this.layout.editUf){BX.bind(this.layout.editUf,"click",this.editUf.bind(this))}BX.bind(this.layout.moreActionsButton,"click",this.openFileActions.bind(this));BX.bind(window,"popstate",this.onPopState.bind(this));BX.addCustomEvent("onIframeElementLoadDataToView",BX.proxy(this.onIframeElementLoadDataToView,this));BX.addCustomEvent("onIframeElementConverted",BX.proxy(this.onIframeElementConverted,this));BX.addCustomEvent("onBeforeElementShow",BX.proxy(this.onBeforeElementShow,this));BX.addCustomEvent(this.externalLink.externalLinkDescription,"Disk.Model.Item:afterRender",this.handleAfterRenderExternalLinkSettings.bind(this));BX.addCustomEvent("SidePanel.Slider:onMessage",this.onSliderMessage.bind(this));BX.addCustomEvent("onPopupFileUploadClose",this.onPopupFileUploadClose.bind(this));if(!!this.uf){BX.bind(this.uf.editButton,"click",BX.delegate(this.onClickEditUfButton,this))}};i.prototype.onSliderMessage=function(e){var t=e.getData();if(e.getEventId()==="Disk.File:onRestoredFromVersion"||e.getEventId()==="Disk.Version:onDeleted"||e.getEventId()==="Disk.OnlyOffice:onSaved"){window.location.reload()}if(e.getEventId()==="Disk.File:onNewVersionUploaded"){if(e.getData().object.id==this.object.id){window.location.reload()}}if(e.getEventId()==="Disk.File.Uf:onUpdated"){this.reloadUf()}};i.prototype.onPopupFileUploadClose=function(e,t){if(t==this.object.id){document.location.reload()}};i.prototype.onBeforeElementShow=function(e,t,i){if(t.hasOwnProperty("image")||!BX.message("disk_restriction")){return}i.prevent=true;BX.PopupWindowManager.create("bx-disk-business-tools-info",null,{content:BX("bx-bitrix24-business-tools-info"),closeIcon:true,onPopupClose:function(){this.destroy()},autoHide:true,zIndex:11e3}).show()};i.prototype.handleAfterRenderExternalLinkSettings=function(){this.adjustExternalLinkBlockHeight()};i.prototype.onIframeElementConverted=function(e,t,i){this.setUrlToAjaxCurrentPage(this.ajaxCurrentPageUrl.replace(encodeURIComponent(i),encodeURIComponent(t)))};i.prototype.onIframeElementLoadDataToView=function(e,t){if(t&&t.status==="restriction"&&BX("bx-bitrix24-business-tools-info")){setTimeout(function(){if(BX.CViewer&&BX.CViewer.objNowInShow){if(e.currentModalWindow){e.currentModalWindow.close()}BX.CViewer.objNowInShow.close()}},100);BX.PopupWindowManager.create("bx-disk-business-tools-info",null,{content:BX("bx-bitrix24-business-tools-info"),closeIcon:true,onPopupClose:function(){this.destroy()},autoHide:true,zIndex:11e3}).show()}};i.prototype.onClickEditUfButton=function(e){BX.PreventDefault(e);BX.Disk.ajax({url:BX.Disk.addToLinkParam(document.location.href.replace(document.location.hash,""),"action","editUserField"),method:"POST",dataType:"html",data:{},onsuccess:BX.delegate(function(e){var t=BX.findChild(this.uf.contentContainer,{className:"bx-disk-uf-show-content"});var i=BX.findChild(this.uf.contentContainer,{className:"bx-disk-uf-edit-content"});if(t){BX.hide(t)}BX.adjust(i,{html:e})},this)})};i.prototype.openConfirmRestoreFromTrash=function(){var e=this.object.name;var t=this.object.id;var i=BX.message("DISK_FILE_TRASH_RESTORE_FILE_CONFIRM_1");var o=[new BX.PopupWindowButton({text:BX.message("DISK_FILE_VIEW_FILE_RESTORE"),className:"popup-window-button-accept",events:{click:function(e){this.addClassName("popup-window-button-wait");BX.ajax.runAction("disk.api.file.restore",{analyticsLabel:"file.view",data:{fileId:t}}).then(function(e){BX.PopupWindowManager.getCurrentPopup().close();var i=BX.SidePanel.Instance.getSliderByWindow(window);if(i){i.close();BX.SidePanel.Instance.postMessageAll(window,"Disk.File:onRestore",{objectId:t})}else if(e.data.file.id){document.location.href=BX.Disk.getUrlToShowObjectInGrid(e.data.ID)}})}}}),new BX.PopupWindowButton({text:BX.message("DISK_FILE_VIEW_VERSION_CANCEL_BUTTON"),events:{click:function(e){BX.PopupWindowManager.getCurrentPopup().close()}}})];BX.Disk.modalWindow({modalId:"bx-link-unlink-confirm",title:BX.message("DISK_FILE_TRASHCAN_TRASH_RESTORE_TITLE"),contentClassName:"tac",contentStyle:{paddingTop:"70px",paddingBottom:"70px"},content:i.replace("#NAME#",e),buttons:o})};i.prototype.openConfirmRestore=function(e){var t=e.object.name;var i=e.object.id;var o=e.version.id;var n=BX.message("DISK_FILE_VIEW_VERSION_RESTORE_CONFIRM_1");var s=[new BX.PopupWindowButton({text:BX.message("DISK_FILE_VIEW_VERSION_RESTORE_BUTTON"),className:"popup-window-button-accept",events:{click:BX.delegate(function(e){BX.PopupWindowManager.getCurrentPopup().close();BX.PreventDefault(e);BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","restoreFromVersion"),data:{objectId:i,versionId:o},onsuccess:BX.delegate(function(e){if(!e){return}this.grid.instance.reload();BX.Disk.showModalWithStatusAction(e)},this)});return false},this)}}),new BX.PopupWindowButton({text:BX.message("DISK_FILE_VIEW_VERSION_CANCEL_BUTTON"),events:{click:function(e){BX.PopupWindowManager.getCurrentPopup().close();BX.PreventDefault(e);return false}}})];BX.Disk.modalWindow({modalId:"bx-link-unlink-confirm",title:BX.message("DISK_FILE_VIEW_VERSION_RESTORE_TITLE"),contentClassName:"tac",contentStyle:{paddingTop:"70px",paddingBottom:"70px"},content:n.replace("#NAME#",t),buttons:s})};i.prototype.openDeleteConfirm=function(){var e=this.object.name;var t=this.object.id;var i=this.canDelete?BX.message("DISK_FILE_VIEW_TRASH_DELETE_DESTROY_FILE_CONFIRM"):BX.message("DISK_FILE_VIEW_TRASH_DELETE_FILE_CONFIRM");if(this.object.isDeleted){i=BX.message("DISK_FILE_VIEW_TRASH_DELETE_DESTROY_DELETED_FILE_CONFIRM")}var o=[];if(!this.object.isDeleted){o.push(new BX.PopupWindowCustomButton({text:BX.message("DISK_FILE_VIEW_TRASH_DELETE_BUTTON"),className:"ui-btn ui-btn-success",events:{click:function(e){this.addClassName("ui-btn-clock");BX.ajax.runAction("disk.api.file.markDeleted",{analyticsLabel:"file.view",data:{fileId:t}}).then(function(e){BX.PopupWindowManager.getCurrentPopup().close();var i=BX.SidePanel.Instance.getSliderByWindow(window);if(i){i.close();BX.SidePanel.Instance.postMessageAll(window,"Disk.File:onMarkDeleted",{objectId:t})}})}}}))}if(this.canDelete){var n=this;o.push(new BX.PopupWindowCustomButton({text:BX.message("DISK_FILE_VIEW_TRASH_DESTROY_BUTTON"),className:"ui-btn ui-btn-light-border",events:{click:function(e){this.addClassName("ui-btn-clock");BX.ajax.runAction("disk.api.file.delete",{analyticsLabel:"file.view",data:{fileId:t}}).then(function(e){BX.PopupWindowManager.getCurrentPopup().close();var i=BX.SidePanel.Instance.getSliderByWindow(window);if(i){i.close();BX.SidePanel.Instance.postMessageAll(window,"Disk.File:onDelete",{objectId:t})}else{document.location.href=n.urls.trashcanList}})}}}))}o.push(new BX.PopupWindowCustomButton({text:BX.message("DISK_FILE_VIEW_VERSION_CANCEL_BUTTON"),className:"ui-btn ui-btn-link",events:{click:function(e){BX.PopupWindowManager.getCurrentPopup().close()}}}));BX.Disk.modalWindow({modalId:"bx-link-unlink-confirm",title:BX.message("DISK_FILE_VIEW_VERSION_DELETE_TITLE"),contentClassName:"disk-popup-text-content",content:i.replace("#NAME#",e),buttons:o})};i.prototype.openConfirmDeleteVersion=function(e){var t=e.object.name;var i=e.object.id;var o=e.version.id;var n=BX.message("DISK_FILE_VIEW_VERSION_DELETE_VERSION_CONFIRM");var s=[new BX.PopupWindowButton({text:BX.message("DISK_FILE_VIEW_VERSION_DELETE_VERSION_BUTTON"),className:"popup-window-button-accept",events:{click:BX.delegate(function(e){BX.PopupWindowManager.getCurrentPopup().close();BX.PreventDefault(e);BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","deleteVersion"),data:{objectId:i,versionId:o},onsuccess:BX.delegate(function(e){if(!e){return}this.grid.instance.removeRow(o);BX.Disk.showModalWithStatusAction(e)},this)});return false},this)}}),new BX.PopupWindowButton({text:BX.message("DISK_FILE_VIEW_VERSION_CANCEL_BUTTON"),events:{click:function(e){BX.PopupWindowManager.getCurrentPopup().close();BX.PreventDefault(e);return false}}})];BX.Disk.modalWindow({modalId:"bx-link-unlink-confirm",title:BX.message("DISK_FILE_VIEW_VERSION_DELETE_VERSION_TITLE"),contentClassName:"tac",contentStyle:{paddingTop:"70px",paddingBottom:"70px"},content:n.replace("#NAME#",t),buttons:s})};i.prototype.deleteBizProc=function(e){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","deleteBizProc"),data:{idBizProc:e,fileId:this.object.id},onsuccess:BX.delegate(function(t){if(t){BX.remove(BX(e))}},this)})};i.prototype.stopBizProc=function(e){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","stopBizProc"),data:{idBizProc:e,fileId:this.object.id},onsuccess:BX.delegate(function(e){if(e.status=="success"){var t=document.location.href.replace("#tab-bp","");t+="#tab-bp";document.location.href=t;location.reload()}else{e.errors=e.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:e.errors.pop().message})}},this)})};i.prototype.openSlider=function(e){BX.SidePanel.Instance.open(e,{allowChangeHistory:false})};i.prototype.showLogBizProc=function(e){this.openSlider(BX.Disk.addToLinkParam(this.urls.fileShowBp,"log_workflow",e))};i.prototype.sortBizProcLog=function(){var e=BX.findChildByClassName(BX("workarea-content"),"bx-sortable").getAttribute("onclick").replace("log_sort=1&","");e=e.replace("?log_workflow","?log_sort=1&log_workflow");e=e.replace("&action=showBp","");BX.findChildByClassName(BX("workarea-content"),"bx-sortable").setAttribute("onclick",e)};i.prototype.fixUrlForSort=function(){var e=document.location.href.replace("&log_sort=1","");e+="#tab-bp";document.location.href=e};i.prototype.copyInternalLink=function(){var e=BX("disk-detail-sidebar-public-link-copy-link");var t=e.getAttribute("for");var i=document.getElementById(t);i.select();document.execCommand("copy");this.popupOuterLink?null:this.showCopyLinkPopup(e,BX.message("DISK_FILE_VIEW_INTERNAL_LINK_COPIED"))};i.prototype.showCopyLinkPopup=function(e,t){this.popupOuterLink=new BX.PopupWindow("disk-popup-copy-link",e,{className:"disk-popup-copy-link",bindPosition:{position:"top"},offsetLeft:-10,darkMode:true,angle:true,content:t});this.popupOuterLink.show();setTimeout(function(){BX.addClass(BX(this.popupOuterLink.uniquePopupId),"disk-popup-copy-link-hide")}.bind(this),2e3);setTimeout(function(){this.popupOuterLink.destroy();this.popupOuterLink=null}.bind(this),2200)};i.prototype.adjustExternalLinkBlockHeight=function(){this.externalLink.adjustHeight()};i.prototype.onPopState=function(e){var t=e.state;if(t&&t.disk){window.location.reload()}};i.prototype.openFileActions=function(e){var t=BX.getEventTarget(e);var i=this;var o=[{text:BX.message("DISK_FILE_VIEW_FILE_GO_TO_HISTORY"),onclick:function(){if(i.object.isHistoryBlocked){top.BX.UI.InfoHelper.show("limit_office_version_storage")}else{BX.SidePanel.Instance.open(i.urls.fileHistory)}this.close()}}];if(this.object.hasUf){o.push({text:BX.message("DISK_FILE_VIEW_FILE_GO_TO_SHOW_USERFIELDS"),onclick:function(){BX.SidePanel.Instance.open(i.urls.fileShowUf,{allowChangeHistory:false});this.close()}})}if(this.object.hasBp){o.push({text:BX.message("DISK_FILE_VIEW_FILE_GO_TO_SHOW_BP"),onclick:function(){BX.SidePanel.Instance.open(i.urls.fileShowBp,{allowChangeHistory:false});this.close()}})}BX.PopupMenu.show("disk-file-view-actions",BX(t),o,{className:"disk-file-view-actions-popup",angle:true,autoHide:true,offsetLeft:20,overlay:{opacity:.01},events:{onPopupClose:function(){BX.PopupMenu.destroy("disk-file-view-actions")}}})};i.prototype.editUf=function(){BX.SidePanel.Instance.open(this.urls.fileEditUf,{allowChangeHistory:false})};i.prototype.reloadUf=function(){BX.ajax.runComponentAction("bitrix:disk.file.view","showUfSidebar",{mode:"class",data:{fileId:this.object.id}}).then(function(e){BX.cleanNode(this.layout.sidebarUfValuesSection);this.layout.sidebarUfValuesSection.innerHTML=e.data.html}.bind(this))};i.prototype.openSelector=function(){if(!this.selectorInitialized){BX.onCustomEvent("Disk.FileView:onShowSharingEntities",[{id:this.selectorId,openDialogWhenInit:true}]);this.selectorInitialized=true}else{BX.onCustomEvent("Disk.FileView:openSelector",[{id:this.selectorId}])}};i.prototype.onUnSelectSelectorItem=function(e){BX.onCustomEvent("Disk.FileView:onUnSelectSelectorItem",[e])};i.prototype.onSelectSelectorItem=function(e){if(e.state!=="select")return;BX.Main.selectorManagerV2.getById(this.selectorId).closeDialog();var t=new BX.Disk.Model.DraftSharingItem({state:{entity:{id:e.item.id,name:e.item.name,link:e.item.link,avatar:e.item.avatar},object:{id:this.object.id}}});t.render();t.save();document.querySelector(".disk-detail-sidebar-user-access-section").appendChild(t.getContainer())};i.prototype.workWithLocationHash=function(){setTimeout(BX.delegate(function(){this.onHashChange()},this),350)};i.prototype.onHashChange=function(){var e=document.location.hash.match(/hl-([0-9]+)/g);if(e){var t=(document.location.hash.match(/!([a-zA-Z]+)/g)||[]).pop();for(var i in e){if(!e.hasOwnProperty(i)){continue}var o=e[i];var n=o.match(/hl-([0-9]+)/);if(n&&n[1]&&t){switch(t.toLowerCase()){case"!history":this.openSlider(this.urls.fileHistory);break}}}}};return i}();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:91:"/bitrix/components/bitrix/disk.file.upload/templates/.default/script.min.js?169925797417682";s:6:"source";s:71:"/bitrix/components/bitrix/disk.file.upload/templates/.default/script.js";s:3:"min";s:75:"/bitrix/components/bitrix/disk.file.upload/templates/.default/script.min.js";s:3:"map";s:75:"/bitrix/components/bitrix/disk.file.upload/templates/.default/script.map.js";}"*/
(function(){if(BX.DiskUpload)return;var e=[];BX.DiskUpload=function(e){this.bp=e["bp"];this.bpParameters=e["bpParameters"];this.bpParametersRequired=e["bpParametersRequired"];this.storageId=e["storageId"];this.ajaxUrl="/bitrix/components/bitrix/disk.folder.list/ajax.php";this.CID=e["CID"];this.nodeContent=BX.create("DIV",{style:{display:"none"},attrs:{id:e["CID"]+"ContentNode"},html:BX.message("DFU_TEMPLATE").replace(/#id#/gi,this.CID)+'<div class="wduf-uploader area">'+BX.message("DFU_DND_TEMPLATE")+"</div>"});document.body.appendChild(this.nodeContent);this.counter={all:[],uploaded:[],uploading:[]};this.init(e);return this};BX.DiskUpload.prototype={_camelToSNAKE:function(e){var t={},i,s;for(i in e){if(e.hasOwnProperty(i)){s=i.replace(/(.)([A-Z])/g,"$1_$2").toUpperCase();t[s]=e[i];t[i]=e[i]}}return t},initAttempt:0,init:function(e){this.initAttempt++;if(this.initAttempt>10||this.agent)return;this.placeHolder=BX(this.CID+"PlaceHolder");if(this.placeHolder){this.templates={new:BX.message("DFU_NODE_TEMPLATE"),done:BX.message("DFU_NODE_TEMPLATE_DONE"),canceled:BX.message("DFU_NODE_TEMPLATE_CANCELED"),error:BX.message("DFU_NODE_TEMPLATE_ERROR"),error_double:BX.message("DFU_NODE_TEMPLATE_ERROR_DOUBLE")};var t,i,s,r,o,a;for(t in this.templates){r={};if(this.templates.hasOwnProperty(t)){i=this.templates[t];if(/^<tr(.*?)>/gi.test(i)){s=/^<tr(.*?)>/gi.exec(i);s=s[1].split(" ");if(s&&s.length>0){for(o=0;o<s.length;o++){a=s[o].split("=");if(a&&a.length==2){a[0]=a[0].replace(/['"]/gi,"");a[1]=a[1].replace(/['"]/gi,"");r[a[0]]=a[1]}}}}this.templates[t]={node:"TR",attrs:r,text:i.replace(/^<tr(.*?)>/i,"").replace(/<\/tr>$/i,"")}}}this.agent=BX.Uploader.getInstance({id:this.CID,streams:1,allowUpload:"A",uploadFormData:"Y",uploadMethod:this.bp?this.bpParameters?"deferred":"immediate":"immediate",uploadFileUrl:e["urlUpload"],showImage:false,sortItems:false,input:e["input"],dropZone:e["dropZone"],placeHolder:this.placeHolder,phpMaxFileUploads:1,queueFields:{thumb:{tagName:"TR",className:"bxu-item"}},fields:{thumb:{tagName:"",template:this.templates["new"].text}}});this._onItemIsAdded=BX.delegate(this.onItemIsAdded,this);this._onFileIsInited=BX.delegate(this.onFileIsInited,this);this._onStart=BX.delegate(this.onStart,this);this._onError=BX.delegate(this.onError,this);if(BX(this.agent.fileInput)&&!this.agent.fileInput.hasAttribute("id"))this.agent.fileInput.setAttribute("id","diskUbloadFileInput"+this.CID);BX.addCustomEvent(this.agent,"onItemIsAdded",this._onItemIsAdded);BX.addCustomEvent(this.agent,"onFileIsInited",this._onFileIsInited);BX.addCustomEvent(this.agent,"onStart",this._onStart);BX.addCustomEvent(this.agent,"onError",this._onError);BX.addCustomEvent("Disk.Page:onChangeFolder",function(e,t){this.changeTargetFolderId(t.id)}.bind(this));this._onFileIsAppended=BX.delegate(this.onFileIsAppended,this);this._onUploadStart=BX.delegate(this.onUploadStart,this);this._onUploadProgress=BX.delegate(this.onUploadProgress,this);this._onUploadDone=BX.delegate(this.onUploadDone,this);this._onUploadError=BX.delegate(this.onUploadError,this);this._onUploadWindowClose=BX.delegate(this.onUploadWindowClose,this);this._onUploadWindowFirstShow=BX.delegate(this.onUploadWindowFirstShow,this);this._onStartBizproc=BX.delegate(this.onStartBizproc,this);if(BX(e["dropZone"])){var n=BX.create("DIV",{attrs:{className:"wduf-uploader area"},html:BX.message("DFU_DND_TEMPLATE")}),d=BX.pos(e["dropZone"]);BX.adjust(e["dropZone"],{style:{position:"relative"},children:[n]});BX.addCustomEvent(this.agent.dropZone,"dragEnter",function(){var e=BX.GetWindowInnerSize(),t=BX.GetWindowScrollPos();d["height"]=e["innerHeight"]-(d["top"]-t["scrollTop"]);n.style.height=d["height"]+"px"})}}else{setTimeout(BX.delegate(function(){this.init(e)},this),500)}},changeTargetFolderId:function(e){if(this.agent.form&&this.agent.form.targetFolderId){this.agent.form.targetFolderId.value=e;var t=this.agent.getItems().items;for(var i in t){if(!t.hasOwnProperty(i)){continue}var s=t[i];var r=this.agent.getItem(s.id);if(r.node){BX.remove(r.node)}}}},onItemIsAdded:function(){if(this.popup)this.popup.show();else if(this.bp&&this.bpParameters){var e=BX.findChildren(this.nodeContent);e.unshift(BX("parametersFormBp"));this.popup=BX.Disk.modalWindow({modalId:"bx-dfu-upload-"+this.CID,closeIcon:false,title:BX.message("DFU_UPLOAD_TITLE1"),contentClassName:" tac bx-disk-upload-file",withoutWindowManager:true,content:e,events:{onPopupFirstShow:this._onUploadWindowFirstShow,onPopupClose:function(){BX.reload()}},zIndex:-200,htmlButtons:[BX.create("A",{text:BX.message("DFU_SAVE_BP"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-green mb0"},events:{click:this._onStartBizproc},attrs:{id:"bx-disk-savebp-button"}}),BX.create("LABEL",{text:BX.message("DFU_UPLOAD"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-green mb0 bx-hide-button"},attrs:{id:"bx-disk-upload-button",for:this.agent.fileInput.getAttribute("id")}}),BX.create("A",{text:BX.message("DFU_CLOSE"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-gray mb0"},attrs:{id:this.CID+"ButtonClose",disabled:true},events:{click:this._onUploadWindowClose}})]})}else{this.popup=BX.Disk.modalWindow({modalId:"bx-dfu-upload-"+this.CID,closeIcon:false,title:BX.message("DFU_UPLOAD_TITLE1"),contentClassName:" tac bx-disk-upload-file",content:BX.findChildren(this.nodeContent),events:{onPopupFirstShow:this._onUploadWindowFirstShow,onPopupClose:BX.delegate(function(){BX.addCustomEvent(this.agent,"onItemIsAdded",this._onItemIsAdded)},this)},htmlButtons:[BX.create("LABEL",{text:BX.message("DFU_UPLOAD"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-green mb0"},attrs:{for:this.agent.fileInput.getAttribute("id")}}),BX.create("A",{text:BX.message("DFU_CLOSE"),props:{className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-gray mb0"},attrs:{id:this.CID+"ButtonClose",disabled:true},events:{click:this._onUploadWindowClose}})]})}this.popup.destroy=BX.DoNothing;BX.removeCustomEvent(this.agent,"onItemIsAdded",this._onItemIsAdded)},onStartBizproc:function(){if(BX("formPostAjax").getElementsByTagName("div").length){BX("formPostAjax").removeChild(BX("divStartBizProc"))}var e=BX("divStartBizProc").cloneNode(true),t=BX("parametersFormBp").querySelectorAll("textarea"),i=BX("parametersFormBp").querySelectorAll("select"),s=e.querySelectorAll("textarea"),r=e.querySelectorAll("select"),o;if(t.length){for(o in t){if(t.hasOwnProperty(o)){s[o].value=t[o].value}}}if(i.length){for(o in i){if(i.hasOwnProperty(o)){r[o].value=i[o].value}}}BX("formPostAjax").appendChild(e);var a=BX.ajax.prepareForm(BX("formPostAjax")),n=this.agent;BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","validateParameterAutoloadBizProc"),data:{required:this.bpParametersRequired,data:a,storageId:this.storageId},onsuccess:function(e){if(e.status=="success"){n.submit();BX("formPostAjax").removeChild(BX("divStartBizProc"));BX("errorTd").innerHTML="";if(!BX.hasClass(BX("bx-disk-savebp-button"),"bx-hide-button")){BX.toggleClass(BX("bx-disk-upload-button"),"bx-hide-button");BX.toggleClass(BX("bx-disk-savebp-button"),"bx-hide-button")}}else{if(BX("formPostAjax").getElementsByTagName("div").length){BX("formPostAjax").removeChild(BX("divStartBizProc"))}for(o in e["errors"]){if(e["errors"].hasOwnProperty(o)){BX("errorTd").innerHTML=e["errors"][o].message}}if(BX.hasClass(BX("bx-disk-savebp-button"),"bx-hide-button")){BX.toggleClass(BX("bx-disk-upload-button"),"bx-hide-button");BX.toggleClass(BX("bx-disk-savebp-button"),"bx-hide-button")}}}})},onFileIsInited:function(e,t){this.counter.all.push(e);BX.addCustomEvent(t,"onFileIsAppended",this._onFileIsAppended);BX.addCustomEvent(t,"onUploadStart",this._onUploadStart);BX.addCustomEvent(t,"onUploadProgress",this._onUploadProgress);BX.addCustomEvent(t,"onUploadDone",this._onUploadDone);BX.addCustomEvent(t,"onUploadError",this._onUploadError);this.__checkButton();if(this.bp&&this.bpParameters&&this.popup){this.onStartBizproc()}},onFileIsAppended:function(e,t){var i=this.agent.getItem(e);this.__bindEventsToNode(i.node,t)},onUploadStart:function(e){this.counter.uploading.push(e.id);e.__progressBar=BX(e.id+"Progress");e.__progressBarWidth=5;if(e.__progressBar)e.__progressBar.style.width=e.__progressBarWidth+"%"},onUploadProgress:function(e,t){t=Math.min(t,96);if(t>e.__progressBarWidth){e.__progressBarWidth=Math.ceil(t);e.__progressBarWidth=e.__progressBarWidth>100?100:e.__progressBarWidth;e.__progressBar=BX(e.id+"Progress");if(e.__progressBar)e.__progressBar.style.width=e.__progressBarWidth+"%"}},onUploadDone:function(e,t){if(!this.agent.getItem(e.id)){return}e.__progressBar=BX(e.id+"Progress");if(e.__progressBar)e.__progressBar.style.width="100%";this.counter.uploading=BX.util.deleteFromArray(this.counter.uploading,BX.util.array_search(e.id,this.counter.uploading));this.counter.uploaded.push(e.id);e.fileId=t["file"]["fileId"];var i=this.agent.getItem(e.id).node,s=this._camelToSNAKE(t["file"]);if(BX(i)){var r=this.templates.done.text;for(var o in s){if(s.hasOwnProperty(o)){r=r.replace(new RegExp("#"+o.toLowerCase()+"#","gi"),BX.util.htmlspecialchars(s[o])).replace(new RegExp("#"+o.toUpperCase()+"#","gi"),BX.util.htmlspecialchars(s[o]))}}var a;if(BX.browser.IsIE8()){a=i;while(a.cells.length>0){a.deleteCell(0)}var n=0;r.replace(/<\/td>/gi,"\x02").replace(/<td([^>]+)>([^\002]+)\002/gi,function(e,t,i){var s=a.insertCell(n);s.innerHTML=i;t.replace(/class=["']([a-z\-\s]+)['"]/,function(e,t){s.className=t});n++;return""})}else{a=BX.create("TR",{attrs:this.templates.done.attrs,html:r});a.setAttribute("id",i.getAttribute("id"));i.parentNode.replaceChild(a,i)}}else{this.onUploadError(e,t)}this.__bindEventsToNode(i,e);this.__checkButton()},onUploadError:function(e,t,i){this.counter.uploading=BX.util.deleteFromArray(this.counter.uploading,BX.util.array_search(e.id,this.counter.uploading));t=typeof t=="object"&&t?t:{};var s=this.agent.getItem(e.id).node,r=this._camelToSNAKE(t);if(BX(s)&&(i==true||!BX(s).hasAttribute("bx-disk-error"))){r=!!r&&typeof r=="object"?r:{};var o=r["file"]&&r["file"]["isNotUnique"]?this.templates.error_double:this.templates.error,a=o.text,n;for(n in e){if(e.hasOwnProperty(n)&&typeof e[n]=="string"){a=a.replace(new RegExp("#"+n.toLowerCase()+"#","gi"),BX.util.htmlspecialchars(e[n])).replace(new RegExp("#"+n.toUpperCase()+"#","gi"),BX.util.htmlspecialchars(e[n]))}}if(r){for(n in r){if(r.hasOwnProperty(n)){a=a.replace(new RegExp("#"+n.toLowerCase()+"#","gi"),BX.util.htmlspecialchars(r[n])).replace(new RegExp("#"+n.toUpperCase()+"#","gi"),BX.util.htmlspecialchars(r[n]))}}if(r["file"]){for(n in r["file"]){if(r["file"].hasOwnProperty(n)){a=a.replace(new RegExp("#"+n.toLowerCase()+"#","gi"),BX.util.htmlspecialchars(r["file"][n])).replace(new RegExp("#"+n.toUpperCase()+"#","gi"),BX.util.htmlspecialchars(r["file"][n]))}}}}var d=BX.create("TR",{attrs:o.attrs,html:a});d.setAttribute("id",s.getAttribute("id"));d.setAttribute("bx-disk-error","Y");s.parentNode.replaceChild(d,s);this.__bindEventsToNode(d,e);this.__checkButton();if(this.uploadParams.errored<=0){var l=BX.pos(d),p=BX.pos(this.placeHolder);this.placeHolder.parentNode.scrollTop=l.top-p.top}this.uploadParams.errored++}else{BX.debug("BX.Disk.Upload: node for error does not exist.")}},uploadParams:{errored:0},onStart:function(){this.uploadParams.errored=0},onError:function(e,t,i){if(i&&i.status==="restriction"&&BX("bx-bitrix24-business-tools-info")){BX.PopupWindowManager.create("bx-disk-business-tools-info",null,{content:BX("bx-bitrix24-business-tools-info"),closeIcon:true,onPopupClose:function(){this.destroy()},autoHide:true}).show()}var s="Uploading error.",r=s,o,a;if(i){if(i["error"]&&typeof i["error"]=="string")r=i["error"];else if(i["message"]&&typeof i["message"]=="string")r=i["message"];else if(BX.type.isArray(i["errors"])&&i["errors"].length>0){r=[];for(var n=0;n<i["errors"].length;n++){if(typeof i["errors"][n]=="object"&&i["errors"][n]["message"])r.push(i["errors"][n]["message"])}if(r.length<=0)r.push(s);r=r.join(" ")}}e["files"]=e.files||{};for(a in e["files"]){if(e["files"].hasOwnProperty(a)){o=this.agent.queue.items.getItem(a);this.onUploadError(o,{error:r},r!=s)}}},deleteFile:function(e,t){BX.addClass(e,"bx-disk-popup-upload-file-delete-event");var i=BX.findChild(e,{className:"file-delete"},true),s=BX.util.array_search(t.id,this.counter.uploaded);if(s>=0)this.counter.uploaded=BX.util.deleteFromArray(this.counter.uploaded,s);s=BX.util.array_search(t.id,this.counter.uploading);if(s>=0)this.counter.uploading=BX.util.deleteFromArray(this.counter.uploading,s);this.counter.all=BX.util.deleteFromArray(this.counter.all,BX.util.array_search(t.id,this.counter.all));delete t.hash;setTimeout(function(){t.deleteFile("deleteFile")},400);if(!!i&&i.getAttribute("href").length>0)BX.ajax.post(i.href,{sessid:BX.bitrix_sessid()});this.__checkButton()},replaceFile:function(e,t){if(BX(e)){var i=this.templates["new"].text;for(var s in t){if(t.hasOwnProperty(s)){i=i.replace(new RegExp("#"+s.toLowerCase()+"#","gi"),BX.util.htmlspecialchars(t[s])).replace(new RegExp("#"+s.toUpperCase()+"#","gi"),BX.util.htmlspecialchars(t[s]))}}var r=BX.create("TR",{attrs:this.templates["new"].attrs,html:i});r.setAttribute("id",e.getAttribute("id"));e.parentNode.replaceChild(r,e);this.__bindEventsToNode(e,t);this.__checkButton();var o=t.file.uploadStatus;this.agent.queue.restoreFiles(new BX.UploaderUtils.Hash(t.id,t),true);t.file.uploadStatus=o;if(this.agent.post){this.agent.post.data["REPLACE_FILE"]=this.agent.post.data["REPLACE_FILE"]||[];this.agent.post.data["REPLACE_FILE"].push(t.id)}var a;if(this.agent.form){a=BX.create("INPUT",{attrs:{id:"input"+t.id},props:{name:"REPLACE_FILE[]",value:t.id}});this.agent.form.appendChild(a)}this.agent.submit();if(this.agent.post){this.agent.post.data["REPLACE_FILE"].pop()}if(this.agent.form){BX.remove(a)}}},restoreFile:function(e,t){if(!BX(e)){return}var i=this.templates["new"].text;for(var s in t){if(t.hasOwnProperty(s)){i=i.replace(new RegExp("#"+s.toLowerCase()+"#","gi"),BX.util.htmlspecialchars(t[s])).replace(new RegExp("#"+s.toUpperCase()+"#","gi"),BX.util.htmlspecialchars(t[s]))}}var r=BX.create("TR",{attrs:this.templates["new"].attrs,html:i});r.setAttribute("id",e.getAttribute("id"));e.parentNode.replaceChild(r,e);this.__bindEventsToNode(e,t);this.__checkButton();var o=t.file.uploadStatus;this.agent.queue.restoreFiles(new BX.UploaderUtils.Hash(t.id,t),true,false);t.file.uploadStatus=o;t.__progressBar=BX(t.id+"Progress");t.__progressBarWidth=5;this.agent.submit()},__checkButton:function(){var e=BX(this.CID+"ButtonClose"),t=BX(this.CID+"Number"),i=BX(this.CID+"Count");if(e)BX.adjust(e,{props:{disabled:this.counter.uploading.length>0}});if(t)t.innerHTML=this.counter.uploaded.length;if(i)i.innerHTML=this.counter.all.length},__bindEventsToNode:function(e,t){var i=function(){this.deleteFile(e,t)}.bind(this),s=function(i){BX.PreventDefault(i);this.replaceFile(e,t);return false}.bind(this),r=function(i){BX.PreventDefault(i);this.restoreFile(e,t);return false}.bind(this),o=BX.findChild(e,{attribute:{id:t.id+"Cancel"}},true),a=BX.findChild(e,{attribute:{id:t.id+"Replace"}},true),n=BX.findChild(e,{attribute:{id:t.id+"Restore"}},true);if(o&&!o.hasAttribute("bx-bound")){o.setAttribute("bx-bound","Y");BX.bind(o,"click",i)}if(a&&!a.hasAttribute("bx-bound")){a.setAttribute("bx-bound","Y");BX.bind(a,"click",s)}if(n&&!n.hasAttribute("bx-bound")){n.setAttribute("bx-bound","Y");BX.bind(n,"click",r)}},onUploadWindowFirstShow:function(e){this.agent.initDropZone(e.contentContainer);if(this.bp&&this.bpParameters){var t=BX.findChildrenByClassName(BX("parametersFormBp"),"bx-html-editor"),i;for(var s in t){if(t.hasOwnProperty(s)){i=t[s].getAttribute("id").replace("bx-html-editor-","");window["BXHtmlEditor"].editors[i].CheckAndReInit()}}}},onUploadWindowClose:function(){if(this.popup&&this.counter.uploading.length<=0){this.popup.close();if(this.counter.uploaded.length>0){var e,t;var i=this.counter.uploaded.length;while((t=this.agent.getItem(this.counter.uploaded.pop()))&&t&&t["item"]&&(t=t["item"])){if(t["fileId"]){e=BX.Disk.getUrlToShowObjectInGrid(t["fileId"]);break}}if(i===1&&BX.SidePanel.Instance.getSliderByWindow(window)){BX.SidePanel.Instance.postMessageAll(window,"Disk.File:onNewVersionUploaded",{object:{id:t["fileId"]}})}BX.onCustomEvent("onPopupFileUploadClose",[this,t["fileId"]])}}}};BX.DiskUpload.initialize=function(t){t["CID"]=t["CID"]?t["CID"]:"DiskUpload";var i=BX.create("INPUT",{attrs:{id:"inputContainer"+t["CID"]},props:{type:"file",multiple:true,title:BX.message("DFU_UPLOAD_TITLE1")}});var s=BX.create("FORM",{attrs:{id:"formPostAjax"},style:{display:"none"},children:[i,t["targetFileId"]?BX.create("INPUT",{props:{type:"hidden",name:"targetFileId",value:t["targetFileId"]}}):BX.create("INPUT",{props:{type:"hidden",name:"targetFolderId",value:t["targetFolderId"]}})]});var r=BX.create("LABEL",{attrs:{id:"inputContainerLabel"+t["CID"],title:BX.message("DFU_UPLOAD_TITLE1"),for:"inputContainer"+t["CID"]},children:[]});var o=BX.create("DIV",{style:{display:"none"}});document.body.appendChild(o);if(t["inputContainer"]){var a=BX(t["inputContainer"]);BX.adjust(r,{attrs:{className:a.className,id:a.id,title:BX.message("DFU_UPLOAD_TITLE1"),for:"inputContainer"+t["CID"]},html:a.innerHTML});r.appendChild(s);a.parentNode.replaceChild(r,a)}else{r.appendChild(s);o.appendChild(r);BX.addCustomEvent(window,"onDiskUploadPopupShow",function(e){e.appendChild(r)});BX.addCustomEvent(window,"onDiskUploadPopupClose",function(e){o.appendChild(r)})}t["input"]=i;if(!e[t["CID"]]){e[t["CID"]]=new BX.DiskUpload(t)}return e[t["CID"]]};BX.DiskUpload.getObj=function(t){return e[t]}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:91:"/bitrix/components/bitrix/main.ui.selector/templates/.default/script.min.js?169925795113346";s:6:"source";s:71:"/bitrix/components/bitrix/main.ui.selector/templates/.default/script.js";s:3:"min";s:75:"/bitrix/components/bitrix/main.ui.selector/templates/.default/script.min.js";s:3:"map";s:75:"/bitrix/components/bitrix/main.ui.selector/templates/.default/script.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main");BX.Main.selectorManagerV2={getById:function(t){if(typeof this.controls[t]!="undefined"){return this.controls[t]}return null},controls:{},loadedEntities:{}};BX.Main.SelectorV2=function(){this.initialized=false;this.blockInit=false;this.id="";this.apiVersion=2;this.fieldName=null;this.inputId=null;this.input=null;this.tagId=null;this.tag=null;this.options=null;this.callback=null;this.callbackBefore=null;this.items=null;this.entities=null;this.mainPopupWindow=null;this.entitiesSet=["users","emails","crmemails","groups","sonetgroups","department","departmentRelation","contacts","companies","leads","deals"];this.entityTypes={};this.auxObject=null;this.selectorInstance=null;this.eventOpenBinded=false};BX.Main.SelectorV2.controls={};BX.Main.SelectorV2.create=function(t){if(typeof t.id=="undefined"||!t.id){t.id=BX.util.hashCode(Math.random().toString())}else if(typeof BX.Main.selectorManagerV2.controls[t.id]!="undefined"){var e=BX.Main.selectorManagerV2.controls[t.id];if(e.bindNode&&!document.body.contains(e.bindNode)){delete BX.Main.selectorManagerV2.controls[t.id]}else{return BX.Main.selectorManagerV2.controls[t.id]}}var i=new BX.Main.SelectorV2;BX.Main.selectorManagerV2.controls[t.id]=i;i.init(t);return i};BX.Main.SelectorV2.proxyCallback=function(t,e){t(e)};BX.Main.SelectorV2.prototype={init:function(t){this.id=t.id;this.apiVersion=t.apiVersion&&parseInt(t.apiVersion)>=2?parseInt(t.apiVersion):2;this.fieldName=t.fieldName?t.fieldName:null;this.inputId=t.inputId?t.inputId:null;this.input=t.inputId&&BX(t.inputId)?BX(t.inputId):null;this.inputBox=t.inputBoxId&&BX(t.inputBoxId)?BX(t.inputBoxId):null;this.inputItemsContainer=t.inputContainerId&&BX(t.inputContainerId)?BX(t.inputContainerId):null;this.containerNode=t.containerId&&BX(t.containerId)?BX(t.containerId):null;this.bindNode=t.bindId&&BX(t.bindId)?BX(t.bindId):this.containerNode;this.tagId=t.tagId?t.tagId:null;this.tag=t.tagId&&BX(t.tagId)?BX(t.tagId):null;this.openDialogWhenInit=typeof t.openDialogWhenInit=="undefined"||!!t.openDialogWhenInit;this.options=t.options||{};this.callback=t.callback||null;this.callbackBefore=t.callbackBefore||null;this.items=t.items||null;this.entities=t.entities||null;this.entityTypes={};BX.onCustomEvent("BX.Main.SelectorV2:onGetEntityTypes",[{selector:this}]);this.selectorInstance=BX.UI.Selector.create({id:this.id,fieldName:this.fieldName,type:"xxx",pathToAjax:BX.type.isNotEmptyString(t.pathToAjax)?t.pathToAjax:null,input:this.input||null,tag:this.tag||null,inputBox:this.inputBox||null,inputItemsContainer:this.inputItemsContainer||null,entities:BX.clone(this.entityTypes),itemsSelected:BX.clone(this.items.selected)||{},itemsUndeletable:BX.clone(this.items.undeletable)||[],options:{multiple:this.getOption("multiple"),useSearch:this.getOption("useSearch"),useContainer:this.getOption("useContainer")=="Y"?"Y":"N",userNameTemplate:this.getOption("userNameTemplate"),siteDepartmentId:this.getOption("siteDepartmentId"),showCloseIcon:"Y",popupAutoHide:this.getOption("popupAutoHide")=="N"?"N":"Y",last:{disable:this.getOption("disableLast")=="Y"?"Y":"N"},search:{useAjax:this.getOption("sendAjaxSearch")!="N"?"Y":"N",useClientDatabase:this.getOption("useClientDatabase")=="Y"?"Y":"N"},focusInputOnSelectItem:this.getOption("focusInputOnSelectItem")!="N"?"Y":"N",focusInputOnSwitchTab:this.getOption("focusInputOnSwitchTab")!="N"?"Y":"N",isCrmFeed:this.getOption("isCrmFeed")=="Y"?"Y":"N",tagLink1:this.getOption("tagLink1"),tagLink2:this.getOption("tagLink2")},bindOptions:{node:this.bindNode,offsetTop:5,offsetLeft:15,zIndex:parseInt(this.getOption("popupZIndex"))>0?parseInt(this.getOption("popupZIndex")):1200},callback:this.callback,callbackBefore:this.callbackBefore});BX.addCustomEvent("BX.UI.SelectorManager:getTreeItemRelation",function(t){if(this.id==t.selectorId){this.getTreeItemRelation(t)}}.bind(this));BX.addCustomEvent("BX.UI.SelectorManager:loadAll",function(t){this.loadAll(t)}.bind(this));BX.addCustomEvent("BX.Main.SelectorV2:initDialog",function(t){if(this.id==t.selectorId){if(!!t.openDialogWhenInit){this.openDialogWhenInit=true}this.initDialog()}}.bind(this));BX.addCustomEvent("BX.Main.SelectorV2:reInitDialog",function(t){if(this.id==t.selectorId){this.initialized=false;this.items.selected=BX.type.isNotEmptyObject(t.selectedItems)?t.selectedItems:{};this.items.undeletable=BX.type.isNotEmptyObject(t.undeletableItems)?t.undeletableItems:{};var e=BX.UI.SelectorManager.instances[t.selectorId],i=null,n=null,s=0;if(e){for(var o in e.itemsSelected){if(e.itemsSelected.hasOwnProperty(o)){i=e.itemsSelected[o].toUpperCase();n=BX.UI.SelectorManager.getEntityTypeFullList(i);for(s=0;s<n.length;s++){if(BX.type.isNotEmptyObject(e.entities[n[s]])){e.unselectItem({itemNode:BX.type.isNotEmptyObject(e.entities[n[s]].items)&&BX.type.isNotEmptyObject(e.entities[n[s]].items[o])?e.entities[n[s]].items[o]:false,itemId:o,entityType:n[s],mode:"reinit"})}}}}e.itemsSelected=this.items.selected;e.itemsUndeletable=this.items.undeletable}this.initDialog()}}.bind(this));BX.addCustomEvent("BX.UI.SelectorManager:searchRequest",function(t){if(this.id==t.selectorInstance.id){t.selectorInstance.timeouts.search=setTimeout(function(){this.searchRequest(t)}.bind(this),1e3)}}.bind(this));BX.addCustomEvent("BX.UI.Selector:onSelectItem",function(t){if(this.apiVersion>=3&&BX.type.isNotEmptyObject(t)&&this.id==t.selectorId&&BX.type.isNotEmptyString(t.itemId)){this.saveDestination({itemId:t.itemId})}}.bind(this));if(!BX.type.isNotEmptyString(this.getOption("lheName"))){var e=BX("div"+this.getOption("lheName"));if(e){BX.addCustomEvent(e,"OnShowLHE",function(t){if(!t){this.selectorInstance.closeAllPopups()}}.bind(this))}}if(this.getOption("useContainer")!="Y"&&this.input){if(this.getOption("lazyLoad")!="Y"||BX.type.isNotEmptyObject(this.items.selected)){if(BX.type.isNotEmptyObject(this.items.selected)){this.openDialogWhenInit=false}this.initDialog()}if(this.tag){BX.bind(this.tag,"focus",BX.delegate(function(t){this.initDialog({realParams:true,bByFocusEvent:true});return t.preventDefault()},this));this.selectorInstance.setTagTitle()}BX.bind(this.input,"keydown",function(t){this.selectorInstance.getSearchInstance().beforeSearchHandler({event:t})}.bind(this));BX.bind(this.input,"bxchange",function(e){setTimeout(function(){this.selectorInstance.getSearchInstance().searchHandler({event:e,tagInputName:t.tagId})}.bind(this),0)}.bind(this));this.input.setAttribute("data-bxchangehandler","Y")}else if(this.getOption("useContainer")=="Y"&&(this.getOption("lazyLoad")!="Y"||this.getOption("useContainer")=="Y")){this.initDialog()}if(this.items.hidden){for(var i in this.items.hidden){if(this.items.hidden.hasOwnProperty(i)){this.callback.select.apply({id:(typeof this.items.hidden[i]["PREFIX"]!="undefined"?this.items.hidden[i]["PREFIX"]:"SG")+this.items.hidden[i]["ID"],name:this.items.hidden[i]["NAME"]},typeof this.items.hidden[i]["TYPE"]!="undefined"?this.items.hidden[i]["TYPE"]:"sonetgroups","",true,"","init")}}}},show:function(){this.initDialog()},initDialog:function(t){if(typeof t=="undefined"||typeof t.realParams=="undefined"){t=null}if(this.blockInit){return}var e={id:this.id};if(!this.initialized){BX.onCustomEvent(window,"BX.Main.SelectorV2:beforeInitDialog",[e])}setTimeout(BX.delegate(function(){if(typeof e.blockInit=="undefined"||e.blockInit!==true){if(this.initialized){if(!this.mainPopupWindow||!this.mainPopupWindow.isShown()){if(this.input){this.input.style.display="inline-block"}if(this.inputBox){this.inputBox.style.display="inline-block"}this.openDialog(t)}}else{this.getData(BX.delegate(function(e){if(!!this.openDialogWhenInit){if(this.input){this.input.style.display="inline-block"}if(this.inputBox){this.inputBox.style.display="inline-block"}this.openDialog(t)}BX.onCustomEvent(window,"BX.Main.SelectorV2:afterInitDialog",[{id:this.id}]);if(typeof this.options.eventOpen!="undefined"&&!this.eventOpenBinded){this.eventOpenBinded=true;BX.addCustomEvent(window,this.options.eventOpen,function(t){if(typeof t.id=="undefined"||t.id!=this.id){return}if(this.options.multiple!="Y"&&this.inputItemsContainer&&this.inputItemsContainer.children.length>0){return}if(this.mainPopupWindow&&this.mainPopupWindow.isShown()){return}if(this.input){this.input.style.display="inline-block"}if(this.inputBox){this.inputBox.style.display="inline-block"}var e=BX.type.isNotEmptyObject(t)&&t.bindNode?t.bindNode:this.bindNode;var i=BX.type.isNotEmptyObject(t)&&BX.type.isNotEmptyObject(t.bindPosition)?t.bindPosition:false;if(e){var n=BX.findChild(e,{tagName:"input",attr:{type:"text"}},true);if(n){this.selectorInstance.nodes.input=n;var s=this.tag||BX(t.tagId);if(s){this.selectorInstance.nodes.tag=s}if(n.getAttribute("data-bxchangehandler")!=="Y"){BX.bind(n,"keydown",function(t){this.selectorInstance.getSearchInstance().beforeSearchHandler({event:t})}.bind(this));BX.bind(n,"bxchange",function(t){this.selectorInstance.getSearchInstance().searchHandler({event:t})}.bind(this));n.setAttribute("data-bxchangehandler","Y")}}}if(i||e){if(!this.initialized){this.selectorInstance.itemsSelected={}}if(typeof t.value!="undefined"){this.selectorInstance.itemsSelected=t.value}this.openDialog({bindNode:e,bindPosition:i})}}.bind(this))}},this))}}},this),1)},openDialog:function(t){if(BX.type.isNotEmptyObject(t)){if(typeof t.bindNode!="undefined"){this.selectorInstance.bindOptions.node=t.bindNode}if(typeof t.bindPosition!="undefined"){this.selectorInstance.bindOptions.position=t.bindPosition}}this.selectorInstance.openDialog();this.mainPopupWindow=this.getOption("useContainer")=="Y"?this.selectorInstance.popups.container:this.selectorInstance.popups.main},closeDialog:function(){this.selectorInstance.closeDialog()},getData:function(t){this.blockInit=true;BX.onCustomEvent("BX.Main.SelectorV2:onGetDataStart",[this.id]);BX.ajax.runComponentAction("bitrix:main.ui.selector","getData",{mode:"ajax",data:{options:this.options,entityTypes:this.entityTypes,selectedItems:this.items.selected||{}}}).then(function(e){if(BX.type.isNotEmptyObject(e.data)){this.blockInit=false;BX.onCustomEvent("BX.Main.SelectorV2:onGetDataFinish",[this.id]);this.addData(e.data,t);this.initialized=true}}.bind(this),function(t){this.blockInit=false;BX.onCustomEvent("BX.Main.SelectorV2:onGetDataFinish",[this.id])}.bind(this))},loadAll:function(t){var e=BX.type.isNotEmptyString(t.entity)?t.entity.toUpperCase():"USERS";if(BX.type.isNotEmptyObject(t)&&BX.type.isFunction(t.callback)&&!BX.Main.selectorManagerV2.loadedEntities[e]){BX.Main.selectorManagerV2.loadedEntities[e]=true;BX.ajax.runComponentAction("bitrix:main.ui.selector","loadAll",{mode:"ajax",data:{entityType:e}}).then(function(e){if(BX.type.isNotEmptyObject(e.data)){for(var i in e.data){if(e.data.hasOwnProperty(i)){BX.onCustomEvent("onFinderAjaxLoadAll",[e.data[i],BX.UI.SelectorManager,i.toLowerCase()])}}t.callback()}}.bind(this),function(t){}.bind(this))}},searchRequest:function(t){this.blockInit=true;if(this.selectorInstance.timeouts.search){clearTimeout(this.selectorInstance.timeouts.search)}var e=new Date;this.selectorInstance.searchRequestId=e.getTime();BX.ajax.runComponentAction("bitrix:main.ui.selector","doSearch",{mode:"ajax",data:{searchString:t.searchString,searchStringConverted:BX.message("LANGUAGE_ID")=="ru"&&BX.correctText?BX.correctText(t.searchString):"",currentTimestamp:this.selectorInstance.searchRequestId,options:this.options,entityTypes:this.entityTypes,additionalData:BX.type.isNotEmptyObject(t.additionalData)?t.additionalData:{}},onrequeststart:function(t){this.selectorInstance.searchXhr=t}.bind(this)}).then(function(e){this.blockInit=false;if(BX.type.isNotEmptyObject(e.data)&&e.data.currentTimestamp&&e.data.currentTimestamp==this.selectorInstance.searchRequestId&&BX.type.isNotEmptyObject(t.callback)&&BX.type.isFunction(t.callback.success)){t.callback.success(e.data,{searchString:t.searchString,searchStringOriginal:BX.type.isNotEmptyObject(t.searchStringOriginal)?t.searchStringOriginal:t.searchString})}}.bind(this),function(e){this.blockInit=false;if(BX.type.isNotEmptyObject(t.callback)&&BX.type.isFunction(t.callback.failure)){t.callback.failure(BX.type.isNotEmptyObject(e.data)?e.data:{})}}.bind(this))},getTreeItemRelation:function(t){BX.ajax.runComponentAction("bitrix:main.ui.selector","getTreeItemRelation",{mode:"ajax",data:{entityType:t.entityType,categoryId:t.categoryId,allowSearchSelf:t.allowSearchSelf}}).then(function(e){if(BX.type.isNotEmptyObject(e.data)&&typeof t.callback!="undefined"){t.callback({selectorInstanceId:this.selectorInstance.id,entityType:t.entityType,categoryId:t.categoryId,data:e.data})}}.bind(this),function(t){})},addData:function(t,e){BX.onCustomEvent("BX.Main.SelectorV2:onAddData",[this.id,t]);if(typeof t.ENTITIES.CRM!="undefined"&&typeof t.ENTITIES.CRM.ITEMS_LAST!="undefined"&&BX.type.isNotEmptyObject(t.ENTITIES.CRM.ITEMS_LAST)){}e.apply(this,t)},getId:function(){return this.id},getOption:function(t){return typeof this.options[t]!="undefined"?this.options[t]:null},saveDestination:function(t){if(BX.type.isNotEmptyObject(t)&&BX.type.isNotEmptyString(t.itemId)){var e=this.getOption("context");if(BX.type.isNotEmptyString(e)){BX.ajax.runComponentAction("bitrix:main.ui.selector","saveDestination",{mode:"ajax",data:{context:e,itemId:t.itemId}}).then(function(t){},function(t){})}}}}})();
/* End */
;; /* /bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js?16992580712527*/
; /* /bitrix/components/bitrix/disk.file.view/templates/.default/script.min.js?169925797415822*/
; /* /bitrix/components/bitrix/disk.file.upload/templates/.default/script.min.js?169925797417682*/
; /* /bitrix/components/bitrix/main.ui.selector/templates/.default/script.min.js?169925795113346*/

//# sourceMappingURL=page_ec1419da5f6891a9b12e498549cf014e.map.js