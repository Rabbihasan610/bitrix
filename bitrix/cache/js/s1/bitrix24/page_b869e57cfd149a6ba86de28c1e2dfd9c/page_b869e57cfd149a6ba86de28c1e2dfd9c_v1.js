
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js?16992580712527";s:6:"source";s:78:"/bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
var waitDiv = null;
var waitPopup = null;
var waitTimeout = null;
var waitTime = 500;

function __SASSetAdmin()
{
	__SASShowWait();
	BX.ajax({
		url: '/bitrix/components/bitrix/socialnetwork.admin.set/ajax.php',
		method: 'POST',
		dataType: 'json',
		data: {'ACTION': 'SET', 'sessid': BX.bitrix_sessid(), 'site': BX.util.urlencode(BX.message('SASSiteId'))},
		onsuccess: function(data) { __SASProcessAJAXResponse(data); }
	});
}

function __SASProcessAJAXResponse(data)
{
	if (data["SUCCESS"] != "undefined" && data["SUCCESS"] == "Y")
	{
		BX.reload();
		return false;
	}
	else if (data["ERROR"] != "undefined" && data["ERROR"].length > 0)
	{
		if (data["ERROR"].indexOf("SESSION_ERROR", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorSessionWrong'));
			BX.reload();
		}
		else if (data["ERROR"].indexOf("CURRENT_USER_NOT_ADMIN", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorNotAdmin'));
			return false;
		}
		else if (data["ERROR"].indexOf("CURRENT_USER_NOT_AUTH", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorCurrentUserNotAuthorized'));
			return false;
		}
		else if (data["ERROR"].indexOf("SONET_MODULE_NOT_INSTALLED", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorModuleNotInstalled'));
			return false;
		}
		else
		{
			__SASShowError(data["ERROR"]);
			return false;		
		}
	}
}
				
function __SASShowError(errorText) 
{
	__SASCloseWait();

	var errorPopup = new BX.PopupWindow('sas-error' + Math.random(), window, {
		autoHide: true,
		lightShadow: false,
		zIndex: 2,
		content: BX.create('DIV', {props: {'className': 'sonet-adminset-error-text-block'}, html: errorText}),
		closeByEsc: true,
		closeIcon: true
	});
	errorPopup.show();

}

function __SASShowWait(timeout)
{
	if (timeout !== 0)
	{
		return (waitTimeout = setTimeout(function(){
			__SASShowWait(0)
		}, 50));
	}

	if (!waitPopup)
	{
		waitPopup = new BX.PopupWindow('sas_wait', window, {
			autoHide: true,
			lightShadow: true,
			zIndex: 2,
			content: BX.create('DIV', {
				props: {
					className: 'sonet-adminset-wait-cont'
				},
				children: [
					BX.create('DIV', {
						props: {
							className: 'sonet-adminset-wait-icon'
						}
					}),
					BX.create('DIV', {
						props: {
							className: 'sonet-adminset-wait-text'
						},
						html: BX.message('SASWaitTitle')
					})
				]
			})
		});
	}
	else
		waitPopup.setBindElement(window);

	waitPopup.show();
}

function __SASCloseWait()
{
	if (waitTimeout)
	{
		clearTimeout(waitTimeout);
		waitTimeout = null;
	}

	if (waitPopup)
		waitPopup.close();
}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:87:"/bitrix/components/bitrix/tasks.iframe.popup/templates/wrap/logic.min.js?16992580841319";s:6:"source";s:68:"/bitrix/components/bitrix/tasks.iframe.popup/templates/wrap/logic.js";s:3:"min";s:72:"/bitrix/components/bitrix/tasks.iframe.popup/templates/wrap/logic.min.js";s:3:"map";s:72:"/bitrix/components/bitrix/tasks.iframe.popup/templates/wrap/logic.map.js";}"*/
"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.IframePopup!="undefined"){return}BX.Tasks.Component.IframePopup={};BX.Tasks.Component.IframePopup.SideSlider=BX.Tasks.Component.extend({sys:{code:"iframe-popup-side-slider"},methods:{bindEvents:function(){BX.addCustomEvent(window,"tasksTaskEvent",this.onTaskGlobalEvent.bind(this));BX.bindDelegate(this.scope(),"click",{className:"js-id-copy-page-url"},this.onCopyUrl.bind(this))},onCopyUrl:function(o){o=o||window.event;this.onCopyUrlByNode(o.target,this.getWindowHref())},onCopyUrlByNode:function(o,e){this.timeoutIds=this.timeoutIds||[];if(!BX.clipboard.copy(e)){return}var t={content:BX.message("TASKS_TIP_TEMPLATE_LINK_COPIED"),darkMode:true,autoHide:true,zIndex:1e3,angle:true,offsetLeft:20,bindOptions:{position:"top"}};var n=new BX.PopupWindow("tasks_clipboard_copy",o,t);n.show();var i;while(i=this.timeoutIds.pop())clearTimeout(i);i=setTimeout(function(){n.close()},1500);this.timeoutIds.push(i)},getWindowHref:function(){return BX.util.remove_url_param(window.location.href,["IFRAME","IFRAME_TYPE"])},onTaskGlobalEvent:function(o,e){if(BX.type.isNotEmptyString(o)){e=e||{};if(!e.options.STAY_AT_PAGE){window.top.BX.onCustomEvent("BX.Bitrix24.PageSlider:close",[false])}}}}})}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:80:"/bitrix/components/bitrix/tasks.task/templates/view/logic.min.js?169925808216157";s:6:"source";s:60:"/bitrix/components/bitrix/tasks.task/templates/view/logic.js";s:3:"min";s:64:"/bitrix/components/bitrix/tasks.task/templates/view/logic.min.js";s:3:"map";s:64:"/bitrix/components/bitrix/tasks.task/templates/view/logic.map.js";}"*/
"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TaskView!="undefined"){return}BX.Tasks.Component.TaskView=function(t){this.parameters=t||{};this.taskId=this.parameters.taskId;this.userId=this.parameters.userId;this.layout={favorite:BX("task-detail-favorite"),switcher:BX("task-switcher"),switcherTabs:[],elapsedTime:BX("task-switcher-elapsed-time"),effective:BX("task-switcher-effective"),createButton:BX("task-detail-create-button"),importantButton:BX("task-detail-important-button"),saveButton:BX("saveButton"),cancelButton:BX("cancelButton")};this.openTime=this.parameters.componentData.OPEN_TIME;this.analyticsData={};this.timeout=0;this.timeoutSec=2e3;this.paramsToLazyLoadTabs=t.paramsToLazyLoadTabs||{};this.listTabIdUploadedContent={};this.messages=this.parameters.messages||{};for(var e in this.messages){BX.message[e]=this.messages[e]}this.paths=this.parameters.paths||{};this.createButtonMenu=[];this.checkListChanged=false;this.showCloseConfirmation=false;BX.addCustomEvent(window,"tasksTaskEvent",this.onTaskEvent.bind(this));BX.addCustomEvent("SidePanel.Slider:onClose",this.onSliderClose.bind(this,false));BX.addCustomEvent("SidePanel.Slider:onCloseByEsc",this.onSliderClose.bind(this,true));BX.addCustomEvent(window,"OnUCCommentWasRead",this.onCommentRead.bind(this));BX.PULL.subscribe({type:BX.PullClient.SubscriptionType.Server,moduleId:"tasks",command:"tag_changed",callback:function(){BX.ajax.runComponentAction("bitrix:tasks.tag.list","getTaskTags",{mode:"class",data:{taskId:this.taskId}}).then((function(t){var e=BX("task-tags-line");BX.cleanNode(e);var s=t.data;var i=s.join(", ");BX.adjust(e,{text:i})}))}.bind(this)});BX.Event.EventEmitter.subscribe("BX.Tasks.CheckListItem:CheckListChanged",function(t){var e=t.data.action;var s=["addAccomplice","fileUpload","tabIn"];if(BX.util.in_array(e,s)){this.analyticsData[e]="Y"}this.toggleFooterWrap(true)}.bind(this));this.initFavorite();this.initCreateButton();this.initSwitcher();this.initViewer();this.initAjaxErrorHandler();this.initImportantButton();this.initFooterButtons();this.initCommentActionController();this.extendWatch();this.handleEvent();this.temporalCommentFix();if(!!window.mplCheckForQuote&&BX("task-detail-author-info")){BX.bind(BX("task-detail-content"),"mouseup",function(t){window.mplCheckForQuote(t,t.currentTarget,"TASK_"+this.taskId,"task-detail-author-info")}.bind(this))}};BX.Tasks.Component.TaskView.prototype.extendWatch=function(){BX.PULL.extendWatch("TASK_VIEW_"+this.taskId,true);setTimeout(function(){this.extendWatch()}.bind(this),29*60*1e3)};BX.Tasks.Component.TaskView.prototype.onSliderClose=function(t,e){if(!this.checkListChanged||typeof BX.Tasks.CheckListInstance==="undefined"){return}var s=BX.Tasks.CheckListInstance.optionManager.slider;if(!s||s!==e.getSlider()||!this.isChecklistSidePanel(s.getUrl())){return}if(t){var i=BX.Tasks.CheckListInstance.getTreeStructure();if(i&&i.checkActiveUpdateExist()){e.denyAction();return}}if(!this.showCloseConfirmation){this.showCloseConfirmation=true;return}e.denyAction();this.showChecklistCloseSliderPopup(s)};BX.Tasks.Component.TaskView.prototype.isChecklistSidePanel=function(t){var e=false;var s=[new RegExp("/company/personal/user/(\\d+)/tasks/task/view/(\\d+)/","i"),new RegExp("/workgroups/group/(\\d+)/tasks/task/view/(\\d+)/","i"),new RegExp("/extranet/contacts/personal/user/(\\d+)/tasks/task/view/(\\d+)/","i")];s.forEach((function(s){if(t.match(s)){e=true}}));return e};BX.Tasks.Component.TaskView.prototype.showChecklistCloseSliderPopup=function(t){if(!this.checklistCloseSliderPopup){this.checklistCloseSliderPopup=new BX.PopupWindow({titleBar:BX.message("TASKS_CLOSE_SLIDER_CONFIRMATION_POPUP_HEADER"),content:BX.message("TASKS_CLOSE_SLIDER_CONFIRMATION_POPUP_CONTENT"),closeIcon:false,buttons:[new BX.PopupWindowButton({text:BX.message("TASKS_CLOSE_SLIDER_CONFIRMATION_POPUP_BUTTON_CLOSE"),className:"popup-window-button-accept",events:{click:function(){this.showCloseConfirmation=false;this.checklistCloseSliderPopup.close();t.close()}.bind(this)}}),new BX.PopupWindowButton({className:"popup-window-button popup-window-button-link",text:BX.message("TASKS_CLOSE_SLIDER_CONFIRMATION_POPUP_BUTTON_CANCEL"),events:{click:function(){this.checklistCloseSliderPopup.close()}.bind(this)}})]})}this.checklistCloseSliderPopup.show()};BX.Tasks.Component.TaskView.prototype.onCommentRead=function(t,e){if(t==="TASK_"+this.taskId&&this.timeout<=0){this.timeout=setTimeout(this.readComments.bind(this),this.timeoutSec)}};BX.Tasks.Component.TaskView.prototype.readComments=function(){this.timeout=0;BX.ajax.runAction("tasks.task.view.update",{data:{taskId:this.taskId}})};BX.Tasks.Component.TaskView.prototype.temporalCommentFix=function(){BX.addCustomEvent(window,"OnUCFormResponse",(function(t,e,s){if(BX.type.isNotEmptyString(t)&&t.indexOf("TASK_")===0&&BX.proxy_context&&BX.proxy_context.jsonFailure===true){if(s&&s["handler"]&&s.handler["oEditor"]&&s.handler.oEditor["DenyBeforeUnloadHandler"]){s.handler.oEditor.DenyBeforeUnloadHandler()}BX.reload()}}))};BX.Tasks.Component.TaskView.prototype.handleEvent=function(){var t=this.parameters.componentData.EVENT_TYPE;var e=this.parameters.componentData.EVENT_OPTIONS;if(t==="ADD"){var s={action:"taskAdding",source:"addButton"};if(e.FIRST_GRID_TASK_CREATION_TOUR_GUIDE){s.tourGuide="firstGridTaskCreation"}if(e.SCOPE){s.scope=e.SCOPE}BX.ajax.runAction("tasks.analytics.hit",{analyticsLabel:s})}this.fireTaskEvent(t,e)};BX.Tasks.Component.TaskView.prototype.fireTaskEvent=function(t,e){var s=this;if(this.parameters.eventTaskUgly!=null){if(t==="ADD"){var i=window.top;i.BX.UI.Notification.Center.notify({content:BX.message("TASKS_NOTIFY_TASK_CREATED"),actions:[{title:BX.message("TASKS_NOTIFY_TASK_DO_VIEW"),events:{click:function(t,e,a){e.close();i.BX.SidePanel.Instance.open(s.parameters.eventTaskUgly.url)}}}]})}BX.Tasks.Util.fireGlobalTaskEvent(t,{ID:this.parameters.eventTaskUgly.id},{STAY_AT_PAGE:e.STAY_AT_PAGE!=false},this.parameters.eventTaskUgly)}};BX.Tasks.Component.TaskView.prototype.initImportantButton=function(){if(this.parameters.can.TASK.ACTION.EDIT){BX.bind(this.layout.importantButton,"click",BX.Tasks.passCtx(this.onImportantButtonClick,this))}};BX.Tasks.Component.TaskView.prototype.initCreateButton=function(){BX.bind(this.layout.createButton,"click",this.onCreateButtonClick.bind(this));var t=this.paths;var e=this.parameters.groupId;var s=this.messages;this.createButtonMenu=[{text:s.addTask,className:"menu-popup-item menu-popup-no-icon",href:t.newTask},{text:s.addTaskByTemplate,className:"menu-popup-item menu-popup-no-icon menu-popup-item-submenu",cacheable:true,items:[{id:"loading",text:s.tasksAjaxLoadTemplates}],events:{onSubMenuShow:function(){if(this.isSubMenuLoaded){return}BX.ajax.runComponentAction("bitrix:tasks.templates.list","getList",{mode:"class",data:{select:["ID","TITLE"],order:{ID:"DESC"},filter:{ZOMBIE:"N"}}}).then(function(i){this.isSubMenuLoaded=true;this.getSubMenu().removeMenuItem("loading");var a=[];if(i.data.length>0){var n=t.newTask+(t.newTask.indexOf("?")!==-1?"&":"?")+(e>0?"GROUP_ID="+e+"&":"")+"TEMPLATE=";BX.Tasks.each(i.data,(function(t,e){a.push({text:BX.util.htmlspecialchars(t.TITLE),href:n+t.ID})}))}else{a.push({text:s.tasksAjaxEmpty})}this.addSubMenu(a);this.showSubMenu()}.bind(this),function(){this.isSubMenuLoaded=true;this.getSubMenu().removeMenuItem("loading");this.addSubMenu([{text:s.tasksAjaxErrorLoad}]);this.showSubMenu()}.bind(this))}}},{delimiter:true},{text:s.addSubTask,className:"menu-popup-item menu-popup-no-icon",href:t.newSubTask},{delimiter:true},{text:s.listTaskTemplates,className:"menu-popup-item menu-popup-no-icon",href:t.taskTemplates,target:"_top"}]};BX.Tasks.Component.TaskView.prototype.initFooterButtons=function(){BX.bind(this.layout.saveButton,"click",this.onSaveButtonClick.bind(this));BX.bind(this.layout.cancelButton,"click",this.onCancelButtonClick.bind(this))};BX.Tasks.Component.TaskView.prototype.onSaveButtonClick=function(){if(this.isSaving){return}this.isSaving=true;BX.Tasks.CheckListInstance.activateLoading();BX.Tasks.CheckListInstance.onSave();this.saveCheckList()};BX.Tasks.Component.TaskView.prototype.saveCheckList=function(){var t=this;var e=BX.Tasks.CheckListInstance.getTreeStructure();BX.ajax.runComponentAction("bitrix:tasks.widget.checklist.new","saveChecklist",{mode:"class",data:{taskId:this.taskId,items:e.getRequestData(),params:{analyticsData:Object.assign(this.analyticsData,{checklistCount:e.getDescendantsCount()})}}}).then(function(e){var s=e.data;var i=s.PREVENT_CHECKLIST_SAVE;if(i){var a=new BX.PopupWindow({titleBar:"Warning",content:i,closeIcon:false,buttons:[new BX.PopupWindowButton({className:"popup-window-button",text:"OK",events:{click:function(){a.close();BX.Tasks.CheckListInstance.deactivateLoading();BX.removeClass(BX("saveButton"),"ui-btn-wait")}}})],events:{onPopupClose:function(){this.destroy()}}});a.show()}else{var n=s.OPEN_TIME;var o=s.TRAVERSED_ITEMS;if(o){var r=BX.Tasks.CheckListInstance.getTreeStructure();Object.keys(o).forEach((function(t){var e=r.findChild(t);if(e!=="undefined"&&e.fields.getId()===null){e.fields.setId(o[t].ID)}}))}if(n){this.openTime=n}this.analyticsData={};BX.Tasks.CheckListInstance.saveStableTreeStructure();BX.Tasks.CheckListInstance.deactivateLoading();t.toggleFooterWrap(false);this.isSaving=false}}.bind(this)).catch(function(t){if(t.errors){BX.Tasks.alert(t.errors);this.isSaving=false;BX.Tasks.CheckListInstance.deactivateLoading()}}.bind(this))};BX.Tasks.Component.TaskView.prototype.onCancelButtonClick=function(t){if(this.isSaving){return}var e=this;var s=new BX.PopupWindow({titleBar:BX.message("TASKS_DISABLE_CHANGES_CONFIRMATION_POPUP_HEADER"),content:BX.message("TASKS_DISABLE_CHANGES_CONFIRMATION_POPUP_CONTENT"),closeIcon:false,buttons:[new BX.PopupWindowButton({text:BX.message("TASKS_DISABLE_CHANGES_CONFIRMATION_POPUP_BUTTON_YES"),className:"popup-window-button-accept",events:{click:function(){s.close();if(BX.Tasks.CheckListInstance!=="undefined"){BX.Tasks.CheckListInstance.rerender()}e.toggleFooterWrap(false)}}}),new BX.PopupWindowButton({className:"popup-window-button popup-window-button-link",text:BX.message("TASKS_DISABLE_CHANGES_CONFIRMATION_POPUP_BUTTON_NO"),events:{click:function(){s.close()}}})],events:{onPopupClose:function(){this.destroy()}}});s.show()};BX.Tasks.Component.TaskView.prototype.onImportantButtonClick=function(t){var e=BX.data(t,"priority");var s=e==2?1:2;BX.ajax.runComponentAction("bitrix:tasks.task","setPriority",{mode:"class",data:{taskId:this.taskId,priority:s}}).then(function(e){BX.data(t,"priority",s);BX.toggleClass(t,"no")}.bind(this)).catch(function(t){if(t.errors){BX.Tasks.alert(t.errors)}}.bind(this))};BX.Tasks.Component.TaskView.prototype.onCreateButtonClick=function(){BX.PopupMenu.show("task-detail-create-button",this.layout.createButton,this.createButtonMenu,{angle:{position:"top",offset:40}})};BX.Tasks.Component.TaskView.prototype.onTaskEvent=function(t,e){e=e||{};var s=e.task||{};if(t=="UPDATE"&&s.ID==this.parameters.taskId){if(BX.type.isNotEmptyString(s.REAL_STATUS)){this.setStatus(s.REAL_STATUS)}}if(t==="ADD"){if(this.taskId===e.taskUgly.parentTaskId){window.location.href=this.paths.taskView}}};BX.Tasks.Component.TaskView.prototype.setStatus=function(t){var e=BX("task-detail-status-below-name");if(e){var s=BX.message("TASKS_STATUS_"+t);e.innerHTML=s.substr(0,1).toLowerCase()+s.substr(1)}};BX.Tasks.Component.TaskView.prototype.initFavorite=function(){BX.bind(this.layout.favorite,"click",BX.proxy(this.onFavoriteClick,this))};BX.Tasks.Component.TaskView.prototype.onFavoriteClick=function(){var t=BX.hasClass(this.layout.favorite,"task-detail-favorite-active")?"deleteFavorite":"addFavorite";BX.ajax.runComponentAction("bitrix:tasks.task",t,{mode:"class",data:{taskId:this.taskId}}).then(function(t){BX.toggleClass(this.layout.favorite,"task-detail-favorite-active")}.bind(this)).catch(function(t){if(t.errors){BX.Tasks.alert(t.errors)}}.bind(this))};BX.Tasks.Component.TaskView.prototype.initSwitcher=function(){if(!this.layout.switcher){return}var t=this.layout.switcher.getElementsByClassName("task-switcher");var e=this.layout.switcher.parentNode.getElementsByClassName("task-switcher-block");for(var s=0;s<t.length;s++){var i=t[s],a=i.dataset.id;var n=e[s];BX.bind(i,"click",BX.proxy(this.onSwitch,this));this.layout.switcherTabs.push({title:i,block:n});this.listTabIdUploadedContent[a]=false;switch(a){case"files":BX.addCustomEvent("OnUCAfterRecordAdd",BX.proxy(this.onUCAfterRecordAdd,this));break}}BX.addCustomEvent("TaskElapsedTimeUpdated",BX.proxy((function(t,e,s,i){this.layout.elapsedTime.innerText=BX.Tasks.Util.formatTimeAmount(i.time)}),this))};BX.Tasks.Component.TaskView.prototype.onSwitch=function(){var t=BX.proxy_context;if(BX.hasClass(t,"task-switcher-selected")){return false}switch(t.dataset.id){default:this.switchTabStyle(t);break;case"files":this.getTabContent(t);break}return false};BX.Tasks.Component.TaskView.prototype.getTabContent=function(t){var e=t.dataset.id;if(!this.paramsToLazyLoadTabs.hasOwnProperty(e)){return}if(this.listTabIdUploadedContent[e]){this.switchTabStyle(t)}else if(e==="files"){BX.ajax.runComponentAction("bitrix:tasks.task","getFiles",{mode:"class",data:{taskId:this.parameters.taskId}}).then(function(s){var i=s.data;if(i.asset&&i.html&&BX.type.isNotEmptyString(i.html)){BX.html(null,i.asset.join(" ")).then(function(){this.listTabIdUploadedContent[e]=true;BX("task-"+e+"-block").innerHTML=i.html;BX.ajax.processScripts(BX.processHTML(i.html).SCRIPT);this.switchTabStyle(t)}.bind(this))}}.bind(this)).catch(function(t){if(t.errors){BX.Tasks.alert(t.errors)}}.bind(this))}};BX.Tasks.Component.TaskView.prototype.switchTabStyle=function(t){for(var e=0;e<this.layout.switcherTabs.length;e++){var s=this.layout.switcherTabs[e].title;var i=this.layout.switcherTabs[e].block;if(s===t){BX.addClass(s,"task-switcher-selected");BX.addClass(i,"task-switcher-block-selected")}else{BX.removeClass(s,"task-switcher-selected");BX.removeClass(i,"task-switcher-block-selected")}}};BX.Tasks.Component.TaskView.prototype.onUCAfterRecordAdd=function(t,e){if(e.hasOwnProperty("messageFields")){var s=e.messageFields.UF,i;if(s&&s["UF_FORUM_MESSAGE_DOC"]){i=s["UF_FORUM_MESSAGE_DOC"];if(BX.type.isArray(i.VALUE)&&i.VALUE.length){this.listTabIdUploadedContent["files"]=false;this.setFileCount()}}}};BX.Tasks.Component.TaskView.prototype.setFileCount=function(){BX.ajax.runComponentAction("bitrix:tasks.task","getFileCount",{mode:"class",data:{taskId:this.taskId}}).then(function(t){if(t.data.fileCount){BX.findChildByClassName(BX("task-files-switcher"),"task-switcher-text-counter").innerHTML=parseInt(t.data.fileCount)}}.bind(this)).catch(function(t){if(t.errors){BX.Tasks.alert(t.errors)}}.bind(this))};BX.Tasks.Component.TaskView.prototype.initViewer=function(){var t=["task-detail-description","task-detail-files","task-comments-block","task-files-block"];t.forEach((function(t){var e=BX(t);if(e){var s=typeof top.BX.viewElementBind==="function"?top.BX:BX;s.viewElementBind(e,{},(function(t){return BX.type.isElementNode(t)&&(t.getAttribute("data-bx-viewer")||t.getAttribute("data-bx-image"))}))}}))};BX.Tasks.Component.TaskView.prototype.initAjaxErrorHandler=function(){BX.addCustomEvent("TaskAjaxError",(function(t){BX.Tasks.alert(t).then((function(){BX.reload()}))}))};BX.Tasks.Component.TaskView.prototype.toggleFooterWrap=function(t){var e=BX("footerWrap");var s=BX("saveButton");var i="ui-btn-wait";var a="task-footer-wrap-active";if(t){if(!BX.hasClass(e,a)){BX.addClass(e,a)}this.checkListChanged=true;this.showCloseConfirmation=true}else{if(BX.hasClass(e,a)){BX.removeClass(e,a)}BX.removeClass(s,i);this.checkListChanged=false;this.showCloseConfirmation=false}};BX.Tasks.Component.TaskView.prototype.initCommentActionController=function(){if(window.top!==window&&window.BX.Tasks.CommentActionController){window.top.BX.Tasks.CommentActionController=window.BX.Tasks.CommentActionController}if(BX.Tasks.CommentActionController){void BX.Tasks.CommentActionController.init({workHours:this.parameters.workHours,workSettings:this.parameters.workSettings})}}}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:95:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/script.min.js?169925808360";s:6:"source";s:78:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/script.js";s:3:"min";s:82:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/script.min.js";s:3:"map";s:82:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/script.map.js";}"*/
BX.namespace("BX.Tasks");
/* End */
;
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?169925794962259";s:6:"source";s:77:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.js";s:3:"min";s:81:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.map.js";}"*/
BX.namespace("BX.Main");if(typeof BX.Main.interfaceButtons==="undefined"){BX.Main.interfaceButtons=function(t,e){this.classItem="main-buttons-item";this.classItemSublink="main-buttons-item-sublink";this.classItemText="main-buttons-item-text";this.classItemCounter="main-buttons-item-counter";this.classItemIcon="main-buttons-item-icon";this.classItemMore="main-buttons-item-more";this.classOnDrag="main-buttons-drag";this.classDropzone="main-buttons-submenu-dropzone";this.classSeparator="main-buttons-submenu-delimiter";this.classHiddenLabel="main-buttons-hidden-label";this.classSubmenuItem="main-buttons-submenu-item";this.classItemDisabled="main-buttons-disabled";this.classItemOver="--over";this.classMenuShown="--menu-shown";this.classItemActive="main-buttons-item-active";this.classSubmenu="main-buttons-submenu";this.classSecret="secret";this.classItemLocked="--locked";this.classExtraItemLink="";this.classExtraItemText="";this.classExtraItemIcon="";this.classExtraItemCounter="";this.submenuIdPrefix="main_buttons_popup_";this.childMenuIdPrefix="main_buttons_popup_child_";this.submenuWindowIdPrefix="menu-popup-";this.classSettingMenuItem="main-buttons-submenu-setting";this.classEditState="main-buttons-edit";this.classEditItemButton="main-buttons-item-edit-button";this.classDragItemButton="main-buttons-item-drag-button";this.classSettingsApplyButton="main-buttons-submenu-settings-apply";this.classSettingsResetButton="main-buttons-submenu-settings-reset";this.classSetHome="main-buttons-set-home";this.classSetHide="main-buttons-set-hide";this.classManage="main-buttons-manage";this.classContainer="main-buttons";this.classSubmenuNoHiddenItem="main-buttons-submenu-item-no-hidden";this.classDefaultSubmenuItem="menu-popup-item";this.classDefaultSubmenuDelimimeter="popup-window-delimiter-section";this.classInner="main-buttons-inner-container";this.listContainer=null;this.dragItem=null;this.overItem=null;this.moreButton=null;this.messages=null;this.licenseParams=null;this.ajaxSettings=null;this.enableItemMouseEnter=true;this.menuShowTimeout=null;this.isMoreMenuShown=false;this.onDragStarted=false;this.isSettingsEnabled=true;this.containerId=e.containerId;this.isEditEnabledState=false;this.theme=BX.Type.isStringFilled(e.theme)?e.theme:"default";this.maxItemLength=BX.Type.isNumber(e.maxItemLength)&&e.maxItemLength>6?e.maxItemLength:20;this.tmp={};this.itemData=new WeakMap;this.handleMoreMenuItemMouseEnter=this.handleMoreMenuItemMouseEnter.bind(this);this.init(t,e);return{getItemById:this.getItemById.bind(this),getAllItems:this.getAllItems.bind(this),getHiddenItems:this.getHiddenItems.bind(this),getVisibleItems:this.getVisibleItems.bind(this),getDisabledItems:this.getDisabledItems.bind(this),getMoreButton:this.getMoreButton.bind(this),adjustMoreButtonPosition:this.adjustMoreButtonPosition.bind(this),getItemData:this.getItemData.bind(this),getSubmenu:this.getMoreMenu.bind(this),showSubmenu:this.showMoreMenu.bind(this),closeSubmenu:this.closeMoreMenu.bind(this),refreshSubmenu:this.refreshMoreMenu.bind(this),getMoreMenu:this.getMoreMenu.bind(this),showMoreMenu:this.showMoreMenu.bind(this),closeMoreMenu:this.closeMoreMenu.bind(this),refreshMoreMenu:this.refreshMoreMenu.bind(this),getCurrentSettings:this.getCurrentSettings.bind(this),saveSettings:this.saveSettings.bind(this),updateCounter:this.updateCounter.bind(this),getActive:this.getActive.bind(this),isDisabled:this.isDisabled.bind(this),isVisibleItem:this.isVisibleItem.bind(this),isEditEnabled:this.isEditEnabled.bind(this),isActiveInMoreMenu:this.isActiveInMoreMenu.bind(this),isSettingsEnabled:this.isSettingsEnabled,classes:{item:this.classItem,itemText:this.classItemText,itemCounter:this.classItemCounter,itemIcon:this.classItemIcon,itemDisabled:this.classItemDisabled,itemOver:this.classItemOver,itemActive:this.classItemActive,itemLocked:this.classItemLocked,menuShown:this.classMenuShown,submenu:this.classSubmenu,submenuItem:this.classSubmenuItem,containerOnDrag:this.classOnDrag,classSettingMenuItem:this.classSettingMenuItem},itemsContainer:this.listContainer,itemsContainerId:this.listContainer.id}};BX.Main.interfaceButtons.prototype={init:function(t,e){this.listContainer=BX(this.getId());if(!BX.Type.isPlainObject(e)){throw"BX.MainButtons: params is not Object"}if(!("containerId"in e)||!BX.Type.isStringFilled(e.containerId)){throw"BX.MainButtons: containerId not set in params"}if(!BX.Type.isDomNode(this.listContainer)){throw"BX.MainButtons: #"+e.containerId+" is not dom node"}if("classes"in e&&BX.Type.isPlainObject(e.classes)){this.setCustomClasses(e.classes)}if("messages"in e&&BX.Type.isPlainObject(e.messages)){this.setMessages(e.messages)}if("licenseWindow"in e&&BX.Type.isPlainObject(e.licenseWindow)){this.setLicenseWindowParams(e.licenseWindow)}if("disableSettings"in e&&e.disableSettings==="true"){this.isSettingsEnabled=false;this.visibleControlMoreButton()}this.initSaving(e.ajaxSettings);this.moreButton=this.getMoreButton();this.listChildItems={};this.initItems();this.adjustMoreButtonPosition();this.bindEventsOnMoreButton();this.bindOnResizeFrame();BX.Event.bind(this.getContainer(),"click",BX.delegate(this._onDocumentClick,this));BX.addCustomEvent("onPullEvent-main",BX.delegate(this._onPush,this));this.updateMoreButtonCounter();if(this.isActiveInMoreMenu()){this.activateItem(this.moreButton)}const s=this.getHomeItem();if(s){const{url:t}=s;this.lastHomeLink=t}const i=Array.from(this.container.querySelectorAll(".main-buttons-item-child-button"));i.forEach((function(t){const e=t.closest(".main-buttons-item-child");if(e.dataset.isOpened){this.realChildButton=e;const t=e.closest(".main-buttons-item-child-button-cloned");if(t){this.clonedChildButton=t}}BX.Event.bind(t,"click",this.onShowChildButtonClick.bind(this))}),this)},calculateChildListWidth:function(){if(this.realChildButton){const t=this.realChildButton.querySelectorAll(".main-buttons-item-child-list-inner .main-buttons-item");const e=10;return Array.from(t).reduce((function(t,e){const s=BX.Text.toNumber(BX.Dom.style(e,"width"));const i=BX.Text.toNumber(BX.Dom.style(e,"margin-left"));const n=BX.Text.toNumber(BX.Dom.style(e,"margin-right"));return t+s+i+n}),e)}return 0},onShowChildButtonClick:function(t){t.preventDefault();if(!this.realChildButton){this.realChildButton=t.currentTarget.closest(".main-buttons-item-child")}const e=this.realChildButton.querySelector(".main-buttons-item-child-list");this.enableItemMouseEnter=false;setTimeout((()=>{this.enableItemMouseEnter=true}),200);const s=BX.Dom.attr(this.realChildButton,"data-child-items");const i=BX.Dom.attr(this.realChildButton,"data-is-opened");let n={};if(i){BX.Dom.attr(this.realChildButton,"data-is-opened",null);s.forEach((function(t){const e=this.getContainer().querySelector('[data-id="'+t+'"]');BX.Dom.style(e,"display",null);if(t.hasOwnProperty("PARENT_ITEM_ID")){n[t["PARENT_ITEM_ID"]]="N"}}),this);if(this.clonedChildButton){BX.Dom.remove(this.clonedChildButton)}BX.Dom.style(e,{overflow:null,"max-width":null});n=JSON.stringify(n);this.saveOptions("expanded_lists",n)}else{BX.Dom.attr(this.realChildButton,"data-is-opened",true);BX.Dom.style(e,"max-width",this.calculateChildListWidth()+"px");this.cloneChildButton(this.realChildButton);s.forEach((t=>{const e=this.getContainer().querySelector('[data-id="'+t+'"]');BX.Dom.insertBefore(e,this.realChildButton);BX.Dom.style(e,"display","inline-block");if(t.hasOwnProperty("PARENT_ITEM_ID")){n[t["PARENT_ITEM_ID"]]="Y"}}));setTimeout((()=>{BX.Dom.style(e,"overflow","unset")}),200);n=JSON.stringify(n);this.saveOptions("expanded_lists",n)}setTimeout((()=>{this._onResizeHandler()}),200)},cloneChildButton:function(t){this.clonedChildButton=BX.Runtime.clone(t);const e=this.clonedChildButton.querySelector(".main-buttons-item-child-list");if(e){BX.Dom.remove(e)}BX.Dom.addClass(this.clonedChildButton,"main-buttons-item-child-button-cloned");BX.Dom.style(this.clonedChildButton,"transition","none");BX.Dom.insertBefore(this.clonedChildButton,t);BX.Event.bind(this.clonedChildButton,"click",this.onShowChildButtonClick.bind(this));setTimeout((()=>{BX.Dom.style(this.clonedChildButton,"transition",null)}),0)},_onDocumentClick:function(t){if(this.isDragButton(t.target)){t.preventDefault();t.stopPropagation()}let e=this.getItem(t);if(BX.Type.isDomNode(e)){if(this.isSettings(e)){this.enableEdit();return false}if(this.isApplySettingsButton(e)){t.preventDefault();t.stopPropagation();this.disableEdit();return false}if(this.isResetSettingsButton(e)){this.resetSettings();return false}if(this.isEditButton(t.target)){this.handleEditButtonClick(t);return false}if(this.isSetHide(e)){const t=this.getVisibleItems();const e=BX.Type.isArray(t)?t.length:null;const s=this.editItemData.ID.replace(this.listContainer.id+"_","");let i=this.getItemById(s);const n=this.getItemAlias(i);i=this.isVisibleItem(i)?i:n;if(this.isDisabled(n)){this.enableItem(n)}else if(!this.isDisabled(n)&&e>2){this.disableItem(n)}if(e===1){BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[i,this])}this.refreshMoreMenu();this.saveSettings();this.adjustMoreButtonPosition();if(this.isEditEnabled()){this.enableEdit()}this.editMenu.popupWindow.close();return false}if(this.isSetHome(e)){const t=this.editItemData.ID.replace(this.listContainer.id+"_","");const e=this.getItemById(t);const s=this.getItemAlias(e);if(this.isDisabled(s)){this.enableItem(s)}this.listContainer.insertBefore(e,BX.firstChild(this.listContainer));this.adjustMoreButtonPosition();this.refreshMoreMenu();this.saveSettings();if(this.isEditEnabled()){this.enableEdit()}this.editMenu.popupWindow.close();return false}if(!this.isDragButton(t.target)&&!this.isEditButton(t.target)){const s=this.getItemData(e);let i=s["ON_CLICK"];if(this.isSublink(t.target)){i=BX.Type.isPlainObject(s["SUB_LINK"])?s["SUB_LINK"]["ON_CLICK"]:""}if(BX.Type.isStringFilled(i)){t.preventDefault();this.execScript(i,t)}}}if(this.isEditEnabled()&&this.getMoreMenu()){this.getMoreMenu().getPopupWindow().setAutoHide(false)}},isActiveInMoreMenu:function(){const t=this.getHiddenItems();const e=this.getDisabledItems();const s=t.concat(e);return s.some((function(t){const e=this.getItemData(t);return e["IS_ACTIVE"]===true}),this)},_onPush:function(t,e){if(t==="user_counter"&&e&&BX.message("SITE_ID")in e){const t=e[BX.message("SITE_ID")];for(const e in t){if(t.hasOwnProperty(e)){this.updateCounter(e,t[e])}}}},getActive:function(){let t=this.getAllItemsData();let e=null;let s=null;while(BX.Type.isArrayFilled(t)){const i=t.shift();if(i["IS_ACTIVE"]===true){if(s===null){s=i}e=i;t=BX.Type.isArrayFilled(i["ITEMS"])?[...i["ITEMS"]]:null}}if(e!==null&&s!==null){const t=BX(s.ID);if(BX.Type.isDomNode(t)){e.NODE=t}else{e.NODE=null}}return e},isSetHome:function(t){return BX.Dom.hasClass(t,this.classSetHome)},isSetHide:function(t){return BX.Dom.hasClass(t,this.classSetHide)},getSettingsButton:function(){return BX.Buttons.Utils.getByClass(this.getMoreMenuContainer(),this.classSettingMenuItem)},getSettingsApplyButton:function(){return BX.Buttons.Utils.getByClass(this.getMoreMenuContainer(),this.classSettingsApplyButton)},isApplySettingsButton:function(t){return BX.Dom.hasClass(t,this.classSettingsApplyButton)},enableEdit:function(){const t=this.getMoreMenu();if(t){const e=t.getPopupWindow();e.setAutoHide(false);BX.Dom.addClass(e.getPopupContainer(),this.classEditState)}BX.Dom.addClass(this.listContainer,this.classEditState);this.isEditEnabledState=true},disableEdit:function(){const t=this.getMoreMenu();if(t){const e=t.getPopupWindow();e.setAutoHide(true);BX.Dom.removeClass(e.getPopupContainer(),this.classEditState)}BX.Dom.removeClass(this.listContainer,this.classEditState);this.isEditEnabledState=false;this.destroyItemEditMenu()},isEditEnabled:function(){return this.isEditEnabledState},showItemEditMenu:function(t,e){if(BX.Type.isPlainObject(t)&&"ID"in t){const s=[this.listContainer.id,"_edit_item"].join("");let i=BX.Main.MenuManager.getMenuById(s);if(i){BX.Main.MenuManager.destroy(s)}i=this.createItemEditMenu(t,s,e);i.popupWindow.show()}},destroyItemEditMenu:function(){const t=[this.listContainer.id,"_edit_item"].join("");const e=BX.Main.MenuManager.getMenuById(t);if(e){BX.Main.MenuManager.destroy(t)}},getContainer:function(){if(!BX.Type.isDomNode(this.container)){this.container=BX(this.containerId).parentNode.parentNode}return this.container},getItemEditMenu:function(){return BX.Main.MenuManager.getMenuById([this.listContainer.id,"_edit_item"].join(""))},createItemEditMenu:function(t,e,s){const i=[{text:this.message("MIB_SET_HOME"),className:"main-buttons-set-home menu-popup-no-icon"}];const n=t["ID"].replace(this.listContainer.id+"_","");const o=this.getItemById(n);if(this.isDisabled(o)){i.push({text:this.message("MIB_SET_SHOW"),className:"main-buttons-set-hide menu-popup-no-icon"})}else{i.push({text:this.message("MIB_SET_HIDE"),className:"main-buttons-set-hide menu-popup-no-icon"})}if(t["IS_PINNED"]){const e=this.getParentItem(t["ID"]);i.push({text:this.message("MIB_UNPIN_ITEM").replace("#NAME#",e?e["TEXT"]:""),onclick:(e,s)=>{this.handleItemUnpin(t,o);s.getMenuWindow().close()}})}const a=BX.pos(s);const u={menuId:e,anchor:s,menuItems:i,settings:{autoHide:true,offsetTop:0,offsetLeft:a.width/2,zIndex:20,angle:{position:"top",offset:a.width/2}}};const r=BX.Main.MenuManager.create(u.menuId,u.anchor,u.menuItems,u.settings);if(this.isVisibleItem(o)){t.NODE=o}else{t.NODE=this.getItemAlias(o)}this.editItemData=t;if("menuItems"in r&&BX.Type.isArray(r.menuItems)){r.menuItems.forEach((function(t){BX.Event.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))}),this)}BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onBeforeCreateEditMenu",[r,t,this]);this.editMenu=r;return r},setHome:function(){const t=this.getHomeItem();if(!t){return}const{itemData:e,url:s,firstVisibleItem:i}=t;if(!e){return}if(this.lastHomeLink!==s){this.saveOptions("firstPageLink",s);BX.onCustomEvent("BX.Main.InterfaceButtons:onFirstItemChange",[s,i])}this.lastHomeLink=s},getHomeItem:function(){const t=this.getVisibleItems();const e=BX.Type.isArray(t)&&t.length>0?t[0]:null;if(!e){return null}const s=this.getItemData(e);const i=this.normalizeUrl(s["URL"]);if(this.canBeHomed(i,s)){return{itemData:s,url:i,firstVisibleItem:e}}if(BX.Type.isArrayFilled(s["ITEMS"])){for(let t=0;t<s["ITEMS"].length;t++){const i=s["ITEMS"][t];if(i["IS_PINNED"]||i["IS_DISBANDED"]||i["IS_DELIMITER"]){continue}const n=this.normalizeUrl(i["URL"]);if(this.canBeHomed(n,i)){return{itemData:i,url:n,firstVisibleItem:e}}}}return null},normalizeUrl:function(t){if(!BX.Type.isStringFilled(t)){return""}if(t.charAt(0)==="?"){const e=document.createElement("a");e.href=t;t=e.pathname+e.search}return t},canBeHomed:function(t,e){if(!BX.Type.isStringFilled(t)||BX.Type.isStringFilled(e["ON_CLICK"])){return false}if(BX.Reflection.getClass("BX.SidePanel.Instance")){const e=BX.SidePanel.Instance.getUrlRule(t);if(e){return false}}const s=new BX.Event.BaseEvent({data:{itemLink:t,itemData:e}});BX.Event.EventEmitter.emit("BX.Main.InterfaceButtons:onBeforeFirstItemChange",s);return!s.isDefaultPrevented()},isEditButton:function(t){return BX.Dom.hasClass(t,this.classEditItemButton)},isDragButton:function(t){return BX.Dom.hasClass(t,this.classDragItemButton)},isResetSettingsButton:function(t){return BX.Dom.hasClass(t,this.classSettingsResetButton)},getContainerHeight:function(){const t=this.getAllItems().map((function(t){const e=getComputedStyle(t);return BX.height(t)+parseInt(e.marginTop)+parseInt(e.marginBottom)}));return Math.max.apply(Math,t)},setLicenseWindowParams:function(t){this.licenseParams=t||{}},message:function(t){let e;try{e=this.messages[t]}catch(t){e=""}return e},setCustomClasses:function(t){if(!BX.Type.isPlainObject(t)){return}this.classItem=t.item||this.classItem;this.classItemSublink=t.itemSublink||this.classItemSublink;this.classItemText=t.itemText||this.classItemText;this.classItemCounter=t.itemCounter||this.classItemCounter;this.classItemIcon=t.itemIcon||this.classItemIcon;this.classItemMore=t.itemMore||this.classItemMore;this.classItemOver=t.itemOver||this.classItemOver;this.classMenuShown=t.menuShown||this.classMenuShown;this.classItemActive=t.itemActive||this.classItemActive;this.classItemDisabled=t.itemDisabled||this.classItemDisabled;this.classOnDrag=t.onDrag||this.classOnDrag;this.classDropzone=t.dropzone||this.classDropzone;this.classSeparator=t.separator||this.classSeparator;this.classSubmenuItem=t.submenuItem||this.classSubmenuItem;this.classSubmenu=t.submenu||this.classSubmenu;this.classSecret=t.secret||this.classSecret;this.classItemLocked=t.itemLocked||this.classItemLocked;this.classExtraItemLink=t.extraItemLink||this.classExtraItemLink;this.classExtraItemText=t.extraItemText||this.classExtraItemText;this.classExtraItemIcon=t.extraItemIcon||this.classExtraItemIcon;this.classExtraItemCounter=t.extraItemCounter||this.classExtraItemCounter},setMessages:function(t){if(!BX.Type.isPlainObject(t)){return}this.messages=t},makeFullItemId:function(t){if(!BX.Type.isStringFilled(t)){return}return[this.listContainer.id,t.replace("-","_")].join("_")},getItemById:function(t){let e=null;if(BX.Type.isStringFilled(t)){const s=t.startsWith(this.listContainer.id)?t:this.makeFullItemId(t);e=BX.Buttons.Utils.getBySelector(this.listContainer,"#"+s.replaceAll(":","\\:"))}return e},getItemCounterObject:function(t){let e=null;if(BX.Type.isDomNode(t)){e=BX.Buttons.Utils.getByClass(t,this.classItemCounter)}return e},updateCounter:function(t,e){if(t.indexOf("crm")===0&&e<0){return}this.updateItemsByCounterId(this.getAllItemsData(),t,e);this.updateMoreButtonCounter()},updateItemsByCounterId:function(t,e,s,i=[]){for(let n=0;n<t.length;n++){const o=t[n];if(o["COUNTER_ID"]===e){o["COUNTER"]=Number(s);this.setCounterValueById(e,o["COUNTER"]);for(let t=i.length-1;t>=0;t--){const e=i[t];e["COUNTER"]=e["ITEMS"].reduce(((t,e)=>{const s=e["IS_PINNED"]===true;const i=BX.Type.isNumber(e["COUNTER"])&&!s?e["COUNTER"]:0;return t+i}),0);this.setCounterValueById(e["COUNTER_ID"],e["COUNTER"])}}if(o["ITEMS"]){this.updateItemsByCounterId(o["ITEMS"],e,s,[...i,o])}}},recalculateItemsCounters:function(t,e=[]){let s=0;for(let i=0;i<t.length;i++){const n=t[i];if(n["ITEMS"]){n["COUNTER"]=this.recalculateItemsCounters(n["ITEMS"],[...e,n])}const o=n["IS_PINNED"]===true;s+=BX.Type.isNumber(n["COUNTER"])&&!o?n["COUNTER"]:0}for(let t=e.length-1;t>=0;t--){const s=e[t];s["COUNTER"]=s["ITEMS"].reduce(((t,e)=>{const s=e["IS_PINNED"]===true;const i=BX.Type.isNumber(e["COUNTER"])&&!s?e["COUNTER"]:0;return t+i}),0);this.setCounterValueById(s["COUNTER_ID"],s["COUNTER"])}return s},setCounterValueById:function(t,e){if(!BX.Type.isStringFilled(t)){return}const s=e>99?"99+":e>0?e:"";const i=document.querySelectorAll(`[data-mib-counter-id="${t}"]`);Array.from(i).forEach((t=>{t.textContent=s}))},setMoreButtonCounter:function(t){const e=this.getItemCounterObject(this.moreButton);e.textContent=t>99?"99+":t>0?t:""},bindEventsOnMoreButton:function(){BX.Event.bind(this.moreButton,"click",this.handleMoreButtonClick.bind(this));BX.Event.bind(this.moreButton,"mouseenter",this.handleMoreButtonMouseEnter.bind(this));BX.Event.bind(this.moreButton,"mouseleave",this.handleMoreButtonMouseLeave.bind(this))},bindOnResizeFrame:function(){window.frames["maininterfacebuttonstmpframe-"+this.getId()].onresize=BX.throttle(this._onResizeHandler,20,this)},getId:function(){return BX.Buttons.Utils.getByClass(this.getContainer(),this.classInner).id},getAllItems:function(){return BX.Buttons.Utils.getByClass(this.listContainer,this.classItem,true)},getAllItemsData:function(){return this.getAllItems().map((t=>this.getItemData(t)))},getVisibleItems:function(){const t=this.getAllItems();let e=[];if(t&&t.length){e=t.filter((t=>this.isVisibleItem(t)&&!this.isDisabled(t)))}return e},getHiddenItems:function(){const t=this.getAllItems();let e=[];if(t&&t.length){e=t.filter((t=>!this.isVisibleItem(t)&&!this.isDisabled(t)))}return e},getDisabledItems:function(){return this.getAllItems().filter((t=>this.isDisabled(t)))},getMoreButton:function(){const t=this.getContainer().getElementsByClassName(this.classItemMore);return t[0]||null},getLastVisibleItem:function(){const t=this.getVisibleItems();let e=null;if(BX.Type.isArray(t)&&t.length){e=t[t.length-1]}if(!BX.Type.isDomNode(e)){e=null}return e},getLastDisabledItem:function(){const t=this.getDisabledItems();let e=null;if(BX.Type.isArray(t)&&t.length){e=t[t.length-1]}if(!BX.Type.isDomNode(e)){e=null}return e},adjustMoreButtonPosition:function(){this.updateMoreButtonCounter();if(this.getMoreMenu()){this.getMoreMenu().getPopupWindow().adjustPosition()}},getMoreMenuId:function(t){let e="";if(BX.Type.isDomNode(this.listContainer)&&BX.Type.isStringFilled(this.listContainer.id)){e=this.submenuIdPrefix+this.listContainer.id}if(t){e=this.submenuWindowIdPrefix+e}return e},getChildMenuId:function(){let t="";if(BX.Type.isDomNode(this.listContainer)&&BX.Type.isStringFilled(this.listContainer.id)){t=this.childMenuIdPrefix+this.listContainer.id}return t},getMenuItemText:function(t,e=null){const s=BX.Type.isElementNode(t)?this.getItemData(t):t;return BX.Tag.render`
				<span class="main-buttons-menu-popup-item">${[BX.Tag.render`<span class="${this.classItemIcon}"></span>`,this.createItemText(s),this.createItemCounter(s),e&&this.isEditEnabled()?this.createItemPin(s,e):""]}</span>
			`},createRootItem:function(t){let e=this.classItem;e+=BX.Type.isStringFilled(t["CLASS"])?" "+t["CLASS"]:"";if(t["IS_PASSIVE"]){e+=" --passive"}else if(t["IS_ACTIVE"]){if(BX.Type.isStringFilled(this.classItemActive)){e+=" "+this.classItemActive}else{e+=" main-buttons-item-active"}}if(t["HAS_MENU"]){e+=" --has-menu"}if(t["IS_LOCKED"]){e+=" --locked"}const s=BX.Tag.render`
				<div
					id="${t["ID"]}"
					class="${e}"
					data-disabled="${t["IS_DISABLED"]}"
					data-class="${t["CLASS_SUBMENU_ITEM"]}"
					data-id="${t["DATA_ID"]}"
					data-top-menu-id="${this.getId()}"
					title=""
				>${[this.createItemLink(t,true),BX.Type.isPlainObject(t["SUB_LINK"])?this.createItemSubLink(t["SUB_LINK"]):""]}</div>
			`;this.setItemData(s,t);return s},createItemLink:function(t,e=false){t=BX.Type.isPlainObject(t)?t:{};let s;const i=["main-buttons-item-link",this.classExtraItemLink].join(" ").trim();if(BX.Type.isStringFilled(t["URL"])){s=BX.Tag.render`<a class="${i}" href="${BX.Text.encode(t["URL"])}"></a>`}else{s=BX.Tag.render`<span class="${i}"></span>`}BX.Dom.append(this.createItemIcon(t),s);BX.Dom.append(this.createItemText(t,e),s);BX.Dom.append(this.createItemCounter(t),s);return s},createItemSubLink:function(t){t=BX.Type.isPlainObject(t)?t:{};const e=BX.Type.isStringFilled(t["CLASS"])?" "+t["CLASS"]:"";const s=BX.Type.isStringFilled(t["URL"])?BX.Text.encode(t["URL"]):"";return BX.Tag.render`
				<a class="${this.classItemSublink}${e}" href="${s}"></a>
			`},createItemIcon:function(t){const e=[this.classItemIcon,this.classExtraItemIcon].join(" ").trim();return BX.Tag.render`<span class="${e}"></span>`},createItemText:function(t,e=false){t=BX.Type.isPlainObject(t)?t:{};const s=[this.classItemText,this.classExtraItemText].join(" ").trim();let i=BX.Type.isStringFilled(t["TEXT"])?t["TEXT"]:"";if(e&&i.length>this.maxItemLength){i=i.substring(0,this.maxItemLength-3)+"..."}let n="";if(BX.Type.isPlainObject(t["SUPER_TITLE"])){let{TEXT:e,CLASS:s,COLOR:i}=t["SUPER_TITLE"];s=BX.Type.isStringFilled(s)?` ${s}`:"";const o=BX.Type.isStringFilled(i)?` style="color:${i}"`:"";n=BX.Tag.render`
					<span class="main-buttons-item-super-title${s}"${o}>${e}</span>
				`}return BX.Tag.render`
				<span class="${s}">${[BX.Tag.render`<span 
						class="main-buttons-item-drag-button"
						onclick="${this.handleDragButtonClick.bind(this)}" 
						data-slider-ignore-autobinding="true"
					></span>`,n,BX.Tag.render`
						<span class="main-buttons-item-text-title">
							<span class="main-buttons-item-text-box">${BX.Text.encode(i)}<span class="main-buttons-item-menu-arrow"></span></span>
						</span>
					`,BX.Tag.render`<span 
						class="main-buttons-item-edit-button"
						onclick="${this.handleEditButtonClick.bind(this)}" 
						data-slider-ignore-autobinding="true"
					></span>`,BX.Tag.render`<span class="main-buttons-item-text-marker"></span>`]}</span>
			`},createItemCounter:function(t){t=BX.Type.isPlainObject(t)?t:{};const e=[this.classItemCounter,this.classExtraItemCounter].join(" ").trim();let s="";const i=BX.Type.isNumber(t["MAX_COUNTER_SIZE"])?t["MAX_COUNTER_SIZE"]:99;if(BX.Type.isNumber(t["COUNTER"])&&t["COUNTER"]>0){s=t["COUNTER"]>i?`${i}+`:t["COUNTER"]}const n=BX.Type.isStringFilled(t["COUNTER_ID"])?t["COUNTER_ID"]:"";return BX.Tag.render`<span data-mib-counter-id="${n}" class="${e}">${s}</span>`},createItemPin:function(t,e){return BX.Tag.render`
				<span class="main-buttons-item-pin" 
					data-slider-ignore-autobinding="true"
					onclick="${this.handleItemPin.bind(this,t,e)}"
					onmouseenter="${this.handleItemPinEnter.bind(this)}"
					onmouseleave="${this.handleItemPinLeave.bind(this)}"
				></span>
			`},getLockedClass:function(t){let e="";if(BX.Type.isDomNode(t)&&this.isLocked(t)){e=this.classItemLocked}return e},getMoreMenuItems:function(){const t=this.getAllItems();const e=this.getHiddenItems();const s=this.getDisabledItems();const i=[];if(t.length){t.forEach((t=>{if(e.indexOf(t)===-1&&s.indexOf(t)===-1){const e=this.getItemData(t);i.push({id:e["DATA_ID"],html:this.getMenuItemText(t),href:e["URL"],onclick:e["ON_CLICK"],title:t.getAttribute("title"),className:[this.classSubmenuItem,this.getIconClass(t),this.classSecret,this.getAliasLink(t),this.getLockedClass(t)].join(" "),items:this.getMoreMenuSubItems(t),events:{onMouseEnter:this.handleMoreMenuItemMouseEnter}})}}))}if(e.length){e.forEach((t=>{const e=this.getItemData(t);const s=[this.classSubmenuItem,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(e["IS_ACTIVE"]===true){s.push(this.classItemActive)}i.push({id:e["DATA_ID"],html:this.getMenuItemText(t),href:e["URL"],onclick:e["ON_CLICK"],title:t.getAttribute("title"),className:s.join(" "),items:this.getMoreMenuSubItems(t),events:{onMouseEnter:this.handleMoreMenuItemMouseEnter}})}))}if(this.isSettingsEnabled){i.push({delimiter:true,html:"<span>"+this.message("MIB_MANAGE")+"</span>",className:[this.classSeparator,this.classSubmenuItem,this.classManage].join(" ")});i.push({html:this.message("MIB_SETTING_MENU_ITEM"),className:[this.classSettingMenuItem,this.classSubmenuItem].join(" ")});const t=["ui-btn",this.theme==="default"?"ui-btn-sm":"ui-btn-xs","ui-btn-success-light","ui-btn-no-caps","ui-btn-round","ui-btn-icon-main-buttons-apply"];i.push({html:`\n\t\t\t\t\t<span class="${t.join(" ")}">\n\t\t\t\t\t\t<span class="ui-btn-text">${this.message("MIB_APPLY_SETTING_MENU_ITEM")}</span>\n\t\t\t\t\t</span>`,className:[this.classSettingsApplyButton,this.classSubmenuItem].join(" ")});i.push({html:this.message("MIB_RESET_SETTINGS"),className:[this.classSettingsResetButton,this.classSubmenuItem].join(" ")});i.push({delimiter:true,html:"<span>"+this.message("MIB_HIDDEN")+"</span>",className:[this.classSeparator,this.classSubmenuItem,this.classHiddenLabel].join(" ")});if(!s.length){i.push({html:"<span>"+this.message("MIB_NO_HIDDEN")+"</span>",className:[this.classSubmenuItem,this.classSubmenuNoHiddenItem].join(" ")})}if(s.length){s.forEach((t=>{const e=this.getItemData(t);const s=[this.classSubmenuItem,this.classItemDisabled,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(e["IS_ACTIVE"]===true){s.push(this.classItemActive)}i.push({id:e["DATA_ID"],html:this.getMenuItemText(t),href:e["URL"],onclick:e["ON_CLICK"],title:t.getAttribute("title"),className:s.join(" "),items:this.getMoreMenuSubItems(t),events:{onMouseEnter:this.handleMoreMenuItemMouseEnter}})}))}}return i},getMenuItems:function(t){return this.createMenuItems(this.getItemData(t),t)},getMoreMenuSubItems:function(t){return this.createMenuItems(this.getItemData(t),null)},createMenuItems:function(t,e=null){if(!BX.Type.isArrayFilled(t["ITEMS"])){return[]}const s=t["ITEMS"];const i=[];for(let t=0;t<s.length;t++){const n=s[t];if(n["IS_PINNED"]||n["IS_DISBANDED"]){continue}const o=n["IS_DELIMITER"]===true;if(o){const t=i.length===0;const e=i[i.length-1];if(t||e&&e["delimiter"]===true){continue}}const a=["menu-popup-no-icon","main-buttons-menu-item"];if(n["IS_ACTIVE"]===true){a.push("main-buttons-menu-item-active")}const u=BX.Text.toBoolean(n["IS_LOCKED"]);if(u){a.push(this.classItemLocked)}if(this.isEditEnabled()){a.push(this.classEditState)}let r;if(o){r={delimiter:true,className:a.join(" "),text:n["TEXT"]}}else{r={html:this.getMenuItemText(n,e),href:n["URL"],onclick:n["ON_CLICK"],title:n["TITLE"],className:a.join(" ")}}const l=n.hasOwnProperty("AJAX_OPTIONS");if(l){r.cacheable=true;r.events=this._getEvents(n["AJAX_OPTIONS"]);r.items=[{id:"loading",text:this.message("MIB_MAIN_BUTTONS_LOADING")}]}else if(BX.Type.isArrayFilled(n["ITEMS"])&&!this.isEditEnabled()){const t=this.createMenuItems(n,e);if(t.length){r.items=t}}i.push(r)}if(i.length&&i[i.length-1]["delimiter"]===true){i.pop()}return i},_setAjaxMode:function(t){for(let e in t){if(!t.hasOwnProperty(e)){continue}if(t[e].hasOwnProperty("ajaxOptions")){t[e].cacheable=true;t[e].events=this._getEvents(t[e]["ajaxOptions"]);t[e].items=[{id:"loading",text:this.message("MIB_MAIN_BUTTONS_LOADING")}]}}},_getEvents:function(t){return{onSubMenuShow:()=>{if(this.subMenuLoaded){return}const e=this.getSubMenu();e.removeMenuItem("loading");const s=e.getMenuItem("loading");this.getSubItems(t).then((t=>{this._setAjaxMode(t);this.subMenuLoaded=true;this.addSubMenu(t);this.showSubMenu()})).catch((t=>{if(s){s.getLayout().text.innerText=t}}))}}},getSubItems:function(t){return new Promise((function(e,s){if(this.progress){s(this.message("MIB_MAIN_BUTTONS_LOADING"));return}if(t.mode==="component"){this.progress=true;BX.ajax.runComponentAction(t.component,t.action,{mode:t.componentMode,signedParameters:t.signedParameters?t.signedParameters:{},data:t.data}).then((t=>{this.progress=false;e(t.data)}))}else{this.progress=true;BX.ajax.runAction(t.action,{data:t.data}).then((t=>{this.progress=false;e(t.data)}))}}))},getMoreMenuArgs:function(){const t=this.getMoreMenuId();const e=this.moreButton;const s=this.getMoreMenuItems();let i;const n=800;if(this.theme==="default"){const t=350;const s=25;i={autoHide:false,compatibleMode:false,offsetLeft:-s,offsetTop:4,cacheable:false,className:"main-buttons-menu-popup main-buttons-more-menu-popup",minWidth:240,maxWidth:t,maxHeight:n,subMenuOptions:{className:"main-buttons-menu-popup main-buttons-more-menu-popup --sub-menu",minWidth:150,maxWidth:t,events:{onFirstShow:this.handleMoreMenuFirstShow.bind(this)}},bindOptions:{position:"bottom",forceTop:true},events:{onClose:this.handleMoreMenuClose.bind(this),onDestroy:this.handleMoreMenuClose.bind(this),onFirstShow:this.handleMoreMenuFirstShow.bind(this),onShow:this.handleMoreMenuShow.bind(this),onBeforeAdjustPosition:this.handleAdjustPosition.bind(this,e)}}}else{const t=this.moreButton.querySelector(".main-buttons-item-text-title");const e=t.offsetWidth;const s=250;const o=e/2-s/2+BX.Main.Popup.getOption("angleLeftOffset");const a=BX.Main.Popup.getOption("angleLeftOffset")-BX.Main.Popup.getOption("angleMinTop");const u=s/2-a;i={autoHide:false,compatibleMode:false,offsetTop:4,offsetLeft:o,minWidth:s,maxWidth:s,maxHeight:n,angle:{position:"top",offset:u},className:"main-buttons-default-menu-popup main-buttons-more-menu-popup",subMenuOptions:{className:"main-buttons-default-menu-popup main-buttons-more-menu-popup --sub-menu",minWidth:null,events:{onFirstShow:this.handleMoreMenuFirstShow.bind(this)}},cacheable:false,bindOptions:{position:"bottom",forceTop:true},events:{onClose:this.handleMoreMenuClose.bind(this),onDestroy:this.handleMoreMenuClose.bind(this),onFirstShow:this.handleMoreMenuFirstShow.bind(this),onShow:this.handleMoreMenuShow.bind(this)}}}if(this.isEditEnabled()){i.className+=" "+this.classEditState}return[t,e,s,i]},getChildMenuArgs:function(t){const e=800;if(this.theme==="default"){const s=25;const i=350;return{autoHide:false,compatibleMode:false,offsetLeft:-s,offsetTop:4,cacheable:false,className:"main-buttons-menu-popup",maxWidth:i,minWidth:t.offsetWidth+s*2+30,maxHeight:e,subMenuOptions:{className:"main-buttons-menu-popup --sub-menu",minWidth:null,events:{onFirstShow:this._onChildMenuFirstShow.bind(this)}},bindOptions:{position:"bottom",forceTop:true},events:{onFirstShow:this._onChildMenuFirstShow.bind(this),onShow:this._onChildMenuShow.bind(this,t),onClose:this._onChildMenuClose.bind(this,t),onDestroy:this._onChildMenuClose.bind(this,t),onBeforeAdjustPosition:this.handleAdjustPosition.bind(this,t)}}}else{const s=250;return{autoHide:false,compatibleMode:false,offsetTop:4,cacheable:false,className:"main-buttons-default-menu-popup",minWidth:Math.min(t.offsetWidth+25*2+30,s),maxWidth:s,maxHeight:e,bindOptions:{position:"bottom",forceTop:true},subMenuOptions:{className:"main-buttons-default-menu-popup --sub-menu",minWidth:null,events:{onFirstShow:this._onChildMenuFirstShow.bind(this)}},events:{onFirstShow:this._onChildMenuFirstShow.bind(this),onShow:this._onChildMenuShow.bind(this,t),onClose:this._onChildMenuClose.bind(this,t),onDestroy:this._onChildMenuClose.bind(this,t)}}}},centerPopupArrow(t,e){const s=e.offsetWidth;const i=t.getPopupContainer().offsetWidth;const n=s/2-i/2;const o=BX.Main.Popup.getOption("angleLeftOffset")-BX.Main.Popup.getOption("angleMinTop");t.setAngle({offset:i/2-o});t.setOffset({offsetLeft:n+BX.Main.Popup.getOption("angleLeftOffset")})},visibleControlMoreButton:function(){const t=this.getHiddenItems();if(!t.length){this.getMoreButton().style.display="none"}else{this.getMoreButton().style.display=""}},createMoreMenu:function(){const t=BX.Main.MenuManager.create(...this.getMoreMenuArgs());if(this.isSettingsEnabled){this.dragAndDropInitInSubmenu()}t.getMenuItems().forEach((function(t){const e=t.getLayout().item;BX.Event.bind(e,"click",BX.delegate(this._onDocumentClick,this))}),this);return t},createChildMenu:function(t){const e=this.getMenuItems(t);if(e.length){const s=BX.Main.MenuManager.create(this.getChildMenuId(),t,e,this.getChildMenuArgs(t));if(!this.isEditEnabled()&&this.isSettingsEnabled){const e=()=>{this.showMoreMenu();this.enableEdit();this.destroyChildMenu();this.showChildMenu(t)};s.getMenuItems().forEach((t=>{const s=t.getLayout().item;s.draggable=true;BX.Event.bind(s,"dragstart",e)}))}return s}return null},showMoreMenu:function(){clearTimeout(this.submenuLeaveTimeout);if(!this.isEditEnabled()){this.closeChildMenu()}let t=this.getMoreMenu();if(t!==null){t.getPopupWindow().show()}else{this.destroyMoreMenu();t=this.createMoreMenu();t.getPopupWindow().show()}this.setMoreMenuShown(true);this.activateItem(this.moreButton);if(this.isEditEnabled()){t.getPopupWindow().setAutoHide(false)}},showChildMenu:function(t){clearTimeout(this.childMenuLeaveTimeout);if(!this.isEditEnabled()){this.closeMoreMenu()}if(!this.isVisibleItem(t)){return}const e=BX.Main.MenuManager.getMenuById(this.getChildMenuId());if(e&&e.bindElement===t){e.getPopupWindow().show();this.destroyItemEditMenu()}else{this.destroyChildMenu(t);const e=this.createChildMenu(t);if(e){e.getPopupWindow().show();this.destroyItemEditMenu()}}},closeMoreMenu:function(){const t=this.getMoreMenu();if(t===null){return}t.getPopupWindow().close();if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}this.setMoreMenuShown(false)},closeChildMenu:function(){const t=this.getChildMenu();if(t===null){return}this.closePinHint();t.close()},getMoreMenu:function(){return BX.Main.MenuManager.getMenuById(this.getMoreMenuId())},getChildMenu:function(){return BX.Main.MenuManager.getMenuById(this.getChildMenuId())},destroyMoreMenu:function(){BX.Main.MenuManager.destroy(this.getMoreMenuId())},destroyChildMenu:function(){BX.Main.MenuManager.destroy(this.getChildMenuId())},refreshMoreMenu:function(){const t=this.getMoreMenu();if(t===null){return}const e=this.getMoreMenuArgs();if(BX.Type.isArray(e)){this.destroyMoreMenu();this.createMoreMenu();this.showMoreMenu()}},setMoreMenuShown:function(t){this.isSubmenuShown=false;if(BX.type.isBoolean(t)){this.isSubmenuShown=t}if(this.isSubmenuShown){BX.Dom.addClass(this.moreButton,this.classMenuShown)}else{BX.Dom.removeClass(this.moreButton,this.classMenuShown)}},activateItem:function(t){if(!BX.Type.isDomNode(t)){return}if(!BX.Dom.hasClass(t,this.classItemActive)){BX.Dom.addClass(t,this.classItemActive)}},deactivateItem:function(t){if(!BX.Type.isDomNode(t)){return}if(BX.Dom.hasClass(t,this.classItemActive)){BX.Dom.removeClass(t,this.classItemActive)}},getCurrentSettings:function(){const t={};this.getAllItems().forEach(((e,s)=>{t[e.id]={sort:s,isDisabled:this.isDisabled(e),isPinned:this.isPinned(e)}}));return t},initSaving:function(t){this.sendOptions=this.sendOptions.bind(this);this.optionsToSave=[];this.debouncedSendOptions=BX.debounce(this.sendOptions,5e3);if(BX.Type.isPlainObject(t)){this.ajaxSettings={componentName:t.componentName,signedParams:t.signedParams}}},sendOptions:function(){if(this.optionsToSave.length<=0){return}const t={};this.optionsToSave.forEach((function(e){t[e.name]=e.value}));this.optionsToSave=[];window.removeEventListener("beforeunload",this.sendOptions);BX.removeCustomEvent("SidePanel.Slider:onClose",this.sendOptions);return BX.ajax.runComponentAction(this.ajaxSettings.componentName,"save",{mode:"class",signedParameters:this.ajaxSettings.signedParams,data:{options:t}})},saveOptions:function(t,e){if(this.ajaxSettings){if(this.optionsToSave.length<=0){window.addEventListener("beforeunload",this.sendOptions);BX.addCustomEvent("SidePanel.Slider:onClose",this.sendOptions)}this.optionsToSave.push({name:t,value:e});this.debouncedSendOptions()}else if(this.listContainer.id){BX.userOptions.save("ui",this.listContainer.id,t,e)}},saveSettings:function(){const t=this.getCurrentSettings();const e="settings";if(!BX.Type.isPlainObject(t)){return}if(BX.Type.isDomNode(this.listContainer)){if("id"in this.listContainer){this.saveOptions(e,JSON.stringify(t));this.setHome()}}},resetSettings:function(){let t=null;const e=BX.PopupWindowManager.create(this.listContainer.id+"_reset_popup",null,{content:this.message("MIB_RESET_ALERT"),autoHide:false,overlay:true,closeByEsc:true,closeIcon:true,draggable:{restrict:true},titleBar:this.message("MIB_RESET_SETTINGS"),buttons:[t=new BX.PopupWindowButton({text:this.message("MIB_RESET_BUTTON"),className:"popup-window-button-create",events:{click:()=>{if(BX.Dom.hasClass(t.buttonNode,"popup-window-button-wait")){return}BX.Dom.addClass(t.buttonNode,"popup-window-button-wait");this.handleResetSettings((s=>{if(s){BX.Dom.removeClass(t.buttonNode,"popup-window-button-wait");e.setContent(s)}else{this.saveOptions("settings",JSON.stringify({}));this.saveOptions("firstPageLink","");this.sendOptions().then((function(){window.location.reload()})).catch((function(){window.location.reload()}))}}))}}}),new BX.PopupWindowButtonLink({text:this.message("MIB_CANCEL_BUTTON"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})]});e.show()},handleResetSettings:function(t){const e=[];BX.onCustomEvent("BX.Main.InterfaceButtons:onBeforeResetMenu",[e,this]);let s=new BX.Promise;const i=s;for(let t=0;t<e.length;t++){s=s.then(e[t])}s.then((function(e){t(null,e)}),(function(e){t(e,null)}));i.fulfill()},moveButtonAlias:function(t,e){if(!t||!this.dragItem){return}const s=this.getItemAlias(this.dragItem);const i=this.getItemAlias(t);if(this.isListItem(s)){if(i){if(e){BX.Dom.insertAfter(s,i)}else{this.listContainer.insertBefore(s,i)}}else{this.listContainer.appendChild(s)}}if(this.getMoreMenu()){this.getMoreMenu().getPopupWindow().adjustPosition()}},moveButton:function(t,e){if(!BX.Type.isDomNode(t)||!BX.Type.isDomNode(this.dragItem)){return}if(this.isListItem(t)){if(this.isDisabled(this.dragItem)){this.dragItem.dataset.disabled="false"}if(BX.Type.isDomNode(t)){if(e){BX.Dom.insertAfter(this.dragItem,t)}else{this.listContainer.insertBefore(this.dragItem,t)}}else{this.listContainer.appendChild(this.dragItem)}}if(this.isSubmenuItem(t)){if(e){BX.Dom.insertAfter(this.dragItem,t)}else{this.getMoreMenuContainer().insertBefore(this.dragItem,t)}}},getMoreMenuContainer:function(){const t=this.getMoreMenu();let e=null;if(t!==null){e=t.itemsContainer}return e},findNextSiblingByClass:function(t,e){const s=t;for(;!!t;t=t.nextElementSibling){if(e){if(BX.Dom.hasClass(t,e)&&t!==s){return t}}else{return null}}return null},findChildrenByClassName:function(t,e){let s=null;if(BX.Type.isDomNode(t)&&BX.Type.isStringFilled(e)){s=BX.Buttons.Utils.getByClass(t,e)}return s},initItems:function(){this.getAllItems().forEach((t=>{this.initItem(t)}))},initItem:function(t){if(this.isSettingsEnabled){t.setAttribute("draggable","true");t.setAttribute("tabindex","-1");BX.Event.bind(t,"dragstart",BX.delegate(this._onDragStart,this));BX.Event.bind(t,"dragend",BX.delegate(this._onDragEnd,this));BX.Event.bind(t,"dragenter",BX.delegate(this._onDragEnter,this));BX.Event.bind(t,"dragover",BX.delegate(this._onDragOver,this));BX.Event.bind(t,"dragleave",BX.delegate(this._onDragLeave,this));BX.Event.bind(t,"drop",BX.delegate(this._onDrop,this));t.dataset.link="item-"+BX.Text.getRandom().toLowerCase()}BX.Event.bind(t,"click",this._handleItemClick.bind(this));BX.Event.bind(t,"mouseenter",this.handleItemMouseEnter.bind(this));BX.Event.bind(t,"mouseleave",this.handleItemMouseLeave.bind(this))},dragAndDropInitInSubmenu:function(){const t=this.getMoreMenu();if(!t){return}const e=t.menuItems;e.forEach((t=>{if(this.isSeparator(t.layout.item)||this.isSettings(t.layout.item)||this.isApplySettingsButton(t.layout.item)||this.isResetSettingsButton(t.layout.item)){t.layout.item.draggable=false}else{t.layout.item.draggable=true;t.layout.item.dataset.sortable=true;BX.Event.bind(t.layout.item,"dragstart",BX.delegate(this._onDragStart,this));BX.Event.bind(t.layout.item,"dragenter",BX.delegate(this._onDragEnter,this));BX.Event.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this));BX.Event.bind(t.layout.item,"dragleave",BX.delegate(this._onDragLeave,this));BX.Event.bind(t.layout.item,"dragend",BX.delegate(this._onDragEnd,this));BX.Event.bind(t.layout.item,"drop",BX.delegate(this._onDrop,this))}if(BX.Dom.hasClass(t.layout.item,this.classHiddenLabel)||BX.Dom.hasClass(t.layout.item,this.classManage)){BX.Event.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this))}}))},getItem:function(t){if(!BX.Type.isDomNode(t)){if(!t||!BX.Type.isDomNode(t.target)){return null}}else{t={target:t}}let e=t.target.closest("."+this.classItem);if(!BX.Type.isDomNode(e)){e=t.target.closest("."+this.classDefaultSubmenuItem+", ."+this.classDefaultSubmenuDelimimeter)}return e},getItemData:function(t){if(!BX.Type.isDomNode(t)){return{}}const e=this.itemData.get(t);if(e){return e}let s;try{s=JSON.parse(t.dataset.item)}catch(t){s={}}this.setItemData(t,s);return s},setItemData(t,e){if(BX.Type.isElementNode(t)&&BX.Type.isPlainObject(e)){e.NODE=t;this.itemData.set(t,e)}},setOpacity:function(t){if(!BX.Type.isDomNode(t)){return}BX.style(t,"opacity",.5)},unsetOpacity:function(t){if(!BX.Type.isDomNode(t)){return}BX.style(t,"opacity","1")},setDragStyles:function(){BX.Dom.addClass(this.listContainer,this.classOnDrag);BX.Dom.addClass(BX(this.getMoreMenuId(true)),this.classOnDrag);this.setOpacity(this.dragItem)},unsetDragStyles:function(){const t=this.getMoreMenu();this.getAllItems().forEach((t=>{this.unsetOpacity(t);BX.Dom.removeClass(t,this.classItemOver)}));if(t&&BX.Type.isArray(t.menuItems)&&t.menuItems.length){t.menuItems.forEach((t=>{this.unsetOpacity(t);BX.Dom.removeClass(t.layout.item,this.classItemOver)}))}BX.Dom.removeClass(this.listContainer,this.classOnDrag);BX.Dom.removeClass(BX(this.getMoreMenuId(true)),this.classOnDrag)},getIconClass:function(t){let e="";if(BX.Type.isDomNode(t)&&"dataset"in t&&"class"in t.dataset&&BX.Type.isStringFilled(t.dataset.class)){e=t.dataset.class}return e},disableItem:function(t){const e=this.getItemAlias(t);if(t&&"dataset"in t){t.dataset.disabled="true";if(e){e.dataset.disabled="true"}}},enableItem:function(t){let e;if(!BX.Type.isDomNode(t)){return}if(this.isSubmenuItem(t)){BX.Dom.removeClass(t,this.classItemDisabled);e=this.getItemAlias(t);if(BX.Type.isDomNode(e)){e.dataset.disabled="false"}}},getAliasLink:function(t){return this.dataValue(t,"link")||""},getItemAlias:function(t){let e=null;if(!BX.Type.isDomNode(t)){return e}const s=this.getAllItems();const i=this.isSubmenuItem(t);const n=this.isListItem(t);if(!i&&!n){return e}if(i){s.forEach((function(s){BX.Dom.hasClass(t,this.getAliasLink(s))&&(e=s)}),this)}if(n){e=BX.Buttons.Utils.getByClass(document,this.getAliasLink(t))}return e},hideItem:function(t){!!t&&BX.Dom.addClass(t,this.classSecret)},showItem:function(t){!!t&&BX.Dom.removeClass(t,this.classSecret)},fakeDragItem:function(){if(!BX.Type.isDomNode(this.dragItem)||!BX.Type.isDomNode(this.overItem)){return}let t=null;if(this.isDragToSubmenu()){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.listContainer.appendChild(this.dragItem);this.dragItem=t;this.showItem(this.dragItem);this.adjustMoreButtonPosition();this.updateMoreMenuItems();this.tmp.moved=false;this.tmp.movetToSubmenu=true;this.setOpacity(this.dragItem)}}if(this.isDragToList()&&!this.tmp.movetToSubmenu){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.hideItem(this.dragItem);this.dragItem=t;this.adjustMoreButtonPosition();this.updateMoreMenuItems();this.setOpacity(this.dragItem)}}this.tmp.movetToSubmenu=false},updateMoreMenuItems:function(){const t=this.getMoreMenu();if(t===null){return}const e=t.menuItems;if(!BX.Type.isArray(e)||!e.length){return}const s=this.getHiddenItems();const i=this.getDisabledItems();const n=i.concat(s);e.forEach((t=>{const e=[].some.call(n,(e=>BX.Dom.hasClass(t.layout.item,this.dataValue(e,"link"))||this.isDisabled(t.layout.item)||this.isSeparator(t.layout.item)||this.isDropzone(t.layout.item)));if(e||(this.isSettings(t.layout.item)||this.isApplySettingsButton(t.layout.item)||this.isResetSettingsButton(t.layout.item)||this.isNotHiddenItem(t.layout.item)||this.isSeparator(t.layout.item)||t.layout.item===this.dragItem)&&!this.isMoreButton(t.layout.item)){this.showItem(t.layout.item)}else{this.hideItem(t.layout.item)}}))},isNotHiddenItem:function(t){return BX.Dom.hasClass(t,this.classSubmenuNoHiddenItem)},getNotHidden:function(){return BX.Buttons.Utils.getByClass(this.getMoreMenuContainer(),this.classSubmenuNoHiddenItem)},setOverStyles:function(t){if(BX.Type.isDomNode(t)&&!BX.Dom.hasClass(t,this.classItemOver)){BX.Dom.addClass(t,this.classItemOver)}},unsetOverStyles:function(t){if(BX.Type.isDomNode(t)&&BX.Dom.hasClass(t,this.classItemOver)){BX.Dom.removeClass(t,this.classItemOver)}},dataValue:function(t,e){let s="";if(BX.Type.isDomNode(t)){const i=BX.data(t,e);if(typeof i!=="undefined"){s=i}}return s},execScript:function(t,e){if(BX.Type.isStringFilled(t)){const s=new Function("event",t);s(e)}},showLicenseWindow:function(){if(!B24.licenseInfoPopup){return}const t=B24.licenseInfoPopup;t.init({B24_LICENSE_BUTTON_TEXT:this.message("MIB_LICENSE_BUY_BUTTON"),B24_TRIAL_BUTTON_TEXT:this.message("MIB_LICENSE_TRIAL_BUTTON"),IS_FULL_DEMO_EXISTS:this.licenseParams.isFullDemoExists,HOST_NAME:this.licenseParams.hostname,AJAX_URL:this.licenseParams.ajaxUrl,LICENSE_ALL_PATH:this.licenseParams.licenseAllPath,LICENSE_DEMO_PATH:this.licenseParams.licenseDemoPath,FEATURE_GROUP_NAME:this.licenseParams.featureGroupName,AJAX_ACTIONS_URL:this.licenseParams.ajaxActionsUrl,B24_FEATURE_TRIAL_SUCCESS_TEXT:this.message("MIB_LICENSE_WINDOW_TRIAL_SUCCESS_TEXT")});t.show("main-buttons",this.message("MIB_LICENSE_WINDOW_HEADER_TEXT"),this.message("MIB_LICENSE_WINDOW_TEXT"))},_handleItemClick:function(t){if(!this.isEditEnabled()){const e=this.getItem(t);this.showChildMenu(e)}},handleEditButtonClick:function(t){t.preventDefault();t.stopPropagation();let e=this.getItem(t);if(!BX.Type.isDomNode(e)){return}if(this.isSubmenuItem(e)){e=this.getItemAlias(e)}const s=this.getItemData(e);const i=this.getItemEditMenu();if(i&&i.popupWindow.isShown()&&this.lastEditNode===e){i.popupWindow.close()}else{this.showItemEditMenu(s,t.target)}this.lastEditNode=e},handleDragButtonClick:function(t){t.preventDefault();t.stopPropagation()},handleItemPinEnter:function(t){const e=this.getChildMenu();if(e){this.showPinHint(t.currentTarget)}},showPinHint:function(t){const e=48;const s=BX.Main.PopupManager.create({id:"main-buttons-pin-hint",closeByEsc:true,padding:15,className:"main-buttons-pin-hint-popup",height:e,cacheable:false,autoHide:true,bindOptions:{forceBindPosition:true},content:this.message("MIB_PIN_HINT"),darkMode:true,events:{onAfterShow:function(e){const s=e.getTarget();const i=BX.Dom.getPosition(t);const n=BX.Dom.getPosition(s.getPopupContainer());if(n.left<i.left+i.width){s.setAngle({position:"top",offset:0});s.setOffset({offsetLeft:20,offsetTop:5});s.adjustPosition()}}}});s.setAngle({position:"left",offset:0});s.setOffset({offsetLeft:t.offsetWidth+5,offsetTop:-t.offsetHeight/2-e/2-2});s.setBindElement(t);s.show();s.adjustPosition()},closePinHint:function(){const t=BX.Main.PopupManager.getPopupById("main-buttons-pin-hint");if(t){t.close()}},handleItemPinLeave:function(t){this.closePinHint()},handleItemPin:function(t,e,s){s.stopPropagation();s.preventDefault();const i=this.createRootItem(t);BX.Dom.addClass(i,"main-buttons-item-insert-animation");BX.Dom.insertBefore(i,e);requestAnimationFrame((()=>{requestAnimationFrame((()=>{BX.Dom.style(i,{width:i.scrollWidth+"px",opacity:1})}))}));const n=()=>{BX.Dom.removeClass(i,"main-buttons-item-insert-animation");BX.Dom.style(i,"width",null);BX.Dom.style(i,"opacity",null);const t=this.getItemData(e);this.recalculateItemsCounters([t]);this.showMoreMenu();this.updateMoreButtonCounter();this.showChildMenu(e);this.saveSettings()};setTimeout(n,300);this.initItem(i);this.pinItem(t);this.destroyMoreMenu();this.destroyChildMenu()},handleItemUnpin:function(t,e){BX.Dom.style(e,{width:e.offsetWidth+"px"});BX.Dom.addClass(e,"main-buttons-item-insert-animation");requestAnimationFrame((()=>{requestAnimationFrame((()=>{BX.Dom.style(e,{width:0,margin:0,opacity:0})}))}));const s=()=>{BX.Dom.remove(e);this.showMoreMenu();this.updateMoreButtonCounter();this.saveSettings()};setTimeout(s,300);this.pinItem(t,false);const i=[];let n="";const o=t["ID"].split(":");o.forEach((t=>{n+=`${n===""?"":":"}${t}`;const e=this.getItemById(n);if(e){i.push(this.getItemData(e))}}));this.destroyMoreMenu();this.recalculateItemsCounters(i)},pinItem:function(t,e=true){const s=t["ID"];const i=s.split(":");let n="";i.forEach(((t,o)=>{n+=`${n===""?"":":"}${t}`;const a=this.getItemById(n);if(!a){return}const u=this.getItemData(a);let r=u["ITEMS"];let l=n;const h=i.slice(o+1);const m=[u];while(BX.Type.isArrayFilled(h)&&BX.Type.isArrayFilled(r)){l=l+":"+h.shift();for(let t=0;t<r.length;t++){const i=r[t];if(i["ID"]===s){i["IS_PINNED"]=e;for(let t=m.length-1;t>=0;t--){const s=m[t];const i=t===0;if(e){const t=s["ITEMS"].some((t=>{const e=t["IS_PINNED"]===true;const s=t["IS_DISBANDED"]===true;const i=t["IS_DELIMITER"]===true;return!e&&!s&&!i}));if(!t){s["IS_DISBANDED"]=true;if(i){a.dataset.disbanded=true}}}else{if(i){a.dataset.disbanded=false}s["IS_DISBANDED"]=false}const n=s["ITEMS"].some((t=>t["IS_ACTIVE"]===true&&t["IS_PINNED"]!==true&&t["IS_DELIMITER"]!==true));if(n){s["IS_ACTIVE"]=true;if(i){this.activateItem(a)}}else{s["IS_ACTIVE"]=false;if(i){this.deactivateItem(a)}}}return}else if(i["ID"]===l){r=i["ITEMS"];l=i["ID"];m.push(i);break}}}}))},getParentItem:function(t){const e=t.split(":");let s="";for(let i=0;i<e.length;i++){s+=`${s===""?"":":"}${e[i]}`;const n=this.getItemById(s);if(!n){continue}const o=this.getItemData(n);let a=o["ITEMS"];let u=s;const r=e.slice(i+1);let l=null;while(BX.Type.isArrayFilled(r)&&BX.Type.isArrayFilled(a)){u=u+":"+r.shift();for(let e=0;e<a.length;e++){const s=a[e];if(s["ID"]===t){return l===null?o:l}else if(s["ID"]===u){a=s["ITEMS"];u=s["ID"];l=s;break}}}}return null},_onDragStart:function(t){const e=this.getVisibleItems();const s=BX.Type.isArray(e)?e.length:null;this.dragItem=this.getItem(t);if(!BX.Type.isDomNode(this.dragItem)){return}if(s===1&&this.isListItem(this.dragItem)){t.preventDefault();BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[this.dragItem,this]);return}if(this.isMoreButton(this.dragItem)||this.isSeparator(this.dragItem)||this.isNotHiddenItem(this.dragItem)||BX.Dom.attr(this.dragItem,"data-parent-item-id")||BX.Dom.attr(this.dragItem,"data-has-child")){t.preventDefault();return}this.onDragStarted=true;this.closeChildMenu();this.destroyItemEditMenu();if(this.isListItem(this.dragItem)){this.showMoreMenu()}this.setDragStyles();if(!this.isEditEnabled()){this.enableEdit()}},_onDragEnd:function(t){t.preventDefault();const e=this.getItem(t);this.onDragStarted=false;if(!BX.Type.isDomNode(e)){return}this.unsetDragStyles();this.refreshMoreMenu();if(!this.isEditEnabled()){this.closeMoreMenu()}const s=BX.findNextSibling(this.dragItem,(t=>this.isVisibleItem(t)));const i=BX.findPreviousSibling(this.dragItem,(t=>this.isVisibleItem(t)));if(BX.Dom.hasClass(i,this.classHiddenLabel)||this.isDisabled(i)&&this.isSubmenuItem(i)||this.isDisabled(s)&&this.isSubmenuItem(s)){this.disableItem(this.dragItem);this.refreshMoreMenu()}if(this.isEditEnabled()){this.enableEdit()}else{this.disableEdit()}this.updateMoreButtonCounter();this.saveSettings();this.dragItem=null;this.overItem=null;this.tmp.moved=false},updateMoreButtonCounter:function(){let t=this.getHiddenItems();const e=this.getDisabledItems();t=t.concat(e);let s=0;if(BX.Type.isArray(t)){t.forEach((t=>{const e=this.getItemData(t);const i=BX.Type.isNumber(e["COUNTER"])&&e["COUNTER"]>0?e["COUNTER"]:0;s+=i}))}if(BX.Type.isNumber(s)){this.setMoreButtonCounter(s)}},_onDragEnter:function(t){const e=this.getItem(t);if(BX.Type.isDomNode(e)&&this.isNotHiddenItem(e)){this.setOverStyles(e)}},_onDragOver:function(t){t.preventDefault();this.overItem=this.getItem(t);if(!BX.Type.isDomNode(this.overItem)||!BX.Type.isDomNode(this.dragItem)||this.overItem===this.dragItem||this.isNotHiddenItem(this.overItem)||BX.Dom.attr(this.overItem,"data-parent-item-id")||BX.Dom.attr(this.overItem,"data-has-child")){return}this.fakeDragItem();const e=this.isNext(t);const s=this.isGoodPosition(t);if(e&&s){let t;let e=false;if(this.isListItem(this.overItem)){t=this.findNextSiblingByClass(this.overItem,this.classItem);if(t===null&&this.getLastVisibleItem()===this.overItem){t=this.overItem;e=true}}else{t=this.findNextSiblingByClass(this.overItem,this.classSubmenuItem);if(this.isSettings(t)||this.isApplySettingsButton(t)||this.isResetSettingsButton(t)){return}if(t===null&&this.getItemAlias(this.getLastDisabledItem())===this.overItem){t=this.overItem;e=true}}if(BX.Type.isDomNode(t)){this.moveButton(t,e);this.moveButtonAlias(t,e);this.adjustMoreButtonPosition();this.updateMoreMenuItems()}}else if(!e&&s&&!BX.Dom.hasClass(this.overItem,this.classHiddenLabel)){this.moveButton(this.overItem);this.moveButtonAlias(this.overItem);this.adjustMoreButtonPosition();this.updateMoreMenuItems()}},_onDragLeave:function(t){const e=this.getItem(t);if(BX.Type.isDomNode(e)){this.unsetOverStyles(t.target)}},_onDrop:function(t){const e=this.getItem(t);if(!BX.Type.isDomNode(e)){return}if(this.isNotHiddenItem(e)||this.isDisabled(e)){this.disableItem(this.dragItem);this.adjustMoreButtonPosition()}const s=this.getItemAlias(this.dragItem);if(this.isListItem(s)){s.dataset.disabled="false"}this.unsetDragStyles();t.preventDefault()},handleMoreMenuFirstShow:function(t){const e=t.getTarget();BX.Event.bind(e.getPopupContainer(),"mouseenter",this.handleMoreMenuMouseEnter.bind(this));BX.Event.bind(e.getPopupContainer(),"mouseleave",this.handleMoreMenuMouseLeave.bind(this))},handleMoreMenuMouseEnter:function(){clearTimeout(this.submenuLeaveTimeout)},handleMoreMenuMouseLeave:function(){this.tryCloseMoreMenuOnTimeout()},tryCloseMoreMenuOnTimeout:function(){clearTimeout(this.submenuLeaveTimeout);if(!this.isEditEnabled()){this.submenuLeaveTimeout=setTimeout((()=>{this.closeMoreMenu()}),500)}},handleMoreMenuShow:function(t){BX.Event.EventEmitter.emit("BX.Main.InterfaceButtons:onMenuShow");BX.Event.EventEmitter.emit(this,"BX.Main.InterfaceButtons:onMoreMenuShow",{event:t});setTimeout((()=>{if(!this.isEditEnabled()){t.getTarget().setAutoHide(true)}}),500)},handleMoreMenuClose:function(){BX.Event.EventEmitter.emit(this,"BX.Main.InterfaceButtons:onMoreMenuClose");this.setMoreMenuShown(false);if(this.isEditEnabled()){this.activateItem(this.moreButton)}else{if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}}this.destroyItemEditMenu()},_onChildMenuFirstShow:function(t){const e=t.getTarget();BX.Event.bind(e.getPopupContainer(),"mouseenter",this._onChildMenuMouseEnter.bind(this));BX.Event.bind(e.getPopupContainer(),"mouseleave",this._onChildMenuMouseLeave.bind(this))},_onChildMenuMouseEnter:function(){clearTimeout(this.childMenuLeaveTimeout)},_onChildMenuMouseLeave:function(){this.tryCloseChildMenuOnTimeout()},tryCloseChildMenuOnTimeout:function(){if(this.isEditEnabled()){return}clearTimeout(this.childMenuLeaveTimeout);this.childMenuLeaveTimeout=setTimeout((()=>{this.closeChildMenu()}),500)},_onChildMenuShow:function(t,e){BX.Dom.addClass(t,this.classMenuShown);BX.Event.EventEmitter.emit("BX.Main.InterfaceButtons:onMenuShow");BX.Event.EventEmitter.emit(this,"BX.Main.InterfaceButtons:onSubMenuShow",{item:t,event:e});if(this.theme!=="default"){this.centerPopupArrow(e.getTarget(),t)}setTimeout((()=>{e.getTarget().setAutoHide(true)}),500)},_onChildMenuClose:function(t){BX.Event.EventEmitter.emit(this,"BX.Main.InterfaceButtons:onSubMenuClose");BX.Dom.removeClass(t,this.classMenuShown);this.closePinHint()},handleAdjustPosition:function(t,e){const s=25;const i=BX.Dom.getPosition(t);const n=e.getTarget();if(e.left<i.left-s){const t=n.getPopupContainer().offsetWidth;const o=i.right-t+s;if(o>0){e.left=o;BX.Dom.addClass(n.getPopupContainer(),"--left-handed")}}else{BX.Dom.removeClass(n.getPopupContainer(),"--left-handed")}},_onResizeHandler:function(){this.adjustMoreButtonPosition();this.updateMoreMenuItems();this.closeChildMenu();if(!this.isSettingsEnabled){this.visibleControlMoreButton()}},handleMoreButtonClick:function(t){t.preventDefault();this.showMoreMenu()},handleMoreButtonMouseEnter:function(t){if(this.enableItemMouseEnter){clearTimeout(this.menuShowTimeout);this.menuShowTimeout=setTimeout((()=>{this.showMoreMenu()}),100)}clearTimeout(this.submenuLeaveTimeout)},handleMoreButtonMouseLeave:function(){clearTimeout(this.menuShowTimeout);this.tryCloseMoreMenuOnTimeout()},handleItemMouseEnter:function(t){if(!this.enableItemMouseEnter){return}if(this.onDragStarted){return}const e=this.getItem(t);clearTimeout(this.childMenuLeaveTimeout);clearTimeout(this.menuShowTimeout);this.menuShowTimeout=setTimeout((()=>{this.showChildMenu(e)}),100);BX.Dom.addClass(e,this.classItemOver)},handleItemMouseLeave:function(t){clearTimeout(this.menuShowTimeout);if(!this.enableItemMouseEnter){return}if(this.onDragStarted){return}const e=this.getItem(t);BX.Dom.removeClass(e,this.classItemOver);this.tryCloseChildMenuOnTimeout()},handleMoreMenuItemMouseEnter:function(t){if(this.isEditEnabled()){t.preventDefault()}},getSettingsResetButton:function(){return BX.Buttons.Utils.getByClass(this.getMoreMenuContainer(),this.classSettingsResetButton)},isDisabled:function(t){let e=false;if(BX.Type.isDomNode(t)){e=this.dataValue(t,"disabled")==="true"||BX.Dom.hasClass(t,this.classItemDisabled)}return e},isPinned:function(t){let e=false;if(BX.Type.isDomNode(t)){e=this.getItemData(t)["IS_PINNED"]===true}return e},isSettings:function(t){let e=false;if(BX.Type.isDomNode(t)){e=BX.Dom.hasClass(t,this.classSettingMenuItem)}return e},isLocked:function(t){let e=false;if(BX.Type.isDomNode(t)){e=this.dataValue(t,"locked")==="true"||BX.Dom.hasClass(t,this.classItemLocked)}return e},isDropzone:function(t){return BX.Dom.hasClass(t,this.classDropzone)},isNext:function(t){const e=this.dragItem.getBoundingClientRect();const s=this.overItem.getBoundingClientRect();const i=getComputedStyle(this.dragItem);const n=parseInt(i.marginRight.replace("px",""));let o=null;if(this.isListItem(this.overItem)){o=t.clientX>s.left-n&&t.clientX>e.right}if(this.isSubmenuItem(this.overItem)){o=t.clientY>e.top}return o},isGoodPosition:function(t){const e=this.overItem;if(!BX.Type.isDomNode(e)){return false}let s;const i=e.getBoundingClientRect();if(this.isListItem(e)){s=this.isNext(t)&&t.clientX>=i.left+i.width/2||!this.isNext(t)&&t.clientX<=i.left+i.width/2}if(this.isSubmenuItem(e)){s=this.isNext(t)&&t.clientY>=i.top+i.height/2||!this.isNext(t)&&t.clientY<=i.top+i.height/2}return s},isSubmenuItem:function(t){return BX.Dom.hasClass(t,this.classSubmenuItem)},isVisibleItem:function(t){if(!BX.Type.isDomNode(t)){return false}return t.offsetTop===0},isMoreButton:function(t){let e=false;if(BX.Type.isDomNode(t)&&BX.Dom.hasClass(t,this.classItemMore)){e=true}return e},isListItem:function(t){let e=false;if(BX.Type.isDomNode(t)&&BX.Dom.hasClass(t,this.classItem)){e=true}return e},isSublink:function(t){let e=false;if(BX.Type.isDomNode(t)){e=BX.Dom.hasClass(t,this.classItemSublink)}return e},isSeparator:function(t){let e=false;if(BX.Type.isDomNode(t)){e=BX.Dom.hasClass(t,this.classSeparator)}return e},isDragToSubmenu:function(){return!this.isSubmenuItem(this.dragItem)&&this.isSubmenuItem(this.overItem)},isDragToList:function(){return this.isSubmenuItem(this.dragItem)&&!this.isSubmenuItem(this.overItem)}}}if(typeof BX.Main.interfaceButtonsManager==="undefined"){BX.Main.interfaceButtonsManager={data:{},init:function(t){let e=null;if(!BX.Type.isPlainObject(t)||!("containerId"in t)){throw"BX.Main.interfaceButtonsManager: containerId not set in params Object"}e=BX(t.containerId);if(BX.Type.isDomNode(e)){this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)}else{BX(BX.delegate((function(){e=BX(t.containerId);if(!BX.Type.isDomNode(e)){throw"BX.Main.interfaceButtonsManager: container is not dom node"}this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)}),this))}},getById:function(t){let e=null;if(BX.type.isString(t)&&BX.Type.isStringFilled(t)){try{e=this.data[t]}catch(t){}}return e},getObjects:function(){return this.data}}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:91:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.js?16992579501940";s:6:"source";s:76:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
;(function() {
	'use strict';

	BX.namespace('BX.Buttons');

	/**
	 * BX.Main.interfaceButtons Utils
	 * @type {{getByClass: BX.Buttons.Utils.getByClass, getByTag: BX.Buttons.Utils.getByTag, getBySelector: BX.Buttons.Utils.getBySelector}}
	 */
	BX.Buttons.Utils = {
		/**
		 * Gets elements by className
		 * @param {HTMLElement|HTMLDocument} rootElement
		 * @param {string} className
		 * @param {boolean} [all = false] Gets all elements
		 * @returns {HTMLElement|Array}
		 */
		getByClass: function(rootElement, className, all)
		{
			var result = [];

			if (className)
			{
				result = (rootElement || document.body).getElementsByClassName(className);

				if (!all)
				{
					result = result.length ? result[0] : null;
				}
				else
				{
					result = [].slice.call(result);
				}
			}

			return result;
		},

		/**
		 * Gets elements by by element tag name
		 * @param {HTMLElement|HTMLDocument} rootElement
		 * @param {string} tag
		 * @param {boolean} [all = false] Gets all elements
		 * @returns {HTMLElement|Array}
		 */
		getByTag: function(rootElement, tag, all)
		{
			var result = [];

			if (tag)
			{
				result = (rootElement || document.body).getElementsByTagName(tag);

				if (!all)
				{
					result = result.length ? result[0] : null;
				}
				else
				{
					result = [].slice.call(result);
				}
			}

			return result;
		},

		/**
		 * Gets elements by css selector
		 * @param {HTMLElement|HTMLDocument} rootElement
		 * @param {string} selector
		 * @param {boolean} [all = false] Gets all elements
		 * @returns {HTMLElement|Array}
		 */
		getBySelector: function(rootElement, selector, all)
		{
			var result = [];

			if (selector)
			{
				if (!all)
				{
					result = (rootElement || document.body).querySelector(selector);
				}
				else
				{
					result = (rootElement || document.body).querySelectorAll(selector);
					result = [].slice.call(result);
				}
			}

			return result;
		}
	}
})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/logic.min.js?16992580834013";s:6:"source";s:77:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/logic.js";s:3:"min";s:81:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/logic.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/logic.map.js";}"*/
"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TopMenu!="undefined"){return}BX.Tasks.Component.TopMenu=BX.Tasks.Component.extend({sys:{code:"topmenu"},methodsStatic:{instances:{},getInstance:function(t){return BX.Tasks.Component.TopMenu.instances[t]},addInstance:function(t,e){BX.Tasks.Component.TopMenu.instances[t]=e}},methods:{construct:function(){this.callConstruct(BX.Tasks.Component);BX.Tasks.Component.TopMenu.addInstance(this.sys.code,this);this.userId=Number(this.option("userId"));this.ownerId=Number(this.option("ownerId"));this.groupId=Number(this.option("groupId"));this.isScrumLimitExceeded=Boolean(this.option("isScrumLimitExceeded"));this.isTaskAccessPermissionsLimit=Boolean(this.option("isTaskAccessPermissionsLimit"))},bindEvents:function(){try{var t=this.option("use_ajax_filter")?this.scope().getElementsByClassName("tasks_role_link"):{};if(t.length){for(var e=0;e<t.length;e++){BX.bind(t[e],"click",(function(t){t.preventDefault();var e=t.target.className;var s=this.dataset.id=="view_all"?"":this.dataset.id;var n=this.dataset.url;if(e==="main-buttons-item-sublink "&&s===""||e==="main-buttons-item-edit-button"){return}BX.onCustomEvent("Tasks.TopMenu:onItem",[s,n]);var i=this.parentElement.getElementsByClassName("tasks_role_link");if(i.length){for(var o=0;o<i.length;o++){BX.removeClass(i[o],"main-buttons-item-active")}}BX.addClass(this,"main-buttons-item-active")}))}}}catch(t){}BX.addCustomEvent("onPullEvent-tasks",function(t,e){switch(t){case"user_counter":this.onUserCounter(e);break;case"project_add":this.onProjectAdd(e);break;case"project_remove":this.onProjectRemove(e);break}}.bind(this));BX.addCustomEvent("BX.Main.Filter:apply",function(t,e,s){this.onFilterApply(t,e,s)}.bind(this))},isMyList:function(){return this.userId===this.ownerId},onUserCounter:function(t){if(!this.isMyList()||this.userId!==Number(t.userId)){return}var e=BX("tasks_panel_menu_view_projects");if(e){e.querySelector(".main-buttons-item-counter").innerText=this.getCounterValue(t.projects_major)}Object.keys(t[0]).forEach(function(e){var s=BX("tasks_panel_menu_"+(this.groupId?"group_":"")+e);if(s){s.querySelector(".main-buttons-item-counter").innerText=this.getCounterValue(t[0][e].total)}}.bind(this));var s=BX("tasks_panel_menu_view_scrum");if(s){s.querySelector(".main-buttons-item-counter").innerText=this.getCounterValue(t.scrum_total_comments)}},createScrum:function(t,e){if(this.isScrumLimitExceeded){BX.UI.InfoHelper.show(e,{isLimit:true,limitAnalyticsLabels:{module:"tasks",source:"scrumList"}})}else{BX.SidePanel.Instance.open(t)}},showConfigPermissions:function(){if(this.isTaskAccessPermissionsLimit){BX.UI.InfoHelper.show("limit_task_access_permissions",{isLimit:true,limitAnalyticsLabels:{module:"tasks",source:"topMenu"}})}else{BX.SidePanel.Instance.open("/tasks/config/permissions/",{cacheable:false,events:{onOpen:function(){var t=BX.Main.interfaceButtonsManager;for(var e in t.data){t.data[e].closeSubmenu()}}}})}},onProjectAdd:function(t){this.updateScrumLimit()},onProjectRemove:function(t){this.updateScrumLimit()},updateScrumLimit(){var t=BX("tasks_panel_menu_view_scrum");if(!t){return}this.checkScrumLimit().then(function(t){this.isScrumLimitExceeded=Boolean(t)}.bind(this))},checkScrumLimit:function(){return BX.ajax.runAction("bitrix:tasks.scrum.info.checkScrumLimit",{data:{},signedParameters:this.signedParameters}).then((function(t){return t.data}))},getCounterValue:function(t){if(!t){return""}var e=99;return t>e?e+"+":t},onFilterApply:function(t,e,s){try{var n=s.getFilterFieldsValues().ROLEID;var i=BX.Tasks.Component.TopMenu.getInstance("topmenu").scope();var o=i.querySelectorAll(".tasks_role_link");for(var a=0;a<o.length;a++){BX.removeClass(o[a],"main-buttons-item-active")}if(typeof n!=="undefined"){if(!n){n="view_all"}BX.addClass(BX("tasks_panel_menu_"+n),"main-buttons-item-active");var r=BX.Tasks.Component.TasksToolbar.getInstance();if(r){r.rerender(n)}}}catch(t){}}}})}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:104:"/bitrix/components/bitrix/tasks.interface.filter.buttons/templates/.default/script.min.js?16992580822944";s:6:"source";s:85:"/bitrix/components/bitrix/tasks.interface.filter.buttons/templates/.default/script.js";s:3:"min";s:89:"/bitrix/components/bitrix/tasks.interface.filter.buttons/templates/.default/script.min.js";s:3:"map";s:89:"/bitrix/components/bitrix/tasks.interface.filter.buttons/templates/.default/script.map.js";}"*/
"use strict";BX.namespace("BX.Tasks");BX.Tasks.InterfaceFilterButtons=function(t){this.section=t.section;this.entityId=t.entityId;this.muted=t.muted;this.checklistShowCompleted=t.checklistShowCompleted;this.initButtons();this.bindControls()};BX.Tasks.InterfaceFilterButtons.prototype={constructor:BX.Tasks.InterfaceFilterButtons,initButtons:function(){this.muteButton=this.getMuteButton();this.optionsMenuButton=this.getOptionsMenuButton()},getMuteButton:function(){var t="";switch(this.section){case"VIEW_TASK":t="taskViewMute";break;default:break}return BX(t)},getOptionsMenuButton:function(){var t="";switch(this.section){case"EDIT_TASK":t="taskEditPopupMenuOptions";break;case"VIEW_TASK":t="taskViewPopupMenuOptions";break;default:break}return BX(t)},bindControls:function(){var t=[{control:this.muteButton,action:"click",method:this.onMuteButtonClick.bind(this)},{control:this.optionsMenuButton,action:"click",method:this.onOptionsMenuButtonClick.bind(this)}];t.forEach(function(t){if(t.control){BX.bind(t.control,t.action,t.method)}})},onMuteButtonClick:function(){if(this.muteInProgress){return}this.muteInProgress=true;var t="tasks.task."+(this.muted?"unmute":"mute");var e={data:{taskId:this.entityId}};BX.ajax.runAction(t,e).then(function(){var t=this.muted?"ui-btn-icon-unfollow":"ui-btn-icon-follow";var e=this.muted?"ui-btn-icon-follow":"ui-btn-icon-unfollow";var n=this.muted?BX.message("MUTE_BUTTON_HINT_MUTE"):BX.message("MUTE_BUTTON_HINT_UNMUTE");BX.removeClass(this.muteButton,t);BX.addClass(this.muteButton,e);this.muteButton.setAttribute("data-hint",n);this.muteButton.removeAttribute("data-hint-init");BX.UI.Hint.init();BX.UI.Hint.hide();BX.UI.Hint.show(this.muteButton,n);this.muted=!this.muted;this.muteInProgress=false}.bind(this))},onOptionsMenuButtonClick:function(){var t=[{delimiter:true,text:BX.message("POPUP_MENU_CHECKLIST_SECTION")}];t.push({tabId:"showCompleted",text:BX.message("POPUP_MENU_SHOW_COMPLETED"),className:this.checklistShowCompleted?"menu-popup-item-accept":"menu-popup-item",onclick:function(t,e){e.getMenuWindow().close();if(typeof BX.Tasks.CheckListInstance!=="undefined"){BX.toggleClass(e.layout.item,"menu-popup-item-accept");var n=BX.Tasks.CheckListInstance.getTreeStructure();var i=n.optionManager;i.setShowCompleted(!i.getShowCompleted());n.handleTaskOptions()}}});t.push({tabId:"showOnlyMine",text:BX.message("POPUP_MENU_SHOW_ONLY_MINE"),className:"menu-popup-item",onclick:function(t,e){e.getMenuWindow().close();if(typeof BX.Tasks.CheckListInstance!=="undefined"){BX.toggleClass(e.layout.item,"menu-popup-item-accept");var n=BX.Tasks.CheckListInstance.getTreeStructure();var i=n.optionManager;i.setShowOnlyMine(!i.getShowOnlyMine());n.handleTaskOptions()}}});var e=BX.PopupMenu.create("taskPopupMenuOptions",this.optionsMenuButton,t,{closeByEsc:true,offsetLeft:this.optionsMenuButton.getBoundingClientRect().width/2,angle:true});e.popupWindow.show()}};
/* End */
;
; /* Start:"a:4:{s:4:"full";s:87:"/bitrix/components/bitrix/disk.uf.file/templates/.default/script.min.js?169925797466406";s:6:"source";s:67:"/bitrix/components/bitrix/disk.uf.file/templates/.default/script.js";s:3:"min";s:71:"/bitrix/components/bitrix/disk.uf.file/templates/.default/script.min.js";s:3:"map";s:71:"/bitrix/components/bitrix/disk.uf.file/templates/.default/script.map.js";}"*/
this.BX=this.BX||{};this.BX.Disk=this.BX.Disk||{};(function(e,t,i,n,a,r,s){"use strict";var o=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"set",value:function t(i){for(var n in i){if(e.hasOwnProperty(n)){e[n]=i[n]}}}},{key:"getDocumentHandlers",value:function t(){if(!e.documentHandlers){return[]}return e.documentHandlers}},{key:"getDocumentHandler",value:function t(i){if(!e.documentHandlers){return{}}var n=e.documentHandlers.find((function(e){return e.code===i}));return n||{}}}]);return e}();babelHelpers.defineProperty(o,"urlUpload",null);babelHelpers.defineProperty(o,"documentHandlers",null);babelHelpers.defineProperty(o,"previewSize",{width:115,height:115});var l;var c=function(){function e(t,i){babelHelpers.classCallCheck(this,e);this.id=t;this.object=i;this.data={NAME:i.name};s.EventEmitter.subscribe(this.object,"onUploadProgress",this.onUploadProgress.bind(this));s.EventEmitter.subscribe(this.object,"onUploadDone",this.onUploadDone.bind(this));s.EventEmitter.subscribe(this.object,"onUploadError",this.onUploadError.bind(this));this.progress=new BX.UI.ProgressRound({width:18,colorTrack:"rgba(255,255,255,.3)",colorBar:"#fff",lineSize:3,statusType:BX.UI.ProgressRound.Status.INCIRCLE,textBefore:"<i></i>",textAfter:this.object.size})}babelHelpers.createClass(e,[{key:"getContainer",value:function e(){if(!this.container){var t=this.object.name.split(".").pop().toLowerCase();t=r.Text.encode(t===this.object.name?"":t);this.container=r.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t<div class="disk-file-thumb disk-file-thumb-file disk-file-thumb--',' disk-file-thumb--active">\n\t\t\t<div class="ui-icon ui-icon-file-',' disk-file-thumb-icon"><i></i></div>\n\t\t\t<div class="disk-file-thumb-text">','</div>\n\t\t\t<div class="disk-file-thumb-loader">\n\t\t\t\t','\n\t\t\t\t<div class="disk-file-thumb-loader-btn" onclick="','"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t'])),t,t,r.Text.encode(this.object.name),this.progress.getContainer(),this.onClickDelete.bind(this))}return this.container}},{key:"onClickDelete",value:function e(t){var i=this;t.preventDefault();t.stopPropagation();s.EventEmitter.emit(this,"onDelete",[this]);setTimeout((function(){i.object.deleteFile()}),400);delete this.container}},{key:"onUploadProgress",value:function e(t){var i=babelHelpers.slicedToArray(t.compatData,2),n=i[0],a=i[1];a=Math.min(Math.max(this.progress.getValue(),a),98);this.progress.update(a)}},{key:"onUploadDone",value:function e(t){var i=babelHelpers.slicedToArray(t.compatData,2),n=i[0],a=i[1].file;s.EventEmitter.emit(this,"onUploadDone",[a,n.file]);delete this.object.hash;this.object.deleteFile()}},{key:"onUploadError",value:function e(t){var i=babelHelpers.slicedToArray(t.compatData,1),n=i[0];s.EventEmitter.emit(this,"onUploadError",[n.file]);this.progress.setTextBefore(r.Loc.getMessage("WDUF_ITEM_ERROR"));this.container.classList.add("disk-file-upload-error");this.object.deleteFile()}}]);return e}();function u(e,t,i){d(e,t);t.set(e,i)}function d(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function h(e,t,i){b(e,t);p(i,"get");return f(e,i)}function p(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function b(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function f(e,t){if(t.get){return t.get.call(e)}return t.value}var m=new WeakMap;var v=function(){function e(t){var i=t.id,n=t.container,a=t.dropZone,r=t.input;babelHelpers.classCallCheck(this,e);u(this,m,{writable:true,value:0});this.container=n;this.agent=BX.Uploader.getInstance({id:i,allowUpload:"A",uploadFormData:"N",uploadMethod:"immediate",uploadFileUrl:o.urlUpload,showImage:false,sortItems:false,dropZone:a,input:r,pasteFileHashInForm:false});s.EventEmitter.subscribe(this.agent,"onFileIsCreated",this.catchFile.bind(this));s.EventEmitter.subscribe(this.agent,"onPackageIsInitialized",(function(e){var t=babelHelpers.slicedToArray(e.compatData,1),i=t[0];var n={width:o.previewSize.width,height:o.previewSize.height,exact:"N"};if(i.data){i.data["previewParams"]=n}else{i.post.data["previewParams"]=n}}))}babelHelpers.createClass(e,[{key:"catchFile",value:function t(i){var n=this;var a=babelHelpers.slicedToArray(i.compatData,2),r=a[0],o=a[1];this.incrementItemsCount();var l=new c(r,o);s.EventEmitter.subscribe(l,"onUploadDone",(function(t){var i=babelHelpers.slicedToArray(t.data,2),a=i[0],r=i[1];if(!l[h(n.constructor,e,g)]){n.decrementItemsCount();s.EventEmitter.emit(n,"onUploadDone",{itemData:n.convertToItemSavedType(a),itemContainer:l.getContainer(),blob:r})}}));s.EventEmitter.subscribe(l,"onUploadError",(function(t){var i=babelHelpers.slicedToArray(t.data,1),a=i[0];n.decrementItemsCount();l[h(n.constructor,e,g)]=true;s.EventEmitter.emit(n,"onUploadError",{itemContainer:l.getContainer(),blob:a})}));s.EventEmitter.subscribe(l,"onDelete",(function(){n.decrementItemsCount();l[h(n.constructor,e,g)]=true;n.container.removeChild(l.getContainer())}));this.container.appendChild(l.getContainer())}},{key:"addTestThumb",value:function e(t){var i=this;var n=new c(Math.ceil(Math.random()*1e3),{name:"test.file.js",size:"348 Kb",deleteFile:function e(){}});this.container.appendChild(n.getContainer());if(t>0){n.onUploadProgress({compatData:[null,t]})}s.EventEmitter.subscribe(n,"onDelete",(function(){i.container.removeChild(n.getContainer())}))}},{key:"addTestErrorThumb",value:function e(){var t=this;var i=new c(Math.ceil(Math.random()*1e3),{name:"test.file.js",size:"348 Kb",deleteFile:function e(){}});this.container.appendChild(i.getContainer());i.onUploadError({compatData:[{file:null}]});s.EventEmitter.subscribe(i,"onDelete",(function(){t.container.removeChild(i.getContainer())}))}},{key:"upload",value:function e(t){var i=babelHelpers.toArray(t),n=i.slice(0);this.agent.onAttach(n)}},{key:"convertToItemSavedType",value:function e(t){return{ID:t.attachId,IS_LOCKED:false,IS_MARK_DELETED:false,EDITABLE:false,FROM_EXTERNAL_SYSTEM:false,CAN_RESTORE:false,CAN_UPDATE:t.canChangeName,CAN_RENAME:t.canChangeName,CAN_MOVE:t.canChangeName,COPY_TO_ME_URL:null,DELETE_URL:null,DOWNLOAD_URL:null,EDIT_URL:null,VIEW_URL:null,PREVIEW_URL:t.previewUrl?t.previewUrl:"",BIG_PREVIEW_URL:t.previewUrl?t.previewUrl.replace(/\&(width|height)=\d+/gi,""):null,EXTENSION:t.ext,NAME:t.name,SIZE:t.size,SIZE_BYTES:t.sizeInt,STORAGE:t.storage,TYPE_FILE:t.fileType}}},{key:"incrementItemsCount",value:function e(){var t;if(babelHelpers.classPrivateFieldGet(this,m)<=0){s.EventEmitter.emit(this,"onUploadIsStart")}babelHelpers.classPrivateFieldSet(this,m,(t=+babelHelpers.classPrivateFieldGet(this,m))+1),t}},{key:"decrementItemsCount",value:function e(){var t;if(babelHelpers.classPrivateFieldGet(this,m)===1){s.EventEmitter.emit(this,"onUploadIsDone")}babelHelpers.classPrivateFieldSet(this,m,Math.max((babelHelpers.classPrivateFieldSet(this,m,(t=+babelHelpers.classPrivateFieldGet(this,m))-1),t),0))}}]);return e}();var g={writable:true,value:Symbol("deleted")};var E=function(){function e(t){var i=t.container,n=t.eventObject;babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"hasContainer",false);babelHelpers.defineProperty(this,"cache",new r.Cache.MemoryCache);babelHelpers.defineProperty(this,"properties",{pluggedIn:false});this.container=i;this.eventObject=n;this.properties.pluggedIn=this.eventObject&&this.eventObject.dataset.bxHtmlEditable==="Y";if(!this.container){return}this.hasContainer=true}babelHelpers.createClass(e,[{key:"isRelevant",value:function e(){return this.hasContainer}},{key:"getEventObject",value:function e(){return this.eventObject}},{key:"getContainer",value:function e(){return this.container}},{key:"isPluggedIn",value:function e(){return this.properties.pluggedIn}},{key:"show",value:function e(){this.container.style.display="";delete this.container.style.display}},{key:"hide",value:function e(){this.container.style.display="none"}}]);return e}();var D;var I=function(){function e(){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"hiddenFilesCount",0);babelHelpers.defineProperty(this,"stepNumber",0);babelHelpers.defineProperty(this,"cache",new r.Cache.MemoryCache);babelHelpers.defineProperty(this,"stepValue",5)}babelHelpers.createClass(e,[{key:"getContainer",value:function e(){var t=this;return this.cache.remember("container",(function(){return r.Tag.render(D||(D=babelHelpers.taggedTemplateLiteral(['\n\t\t<div class="disk-file-thumb disk-file-thumb-file" onclick="','">\n\t\t\t<div class="ui-icon ui-icon-more disk-file-thumb-icon">\n\t\t\t\t<i></i>\n\t\t\t</div>\n\t\t\t<div class="disk-file-thumb-text">',"</div>\n\t\t</div>"])),t.onClick.bind(t),t.getValueContainer())}))}},{key:"getValueContainer",value:function e(){return this.cache.remember("valueContainer",(function(){return document.createElement("DIV")}))}},{key:"reset",value:function e(){this.hiddenFilesCount=1;this.stepNumber=0;this.getValueContainer().innerHTML=this.hiddenFilesCount;this.show();return this}},{key:"increment",value:function e(){this.hiddenFilesCount++;this.getValueContainer().innerHTML=this.hiddenFilesCount;this.show()}},{key:"decrement",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;this.hiddenFilesCount-=t;this.getValueContainer().innerHTML=this.hiddenFilesCount;if(this.hiddenFilesCount<=0){this.hide()}}},{key:"onClick",value:function e(){this.stepNumber++;var t=Math.min(30,this.stepValue*this.stepNumber);this.decrement(t);s.EventEmitter.emit(this,"onGetMore",{itemsCount:t})}},{key:"show",value:function e(){delete this.getContainer().style.display}},{key:"hide",value:function e(){this.getContainer().style.display="none"}}]);return e}();var k=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"getSelectedFile",value:function e(t,i,n){var a=this;return new Promise((function(e){r.ajax.get(r.Uri.addParam(a.urlSelect,{ACTION:"none",MULTI:"Y",ID:["E",t].join(""),NAME:i,wish:"fakemove",dialogName:n}),e)}))}},{key:"loadFolder",value:function e(t,i,n){var a=t;var s=r.Uri.addParam([BX.DiskFileDialog.obCurrentTab[n].link.replace("/index.php","").replace("/files/lib/","/files/"),"element/upload",a].join("/"),{use_light_view:"Y",AJAX_CALL:"Y",SIMPLE_UPLOAD:"Y",IFRAME:"Y",sessid:BX.bitrix_sessid(),SECTION_ID:a,CHECK_NAME:i});return new Promise((function(e){r.ajax.loadJSON(s,{},e)}))}},{key:"getSelectedData",value:function e(t){var i=this;return new Promise((function(e){r.ajax.get(r.Uri.addParam(i.urlSelect,{dialogName:t}),e)}))}},{key:"getSelectedCloudData",value:function e(t,i){var n=this;return new Promise((function(e){r.ajax.get(r.Uri.addParam(n.urlSelect,{cloudImport:1,service:i,dialogName:t}),e)}))}},{key:"moveFile",value:function e(t,i){return new Promise((function(e){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","moveUploadedFile"),data:{attachedId:t,targetFolderId:i},onsuccess:e})}))}},{key:"getMetaDataForCreatedFileInUf",value:function e(t){return r.ajax.runAction("disk.api.file.getMetaDataForCreatedFileInUf",{data:{id:t}})}},{key:"renameAction",value:function e(t,i){return new Promise((function(e){r.ajax.post("/bitrix/tools/disk/uf.php?action=renameFile",{newName:i,attachedId:t,sessid:r.Loc.getMessage("bitrix_sessid")},e)}))}},{key:"deleteAction",value:function e(t){return new Promise((function(e){r.ajax.post("/bitrix/tools/disk/uf.php?action=deleteFile",{attachedId:t,sessid:r.Loc.getMessage("bitrix_sessid")},e)}))}}]);return e}();babelHelpers.defineProperty(k,"urlSelect","/bitrix/tools/disk/uf.php?action=selectFile&SITE_ID="+r.Loc.getMessage("SITE_ID")+"&dialog2=Y&ACTION=SELECT&MULTI=Y");var C,y,T,S,_,w,F;function A(e,t){U(e,t);t.add(e)}function L(e,t,i){U(e,t);t.set(e,i)}function U(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function N(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var H=new WeakMap;var x=new WeakSet;var O=new WeakSet;var P=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));A(babelHelpers.assertThisInitialized(i),O);A(babelHelpers.assertThisInitialized(i),x);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"cache",new r.Cache.MemoryCache);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"properties",{pluggedIn:false,insertedInText:false});L(babelHelpers.assertThisInitialized(i),H,{writable:true,value:void 0});i.setEventNamespace("Disk:UF:");i.id=String(e["ID"]);i.setData(e);i.subscribe("onMoved",i.onMoved.bind(babelHelpers.assertThisInitialized(i)));return i}babelHelpers.createClass(t,[{key:"getId",value:function e(){return this.id}},{key:"getFileId",value:function e(){return this.data.FILE_ID}},{key:"getData",value:function e(t){if(t){return this.data[t]}return this.data}},{key:"getAllIds",value:function e(){return[this.getId(),["n",this.data.FILE_ID].join("")]}},{key:"setData",value:function e(t){this.data=t}},{key:"setPluggedIn",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.properties.pluggedIn=t===true}},{key:"isPluggedIn",value:function e(){return this.properties.pluggedIn}},{key:"setInsertedInText",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.properties.insertedInText=t===true;r.Dom.addClass(this.getContainer(),"--edit-text-preview")}},{key:"isInsertedInText",value:function e(){return this.properties.insertedInText}},{key:"getNameWithoutExtension",value:function e(){var t=this.data["NAME"].split(".");if(t.length>1){t.pop()}var i=t.join(".");if(i.length>50){return i.substr(0,39)+"..."+i.substr(-5)}return i}},{key:"getButtonBox",value:function e(){var t="";if(this.isPluggedIn()){t=r.Tag.render(C||(C=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div\n\t\t\t\t\tclass="disk-file-thumb-btn-text-copy"\n\t\t\t\t\tonclick="','"\n\t\t\t\t\tonmouseenter="','"\n\t\t\t\t\tonmouseleave="','"\n\t\t\t\t>\n\t\t\t\t</div>'])),this.onClickInsertInText.bind(this),N(this,x,M).bind(this),N(this,O,R).bind(this))}return r.Tag.render(y||(y=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="disk-file-thumb-btn-box">\n\t\t\t\t','\n\t\t\t\t<div class="disk-file-thumb-btn-more" data-bx-role="more" onclick="','"></div>\n\t\t\t</div>\n\t\t'])),t,this.onClickMore.bind(this))}},{key:"getDeleteButton",value:function e(){return r.Tag.render(T||(T=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="disk-file-thumb-btn-close-box">\n\t\t\t\t<div class="disk-file-thumb-btn-close" onclick="','"></div>\n\t\t\t</div>\n\t\t'])),this.onClickDelete.bind(this))}},{key:"getNameBox",value:function e(t,i){var n="";if(i){n=r.Tag.render(S||(S=babelHelpers.taggedTemplateLiteral(['<span class="disk-file-thumb-file-extension">.',"</span>"])),i)}return r.Tag.render(_||(_=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="disk-file-thumb-text-box">\n\t\t\t\t<div data-bx-role="name" class="disk-file-thumb-text">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),t,n)}},{key:"getIcon",value:function e(t){return r.Tag.render(w||(w=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div data-bx-role="icon" class="ui-icon ui-icon-file-',' disk-file-thumb-icon"><i></i></div>\n\t\t'])),t)}},{key:"getContainer",value:function e(){var t=this;return this.cache.remember("container",(function(){var e=r.Text.encode(t.getNameWithoutExtension());var i=r.Text.encode(t.data["EXTENSION"]).toLowerCase();switch(i){case"pptx":i="ppt";break}return r.Tag.render(F||(F=babelHelpers.taggedTemplateLiteral(['\n\t\t<div class="disk-file-thumb disk-file-thumb-file disk-file-thumb--','">\n\t\t\t',"\n\t\t\t","\n\t\t\t","\n\t\t\t","\n\t\t</div>"])),i,t.getIcon(i),t.getNameBox(e,i),t.getDeleteButton(),t.getButtonBox())}))}},{key:"rename",value:function e(t){this.data["NAME"]=t;if(this.hasContainer()){this.getContainer().querySelector('[data-bx-role="name"]').innerHTML=r.Text.encode(this.data["NAME"])}}},{key:"destroy",value:function e(){var t=this;var i=this.cache.keys();i.forEach((function(e){var i=t.cache.get(e);if(r.Type.isDomNode(i)&&i.parentNode){i.parentNode.removeChild(i)}t.cache["delete"](e)}));this.emit("onDestroy")}},{key:"hasContainer",value:function e(){return this.cache.has("container")}},{key:"getMenu",value:function e(){var t=this;var n=this.getData("NAME").split(".").pop();n=n===this.getData("NAME")?"":[".",n].join("");var a=String(this.getData("NAME"));var s=a.substring(0,a.length-n.length);return this.cache.remember("menu",(function(){var e=t.getContainer().querySelector("div[data-bx-role='more']");var a=new i.Menu({id:"crm-tunnels-menu-".concat(r.Text.getRandom().toLowerCase()),bindElement:e,items:[t.isPluggedIn()?{dataset:{bxRole:"insertIntoTheText"},text:r.Loc.getMessage("WDUF_ITEM_MENU_INSERT_INTO_THE_TEXT"),onclick:function e(i,n){a.close();t.onClickInsertInText(i)}}:null,{dataset:{bxRole:"deleteFile"},text:r.Loc.getMessage("WDUF_ITEM_MENU_DELETE"),onclick:function e(i){a.close();t.onClickDelete(i)}},t.data["CAN_RENAME"]===true?{dataset:{bxRole:"renameFile"},text:r.Loc.getMessage("WDUF_ITEM_MENU_RENAME"),items:[{html:['<textarea class="disk-file-popup-rename-file-textarea"\n\t\t\t\t\t\t\t\t\t\t\tname="rename" onkeydown="if(event.keyCode===13){ BX.fireEvent(event.target.parentNode.querySelector(\'input[name=save]\'), \'click\'); }"\n\t\t\t\t\t\t\t\t\t\t\tplaceholder="'.concat(r.Text.encode(s),'">').concat(r.Text.encode(s),"</textarea>"),'<div class="ui-btn-container ui-btn-container-center">\n\t\t\t\t\t\t\t\t\t\t\t<input type="button" class="ui-btn ui-btn-sm ui-btn-primary" name="save" value="'.concat(r.Loc.getMessage("WDUF_ITEM_MENU_RENAME_SAVE"),'">\n\t\t\t\t\t\t\t\t\t\t\t<input type="button" class="ui-btn ui-btn-sm ui-btn-link" value="').concat(r.Loc.getMessage("WDUF_ITEM_MENU_RENAME_CANCEL"),'">\n\t\t\t\t\t\t\t\t\t\t</div>')].join(""),className:"menu-popup-item-rename-form",onclick:function e(i,s){if(r.Type.isDomNode(i.target)&&i.target.type==="button"){if(i.target.name==="save"){t.onRenamed([s.getContainer().querySelector("textarea").value,n].join(""));t.clearMenu()}a.close()}}}]}:null,{delimiter:true,text:[r.Loc.getMessage("WDUF_ITEM_MENU_FILE"),r.Text.encode(t.data["SIZE"])].join(" ")},t.data["CAN_MOVE"]===true?{dataset:{bxRole:"moveFile"},text:r.Text.encode(t.data["STORAGE"]),className:"menu-popup-item-storage",onclick:function e(i,n){var r;i["counter"]=((r=i["counter"])!==null&&r!==void 0?r:1)+1;a.close();t.onClickMoveTo(i,n)}}:{text:r.Text.encode(t.data["STORAGE"]),className:"menu-popup-item-storage"}].filter((function(e){return e!==null})),angle:true,offsetLeft:9});return a}))}},{key:"clearMenu",value:function e(){if(this.cache.has("menu")){this.cache.get("menu").destroy();this.cache["delete"]("menu")}}},{key:"onClick",value:function e(t){this.emit("onClick")}},{key:"onClickDelete",value:function e(t){t.preventDefault();t.stopPropagation();this.emit("onDelete");this.destroy();k.deleteAction(this.getId())}},{key:"onClickInsertInText",value:function e(t){this.emit("onClickInsertInText")}},{key:"onClickMore",value:function e(t){t.preventDefault();t.stopPropagation();this.getMenu().show()}},{key:"onClickEdit",value:function e(){}},{key:"onClickMoveTo",value:function e(t,i,n){var a=s.EventEmitter.emit(BX.DiskFileDialog,"onFileNeedsToMove",[this]);return a.length>0}},{key:"onMoved",value:function e(t){var i=t.data;this.data["STORAGE"]=i;this.clearMenu()}},{key:"onRenamed",value:function e(t){if(this.getData("NAME")===t){return}this.rename(t);k.renameAction(this.getId(),t)}},{key:"getHTMLForHTMLEditor",value:function e(t){if(this.getData("TYPE_FILE")==="player"){return'<img contenteditable="false" class="bxhtmled-player-surrogate" data-bx-file-id="'.concat(r.Text.encode(this.data.ID),'" id="').concat(t,'" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" />')}return'<span contenteditable="false" data-bx-file-id="'.concat(r.Text.encode(this.data.ID),'" id="').concat(t,'" style="color: #2067B0; border-bottom: 1px dashed #2067B0; margin:0 2px;">').concat(r.Text.encode(this.data.NAME),"</span>")}}],[{key:"detect",value:function e(){return true}}]);return t}(s.EventEmitter);function M(e){var t=this;if(babelHelpers.classPrivateFieldGet(this,H)){return}var i=e.currentTarget;var n=i.offsetWidth;babelHelpers.classPrivateFieldSet(this,H,new BX.PopupWindow({content:r.Loc.getMessage("WDUF_ITEM_MENU_INSERT_INTO_THE_TEXT"),cacheable:false,animation:"fading-slide",bindElement:i,offsetTop:0,bindOptions:{position:"top"},darkMode:true,events:{onClose:function e(){babelHelpers.classPrivateFieldGet(t,H).destroy();babelHelpers.classPrivateFieldSet(t,H,null)},onShow:function e(t){var i=t.getTarget();i.getPopupContainer().style.display="block";var a=n/2-i.getPopupContainer().offsetWidth/2;i.setOffset({offsetLeft:a+40});i.setAngle({offset:i.getPopupContainer().offsetWidth/2-17})}}}));babelHelpers.classPrivateFieldGet(this,H).show()}function R(e){if(!babelHelpers.classPrivateFieldGet(this,H)){return}babelHelpers.classPrivateFieldGet(this,H).close();babelHelpers.classPrivateFieldSet(this,H,null)}var B;var j=function(e){babelHelpers.inherits(t,e);function t(){var e;var i;babelHelpers.classCallCheck(this,t);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++){a[s]=arguments[s]}i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(a)));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"cache",new r.Cache.MemoryCache);return i}babelHelpers.createClass(t,[{key:"setData",value:function e(t){this.data=t;this.data.BIG_REVIEW_URL=this.data.PREVIEW_URL.replace(/\&(width|height)\=\d+/gi,"")}},{key:"getContainer",value:function e(){var t=this;return this.cache.remember("container",(function(){var e=r.Text.encode(t.getNameWithoutExtension());var i=r.Text.encode(t.data["EXTENSION"]).toLowerCase();return r.Tag.render(B||(B=babelHelpers.taggedTemplateLiteral(['\n\t\t<div class="disk-file-thumb disk-file-thumb-preview">\n\t\t\t<div style="background-image: url(\'','\'); background-size: cover;" class="disk-file-thumb-image"></div>\n\t\t\t',"\n\t\t\t","\n\t\t\t","\n\t\t\t","\n\t\t</div>"])),encodeURI(t.data["PREVIEW_URL"]),t.getIcon(i),t.getNameBox(e,i),t.getDeleteButton(),t.getButtonBox())}))}},{key:"getHTMLForHTMLEditor",value:function e(t){return'<img style="max-width: 90%;" data-bx-file-id="'.concat(r.Text.encode(this.data.ID),'" id="').concat(t,'" src="').concat(this.data.BIG_REVIEW_URL,'" />')}}],[{key:"detect",value:function e(t){return!!t["PREVIEW_URL"]}}]);return t}(P);function X(e,t){W(e,t);t.add(e)}function W(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function V(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var G=0;var z=new WeakSet;var Y=function(){function e(t){babelHelpers.classCallCheck(this,e);X(this,z);babelHelpers.defineProperty(this,"tag","[DISK FILE ID=#id#]");babelHelpers.defineProperty(this,"regexp",/\[(?:DOCUMENT ID|DISK FILE ID)=([n0-9]+)\]/gi);this.id=["diskfile"+G++].join("_");this.items=t.items}babelHelpers.createClass(e,[{key:"getInterface",value:function e(){var t=this;return{id:this.id,init:function e(i){t.htmlEditor=i},parse:this.parse.bind(this),unparse:this.unparse.bind(this)}}},{key:"hasInterface",value:function e(){return this.regexp!==null&&this.tag!==null}},{key:"setParams",value:function e(t){var i=t.tag,n=t.regexp;if(r.Type.isStringFilled(i)&&i!=="null"){this.tag=i}else{this.tag=null}if(r.Type.isStringFilled(n)&&n!=="null"){this.regexp=new RegExp(n)}else if(n instanceof RegExp){this.regexp=n}else{this.regexp=null}}},{key:"insertFile",value:function e(t){var i=this.items.get(String(t));if(i){var n=i instanceof j?"\n":" ";var a=i instanceof j?"<br>":"&nbsp;";s.EventEmitter.emit(this.htmlEditor,"OnInsertContent",[n+this.getItemBBCode(t)+n,a+this.getItemHTML(t)+a])}}},{key:"getItemBBCode",value:function e(t){var i=this.items.get(String(t));if(i&&i.isPluggedIn()){i.setInsertedInText()}return this.tag.replace("#id#",t)}},{key:"getItemHTML",value:function e(t){var i=this.items.get(String(t));if(i){return V(this,z,K).call(this,i,t)}return null}},{key:"deleteFile",value:function e(t){if(!this.items.has(t)){return}var i=this.items.get(t).getAllIds();if(this.htmlEditor.GetViewMode()==="wysiwyg"){var n=this.htmlEditor.GetIframeDoc();for(var a in this.htmlEditor.bxTags){if(this.htmlEditor.bxTags.hasOwnProperty(a)&&babelHelpers["typeof"](this.htmlEditor.bxTags[a])==="object"&&this.htmlEditor.bxTags[a]["tag"]===this.id&&i.indexOf(String(this.htmlEditor.bxTags[a]["itemId"]))>=0&&n.getElementById(a)){var r=n.getElementById(a);r.parentNode.removeChild(r)}}this.htmlEditor.SaveContent()}else{var s=this.htmlEditor.GetContent().replace(this.regexp,(function(e,t){return i.indexOf(t)>=0?"":e}));this.htmlEditor.SetContent(s);this.htmlEditor.Focus()}}},{key:"parse",value:function e(t){if(!this.regexp.test(t)){return t}t=t.replace(this.regexp,function(e,t){var i=this.items.has(t)?this.items.get(t):babelHelpers.toConsumableArray(this.items.values()).find((function(e){return e.getAllIds().indexOf(t)>=0}));if(i){return V(this,z,K).call(this,i,t)}return e}.bind(this));return t}},{key:"unparse",value:function e(t,i){var n=i.node;var a=t.itemId;if(this.items.has(a)){return this.getItemBBCode(a)}return""}}]);return e}();function K(e,t){if(e.isPluggedIn()){e.setInsertedInText()}return e.getHTMLForHTMLEditor(this.htmlEditor.SetBxTag(false,{tag:this.id,fileId:t,itemId:e.getId()}))}var q=[P,j];function Z(e){var t=P;q.forEach((function(i){if(i.detect(e)){t=i}}));return new t(e)}var J=function(e){babelHelpers.inherits(t,e);function t(e){var i;var n=e.id,a=e.container,r=e.fieldName,s=e.multiple,o=e.eventObject;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{container:a.querySelector('[data-bx-role="placeholder"]'),eventObject:o}));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"maxVisibleCount",10);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"prefixHTMLNode","disk-attach-");i.items=new Map;i.multiple=s!==false;i.fieldName=r;if(!a.querySelector('[data-bx-role="placeholder"]')){return babelHelpers.possibleConstructorReturn(i)}if(i.isPluggedIn()){i.buildInHTMLEditor()}return i}babelHelpers.createClass(t,[{key:"buildInHTMLEditor",value:function e(){var t=this;if(this.getParser().hasInterface()){s.EventEmitter.emit(this.eventObject,"OnParserRegister",this.getParser().getInterface())}s.EventEmitter.subscribe(this.eventObject,"onReinitializeBefore",(function(e){var i=babelHelpers.slicedToArray(e.data,2),n=i[0],a=i[1];var s=true;if(a){Object.values(a).forEach((function(e){if(e&&e["USER_TYPE_ID"]==="disk_file"&&e["FIELD_NAME"].replace("[]","")===t.fieldName.replace("[]","")){try{var i=[];var n={};if(r.Type.isArray(e["VALUE"])){e["VALUE"].forEach((function(e){var a=document.querySelector(["#",t.prefixHTMLNode,e].join(""));var s=String(e);if(!a||n[s]){return}n[s]=true;var o=a.querySelector("img")||a.querySelector("div[data-bx-preview]");var l=o||a;var c=l.hasAttribute("data-title")?l.getAttribute("data-title"):l.hasAttribute("data-bx-title")?l.getAttribute("data-bx-title"):"";var u={ID:e,FILE_ID:l.getAttribute("bx-attach-file-id"),CAN_RESTORE:false,CAN_UPDATE:false,CAN_RENAME:false,CAN_MOVE:false,COPY_TO_ME_URL:null,DELETE_URL:null,DOWNLOAD_URL:null,EDIT_URL:null,VIEW_URL:null,PREVIEW_URL:null,BIG_PREVIEW_URL:null,EXTENSION:c.split(".").pop(),NAME:c,SIZE:l.getAttribute("data-bx-size"),SIZE_BYTES:l.getAttribute("data-bx-size"),STORAGE:"disk",TYPE_FILE:l.getAttribute("bx-attach-file-type")};if(o){u["PREVIEW_URL"]=o.hasAttribute("data-bx-preview")&&r.Type.isStringFilled(o.getAttribute("data-bx-preview"))?o.getAttribute("data-bx-preview"):o.hasAttribute("data-thumb-src")&&r.Type.isStringFilled(o.getAttribute("data-thumb-src"))?o.getAttribute("data-thumb-src"):o.src;u["BIG_PREVIEW_URL"]=o.hasAttribute("data-bx-src")?o.getAttribute("data-bx-src"):o.getAttribute("data-src")}i.push(u)}))}t.set(i);s=false}catch(e){console.log("e: ",e)}}}))}if(s!==false){t.clear()}}))}},{key:"set",value:function e(t){var i=this;this.clear();var n=this.maxVisibleCount;return new Promise((function(e){t.forEach((function(e){var t=i.addItem(e);n--;if(n>0){i.appendNode(t)}else if(n===0){i.container.appendChild(i.getItemMore().reset().getContainer())}else{i.getItemMore().increment()}}));e()}))}},{key:"clear",value:function e(){this.items.forEach((function(e){e.destroy()}));this.container.innerHTML=""}},{key:"add",value:function e(t,i){this.multiple||this.clear();var n=this.addItem(t);this.appendNode(n,i);return n}},{key:"addItem",value:function e(t){var i=this;var n=Z(t);var a=this.getContainer().querySelector('[data-bx-role="reserve-item"][value="'.concat(r.Text.encode(n.getId()),'"]'));if(!a){a=document.createElement("INPUT");a.name=this.fieldName;a.type="hidden";a.value=n.getId();this.container.appendChild(a)}n.subscribe("onDelete",(function(){if(a&&a.parentNode){a.parentNode.removeChild(a)}s.EventEmitter.emit(i,"OnItemDelete",n)}));n.subscribe("onDestroy",(function(){i.items["delete"](n.getId())}));if(this.isPluggedIn()){s.EventEmitter.emit(this.eventObject,"onShowControllers:File:Increment");if(this.getParser().hasInterface()){n.setPluggedIn();n.subscribe("onClickInsertInText",(function(){i.getParser().insertFile(n.getId())}));n.subscribe("onDelete",(function(){i.getParser().deleteFile(n.getId())}));n.subscribe("onDestroy",(function(){s.EventEmitter.emit(i.eventObject,"onShowControllers:File:Decrement")}))}}this.items.set(n.getId(),n);return n}},{key:"getItem",value:function e(t){return this.items.get(t)}},{key:"appendNode",value:function e(t,i){if(i){if(i.parentNode){i.parentNode.replaceChild(t.getContainer(),i)}}else{this.container.appendChild(t.getContainer())}return t}},{key:"getItemMore",value:function e(){var t=this;return this.cache.remember("moreButton",(function(){var e=new I;s.EventEmitter.subscribe(e,"onGetMore",t.showMoreItems.bind(t));return e}))}},{key:"showMoreItems",value:function e(t){var i=t.data.itemsCount;var n=i;var a=this.getItemMore().getContainer();a.style.opacity="0";a.style.visibility="hidden";this.items.forEach((function(e){if(i>0){if(!e.hasContainer()){i--;var t=document.createElement("DIV");a.parentNode.insertBefore(t,a);setTimeout((function(){r.Dom.style(e.getContainer(),"opacity","0");r.Dom.addClass(e.getContainer(),"disk-file-thumb--animate");r.Dom.style(e.getContainer(),"opacity","");t.parentNode.replaceChild(e.getContainer(),t);e.getContainer().addEventListener("transitionend",(function(){r.Dom.removeClass(e.getContainer(),"disk-file-thumb--animate")}))}),(n-i)*100)}}}));if(i<=0){setTimeout((function(){a.style.opacity="";a.style.visibility=""}),n*100+100)}}},{key:"getParser",value:function e(){this.parser=this.parser||new Y(this);return this.parser}}]);return t}(E);var $=function(e){babelHelpers.inherits(t,e);function t(e){var i;var n=e.container,a=e.eventObject;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{container:n.querySelector('[data-bx-role="setting"]'),eventObject:a}));if(i.getContainer()){i.getContainer().addEventListener("click",i.show.bind(babelHelpers.assertThisInitialized(i)));i.allowEditNode=n.querySelector('input[data-bx-role="settings-allow-edit"]');i.allowGridNode=n.querySelector('input[data-bx-role="settings-allow-grid"]')}return i}babelHelpers.createClass(t,[{key:"show",value:function e(){var t=this;if(!this.popup){this.popup=new i.Menu({bindElement:this.getContainer(),className:"disk-uf-file-popup-settings",items:[this.allowEditNode?{dataset:{bxRole:"allowEdit"},className:this.allowEditNode.checked?"menu-popup-item-take":"",text:r.Loc.getMessage("WDUF_ALLOW_EDIT"),onclick:function(e,t){this.allowEditNode.checked=!this.allowEditNode.checked;if(this.allowEditNode.checked){t.getContainer().classList.add("menu-popup-item-take");t.getContainer().classList.remove("menu-popup-no-icon")}else{t.getContainer().classList.remove("menu-popup-item-take");t.getContainer().classList.add("menu-popup-no-icon")}}.bind(this)}:null,{dataset:{bxRole:"allowGrid"},className:this.allowGridNode.checked?"menu-popup-item-take":"",text:r.Loc.getMessage("WDUF_ALLOW_COLLAGE"),onclick:function(e,t){this.allowGridNode.checked=!this.allowGridNode.checked;if(this.allowGridNode.dataset.bxSave==="Y"){BX.userOptions.save("disk","disk.uf.file",this.allowGridNode.dataset.bxName,this.allowGridNode.checked?"grid":".default")}if(this.allowGridNode.checked){t.getContainer().classList.add("menu-popup-item-take");t.getContainer().classList.remove("menu-popup-no-icon")}else{t.getContainer().classList.remove("menu-popup-item-take");t.getContainer().classList.add("menu-popup-no-icon")}}.bind(this)},{text:this.buildDocumentServiceTextLabel(),items:this.buildSubMenuWithDocumentServices()}],angle:true,offsetTop:-16,offsetLeft:16,events:{onClose:function e(){delete t.popup}}})}this.popup.show()}},{key:"buildDocumentServiceTextLabel",value:function e(){var t=BX.Disk.getDocumentService();if(!t&&BX.Disk.isAvailableOnlyOffice()){t="onlyoffice"}else if(!t){t="l"}var i=o.getDocumentHandler(t).name;return r.Loc.getMessage("DISK_UF_FILE_EDIT_SERVICE_LABEL",{"#NAME#":i})}},{key:"buildSubMenuWithDocumentServices",value:function e(){var t=this;var i=[];o.getDocumentHandlers().forEach((function(e){i.push({text:e.name,dataset:{code:e.code},onclick:function e(i,n){BX.Disk.saveDocumentService(n.dataset.code);n.getMenuWindow().getParentMenuItem().setText(t.buildDocumentServiceTextLabel());n.getMenuWindow().getPopupWindow().close()}})}));return i}},{key:"hide",value:function e(){if(this.popup){this.popup.close()}}}]);return t}(E);var Q=function(e){babelHelpers.inherits(t,e);function t(e){var i;var n=e.container,a=e.eventObject;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{container:n.querySelector('[data-bx-role="document-area"]'),eventObject:a}));if(i.getContainer()){Array.from(i.getContainer().querySelectorAll("[data-bx-handler]")).forEach((function(e){e.addEventListener("click",(function(){i.createDocument(e.getAttribute("data-bx-handler"))}))}))}return i}babelHelpers.createClass(t,[{key:"createDocument",value:function e(t){if(!BX.Disk.getDocumentService()&&BX.Disk.isAvailableOnlyOffice()){BX.Disk.saveDocumentService("onlyoffice")}else if(!BX.Disk.getDocumentService()){BX.Disk.saveDocumentService("l")}var i=function(e){var t=this;var i=e.object.name.split(".");i.pop();setTimeout((function(){s.EventEmitter.emit(t,"onFileIsCreated",{itemData:t.convertToItemSavedType(e)})}),200)}.bind(this);if(BX.Disk.Document.Local.Instance.isSetWorkWithLocalBDisk()){BX.Disk.Document.Local.Instance.createFile({type:t}).then(function(e){i(e)}.bind(this));return}var n=new BX.Disk.Document.CreateProcess({typeFile:t,serviceCode:BX.Disk.getDocumentService(),onAfterSave:function e(t,n){if(t.status!=="success"){return}if(!n){k.getMetaDataForCreatedFileInUf(t.object.id).then((function(e){var t=e.data;i(t)}))}else{i(n)}}});n.start()}},{key:"convertToItemSavedType",value:function e(t){return{ID:"n"+t.object.id,IS_LOCKED:false,IS_MARK_DELETED:false,EDITABLE:false,FROM_EXTERNAL_SYSTEM:false,CAN_RESTORE:false,CAN_UPDATE:true,CAN_RENAME:true,CAN_MOVE:true,COPY_TO_ME_URL:null,DELETE_URL:null,DOWNLOAD_URL:null,EDIT_URL:null,VIEW_URL:t.link,PREVIEW_URL:null,BIG_PREVIEW_URL:null,EXTENSION:t.object.extension,NAME:t.object.name,SIZE:t.object.size,SIZE_BYTES:t.object.sizeInt,STORAGE:t.folderName}}}]);return t}(E);var ee=function(e){babelHelpers.inherits(t,e);function t(e){var i=e.container,n=e.eventObject;babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{container:i.querySelector('[data-bx-role="control-panel"]'),eventObject:n}))}return t}(E);var te=0;var ie=function(e){babelHelpers.inherits(t,e);function t(e){var i;var n=e.container,a=e.eventObject;babelHelpers.classCallCheck(this,t);var r=n.querySelector('[data-bx-role="file-local-controller"]')||n.querySelector(".diskuf-selector-link");i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{container:r,eventObject:a}));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"opened",false);i.dialogName=["selectFile",te++].join("-");if(!i.getContainer()){return babelHelpers.possibleConstructorReturn(i)}i.getContainer().addEventListener("click",i.onClick.bind(babelHelpers.assertThisInitialized(i)));i.openSection=i.openSection.bind(babelHelpers.assertThisInitialized(i));i.selectFile=i.selectFile.bind(babelHelpers.assertThisInitialized(i));s.EventEmitter.subscribe(BX.DiskFileDialog,"loadItems",i.openSection);return i}babelHelpers.createClass(t,[{key:"onClick",value:function e(){var t=this;k.getSelectedData(this.dialogName).then((function(){setTimeout((function(){BX.DiskFileDialog.obCallback[t.dialogName]={saveButton:t.selectFile};BX.DiskFileDialog.openDialog(t.dialogName)}),10)}))}},{key:"openSection",value:function e(t){var i=babelHelpers.slicedToArray(t.data,2),n=i[0],a=i[1];if(a===this.dialogName){BX.DiskFileDialog.target[a]=r.Uri.addParam(n,{dialog2:"Y"})}}},{key:"selectFile",value:function e(t,i,n){s.EventEmitter.unsubscribe(BX.DiskFileDialog,"loadItems",this.openSection);for(var a in n){if(n.hasOwnProperty(a)){s.EventEmitter.emit(this,"onUploadDone",{itemData:this.convertToItemSavedType(n[a])})}}}},{key:"convertToItemSavedType",value:function e(t){var i;return{ID:t.id,IS_LOCKED:false,IS_MARK_DELETED:false,EDITABLE:false,FROM_EXTERNAL_SYSTEM:false,CAN_RESTORE:false,CAN_RENAME:false,CAN_UPDATE:false,CAN_MOVE:false,COPY_TO_ME_URL:null,DELETE_URL:null,DOWNLOAD_URL:null,EDIT_URL:null,VIEW_URL:null,PREVIEW_URL:t.previewUrl?t.previewUrl:"",BIG_PREVIEW_URL:t.previewUrl?t.previewUrl.replace(/\&(width|height)=\d+/gi,""):null,EXTENSION:t.ext,NAME:t.name,SIZE:t.size,SIZE_BYTES:t.sizeInt,STORAGE:(i=t["storage"])!==null&&i!==void 0?i:r.Loc.getMessage("WDUF_MY_DISK")}}}]);return t}(E);var ne=function(e){babelHelpers.inherits(t,e);function t(e,i){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e,i));BX.Disk.ExternalLoader.startLoad({file:{id:n.id,name:n.object.name,service:n.object.service},onFinish:function e(t){s.EventEmitter.emit(babelHelpers.assertThisInitialized(n),"onUploadDone",[t])},onProgress:function e(t){n.onUploadProgress({compatData:[{},t]})}});return n}babelHelpers.createClass(t,[{key:"onClickDelete",value:function e(t){t.preventDefault();t.stopPropagation();s.EventEmitter.emit(this,"onDelete",[this]);delete this.container}},{key:"onUploadDone",value:function e(t){var i=babelHelpers.slicedToArray(t.compatData,2),n=i[0],a=i[1].file}},{key:"onUploadError",value:function e(t){var i=babelHelpers.slicedToArray(t.compatData,1),n=i[0];s.EventEmitter.emit(this,"onUploadError",[n.file]);this.progress.getContainer().parentNode.removeChild(this.progress.getContainer());this.container.classList.add("disk-file-upload-error")}}]);return t}(c);var ae=0;var re=function(e){babelHelpers.inherits(t,e);function t(e){var i;var n=e.container,a=e.eventObject;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{container:n.querySelector('[data-bx-role="placeholder"]'),eventObject:a}));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"services",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"items",new Map);if(!i.getContainer()){return babelHelpers.possibleConstructorReturn(i)}Array.from(n.querySelectorAll('[data-bx-role="file-external-controller"]')).forEach((function(e){i.services.push(e)}));Array.from(n.querySelectorAll(".diskuf-selector-link-cloud")).forEach((function(e){i.services.push(e)}));i.eventObject=a;i.dialogName=["selectFileCloud",ae++].join("-");i.services.forEach((function(e){e.addEventListener("click",i.onClick.bind(babelHelpers.assertThisInitialized(i)))}));i.openSection=i.openSection.bind(babelHelpers.assertThisInitialized(i));i.selectFile=i.selectFile.bind(babelHelpers.assertThisInitialized(i));return i}babelHelpers.createClass(t,[{key:"onClick",value:function e(t){var i=this;s.EventEmitter.subscribe(BX.DiskFileDialog,"loadItems",this.openSection);this.currentService=t.currentTarget.getAttribute("data-bx-doc-handler");k.getSelectedCloudData(this.dialogName,this.currentService).then((function(){setTimeout((function(){BX.DiskFileDialog.obCallback[i.dialogName]={saveButton:i.selectFile};BX.DiskFileDialog.openDialog(i.dialogName)}),10)}))}},{key:"openSection",value:function e(t){var i=babelHelpers.slicedToArray(t.data,2),n=i[0],a=i[1];if(a===this.dialogName){BX.DiskFileDialog.target[a]=r.Uri.addParam(n,{dialog2:"Y"})}}},{key:"selectFile",value:function e(t,i,n){s.EventEmitter.unsubscribe(BX.DiskFileDialog,"loadItems",this.openSection);for(var a in n){if(n.hasOwnProperty(a)&&n[a].type==="file"){this.catchFile(n[a],this.currentService)}}this.currentService=null}},{key:"catchFile",value:function e(t,i){var n=this;if(this.items.has(t.id)){return}t["service"]=t["provider"]||i;var a=new ne(t.id,t);this.items.set(a.id,a);s.EventEmitter.subscribe(a,"onUploadDone",(function(e){var t=babelHelpers.slicedToArray(e.data,1),i=t[0];if(n.items.has(a.id)){n.items["delete"](a.id);s.EventEmitter.emit(n,"onUploadDone",{itemData:n.convertToItemSavedType(i),itemContainer:a.getContainer()})}}));s.EventEmitter.subscribe(a,"onUploadError",(function(){n.items["delete"](a.id);s.EventEmitter.emit(n,"onUploadError",{itemContainer:a.getContainer()})}));s.EventEmitter.subscribe(a,"onDelete",(function(){n.items["delete"](a.id);n.container.removeChild(a.getContainer())}));this.container.appendChild(a.getContainer())}},{key:"convertToItemSavedType",value:function e(t){var i=t.name.split(".").pop().toLowerCase();var n={ID:t.ufId,IS_LOCKED:false,IS_MARK_DELETED:false,EDITABLE:false,FROM_EXTERNAL_SYSTEM:true,CAN_RESTORE:false,CAN_RENAME:false,CAN_UPDATE:false,CAN_MOVE:false,COPY_TO_ME_URL:null,DELETE_URL:null,DOWNLOAD_URL:null,EDIT_URL:null,VIEW_URL:null,PREVIEW_URL:t.previewUrl?t.previewUrl:"",BIG_PREVIEW_URL:t.previewUrl?t.previewUrl.replace(/\&(width|height)=\d+/gi,""):null,EXTENSION:i===t.name?"":i,NAME:t.name,SIZE:t.sizeFormatted,SIZE_BYTES:t.size,STORAGE:t.storage};return n}}]);return t}(E);var se=function(){function e(){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"dialogName","moveFile");this.openSection=this.openSection.bind(this);this.loadFolder=this.loadFolder.bind(this);this.stopLoadingFolder=this.stopLoadingFolder.bind(this);this.checkFileName=this.checkFileName.bind(this);this.onApply=this.onApply.bind(this);this.onCancel=this.onCancel.bind(this)}babelHelpers.createClass(e,[{key:"fire",value:function e(t){var i=this;if(this.item!==null&&this.item!==t){this.onCancel()}this.item=t;k.getSelectedFile(t.getFileId(),t.getData("NAME"),this.dialogName).then((function(){setTimeout((function(){BX.DiskFileDialog.obCallback[i.dialogName]={saveButton:i.onApply,cancelButton:i.onCancel};BX.DiskFileDialog.openDialog(i.dialogName)}),10)}));s.EventEmitter.subscribe(BX.DiskFileDialog,"loadItems",this.openSection);s.EventEmitter.subscribe(BX.DiskFileDialog,"selectItem",this.loadFolder);s.EventEmitter.subscribe(BX.DiskFileDialog,"unSelectItem",this.stopLoadingFolder)}},{key:"openSection",value:function e(t){var i=babelHelpers.slicedToArray(t.data,2),n=i[0],a=i[1];if(a===this.dialogName){BX.DiskFileDialog.target[a]=r.Uri.addParam(n,{dialog2:"Y"})}}},{key:"loadFolder",value:function e(t){var i=this;var n=babelHelpers.slicedToArray(t.data,3),a=n[0],s=n[1],o=n[2];if(o!==this.dialogName){return}k.loadFolder(s.substr(1),this.item.getData("NAME"),this.dialogName).then((function(e){var t=e.permission===true&&e["okmsg"]!=="";if(i.timeout>0){clearTimeout(i.timeout)}i.timeout=setTimeout((function(){if(t){BX.DiskFileDialog.showNotice(r.Loc.getMessage("WDUF_FILE_IS_EXISTS"),i.dialogName)}else{BX.DiskFileDialog.closeNotice(i.dialogName)}}),200)}))}},{key:"stopLoadingFolder",value:function e(t){var i=t.data;if(this.timeout>0){clearTimeout(this.timeout)}this.timeout=setTimeout(this.checkFileName,200)}},{key:"onApply",value:function e(t,i,n,a){var r=this;s.EventEmitter.unsubscribe(BX.DiskFileDialog,"loadItems",this.openSection);s.EventEmitter.unsubscribe(BX.DiskFileDialog,"selectItem",this.loadFolder);s.EventEmitter.unsubscribe(BX.DiskFileDialog,"unSelectItem",this.stopLoadingFolder);if(!this.item){return}var o=this.item.getId();var l=false;var c=function e(t,i,n,a){k.moveFile(t,i).then((function(e){if(!e||e.status!=="success"){BX.Disk.showModalWithStatusAction(e);return}r.showMovedFile(t,n,a)}))};var u,d;for(var h in n){if(n.hasOwnProperty(h)&&n[h].type==="folder"){u=t.name+n[h].path;d={sectionID:h,iblockID:t.iblock_id};c(o,n[h].id,d,u);l=true}}if(!l){u=t.name;d={sectionID:t.section_id,iblockID:t.iblock_id};if(!!a&&!!a.path&&a.path!=="/"){u+=a.path;d.sectionID=a.id;if(!!a){c(o,a.id,d,u)}}}}},{key:"checkFileName",value:function e(t){if(this.timeout>0){clearTimeout(this.timeout)}if(t!==this.dialogName||!this.item){return}var i=this.item.getData("NAME");var n=false;for(var a in BX.DiskFileDialog.obItems[this.dialogName]){if(BX.DiskFileDialog.obItems[this.dialogName].hasOwnProperty(a)&&BX.DiskFileDialog.obItems[this.dialogName][a]["name"]===i){n=true;break}}if(n){BX.DiskFileDialog.showNotice(r.Loc.getMessage("WDUF_FILE_IS_EXISTS"),this.dialogName)}else{BX.DiskFileDialog.closeNotice(this.dialogName)}}},{key:"showMovedFile",value:function e(t,i,n){if(this.item){this.item.emit("onMoved",n)}this.item=null}},{key:"onCancel",value:function e(){s.EventEmitter.unsubscribe(BX.DiskFileDialog,"loadItems",this.openSection);s.EventEmitter.unsubscribe(BX.DiskFileDialog,"selectItem",this.loadFolder);s.EventEmitter.unsubscribe(BX.DiskFileDialog,"unSelectItem",this.stopLoadingFolder);this.item=null;if(this.timeout>0){clearTimeout(this.timeout)}this.timeout=null}}],[{key:"subscribe",value:function t(){if(BX.DiskFileDialog.subscribed!==true){BX.DiskFileDialog.subscribed=true;s.EventEmitter.subscribe(BX.DiskFileDialog,"onFileNeedsToMove",(function(t){t.stopImmediatePropagation();e.getInstance().fire(babelHelpers.toConsumableArray(t.getData()).shift())}))}}},{key:"getInstance",value:function t(){if(this.instance===null){this.instance=new e}return this.instance}}]);return e}();babelHelpers.defineProperty(se,"subscribed",false);babelHelpers.defineProperty(se,"instance",null);var oe,le;var ce=0;function ue(e){var t={},i,n;for(i in e){n=i.replace(/(.)([A-Z])/g,"$1_$2").toUpperCase();t[n]=e[i];t[i]=e[i]}return t}var de=function(e){babelHelpers.inherits(t,e);function t(e){var i;var n=e.id,a=e.fieldName,r=e.container,l=e.eventObject,c=e.input;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{container:r,eventObject:l}));i.id=n;i.fieldName=a;i.input=c;if(!i.input){return babelHelpers.possibleConstructorReturn(i)}i.agent=BX.Uploader.getInstance({id:n,streams:1,allowUpload:"A",uploadFormData:"N",uploadMethod:"immediate",uploadFileUrl:o.urlUpload,showImage:false,sortItems:false,dropZone:null,input:i.input,pasteFileHashInForm:false});i.onUploadDone=i.onUploadDone.bind(babelHelpers.assertThisInitialized(i));i.onUploadError=i.onUploadError.bind(babelHelpers.assertThisInitialized(i));s.EventEmitter.subscribe(i.agent,"onFileIsUploaded",(function(e){var t=babelHelpers.slicedToArray(e.compatData,3),n=t[0],a=t[1],r=t[2];i.onUploadDone(a,r)}));s.EventEmitter.subscribe(i.agent,"onFileIsUploadedWithError",(function(e){var t=babelHelpers.slicedToArray(e.compatData,3),n=t[0],a=t[1],r=t[2];i.onUploadError(a,r)}));i.fileSelector=new ie(babelHelpers.assertThisInitialized(i));s.EventEmitter.subscribe(i.fileSelector,"onUploadDone",(function(e){var t=e.data.itemData;i.onSelectionIsDone(t)}));i.fileSelectorCloud=new re(babelHelpers.assertThisInitialized(i));s.EventEmitter.subscribe(i.fileSelectorCloud,"onUploadDone",(function(e){var t=e.data.itemData;i.onSelectionIsDone(t)}));return i}babelHelpers.createClass(t,[{key:"onSelectionIsDone",value:function e(t){var i={id:"disk-edit-attach"+t["ID"],"bx-agentFileId":t["ID"]};if(t["FILE_ID"])i["bx-attach-file-id"]="n"+t["FILE_ID"];var n=r.Tag.render(oe||(oe=babelHelpers.taggedTemplateLiteral(['<input type="hidden" name="','" value="','">'])),this.fieldName,t["ID"]);for(var a in i){if(i.hasOwnProperty(a)){n.setAttribute(a,i[a])}}this.getContainer().appendChild(n);var o={element_id:t["ID"],element_name:t["NAME"],element_url:t["PREVIEW_URL"],storage:t["STORAGE"]};s.EventEmitter.emit(this.getEventObject(),"OnFileUploadSuccess",new s.BaseEvent({compatData:[o,{},null,{id:ce++,name:t["NAME"],size:t["SIZE"],sizeInt:t["SIZE_INT"]}]}))}},{key:"onUploadDone",value:function e(t,i){if(i["file"]&&i["file"]["attachId"]!==i["file"]["id"]){i["file"]["id"]=i["file"]["attachId"];delete i["file"]["attachId"]}var n=ue(i["file"]);var a={id:"disk-edit-attach"+n.id,"bx-agentFileId":t.id};if(n["XML_ID"])a["bx-attach-xml-id"]=n["XML_ID"];if(n["FILE_ID"])a["bx-attach-file-id"]="n"+n["FILE_ID"];if(n["FILE_TYPE"])a["bx-attach-file-type"]=n["FILE_TYPE"];n.element_id=n.id;var s=r.Tag.render(le||(le=babelHelpers.taggedTemplateLiteral(['<input type="hidden" name="','" value="','">'])),this.fieldName,n.id);for(var o in a){if(a.hasOwnProperty(o)){s.setAttribute(o,a[o])}}this.getContainer().appendChild(s);this.onFileIs(t,n)}},{key:"onFileIs",value:function e(t,i){var n={element_id:i.element_id,element_name:i.element_name||t.name,element_url:i.element_name||i.previewUrl||i.preview_url,storage:"disk"};s.EventEmitter.emit(this.getEventObject(),"OnFileUploadSuccess",new s.BaseEvent({compatData:[n,this,t.file,t]}))}},{key:"onUploadError",value:function e(t,i){BX.onCustomEvent(this.getEventObject(),"OnFileUploadFailed",[this,t.file,t])}}]);return t}(E);var he=function(e){babelHelpers.inherits(t,e);function t(e,i){var n;var a=e.id,r=e.fieldName,o=e.container,l=e.eventObject,c=e.input,u=e.parserParams;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{container:o,eventObject:l}));n.id=a;n.fieldName=r;n.input=c;if(u){n.getFileController().getParser().setParams(u)}n.init();if(i.length>0){s.EventEmitter.emit(n.getEventObject(),"onShowControllers","show");n.show(i)}return n}babelHelpers.createClass(t,[{key:"init",value:function e(){var t=this;if(this.input){this.getFilesUploader()}this.initDocumentController();this.settingsController=new $(this,{});this.panelController=new ee(this);this.fileSelector=new ie(this);s.EventEmitter.subscribe(this.fileSelector,"onUploadDone",(function(e){var i=e.data.itemData;t.getFileController().add(i)}));this.fileSelectorCloud=new re(this);s.EventEmitter.subscribe(this.fileSelectorCloud,"onUploadDone",(function(e){var i=e.data,n=i.itemData,a=i.itemContainer;t.getFileController().add(n,a)}));var i=function e(i){var n=r.Type.isArray(i.getData())?i.getData().shift():i.getData();if(n==="show"){t.show()}else{t.hide()}};s.EventEmitter.subscribe(this.getEventObject(),"onCollectControllers",(function(e){e.data[t.fieldName]={storage:"disk",tag:t.getFileController().isPluggedIn()?t.getFileController().getParser().tag:null,values:[],handler:{selectFile:function e(i,n,a){t.fileSelector.selectFile(i,n,a)}}};Array.from(t.getContainer().querySelectorAll('input[type="hidden"][name="'.concat(t.fieldName,'"]'))).forEach((function(i){e.data[t.fieldName].values.push(i.value)}))}));s.EventEmitter.subscribe(this.getEventObject(),"onShowControllers",i);s.EventEmitter.subscribe(this.getEventObject(),"DiskLoadFormController",i);s.EventEmitter.subscribe(s.EventEmitter.GLOBAL_TARGET,"disk.uf.file:create:thumb:upload",(function(e){var i=e.data;t.show();t.getFilesUploader().addTestThumb(i)}));s.EventEmitter.subscribe(s.EventEmitter.GLOBAL_TARGET,"disk.uf.file:create:thumb:error",(function(){t.show();t.getFilesUploader().addTestErrorThumb()}))}},{key:"initDocumentController",value:function e(){var i=this;this.documentController=new Q({container:this.getContainer(),eventObject:this.getEventObject()});s.EventEmitter.subscribe(this.documentController,"onFileIsCreated",(function(e){var t=e.data.itemData;s.EventEmitter.emit(i.getEventObject(),"onShowControllers","show");i.getFileController().add(t)}));if(!this.documentController.isRelevant()){return}else if(!this.isPluggedIn()){this.documentController.show();return}if(this.eventObject.dataset.bxDiskDocumentButton!=="added"){this.eventObject.dataset.bxDiskDocumentButton="added";var n=document.createElement("DIV");n.addEventListener("click",(function(){var e=n.closest('[data-id="disk-document"]');if(e&&e.hasAttribute("data-bx-button-status")){s.EventEmitter.emit(i.getEventObject(),"onHideDocuments")}else{s.EventEmitter.emit(i.getEventObject(),"onShowControllers","hide");s.EventEmitter.emit(i.getEventObject(),"onShowDocuments","show")}}));n.innerHTML="<i></i>"+r.Loc.getMessage("WDUF_CREATE_DOCUMENT");s.EventEmitter.emit(this.eventObject,"OnAddButton",[{BODY:n,ID:"disk-document"},"file"]);s.EventEmitter.subscribe(this.getEventObject(),"onShowDocuments",(function(){var e=n.closest('[data-id="disk-document"]');if(e){e.setAttribute("data-bx-button-status","active")}}));s.EventEmitter.subscribe(this.getEventObject(),"onHideDocuments",(function(){var e=n.closest('[data-id="disk-document"]');if(e){e.removeAttribute("data-bx-button-status")}}))}s.EventEmitter.subscribe(this.getEventObject(),"onShowDocuments",(function(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"show",i).call(i);i.documentController.show()}));s.EventEmitter.subscribe(this.getEventObject(),"onHideDocuments",(function(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"hide",i).call(i);i.documentController.hide()}));var a=function e(t){var n=t.data;if(n==="show"){s.EventEmitter.emit(i.getEventObject(),"onHideDocuments")}};s.EventEmitter.subscribe(this.getEventObject(),"DiskLoadFormController",a);s.EventEmitter.subscribe(this.getEventObject(),"onShowControllers",a)}},{key:"getFileController",value:function e(){if(!this.filesController){this.filesController=new J({id:this.id,fieldName:this.fieldName,container:this.container,eventObject:this.eventObject})}return this.filesController}},{key:"getFilesUploader",value:function e(){var t=this;if(!this.filesUploader){this.filesUploader=new v({id:this.id,container:this.container.querySelector('[data-bx-role="placeholder"]'),dropZone:this.container,input:this.input});s.EventEmitter.subscribe(this.getEventObject(),"OnVideoHasCaught",(function(e){var i=e.getData();var n=function e(n){var a=n.data,r=a.itemData,o=a.itemContainer,l=a.blob;if(i===l){s.EventEmitter.unsubscribe(t.filesUploader,"onUploadDone",e);t.getFileController().getParser().insertFile(r.ID)}};s.EventEmitter.subscribe(t.filesUploader,"onUploadDone",n);t.filesUploader.upload([i]);e.stopImmediatePropagation()}));s.EventEmitter.subscribe(this.getEventObject(),"OnImageHasCaught",(function(e){var i=e.getData();e.stopImmediatePropagation();return new Promise((function(e,n){var a=function n(a){var o=a.data,l=o.itemData,c=o.itemContainer,u=o.blob;if(i===u){s.EventEmitter.unsubscribe(t.filesUploader,"onUploadDone",n);s.EventEmitter.unsubscribe(t.filesUploader,"onUploadDone",r);e({image:{src:l.PREVIEW_URL},html:t.getFileController().getParser().getItemHTML(l.ID)})}};s.EventEmitter.subscribe(t.filesUploader,"onUploadDone",a);var r=function e(r){var o=r.data.blob;if(i===o){s.EventEmitter.unsubscribe(t.filesUploader,"onUploadDone",a);s.EventEmitter.unsubscribe(t.filesUploader,"onUploadDone",e);n()}};s.EventEmitter.subscribe(t.filesUploader,"onUploadDone",r);t.filesUploader.upload([i])}))}));s.EventEmitter.subscribe(this.getEventObject(),"onFilesHaveCaught",(function(e){e.stopImmediatePropagation();t.filesUploader.upload(babelHelpers.toConsumableArray(e.getData()))}));s.EventEmitter.subscribe(this.filesUploader,"onUploadDone",(function(e){var i=e.data,n=i.itemData,a=i.itemContainer;t.getFileController().add(n,a)}));s.EventEmitter.subscribe(this.filesUploader,"onUploadIsStart",(function(){s.EventEmitter.emit(t.getEventObject(),"onBusy",t)}));s.EventEmitter.subscribe(this.filesUploader,"onUploadIsDone",(function(){s.EventEmitter.emit(t.getEventObject(),"onReady",t)}))}return this.filesUploader}},{key:"getPanelController",value:function e(){return this.panelController}},{key:"show",value:function e(i){var n=this;var a=this.getContainer().parentNode.querySelector("#"+this.getContainer().id+"-switcher");if(a){a.parentNode.removeChild(a)}if(this.getFileController().isPluggedIn()){this.getContainer().setAttribute("data-bx-plugged-in","Y")}babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"show",this).call(this);this.showInitialLoader();this.getFileController().show();this.getPanelController().show();if(i){this.getFileController().set(i).then((function(){n.hideInitialLoader()}))}else{this.hideInitialLoader()}}},{key:"hide",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"hide",this).call(this);this.getFileController().hide();this.getPanelController().hide()}},{key:"showInitialLoader",value:function e(){}},{key:"hideInitialLoader",value:function e(){}}],[{key:"getInstance",value:function e(i,n){if(!this.repo[i["id"]]){this.repo[i["id"]]=new t(i,n)}return this.repo[i["id"]]}},{key:"getBriefInstance",value:function e(t){if(!this.repo[t["id"]]){this.repo[t["id"]]=new de(t,[])}return this.repo[t["id"]]}}]);return t}(E);babelHelpers.defineProperty(he,"repo",{});setTimeout((function(){if(BX.DiskFileDialog){se.subscribe()}}),1e3);var pe=function e(t){var i=BX("diskuf-selectdialog-"+t["UID"]);if(i&&BX.isNodeInDom(i)){var n=i.parentNode;if(!i.hasAttribute("bx-disk-load-is-bound")){i.setAttribute("bx-disk-load-is-bound","Y");BX.addCustomEvent(n,"DiskLoadFormController",(function(e){try{BX.Disk.UF.Options.set({urlUpload:t.urlUpload});return BX.Disk.UF.Form.getBriefInstance({container:i,eventObject:i.parentNode,id:t.UID,fieldName:t.controlName,input:BX.findChild(i,{className:"diskuf-fileUploader"},true)})}catch(e){console.log("Error with compatibility",e)}}))}if(!!t["values"]&&t["values"].length>0&&!t["hideSelectDialog"])BX.onCustomEvent(i.parentNode,"DiskLoadFormController",["show"])}};e.Form=he;e.Options=o;e.add=pe})(this.BX.Disk.UF=this.BX.Disk.UF||{},BX,BX.Main,BX.UI,BX.UI,BX,BX.Event);(function(e){if(e.BX.Disk&&e.BX.Disk.UFShowController)return;var t=e.BX;var i=0;var n={};var a=function(e){return t.Disk.ajaxPromise({url:t.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","getBreadcrumbs"),method:"POST",dataType:"json",data:{attachedId:e}})};var r=function(e){if(!t(e)||e.hasAttribute("bx-is-bound"))return;e.setAttribute("bx-is-bound","Y");this.img=e;this.node=e.parentNode.parentNode.parentNode;t.unbindAll(e);t.unbindAll(this.node);t.show(this.node);t.remove(this.node.nextSibling);this.id="wufdp_"+Math.random()};r.prototype={turnOn:function(){this.timeout=setTimeout(t.delegate((function(){this.show()}),this),500)},turnOff:function(){clearTimeout(this.timeout);this.timeout=null;this.hide()},show:function(){if(this.popup!=null)this.popup.close();if(this.popup==null){var e={width:this.img.naturalWidth,height:this.img.naturalHeight};if(t["UploaderUtils"]){var i=t.UploaderUtils.scaleImage(e,{width:parseInt(t.message("DISK_THUMB_WIDTH")),height:parseInt(t.message("DISK_THUMB_HEIGHT"))});e=i.destin}this.popup=new t.PopupWindow("bx-wufd-preview-img-"+this.id,this.img.parentNode,{lightShadow:true,offsetTop:-7,offsetLeft:(51-28)/2+14,autoHide:true,closeByEsc:true,bindOptions:{position:"top"},events:{onPopupClose:function(){this.destroy()},onPopupDestroy:t.proxy((function(){this.popup=null}),this)},content:t.create("DIV",{props:e,children:[t.create("IMG",{props:e,attrs:{src:this.img.src}})]})});this.popup.show()}this.popup.setAngle({position:"bottom"});this.popup.bindOptions.forceBindPosition=true;this.popup.adjustPosition();this.popup.bindOptions.forceBindPosition=false},hide:function(){if(this.popup!=null)this.popup.close()}};t.addCustomEvent("onDiskPreviewIsReady",(function(e){new r(e)}));t.Disk.UF.runImport=function(e){t.Disk.showActionModal({text:t.message("DISK_UF_FILE_STATUS_PROCESS_LOADING"),showLoaderIcon:true,autoHide:false});t.Disk.ExternalLoader.reloadLoadAttachedObject({attachedObject:{id:e.id,name:e.name,service:e.service},onFinish:t.delegate((function(e){if(e.hasOwnProperty("hasNewVersion")&&!e.hasNewVersion){t.Disk.showActionModal({text:t.message("DISK_UF_FILE_STATUS_HAS_LAST_VERSION"),showSuccessIcon:true,autoHide:true})}else if(e.status==="success"){t.Disk.showActionModal({text:t.message("DISK_UF_FILE_STATUS_SUCCESS_LOADING"),showSuccessIcon:true,autoHide:true})}else{t.Disk.showActionModal({text:t.message("DISK_UF_FILE_STATUS_FAIL_LOADING"),autoHide:true})}}),this),onProgress:t.delegate((function(e){}),this)}).start()};t.Disk.UF.disableAutoCommentToAttachedObject=function(e){var i=e.attachedId;t.Disk.ajax({method:"POST",dataType:"json",url:t.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","disableAutoCommentToAttachedObject"),data:{attachedId:i},onsuccess:t.delegate((function(e){}),this)})};t.Disk.UF.enableAutoCommentToAttachedObject=function(e){var i=e.attachedId;t.Disk.ajax({method:"POST",dataType:"json",url:t.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","enableAutoCommentToAttachedObject"),data:{attachedId:i},onsuccess:t.delegate((function(e){}),this)})};t.Disk.UF.showTransformationUpgradePopup=function(e){B24.licenseInfoPopup.show("disk_transformation_video_limit",t.message("DISK_UF_CONTROLLER_TRANSFORMATION_UPGRADE_POPUP_TITLE"),t.message("DISK_UF_CONTROLLER_TRANSFORMATION_UPGRADE_POPUP_CONTENT"),false)};t.Disk.UFShowController=function(e){if(!t.type.isPlainObject(e)){e={}}this.entityType=t.type.isNotEmptyString(e.entityType)?e.entityType:"";this.entityId=parseInt(e.entityId)>0?e.entityId:"";this.signedParameters=t.type.isNotEmptyString(e.signedParameters)?e.signedParameters:"";this.loader=null;this.container=t.type.isNotEmptyString(e.nodeId)?document.getElementById(e.nodeId):null;if(this.container){var i=this.container.querySelector(".disk-uf-file-switch-control");if(i){t.Event.bind(i,"click",t.Disk.UFShowController.onToggleView)}}if(t.type.isNotEmptyString(e.nodeId)){n[e.nodeId]=this}};t.Disk.UFShowController.getInstance=function(e){return t.type.isNotEmptyString(e)&&n[e]?n[e]:null};t.Disk.UFShowController.onToggleView=function(e){var i=e.currentTarget.closest(".diskuf-files-toggle-container"),n=e.currentTarget.getAttribute("data-bx-view-type");if(!t.type.isDomNode(i)||!t.type.isNotEmptyString(i.id)){return}var a=t.Disk.UFShowController.getInstance(i.id);if(a){a.toggleViewType({viewType:n})}e.preventDefault()};t.Disk.UFShowController.prototype.toggleViewType=function(e){this.showToggleViewLoader();t.ajax.runComponentAction("bitrix:disk.uf.file","toggleViewType",{mode:"class",signedParameters:this.signedParameters,data:{params:{viewType:e.viewType}}}).then(function(e){this.hideToggleViewLoader();t.clean(this.container);t.html(this.container,e.data.html)}.bind(this),(function(e){this.hideToggleViewLoader()}))};t.Disk.UFShowController.prototype.showToggleViewLoader=function(e){this.container.classList.add("diskuf-files-toggle-container-active");this.loader=new t.Loader({target:this.container});this.loader.show()};t.Disk.UFShowController.prototype.hideToggleViewLoader=function(e){this.container.classList.remove("diskuf-files-toggle-container-active");if(this.loader){this.loader.destroy()}};e.DiskOpenMenuCreateService=function(e){var i=[t.Disk.UF.getDocumentHandler("onlyoffice")?{text:t.Disk.UF.getDocumentHandler("onlyoffice").name,className:"bx-viewer-popup-item item-b24-docs",onclick:function(i,n){n.getMenuWindow().close();t.Disk.saveDocumentService("onlyoffice");t.adjust(e,{text:t.Disk.UF.getDocumentHandler("onlyoffice").name})}}:null,t.Disk.Document.Local.Instance.isEnabled()?{text:t.message("DISK_FOLDER_TOOLBAR_LABEL_LOCAL_BDISK_EDIT"),className:"bx-viewer-popup-item item-b24",onclick:function(i,n){n.getMenuWindow().close();t.Disk.saveDocumentService("l");t.adjust(e,{text:t.message("DISK_FOLDER_TOOLBAR_LABEL_LOCAL_BDISK_EDIT")})}}:null,{text:t.Disk.UF.getDocumentHandler("gdrive").name,className:"bx-viewer-popup-item item-gdocs",onclick:function(i,n){n.getMenuWindow().close();t.Disk.saveDocumentService("gdrive");t.adjust(e,{text:t.Disk.UF.getDocumentHandler("gdrive").name})}},{text:t.Disk.UF.getDocumentHandler("office365").name,className:"bx-viewer-popup-item item-office365",onclick:function(i,n){n.getMenuWindow().close();t.Disk.saveDocumentService("office365");t.adjust(e,{text:t.Disk.UF.getDocumentHandler("office365").name})}},{text:t.Disk.UF.getDocumentHandler("onedrive").name,className:"bx-viewer-popup-item item-office",onclick:function(i,n){n.getMenuWindow().close();t.Disk.saveDocumentService("onedrive");t.adjust(e,{text:t.Disk.UF.getDocumentHandler("onedrive").name})}}];t.PopupMenu.show("disk_open_menu_with_services",t(e),i,{offsetTop:0,offsetLeft:25,angle:{position:"top",offset:45},autoHide:true,zIndex:1e4,overlay:{opacity:.01},events:{}})};e.DiskOpenMenuImportService=function(e,i){var n=[];for(var a in i){if(!i.hasOwnProperty(a))continue;n.push({text:i[a].name,code:i[a].id,href:"#",onclick:function(e,i){var n=i.layout.item;t.addClass(n,"diskuf-selector-link-cloud");n.setAttribute("data-bx-doc-handler",i.code);t.onCustomEvent("onManualChooseCloudImport",[{target:n}]);t.removeClass(n,"diskuf-selector-link-cloud");n.removeAttribute("data-bx-doc-handler");t.PopupMenu.destroy("disk_open_menu_with_import_services");return t.PreventDefault(e)}})}var r=new t.CViewer({});r.openMenu("disk_open_menu_with_import_services",t(e),n,{offsetTop:0,offsetLeft:25});return t.PreventDefault()};e.DiskActionFileMenu=function(e,n,a){i++;t.PopupMenu.show("bx-viewer-wd-popup"+i+"_"+e,t(n),a,{angle:{position:"top",offset:25},autoHide:true});return false};e.WDInlineElementClickDispatcher=function(e,i){var n=t(i);if(n){t.fireEvent(n,"click")}return false}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:100:"/bitrix/components/bitrix/tasks.widget.checklist.new/templates/.default/logic.min.js?169925808316242";s:6:"source";s:80:"/bitrix/components/bitrix/tasks.widget.checklist.new/templates/.default/logic.js";s:3:"min";s:84:"/bitrix/components/bitrix/tasks.widget.checklist.new/templates/.default/logic.min.js";s:3:"map";s:84:"/bitrix/components/bitrix/tasks.widget.checklist.new/templates/.default/logic.map.js";}"*/
"use strict";BX.Tasks.CheckList=function(){var t=function(t){this.renderTo=t.renderTo;this.optionManager=new BX.Tasks.CheckList.OptionManager(t);this.treeStructure=this.buildTreeStructure(t.items);this.dragndrop=new BX.Tasks.CheckList.DragManager({dndZone:this.renderTo,treeStructure:this.treeStructure,canDrag:this.optionManager.getCanDrag()});this.clickEventHandler=new BX.Tasks.CheckList.ClickEventHandler({treeStructure:this.treeStructure});this.loader=new BX.Loader({target:this.renderTo});this.suffixDomId=t.suffixDomId;this.setOptionManager(this.treeStructure);this.setClickEventHandler(this.treeStructure);this.saveStableTreeStructure();this.bindControls();this.render();this.treeStructure.handleTaskOptions()};t.prototype.bindControls=function(){var t=this.renderTo.closest("form");if(t){BX.bind(t,"submit",BX.proxy((function(){this.treeStructure.appendRequestLayout()}),this))}var e=document.getElementById("addCheckList_"+this.suffixDomId);if(!e){e=top.document.getElementById("addCheckList_"+this.suffixDomId)}BX.bind(e,"click",this.onAddCheckListClick.bind(this));BX.bind(document,"mousedown",this.onDocumentMouseDown.bind(this));BX.bind(document,"mouseup",this.onDocumentMouseUp.bind(this))};t.prototype.buildTreeStructure=function(t){var e=new BX.Tasks.CheckListItem;e.setNodeId(0);if(t.length!==0){var i=this;var s=t.DESCENDANTS;Object.keys(s).forEach((function(t){e.add(i.makeTree(s[t]))}))}return e};t.prototype.makeTree=function(t){var e=t.FIELDS;var i=t.DESCENDANTS;e.action=t.ACTION;var s=new BX.Tasks.CheckListItem(e);s.fields.setTotalCount(0);if(typeof i!=="undefined"){var r=this;Object.keys(i).forEach((function(t){s.add(r.makeTree(i[t]));s.fields.setTotalCount(s.fields.getTotalCount()+1)}))}return s};t.prototype.setOptionManager=function(t){var e=this;t.optionManager=this.optionManager;t.getDescendants().forEach((function(t){e.setOptionManager(t)}))};t.prototype.setClickEventHandler=function(t){var e=this;t.clickEventHandler=this.clickEventHandler;t.getDescendants().forEach((function(t){e.setClickEventHandler(t)}))};t.prototype.getTreeStructure=function(){return this.treeStructure};t.prototype.render=function(){var t=this.treeStructure.getLayout();if(this.optionManager.converted){BX.append(t,this.renderTo)}else{var e="<div>PART_1</div><br><div>PART_2</div><div>PART_3</div><br><div>PART_4</div>";var i=["PART_1","PART_2","PART_3","PART_4"];i.forEach((function(t){e=e.replace(t,BX.message("TASKS_CHECKLIST_COMPONENT_JS_CHECKLIST_NOT_CONVERTED_MESSAGE_"+t))}));var s=new BX.UI.Alert({text:e,color:BX.UI.Alert.Color.PRIMARY,icon:BX.UI.Alert.Icon.DANGER});BX.append(s.getContainer(),this.renderTo)}};t.prototype.activateLoading=function(){this.loader.show();BX.addClass(this.renderTo.parentElement,"tasks-checklist-zone-disabled");BX.bind(window,"keydown",BX.proxy(this.disableTabbing,this))};t.prototype.deactivateLoading=function(){BX.removeClass(this.renderTo.parentElement,"tasks-checklist-zone-disabled");BX.unbind(window,"keydown",BX.proxy(this.disableTabbing,this));this.loader.hide()};t.prototype.disableTabbing=function(t){if(t.keyCode===9){t.preventDefault()}};t.prototype.getDestructedTreeStructure=function(t){var e=this;var i={};var s={accomplice:"A",auditor:"U"};Object.keys(t.fields).forEach((function(e){if(e==="members"){i[e]={};t.fields[e].forEach((function(t,r){i[e][r]={TYPE:s[t.type],NAME:BX.util.htmlspecialcharsback(t.nameFormatted)}}));return}else if(e==="attachments"){i[e]={};Object.keys(t.fields[e]).forEach((function(s){i[e][s]=t.fields[e][s]}));return}else if(e==="title"){i[e]=BX.util.htmlspecialcharsback(t.fields[e]);return}i[e]=t.fields[e]}));var r={FIELDS:i,ACTION:{MODIFY:t.checkCanUpdate(),REMOVE:t.checkCanRemove(),TOGGLE:t.checkCanToggle()},DESCENDANTS:[]};t.getDescendants().forEach((function(t){r.DESCENDANTS.push(e.getDestructedTreeStructure(t))}));return r};t.prototype.saveStableTreeStructure=function(){this.optionManager.setStableTreeStructure(this.getDestructedTreeStructure(this.treeStructure))};t.prototype.loadStableTreeStructure=function(){return this.buildTreeStructure(this.optionManager.getStableTreeStructure())};t.prototype.rerender=function(){BX.remove(this.treeStructure.panel);this.treeStructure=this.loadStableTreeStructure();this.dragndrop.treeStructure=this.treeStructure;this.clickEventHandler.treeStructure=this.treeStructure;this.setOptionManager(this.treeStructure);this.setClickEventHandler(this.treeStructure);while(this.renderTo.lastChild){this.renderTo.removeChild(this.renderTo.lastChild)}this.render();this.treeStructure.handleTaskOptions()};t.prototype.onAddCheckListClick=function(){if(this.treeStructure.checkActiveUpdateExist()){return}this.addCheckList().then((function(t){t.addCheckListItem()}));BX.Event.EventEmitter.emit("BX.Tasks.CheckListItem:CheckListChanged")};t.prototype.addCheckList=function(){if(!this.optionManager.getCanAdd()){return}var t=new BX.Promise;var e=BX.message("TASKS_CHECKLIST_COMPONENT_JS_NEW_CHECKLIST_TITLE_2").replace("#ITEM_NUMBER#",this.treeStructure.getDescendantsCount()+1);var i=new BX.Tasks.CheckListItem({TITLE:e});this.treeStructure.addCheckListItem(i).then((function(e){t.resolve(e)}));return t};t.prototype.onDocumentMouseDown=function(t){if(t.button!==0){return}this.focusElement=t.target.closest(".ui-ctl-textbox")};t.prototype.onDocumentMouseUp=function(t){if(t.button!==0){return}var e=false;var i=[t.target.closest(".tasks-checklist-item-content-block"),t.target.closest(".tasks-checklist-item-editor-panel-container"),t.target.closest(".tasks-checklist-item-attachment-file"),t.target.closest(".tasks-checklist-header-name"),t.target.closest("#files_chooser"),t.target.closest("#DiskFileDialog"),t.target.closest(".ui-selector-dialog")];i.forEach((function(t){if(!e&&t!==null){e=true}}));if(e||this.focusElement){return}this.treeStructure.disableAllUpdateModes();this.treeStructure.handleTaskOptions()};t.prototype.onSave=function(){this.treeStructure.disableAllGroup()};return t}();BX.Tasks.CheckList.ClickEventHandler=function(){var t=function(){this.pos={x:0,y:0};this.time=0;this.timeoutHandle=0;this.clicked=0};t.prototype.registerClickDoneCallback=function(t){this.callback=t};t.prototype.handleMouseDown=function(t){if(this.timeoutHandle>0){this.clearTimeout()}this.time=(new Date).valueOf();this.pos={x:t.clientX,y:t.clientY}};t.prototype.handleMouseUp=function(t){if(this.timeoutHandle>0){this.clearTimeout()}if((new Date).valueOf()-this.time<400&&Math.abs(this.pos.x-t.clientX)<2){this.clicked+=1;if(this.clicked<2){this.timeoutHandle=window.setTimeout(this.callback,150);setTimeout(this.clearClicked.bind(this),200)}else{this.clearTimeout();setTimeout(this.clearClicked.bind(this),200)}}this.time=0};t.prototype.clearTimeout=function(){window.clearTimeout(this.timeoutHandle);this.timeoutHandle=0};t.prototype.clearClicked=function(){this.clicked=0};return t}();BX.Tasks.CheckList.OptionManager=function(){var t=function(t){this.userId=t.userId;this.entityId=t.entityId;this.entityType=t.entityType;this.userPath=t.userPath;this.prefix=t.prefix;this.commonAction=t.commonAction;this.converted=t.converted;this.ajaxActions=t.ajaxActions;this.attachments=t.attachments;this.diskUrls=t.diskUrls;this.showCompleteAllButton=t.showCompleteAllButton;this.collapseOnCompleteAll=t.collapseOnCompleteAll;this.isNetworkEnabled=t.isNetworkEnabled;this.showCompleted=t.options.SHOW_COMPLETED;this.defaultMemberSelectorType=t.options.DEFAULT_MEMBER_SELECTOR_TYPE;this.showOnlyMine=false;this.stableTreeStructure=null;this.slider=BX.SidePanel.Instance.getTopSlider()};t.prototype.getUserPath=function(){return this.userPath};t.prototype.getUserId=function(){return this.userId};t.prototype.getPrefix=function(){return this.prefix};t.prototype.getCanAdd=function(){return this.commonAction.canAdd};t.prototype.getCanDrag=function(){return this.commonAction.canDrag};t.prototype.getCanAddAccomplice=function(){return this.commonAction.canAddAccomplice};t.prototype.getShowCompleteAllButton=function(){return this.showCompleteAllButton};t.prototype.getCollapseOnCompleteAll=function(){return this.collapseOnCompleteAll};t.prototype.getShowCompleted=function(){return this.showCompleted};t.prototype.setShowCompleted=function(t){this.showCompleted=t;this.updateTaskOption("show_completed",t)};t.prototype.getShowOnlyMine=function(){return this.showOnlyMine};t.prototype.setShowOnlyMine=function(t){this.showOnlyMine=t};t.prototype.getDefaultMemberSelectorType=function(){return this.defaultMemberSelectorType};t.prototype.getStableTreeStructure=function(){return this.stableTreeStructure};t.prototype.setStableTreeStructure=function(t){this.stableTreeStructure=t};t.prototype.updateTaskOption=function(t,e){BX.ajax.runComponentAction("bitrix:tasks.widget.checklist.new","updateTaskOption",{mode:"class",data:{option:t,value:e,userId:this.userId,entityType:this.entityType}}).then(function(t){}.bind(this),function(t){}.bind(this))};return t}();BX.Tasks.CheckList.DragManager=function(){var t=function(t){this.dragObject={};this.dropObject={};this.itemDropPlace=BX.create("div",{props:{className:"tasks-checklist-item tasks-checklist-item-drop-place droppable"},children:[BX.create("div",{props:{className:"tasks-checklist-item-inner"}})]});this.checkListDropPlace=BX.create("div",{props:{className:"tasks-checklist-wrapper-drop-place droppable"}});this.canDrag=t.canDrag;this.dndZone=t.dndZone;this.treeStructure=t.treeStructure;BX.bind(document,"mousedown",this.onMouseDown.bind(this))};t.prototype.onMouseDown=function(t){if(t.button!==0||!this.canDrag){return}var e=t.target.closest(".tasks-checklist-item-dragndrop")||t.target.closest(".tasks-checklist-wrapper-dragndrop");if(!e){return}var i=this.getNodeByDragButton(e);if(!i||i.getCheckList().fields.getIsSelected()){return}this.dragObject={};this.dropObject={};this.dragObject.node=i;this.dragObject.downX=t.pageX;this.dragObject.downY=t.pageY;this.disableSelection(this.dndZone);BX.bind(document,"mousemove",BX.proxy(this.onMouseMove,this));BX.bind(document,"mouseup",BX.proxy(this.onMouseUp,this));return false};t.prototype.getNodeByDragButton=function(t){return this.treeStructure.findChild(t.parentElement.parentElement.id)};t.prototype.getDropObjectType=function(t){if(BX.hasClass(t,"tasks-checklist-item-drop-place")||BX.hasClass(t,"tasks-checklist-wrapper-drop-place")){return"dropPlace"}if(BX.hasClass(t,"tasks-checklist-item-inner")){return"node"}if(BX.hasClass(t,"tasks-checklist-items-list-actions")){return"addButton"}if(BX.hasClass(t,"tasks-checklist-header-wrapper")){return"checklist"}};t.prototype.getDropObjectNode=function(){var t=null;var e=this.dropObject.targetDrop;switch(this.dropObject.type){case"node":t=this.treeStructure.findChild(e.parentElement.id);if(this.dropObject.position==="bottom"&&t.getDescendantsCount()>0){this.dropObject.position="top";t=t.getFirstDescendant()}break;case"addButton":t=this.treeStructure.findChild(e.parentElement.parentElement.id);this.dropObject.position="bottom";break;case"checklist":t=this.treeStructure.findChild(e.parentElement.id);if(!this.dragObject.node.isCheckList()){this.dropObject.position="top"}break}return t};t.prototype.spawnDropPlace=function(){switch(this.dropObject.type){case"node":if(this.dropObject.position==="top"){BX.insertBefore(this.itemDropPlace,this.dropObject.node.getContainer())}else{BX.insertAfter(this.itemDropPlace,this.dropObject.node.getContainer())}break;case"addButton":if(this.dropObject.node.getDescendantsCount()>0){BX.insertAfter(this.itemDropPlace,this.dropObject.node.getLastDescendant().getContainer())}else{BX.append(this.itemDropPlace,this.dropObject.node.getSubItemsContainer())}break;case"checklist":if(this.dragObject.node.isCheckList()){if(this.dropObject.position==="top"){BX.insertBefore(this.checkListDropPlace,this.dropObject.node.getContainer())}else{BX.insertAfter(this.checkListDropPlace,this.dropObject.node.getContainer())}}else if(this.dropObject.node.getDescendantsCount()>0){BX.insertBefore(this.itemDropPlace,this.dropObject.node.getFirstDescendant().getContainer())}else{BX.append(this.itemDropPlace,this.dropObject.node.getSubItemsContainer())}break}};t.prototype.onMouseMove=function(t){if(!this.dragObject.node){return}if(!this.dragObject.avatar){var e=t.pageX-this.dragObject.downX;var i=t.pageY-this.dragObject.downY;if(Math.abs(e)<5&&Math.abs(i)<5){return}this.dragObject.avatar=this.createAvatar();if(!this.dragObject.avatar){this.dragObject={};return}this.startDrag()}this.moveAvatar(t);var s=this.findDroppable(t);if(!s){return false}var r=this.getDropObjectType(s);if(r==="node"||r==="checklist"&&this.dragObject.node.isCheckList()){var o=this.getCoords(s);this.dropObject.position=t.pageY<o.top+o.height/2?"top":"bottom";this.dropObject.targetDrop=s;this.dropObject.type=r;this.dropObject.node=this.getDropObjectNode();this.spawnDropPlace()}else if(r!=="dropPlace"&&s!==this.dropObject.targetDrop){this.dropObject.position=r==="checklist"?"top":"bottom";this.dropObject.targetDrop=s;this.dropObject.type=r;this.dropObject.node=this.getDropObjectNode();this.spawnDropPlace()}return false};t.prototype.createAvatar=function(){var t=this.dragObject.node.getContainer();var e=t.cloneNode(true);if(this.dragObject.node.isCheckList()){BX.addClass(e,"tasks-checklist-wrapper-draggable");if(!BX.hasClass(e,"tasks-checklist-collapse")){BX.addClass(e,"tasks-checklist-collapse")}e.querySelector(".tasks-checklist-items-wrapper").style.height=0}else{BX.addClass(e,"tasks-checklist-item-draggable");if(this.dragObject.node.getDescendantsCount()>0){BX.append(BX.create("div",{props:{className:"tasks-checklist-group-draggable"}}),e)}}BX.removeClass(e.querySelector(".droppable"),"droppable");e.style.left=this.dragObject.downX+"px";e.style.width=t.offsetWidth/2+"px";return e};t.prototype.moveAvatar=function(t){var e=this.dragObject.node.isCheckList()?10:20;var i=25;this.dragObject.avatar.style.left=t.pageX-e+"px";this.dragObject.avatar.style.top=t.pageY-i+"px"};t.prototype.startDrag=function(){var t=this.dragObject.avatar;BX.hide(this.dragObject.node.getContainer());BX.append(t,document.body);t.style.zIndex=9999;t.style.position="absolute";if(this.dragObject.node.isCheckList()){this.treeStructure.getDescendants().forEach((function(t){if(!t.fields.getIsCollapse()){t.toggleCollapse();t.fields.setIsCollapse(false)}}))}};t.prototype.onMouseUp=function(t){if(this.dragObject.avatar){this.finishDrag(t)}this.dragObject={};this.enableSelection();BX.unbind(document,"mousemove",BX.proxy(this.onMouseMove,this));BX.unbind(document,"mouseup",BX.proxy(this.onMouseUp,this))};t.prototype.finishDrag=function(t){var e=this.findDroppable(t);BX.remove(this.itemDropPlace);BX.remove(this.checkListDropPlace);if(!e||this.dragObject.node.isCheckList()&&this.dropObject.type!=="checklist"){this.cancelDrag()}else{this.endDrag()}if(this.dragObject.node.isCheckList()){this.treeStructure.getDescendants().forEach((function(t){if(!t.fields.getIsCollapse()){t.toggleCollapse()}}))}};t.prototype.cancelDrag=function(){this.dragObject.node.getContainer().style.display="";BX.remove(this.dragObject.avatar)};t.prototype.endDrag=function(){var t=this.dragObject.node;var e=this.dropObject.node;BX.remove(this.dragObject.avatar);if(this.dropObject.type==="node"||this.dropObject.type==="checklist"&&t.isCheckList()){t.move(e,this.dropObject.position)}else{t.makeChildOf(e,this.dropObject.position)}t.getContainer().style.display=""};t.prototype.findDroppable=function(t){BX.hide(this.dragObject.avatar);var e=document.elementFromPoint(t.clientX,t.clientY);BX.show(this.dragObject.avatar);if(e==null){return null}return e.closest(".droppable")};t.prototype.getCoords=function(t){var e=t.getBoundingClientRect();return{top:e.top+pageYOffset,left:e.left+pageXOffset,width:e.width,height:e.height}};t.prototype.enableSelection=function(){BX.removeClass(document.body,"tasks-checklist-zone-noselect")};t.prototype.disableSelection=function(){BX.addClass(document.body,"tasks-checklist-zone-noselect")};return t}();(function(){if(typeof BX.Tasks.Component.TasksWidgetCheckListNew!="undefined"){return}BX.Tasks.Component.TasksWidgetCheckListNew=BX.Tasks.Component.extend({sys:{code:"checklist"},methods:{construct:function(){this.callConstruct(BX.Tasks.Component)},bindEvents:function(){}}})}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:104:"/bitrix/components/bitrix/tasks.widget.member.selector/templates/projectlink/logic.min.js?16992580822273";s:6:"source";s:85:"/bitrix/components/bitrix/tasks.widget.member.selector/templates/projectlink/logic.js";s:3:"min";s:89:"/bitrix/components/bitrix/tasks.widget.member.selector/templates/projectlink/logic.min.js";s:3:"map";s:89:"/bitrix/components/bitrix/tasks.widget.member.selector/templates/projectlink/logic.map.js";}"*/
"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksWidgetMemberSelectorProjectLink!="undefined"){return}BX.Tasks.Component.TasksWidgetMemberSelectorProjectLink=BX.Tasks.Component.extend({dialog:null,sys:{code:"ms-plink"},options:{entityRoute:""},methods:{bindEvents:function(){this.bindDelegateControl("deselect","click",this.onDeSelect.bind(this));this.bindDelegateControl("control","click",this.onOpenForm.bind(this))},onDeSelect:function(){this.setItem(0)},setItem:function(t,e){t=parseInt(t);if(t){BX.removeClass(this.control("item"),"invisible");BX.addClass(this.control("control"),"invisible");this.control("item-link").innerHTML=BX.util.htmlspecialchars(e);this.control("item-link").setAttribute("href",this.getProjectLink(t));this.option("groupId",t)}else{BX.addClass(this.control("item"),"invisible");BX.removeClass(this.control("control"),"invisible")}this.saveId(t)},onOpenForm:function(){this.getProjectDialog().show()},getProjectLink:function(t){return this.option("path").SG.toString().replace("{{ID}}",t)},saveId:function(t){var e=this.option("entityRoute");if(!e){return}var i=this.option("entityId");t=parseInt(t);BX.ajax.runComponentAction("bitrix:tasks.widget.member.selector","setProject",{mode:"class",data:{taskId:i,context:this.option("context")??"",groupId:t}}).then(function(e){BX.Tasks.Util.fireGlobalTaskEvent("UPDATE",{ID:i},{STAY_AT_PAGE:true},{id:i});BX.onCustomEvent(this,"onChangeProjectLink",[t,i]);if(e.status==="success"){BX.onCustomEvent(this,"onProjectChanged",t)}}.bind(this)).catch(function(t){if(t.errors){BX.Tasks.alert(t.errors)}}.bind(this))},onSelectorItemSelected:function(t){this.setItem(t.id,BX.util.htmlspecialcharsback(t.nameFormatted))},getProjectDialog:function(){if(!this.dialog){this.dialog=new BX.UI.EntitySelector.Dialog({targetNode:this.control("control"),enableSearch:true,multiple:false,context:"TASKS_PROJECTLINK",entities:[{id:"project"}],events:{"Item:onSelect":function(t){var e=t.getData().item;var i={id:e.getId(),nameFormatted:e.getTitle()};this.onSelectorItemSelected(i);BX.addClass(this.control("control"),"invisible");this.dialog.hide()}.bind(this),"Item:onDeselect":function(t){}.bind(this)}})}return this.dialog}}})}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:82:"/bitrix/components/bitrix/app.placement/templates/menu/script.min.js?1699258043580";s:6:"source";s:64:"/bitrix/components/bitrix/app.placement/templates/menu/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){BX.namespace("BX.rest");if(!!BX.rest.PlacementMenu){return}BX.rest.PlacementMenu=function(e){BX.rest.PlacementMenu.superclass.constructor.apply(this,arguments)};BX.extend(BX.rest.PlacementMenu,BX.rest.Placement);BX.rest.PlacementMenu.prototype.load=function(e,t,n,a){this.initializeInterface(a);BX.rest.AppLayout.openApplication(t,n,{PLACEMENT_ID:e,PLACEMENT:this.param.placement})};BX.rest.PlacementMenu.prototype.initializeInterface=function(e){var t=top.BX.rest.AppLayout.initializePlacement(this.param.placement);t.prototype.reloadData=function(t,n){e();n()}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/tasks.widget.buttons/templates/task/logic.min.js?16992580829719";s:6:"source";s:70:"/bitrix/components/bitrix/tasks.widget.buttons/templates/task/logic.js";s:3:"min";s:74:"/bitrix/components/bitrix/tasks.widget.buttons/templates/task/logic.min.js";s:3:"map";s:74:"/bitrix/components/bitrix/tasks.widget.buttons/templates/task/logic.map.js";}"*/
BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksWidgetButtonsTask!="undefined"){return}BX.Tasks.Component.TasksWidgetButtonsTask=BX.Tasks.Util.Widget.extend({sys:{code:"task-view-b"},options:{goToListOnDelete:true},methods:{construct:function(){this.callConstruct(BX.Tasks.Util.Widget);this.vars.data=this.option("data")||{};this.vars.can=this.option("can")||{};this.vars.publicMode=this.option("publicMode")||false;this.vars.overtime=null;this.vars.buttonActionEnabled=true;this.vars.delegateReload=true;this.vars.time=0;if(this.vars.data.TIME_ELAPSED){this.vars.time=parseInt(this.vars.data.TIME_ELAPSED)}this.bindEvents();this.getDayPlan()},bindEvents:function(){this.bindDelegateControl("open-menu","click",this.passCtx(this.onMenuOpen));this.bindDelegateControl("button","click",this.passCtx(this.onButtonPressed))},onMenuOpen:function(t){if(!this.vars.buttonActionEnabled){return}BX.PopupMenu.show(this.code(),t,this.getTaskMenu(),{closeByEsc:true})},onButtonPressed:function(t){if(!this.vars.buttonActionEnabled){return}var e=BX.data(t,"action");if(BX.type.isNotEmptyString(e)){this.doDynamicAction(e)}},getDayPlan:function(){if(!this.instances.dayplan){var t=BX.clone(this.option("data"));var e=this.option("taskId");t.ID=e;var s={};s[e]=t;this.instances.dayplan=new BX.Tasks.DayPlan({registerDispatcher:true,id:"buttons-dayplan",data:s});this.instances.dayplan.bindEvent("other-task-on-timer",BX.delegate(this.showTimerConfirm,this));this.instances.dayplan.bindEvent("task-timer-toggle",BX.delegate(this.onTaskTimerToggled,this));this.instances.dayplan.bindEvent("task-plan-toggle",BX.delegate(this.onTaskPlanToggled,this));this.instances.dayplan.bindEvent("task-timer-tick",BX.delegate(this.onTaskTimerTick,this))}return this.instances.dayplan},showUserSelector:function(){if(!this.userSelector){this.userSelector=new BX.UI.EntitySelector.Dialog({targetNode:this.control("open-menu"),enableSearch:true,multiple:false,context:"TASKS_MEMBER_SELECTOR_EDIT_responsible",entities:[{id:"user",options:{emailUsers:true}}],events:{"Item:onSelect":function(t){var e=t.getData().item;this.doDynamicAction("DELEGATE",{userId:e.getId()})}.bind(this)}})}this.userSelector.show()},doMenuAction:function(t,e,s){var i=s.code;if(i){if(i==="COPY"){window.location=this.option("copyUrl")}else if(i==="CREATE_SUBTASK"){BX.SidePanel.Instance.open(this.option("createSubtaskUrl"))}else if(i==="DELEGATE"){if(this.option("taskLimitExceeded")){BX.UI.InfoHelper.show("limit_tasks_delegating",{isLimit:true,limitAnalyticsLabels:{module:"tasks",source:"taskView"}});return}this.showUserSelector()}else if(i==="REST"){BX.SidePanel.Instance.open(s.callbackData.serviceUrl,s.callbackData.opt||{})}else{this.doDynamicAction(i)}}t.popupWindow.close()},doDynamicAction:function(t,e){e=e||{};this.togglePanelActivity(false);if(t=="START_TIMER"||t=="PAUSE_TIMER"){this.getDayPlan()[t=="START_TIMER"?"startTimer":"stopTimer"](this.option("taskId"),true,e.force||false)}else if(t=="DAYPLAN.ADD"){this.getDayPlan().addToPlan(this.option("taskId"));this.reFetchTaskData(t)}else if(t=="DELETE"){window.top.BX.UI.Notification.Center.notify({content:BX.message("TASKS_DELETE_SUCCESS")});this.doDynamicTaskAction(t,e)}else if(t==="COMPLETE"||t==="RENEW"){var s=new BX.Promise;var i=null;var a=false;if(this.option("isScrumTask")){top.BX.loadExt("tasks.scrum.task-status").then(function(){if(!BX.type.isUndefined(top.BX.Tasks.Scrum)&&!BX.type.isUndefined(top.BX.Tasks.Scrum.TaskStatus)){i=new top.BX.Tasks.Scrum.TaskStatus({groupId:this.option("groupId"),parentTaskId:this.option("parentId"),taskId:this.option("taskId"),action:t==="COMPLETE"?"complete":"renew",performActionOnParentTask:true});i.isParentScrumTask(this.option("parentId")).then(function(e){a=e;if(a){s.fulfill()}else{if(t==="COMPLETE"){i.showDod(this.option("taskId")).then(function(){s.fulfill()}.bind(this)).catch(function(){s.reject()}.bind(this))}else{s.fulfill()}}}.bind(this))}else{s.fulfill()}}.bind(this))}else{s.fulfill()}s.then(function(){this.doDynamicTaskAction(t,e).then(function(){if(i&&a){i.update()}}.bind(this))}.bind(this))}else{this.doDynamicTaskAction(t,e)}this.togglePanelActivity(true)},doDynamicTaskAction:function(t,e){var s=this.option("taskId");var i=this;var a=t.toLowerCase();e=e||{};e["id"]=s;return BX.ajax.runComponentAction("bitrix:tasks.task",a,{mode:"class",data:{taskId:s,parameters:e}}).then(function(e){if(a==="delete"){BX.Tasks.Util.fireGlobalTaskEvent("DELETE",{ID:s});if(this.option("goToListOnDelete")){window.location=this.option("listUrl")}}else{this.reFetchTaskData(t)}return true}.bind(this)).catch(function(t){if(t.errors){if(a==="delegate"){i.vars.delegateReload=false}BX.Tasks.alert(t.errors);this.togglePanelActivity(true)}}.bind(this))},reFetchTaskData:function(t){if(t!=="DELETE"&&t!=="DAYPLAN.ADD"){var e=this.option("taskId");var s=this;BX.ajax.runComponentAction("bitrix:tasks.task","get",{mode:"class",data:{taskId:e,parameters:{ENTITY_SELECT:["DAYPLAN"]}}}).then(function(i){if(t==="DELEGATE"&&s.vars.delegateReload){window.location.reload()}else if(t==="DEFER"){this.getDayPlan().stopTimer(e,false)}this.updateTaskData(i.data.DATA);this.updatePlanner();this.togglePanelActivity(true)}.bind(this)).catch(function(t){if(t.errors){BX.Tasks.alert(t.errors);this.togglePanelActivity(true)}}.bind(this))}else{if(t==="DAYPLAN.ADD"){this.updateTaskData({ACTION:{"DAYPLAN.ADD":false}})}this.togglePanelActivity(true)}},updateTaskData:function(t){BX.PopupMenu.destroy(this.code());if(t.ACTION){BX.mergeEx(this.vars.can,t.ACTION)}BX.mergeEx(this.vars.data,t);this.updateButtons();var e=BX.clone(this.vars.data);e.ID=this.option("taskId");BX.Tasks.Util.fireGlobalTaskEvent("UPDATE",e,{STAY_AT_PAGE:true})},updateButtons:function(){var t=this.vars.can;var e=this.vars.data;if(e.STATUS==4){t.COMPLETE=false}var s={"timer-start":t["DAYPLAN.TIMER.TOGGLE"]&&!e.TIMER_IS_RUNNING_FOR_CURRENT_USER,"timer-pause":t["DAYPLAN.TIMER.TOGGLE"]&&e.TIMER_IS_RUNNING_FOR_CURRENT_USER,"timer-running":e.TIMER_IS_RUNNING_FOR_CURRENT_USER,"timer-visible":t["DAYPLAN.TIMER.TOGGLE"],pause:!t["DAYPLAN.TIMER.TOGGLE"]&&t.PAUSE,start:!t["DAYPLAN.TIMER.TOGGLE"]&&t.START,complete:t.COMPLETE,approve:t.APPROVE,disapprove:t.DISAPPROVE,edit:t.EDIT&&!this.vars.publicMode,"more-button":!this.vars.publicMode||t.RENEW};this.toggleCSSMap(s)},onTaskTimerTick:function(t,e,s){if(t!=this.option("taskId")){return}if(this.vars.overtime==null){var i=parseInt(this.vars.data.TIME_ESTIMATE);if(!isNaN(i)&&i&&e>i){this.vars.overtime=true;this.changeCSSFlag("timer-overtime",this.vars.overtime)}}this.control("time-elapsed").innerHTML=BX.Tasks.Util.formatTimeAmount(e)},onTaskTimerToggled:function(t,e,s){if(t!=this.option("taskId")){return}this.addToData(s);this.reFetchTaskData("START_TIMER");this.updateButtons()},onTaskPlanToggled:function(t,e){if(t!=this.option("taskId")){return}this.updateTaskData({ACTION:{"DAYPLAN.ADD":true}})},showTimerConfirm:function(t,e){if(t!=this.option("taskId")){return}e=e||{};var s=BX.message("TASKS_TASK_CONFIRM_START_TIMER");s=s.replace("{{TITLE}}",BX.type.isNotEmptyString(e.title)?BX.util.htmlspecialchars(e.title):BX.message("TASKS_UNKNOWN"));BX.Tasks.confirm(s,BX.delegate((function(t){if(t){this.doDynamicAction("START_TIMER",{force:true})}}),this),{title:BX.message("TASKS_TASK_CONFIRM_START_TIMER_TITLE")})},togglePanelActivity:function(t){this.changeCSSFlag("inactive",!t);this.vars.buttonActionEnabled=t},getTaskMenu:function(){var t=[];var e=this.vars.can;if(this.vars.publicMode){if(e.RENEW){t.push({code:"RENEW",text:BX.message("TASKS_RENEW_TASK"),title:BX.message("TASKS_RENEW_TASK"),className:"menu-popup-item-reopen",onclick:this.passCtx(this.doMenuAction)})}return t}t.push({code:"COPY",text:BX.message("TASKS_COPY_TASK"),title:BX.message("TASKS_COPY_TASK_EX"),className:"menu-popup-item-copy",onclick:this.passCtx(this.doMenuAction)},{code:"CREATE_SUBTASK",text:BX.message("TASKS_ADD_SUBTASK"),title:BX.message("TASKS_ADD_SUBTASK"),className:"menu-popup-item-create",onclick:this.passCtx(this.doMenuAction)});if(e["DAYPLAN.ADD"]){t.push({code:"DAYPLAN.ADD",text:BX.message("TASKS_ADD_TASK_TO_TIMEMAN"),title:BX.message("TASKS_ADD_TASK_TO_TIMEMAN_EX"),className:"menu-popup-item-add-to-tm",onclick:this.passCtx(this.doMenuAction)})}if(e.DELEGATE){t.push({code:"DELEGATE",text:BX.message("TASKS_DELEGATE_TASK"),title:BX.message("TASKS_DELEGATE_TASK"),className:"menu-popup-item-delegate"+(this.option("taskLimitExceeded")?" tasks-tariff-lock":""),onclick:this.passCtx(this.doMenuAction)})}if(e.DEFER){t.push({code:"DEFER",text:BX.message("TASKS_DEFER_TASK"),title:BX.message("TASKS_DEFER_TASK"),className:"menu-popup-item-hold",onclick:this.passCtx(this.doMenuAction)})}if(e.RENEW){t.push({code:"RENEW",text:BX.message("TASKS_RENEW_TASK"),title:BX.message("TASKS_RENEW_TASK"),className:"menu-popup-item-reopen",onclick:this.passCtx(this.doMenuAction)})}if(e.REMOVE){t.push({code:"DELETE",text:BX.message("TASKS_DELETE_TASK"),title:BX.message("TASKS_DELETE_TASK"),className:"menu-popup-item-delete",onclick:this.passCtx(this.doMenuAction)})}var s=this.option("additional_tabs");if(s.length>0){var i=[];for(var a=0;a<s.length;a++){var n=s[a];var o={};if(n.LOADER&&n.LOADER.componentData){o={options:{requestMethod:"POST",requestParams:n.LOADER.componentData.params}}}i.push({code:"REST",text:n.NAME,title:n.NAME,callbackData:n.ONCLICK,onclick:n.ONCLICK})}t.push({code:"",text:BX.message("TASKS_REST_BUTTON_TITLE_2"),title:BX.message("TASKS_REST_BUTTON_TITLE_2"),className:"menu-popup-item-",items:i})}return t},addToData:function(t){this.vars.overtime=null;BX.mergeEx(this.vars.data,t||{})},updatePlanner:function(){this.getDayPlan().updatePlanner()}}})}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:85:"/bitrix/components/bitrix/tasks.list/templates/.default/script.min.js?169925808315265";s:6:"source";s:65:"/bitrix/components/bitrix/tasks.list/templates/.default/script.js";s:3:"min";s:69:"/bitrix/components/bitrix/tasks.list/templates/.default/script.min.js";s:3:"map";s:69:"/bitrix/components/bitrix/tasks.list/templates/.default/script.map.js";}"*/
var loadedTasks={};var newTaskParent=0;var newTaskDepth=0;var newTaskGroup=0;var newTaskGroupObj;var tasksMenuPopup={};var quickInfoData={};var preOrder={};var TaskListFilterPopup={popup:null,init:function(e){if(this.popup!=null)return;this.popup=new BX.PopupWindow("task-list-filter",e,{content:BX("task-list-filter"),offsetLeft:-263+e.offsetWidth-10,offsetTop:3,className:"task-filter-popup-window",zIndex:-120,closeByEsc:true,events:{onPopupClose:function(e){if(tasksTagsPopUp!=null){tasksTagsPopUp.popupWindow.close()}}}});BX.bind(BX("task-list-filter"),"click",BX.delegate(this.onFilterSwitch,this))},show:function(e){if(!this.popup)this.init(e);if(BX.hasClass(e,"task-title-button-filter-pressed")){this.popup.close();BX.removeClass(e,"task-title-button-filter-pressed");this.adjustListHeight()}else{this.popup.show();BX.addClass(e,"task-title-button-filter-pressed");this.adjustListHeight();BX.bind(BX("task-list-filter"),"click",BX.proxy(this.onFilterClick,this));window.setTimeout(function(e,t){return function(){t.bindElement=e;BX.bind(document,"click",BX.proxy(t.onDocumentClick,t))}}(e,this),100)}},onFilterClick:function(e){if(!e)e=event;if(e.stopPropagation)e.stopPropagation();else e.cancelBubble=true},onDocumentClick:function(){this.popup.close();BX.removeClass(this.bindElement,"task-title-button-filter-pressed");BX.removeClass(this.bindElement,"webform-small-button-active");this.adjustListHeight();BX.unbind(document,"click",BX.proxy(this.onDocumentClick,this));BX.unbind(BX("task-list-filter"),"click",BX.proxy(this.onFilterClick,this))},adjustListHeight:function(){var e=BX("task-list-container",true);if(!e)return;var t=e.offsetHeight-(parseInt(e.style.paddingBottom)||0);var s=this.popup?this.popup.popupContainer.offsetHeight:0;if(s>t)BX("task-list-container",true).style.paddingBottom=s-t+"px";else BX("task-list-container",true).style.paddingBottom="0px"},onFilterSwitch:function(e){e=e||window.event;var t=e.target||e.srcElement;if(BX.hasClass(t,"task-filter-mode-selected"))this.adjustListHeight()}};var tasksListTemplateDefaultInit=function(){if(BX("task-title-button-search-input",true)){BX.bind(BX("task-title-button-search-input",true),"click",function(e){if(!e)e=window.event;BX.addClass(this.parentNode.parentNode.parentNode,"task-title-button-search-full")});BX.bind(BX("task-title-button-search-input",true),"blur",function(e){if(!e)e=window.event;if(this.value==""){BX.removeClass(this.parentNode.parentNode.parentNode,"task-title-button-search-full")}});BX.bind(BX("task-title-button-search-input",true),"keyup",function(e){if(!e)e=window.event;if(e.keyCode==13){BX.submit(document.forms["task-filter-title-form"])}});BX.bind(BX("task-title-button-search-icon"),"click",function(e){if(!e)e=window.event;BX.submit(document.forms["task-filter-title-form"])})}};function showAjaxErrorPopup(){var e=new BX.PopupWindow("gantt-ajax-error-popup",null,{lightShadow:true,overlay:true,buttons:[new BX.PopupWindowButton({text:BX.message("JS_CORE_WINDOW_CLOSE"),className:"",events:{click:function(){if(BX.SidePanel&&BX.SidePanel.Instance.getTopSlider()===BX.SidePanel.Instance.getSliderByWindow(window)){window.location.reload()}else{BX.reload()}this.popupWindow.close()}}})]});var t=[];for(var s=0;s<arguments.length;s++){var a=arguments[s];if(BX.type.isArray(a)){t=BX.util.array_merge(t,a)}else if(BX.type.isString(a)){t.push(a)}}var i="";for(s=0;s<t.length;s++){i+=(typeof t[s].MESSAGE!=="undefined"?t[s].MESSAGE:t[s])+"<br>"}e.setContent("<div class='task-new-item-error-popup'>"+i+"</div>");e.show()}function isLeftClick(e){if(!e.which&&e.button!==undefined){if(e.button&1)e.which=1;else if(e.button&4)e.which=2;else if(e.button&2)e.which=3;else e.which=0}return e.which==1||e.which==0&&BX.browser.IsIE()}function ShowPopupTask(e,t){if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i))return false;if(!t)t=window.event;if(isLeftClick(t)){if(typeof tasksIFrameList=="undefined")tasksIFrameList=[];taskIFramePopup.view(e,tasksIFrameList);BX.PreventDefault(t)}}function AddQuickPopupTask(e,t){t=t||{};if(!e)e=window.event;if(!isLeftClick(e))return;BX.PreventDefault(e);if(typeof taskIFramePopup!="undefined"){taskIFramePopup.edit(0,t)}}function AddPopupTask(e,t){t=t||0;if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i))return false;if(!e)e=window.event;if(isLeftClick(e)){var s=null;if(t>0)s={GROUP_ID:t};taskIFramePopup.add(s);BX.PreventDefault(e)}}function EditPopupTask(e,t){if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i))return false;if(!t)t=window.event;if(isLeftClick(t)){taskIFramePopup.edit(e);BX.PreventDefault(t)}}function AddPopupSubtask(e,t){if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i))return false;if(!t)t=window.event;if(isLeftClick(t)){taskIFramePopup.add({PARENT_ID:e});BX.PreventDefault(t)}}function CopyPopupTask(e,t){debugger;if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i))return false;if(!t)t=window.event;if(isLeftClick(t)){taskIFramePopup.add({COPY:e});BX.PreventDefault(t)}}function AddPopupTemplateTask(e,t){if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i))return false;if(!t)t=window.event;taskIFramePopup.add({TEMPLATE:e});BX.PreventDefault(t)}function AddPopupTemplateSubtask(e,t,s){if(!s)s=window.event;taskIFramePopup.add({TEMPLATE:e,PARENT_ID:t});BX.PreventDefault(s)}function AddPopupGroupTask(e,t){if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i))return false;if(!t)t=window.event;taskIFramePopup.add({GROUP_ID:e});BX.PreventDefault(t)}function SetCSSStatus(e,t,s){BX.removeClass(e,s+"overdue");BX.removeClass(e,s+"new");BX.removeClass(e,s+"accepted");BX.removeClass(e,s+"in-progress");BX.removeClass(e,s+"delayed");BX.removeClass(e,s+"waiting");BX.removeClass(e,s+"completed");var a=e.getElementsByTagName("TD");var i=BX.findChild(a[0],{tagName:"a"},true);BX.style(i,"text-decoration","none");BX.addClass(e,s+t)}function SetServerStatus(e,t,s){var a=null;var i={mode:t,sessid:BX.message("bitrix_sessid"),path_to_task:BX.message("TASKS_PATH_TO_TASK"),id:e};if(typeof tasksListNS!=="undefined"&&tasksListNS.getColumnsOrder){a=tasksListNS.getColumnsOrder();i["columnsOrder"]=a}if(s){for(var n in s){i[n]=s[n]}}BX.ajax({method:"POST",dataType:"json",url:tasksListAjaxUrl+"&_CODE="+t+"&viewType=VIEW_MODE_GANTT",data:i,processData:true,onsuccess:function(e){return function(t){if(t.status==="failure"&&t.message){BX.UI.Notification.Center.notify({content:t.message});return}if(t.status!="success")return;var s=BX.parseJSON(t.tasksRenderJSON);quickInfoData[e].menuItems=s.menuItems;quickInfoData[e].realStatus=s.realStatus;tasksMenuPopup[e]=s.menuItems;if(typeof ganttChart!="undefined"){ganttChart.getTaskById(e).setMenuItems(__FilterMenuByStatus(quickInfoData[e]));var a=ganttChart.getTaskById(e);if(a){ganttChart.updateTask(a.id,s)}}if(BX.TasksTimerManager)BX.TasksTimerManager.reLoadInitTimerDataFromServer();if(window.BX.TasksIFrameInst)window.BX.TasksIFrameInst.onTaskChanged(s,null,null,null,s.html)}}(e)});__InvalidateMenus([e,"c"+e])}function ShowMenuPopup(e,t){if(tasksMenuPopup[e])BX.PopupMenu.show(e,t,__FilterMenuByStatus(quickInfoData[e]),{events:{onPopupClose:__onMenuPopupClose}});BX.addClass(t,"task-menu-button-selected");return false}function __onMenuPopupClose(){BX.removeClass(this.bindElement,"task-menu-button-selected")}function ShowMenuPopupContext(e,t){var s=t.target||t.srcElement;if(s&&s.tagName.toUpperCase()=="A")return true;if(tasksMenuPopup[e]){BX.PopupMenu.show("c"+e,t,__FilterMenuByStatus(quickInfoData[e]),{});BX.PopupMenu.getCurrentMenu().popupWindow.setBindElement(t);BX.PopupMenu.getCurrentMenu().popupWindow.adjustPosition()}BX.PreventDefault(t)}function __InvalidateMenus(e){for(var t=0,s=e.length;t<s;t++){BX.PopupMenu.destroy(e[t])}}function __FilterMenuByStatus(e){var t=[];for(var s=0,a=e.menuItems.length;s<a;s++){if(typeof e.menuItems[s].status=="undefined"||BX.util.in_array(e.realStatus,e.menuItems[s].status)){t.push(e.menuItems[s])}}return t}var titleBuffer="";function ShowTaskQuickInfo(e,t){if(quickInfoData[e]){titleBuffer=BX("task-"+e).title;BX("task-"+e).title="";BX.fixEventPageXY(t);var s={left:t.pageX,top:t.pageY,bottom:t.pageY};BX.TaskQuickInfo.show(s,quickInfoData[e],{offsetTop:10,dateFormat:"DD.MM.YYYY",onDetailClick:TaskQuickInfoDetail,userProfileUrl:"/company/personal/user/#user_id#/"})}}function HideTaskQuickInfo(e,t){BX("task-"+e).title=titleBuffer;BX.TaskQuickInfo.hide()}function TaskQuickInfoDetail(e,t,s){t.close()}function ShowTemplatesPopup(e){var t=BX("task-popup-templates-popup-content",true);BX.PopupWindowManager.create("task-templates-popup",e,{autoHide:true,offsetTop:1,events:{onPopupClose:__onTemplatesPopupClose},content:t}).show();BX.addClass(e,"webform-button-active");return false}function __onTemplatesPopupClose(){BX.removeClass(this.bindElement,"webform-button-active")}function SwitchTaskFilter(e){if(BX.hasClass(e,"task-filter-mode-selected"))return false;BX.toggleClass(e.parentNode.parentNode.parentNode,"task-filter-advanced-mode");var t=e.parentNode.getElementsByTagName("a");for(var s=0;s<t.length;s++)BX.toggleClass(t[s],"task-filter-mode-selected");return false}function Add2Timeman(e,t){var s=false;var a=BX.findChild(e.popupWindow.contentContainer,{tagName:"a",className:"menu-popup-item-add-to-tm"},true);BX.remove(BX.findPreviousSibling(a));BX.remove(a);e.popupWindow.close();if(BX.addTaskToPlanner)BX.addTaskToPlanner(t);else if(window.top.BX.addTaskToPlanner)window.top.BX.addTaskToPlanner(t)}function ShowQuickTask(e,t){if(t){if(t.parent){var s=BX("task-"+t.parent);if(s)e=BX.findParent(s,{tag:"table"})}else if(t.group){var a=BX("task-project-"+t.group.id);if(a)e=BX.findParent(a,{tag:"table"})}}if(!e)e=BX.findParent(BX("task-new-item-row",true),{tag:"table"});if(BX("task-detail-subtasks-block")&&BX("task-detail-subtasks-block").style.display=="none")BX("task-detail-subtasks-block").style.display="";var i=e.tBodies[0];if(!t){t={}}if(typeof newTaskGroup==="undefined"){newTaskDepth=newTaskParent=newTaskGroup=0;newTaskGroupObj=null}var n=i.rows[0];if(t.group||t.parent){if(t.group){var o=function(e,t,s){if(typeof window["groupsPopup"]==="undefined"){if(t>0){window.setTimeout(function(){o(e,t-e,s)},e)}}else{groupsPopup.select(s)}};o(100,15e3,t.group);if(t.group.id>0){newTaskGroup=t.group.id;if(BX("task-project-"+newTaskGroup)){n=BX.findNextSibling(BX("task-project-"+newTaskGroup),{tag:"tr"})}}}if(t.parent){newTaskParent=parseInt(t.parent)>0?parseInt(t.parent):0;if(BX("task-"+newTaskParent,true)){newTaskDepth=Depth(BX("task-"+newTaskParent,true))+1;n=BX.findNextSibling(BX("task-"+newTaskParent,true),{tag:"tr"})}}}if(!t.parent){newTaskDepth=0;newTaskParent=0}if(n!=BX("task-new-item-row",true)){if(n){i.insertBefore(BX("task-new-item-row",true),n)}else{i.appendChild(BX("task-new-item-row",true))}}BX.removeClass(BX("task-new-item-row",true),"task-list-item-hidden");BX("task-new-item-name").focus();var r=0;if(t.group&&t.group.id)r=t.group.id;var u=BX.message("USER_ID");if(t.user&&t.user.id)u=t.user.id;if(BX("task-new-item-responsible")){if(!window.groupsPopup){BX("task-new-item-responsible").disabled=true;BX("task-new-item-link-group").style.display="none";BX.Tasks.lwPopup.__initSelectors([{requestedObject:"intranet.user.selector.new",selectedUsersIds:u,anchorId:"task-new-item-responsible",bindClickTo:"task-new-item-responsible",userInputId:"task-new-item-responsible",multiple:"N",GROUP_ID_FOR_SITE:r,callbackOnSelect:function(e){BX("task-new-item-responsible-hidden").value=e.id},onLoadedViaAjax:function(){BX("task-new-item-responsible").disabled=false}},{requestedObject:"socialnetwork.group.selector",bindElement:"task-new-item-link-group",callbackOnSelect:function(e,t){onGroupSelect(e)},onLoadedViaAjax:function(e){var t=function(s,a){if(typeof window[e]==="undefined"){if(a>0)window.setTimeout(function(){t(s,a-s)},s)}else{window.groupsPopup=window[e];BX("task-new-item-link-group").style.display=""}};t(100,15e3)}}])}}}function ToggleSubtasks(e,t,s){if(!tasksListNS||!tasksListNS.isReady){window.setTimeout(function(e,t,s){return function(){ToggleSubtasks(e,t,s)}}(e,t,s),500);return}if(loadedTasks[s]){var a=BX.findNextSibling(e,{tagName:"tr"});while(a&&Depth(a)>t){if(BX.hasClass(e,"task-list-item-opened")){BX.addClass(a,"task-list-item-hidden");BX.removeClass(a,"task-list-item-opened")}else if(BX.hasClass(a,"task-depth-"+(t+1))){BX.removeClass(a,"task-list-item-hidden")}a=BX.findNextSibling(a,{tagName:"tr"})}BX.toggleClass(e,"task-list-item-opened")}else{var i={sessid:BX.message("bitrix_sessid"),id:s,depth:t,filter:tasksListNS.arFilter,order:arOrder,columnsOrder:tasksListNS.getColumnsOrder(),path_to_user:BX.message("TASKS_PATH_TO_USER_PROFILE"),path_to_task:BX.message("TASKS_PATH_TO_TASK"),mode:"load"};loadedTasks[s]=true;BX.ajax({method:"POST",dataType:"html",url:tasksListAjaxUrl,data:i,processData:false,onsuccess:function(){var a=function(a){var i=document.createElement("div");i.innerHTML="<table>"+a+"</table>";var n=i.firstChild.getElementsByTagName("TR");var o=i.firstChild.getElementsByTagName("SCRIPT");for(var r=n.length-1;r>=0;r--){if(!BX(n[r].id)){e.parentNode.insertBefore(n[r],e.nextSibling);if(!BX.browser.IsIE()||!!document.documentMode&&document.documentMode>=10){var u=BX.create("script",{props:{type:"text/javascript"},html:o[r].innerHTML})}else{var u=o[r]}e.parentNode.insertBefore(u,e.nextSibling)}}ToggleSubtasks(e,t,s)};return a}()})}}function Depth(e){var t=/task-depth-([0-9]+)/;var s=t.exec(e.className);if(s){return parseInt(s[1])}else{return 0}}function ShowGradePopup(e,t,s){BX.TaskGradePopup.show(e,t,s,{events:{onPopupClose:__onGradePopupClose,onPopupChange:__onGradePopupChange}});BX.addClass(t,"task-grade-and-report-selected");return false}function __onGradePopupClose(){BX.removeClass(this.bindElement,"task-grade-and-report-selected")}function __onGradePopupChange(){this.bindElement.className="task-grade-and-report"+(this.listValue!="NULL"?" task-grade-"+this.listItem.className:"")+(this.report?" task-in-report":"");this.bindElement.title=BX.message("TASKS_MARK")+": "+this.listItem.name;var e={mode:"mark",sessid:BX.message("bitrix_sessid"),id:this.id,mark:this.listValue,report:this.report};BX.ajax.post(tasksListAjaxUrl,e)}function ShowPriorityPopup(e,t,s){BX.TaskPriorityPopup.show(e,t,s,{events:{onPopupClose:__onPriorityPopupClose,onPopupChange:__onPriorityChange}});BX.addClass(t,"task-priority-box-selected");return false}function __onPriorityPopupClose(){BX.removeClass(this.bindElement,"task-priority-box-selected")}function __onPriorityChange(){BX.removeClass(this.bindElement,"task-priority-box-selected");this.bindElement.title=BX.message("TASKS_PRIORITY_V2")+": "+this.listItem.name;this.bindElement.childNodes[0].className="task-priority-icon task-priority-"+this.listValue;var e={mode:"priority",sessid:BX.message("bitrix_sessid"),id:this.id,path_to_user:BX.message("TASKS_PATH_TO_USER_PROFILE"),path_to_task:BX.message("TASKS_PATH_TO_TASK"),priority:this.listValue};BX.ajax.post(tasksListAjaxUrl,e)}function tasksFormatDate(e){return BX.date.format(BX.date.convertBitrixFormat(BX.message("FORMAT_DATETIME")),e)}function onDetails(e){ShowPopupTask(this.id,e.event)}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/tasks.list/templates/.default/table-view.min.js?169925808333530";s:6:"source";s:69:"/bitrix/components/bitrix/tasks.list/templates/.default/table-view.js";s:3:"min";s:73:"/bitrix/components/bitrix/tasks.list/templates/.default/table-view.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/tasks.list/templates/.default/table-view.map.js";}"*/
var tasksListTemplateDefaultTableViewInit=function(){if(BX("task-new-item-responsible")){BX.bind(BX("task-new-item-link-group"),"click",function(e){if(!e)e=window.event;groupsPopup.show();BX.PreventDefault(e)})}};var tasksListNS={isReady:false,table:null,columnsContextId:null,registeredTimerNodes:{},columnsMetaData:[],initialColumnsMetaDataHash:null,groupActionCheckboxes:null,lastCheckboxIndex:null,objResizer:null,arFilter:null,groupActionCheckboxesName:null,groupActionSelectAll:null,userSelector:null,groupSelector:null,curUserName:"...",menu:null,approveTask:function(e){var t=BX("task-"+e);if(t){SetCSSStatus(t,"completed","task-status-");var s=t.getElementsByTagName("TD");var a=BX.findChild(s[0],{tagName:"a"},true);BX.style(a,"text-decoration","line-through");s[2].innerHTML="&nbsp;";var i=BX.findChild(t,{tagName:"a",className:"task-complete-action"},true);if(i){i.onclick=null;i.title=BX.message("TASKS_FINISHED")}}SetServerStatus(e,"approve")},disapproveTask:function(e){var t=BX("task-"+e);if(t){SetCSSStatus(t,"accepted","task-status-");var s=t.getElementsByTagName("TD");s[2].innerHTML="&nbsp;"}SetServerStatus(e,"disapprove")},renderTimerItem:function(e,t,s,a,i,n){var r="task-timer-inner";var o=t+i;var n=n||false;if(a)r=r+" task-timer-play";else if(n)r=r+" task-timer-pause";else r=r+" task-timer-clock";if(s>0&&o>s)r=r+" task-timer-overdue";return BX.create("span",{props:{id:"task-timer-block-"+e,className:"task-timer-block"},events:{click:function(e,t){return function(){if(BX.hasClass(BX("task-timer-block-inner-"+e),"task-timer-play"))BX.TasksTimerManager.stop(e);else if(t)BX.TasksTimerManager.start(e)}}(e,n)},children:[BX.create("span",{props:{id:"task-timer-block-inner-"+e,className:r},children:[BX.create("span",{props:{className:"task-timer-icon"}}),BX.create("span",{props:{id:"task-timer-block-value-"+e,className:"task-timer-time"},text:tasksListNS.renderTimerTimes(o,s,a)})]})]})},renderTimerTimes:function(e,t,s){var a="";var i=false;if(s)i=true;a=tasksListNS.renderSecondsToHHMMSS(e,i);if(t>0)a=a+" / "+tasksListNS.renderSecondsToHHMMSS(t,false);return a},renderSecondsToHHMMSS:function(e,t){var s="00";var a=""+Math.floor(e/3600);var i=""+Math.floor(e/60)%60;var n=0;var r="";r=s.substring(0,2-a.length)+a+":"+s.substring(0,2-i.length)+i;if(t){n=""+e%60;r=r+":"+s.substring(0,2-n.length)+n}return r},redrawTimerNode:function(e,t,s,a,i,n){var r=BX("task-timer-block-"+e);var o=tasksListNS.renderTimerItem(e,t,s,a,i,n);if(r){r.parentNode.replaceChild(o,r)}else{var l=BX("task-"+e);if(l){var d=BX.findChild(l,{tagName:"a",className:"task-title-link"},true);if(d){if(this.registeredTimerNodes[e])BX.removeCustomEvent(window,"onTaskTimerChange",this.registeredTimerNodes[e]);d.parentNode.insertBefore(o,null);if(BX("task-timer-block-"+e)){this.registeredTimerNodes[e]=this.__getTimerChangeCallback(e);BX.addCustomEvent(window,"onTaskTimerChange",this.registeredTimerNodes[e])}}}}},removeTimerNode:function(e){var t=BX("task-timer-block-"+e);if(this.registeredTimerNodes[e])BX.removeCustomEvent(window,"onTaskTimerChange",this.registeredTimerNodes[e]);if(t)t.parentNode.removeChild(t)},__getTimerChangeCallback:function(e){var t=null;return function(s){var a=null;var i=null;if(s.action==="refresh_daemon_event"){if(s.taskId!==e){if(t==="paused")return;else a="paused"}else{if(t!=="playing")a="playing";tasksListNS.redrawTimerNode(s.taskId,s.data.TASK.TIME_SPENT_IN_LOGS,s.data.TASK.TIME_ESTIMATE,true,s.data.TIMER.RUN_TIME,true)}}else if(s.action==="start_timer"){if(e==s.taskId&&s.timerData&&e==s.timerData.TASK_ID){a="playing"}else a="paused"}else if(s.action==="stop_timer"){if(e==s.taskId)a="paused"}else if(s.action==="init_timer_data"){if(s.data.TIMER){if(s.data.TIMER.TASK_ID==e){if(s.data.TIMER.TIMER_STARTED_AT>0)a="playing";else a="paused"}else if(s.data.TIMER.TASK_ID>0){a="paused"}}}if(a!==null){i=BX("task-timer-block-inner-"+e);if(i&&!BX.hasClass(i,"task-timer-clock")){if(a==="paused"){BX.removeClass(i,"task-timer-play");BX.addClass(i,"task-timer-pause")}else if(a==="playing"){BX.removeClass(i,"task-timer-pause");BX.addClass(i,"task-timer-play")}}t=a}}},onDeadlineChangeClick:function(e,t,s){BX.calendar({node:t,value:s,form:"",bTime:true,currentTime:Math.round(new Date/1e3)-(new Date).getTimezoneOffset()*60,bHideTimebar:false,callback_after:function(e,t){return function(s,a){var i=true;if(typeof a!=="undefined")i=a;BX.CJSTask.batchOperations([{operation:"CTaskItem::update()",taskData:{ID:t,DEADLINE:BX.calendar.ValueToString(s,i)}}],{callbackOnSuccess:function(e,t,s){return function(a){if(e.parentNode.parentNode.tagName==="TD")e.parentNode.parentNode.innerHTML=tasksListNS.renderDeadline(t,s,true);else e.parentNode.innerHTML=tasksListNS.renderDeadline(t,s,true)}}(e,t,s)})}}(t,e)})},renderDeadline:function(e,t,s){if(t){var t=BX.calendar.ValueToString(t,true);if(BX.isAmPmMode()){deadline=t.substr(11,11)=="12:00:00 am"?t.substr(0,10):t.substr(0,22)}else{deadline=t.substr(11,8)=="00:00:00"?t.substr(0,10):t.substr(0,19)}deadline=deadline.split(" ");if(deadline.length>1){var a=deadline[0];delete deadline[0];var i=deadline.join(" ");n='<span class="task-deadline-datetime"><span class="task-deadline-date webform-field-action-link" onclick="tasksListNS.onDeadlineChangeClick('+e+", this, '"+t+"');\">"+a+'</span></span> <span class="task-deadline-time webform-field-action-link" onclick="tasksListNS.onDeadlineChangeClick('+e+", this, '"+t+"');\">"+i+"</span>"}else{if(s)n='<span class="task-deadline-date webform-field-action-link" onclick="tasksListNS.onDeadlineChangeClick('+e+", this, '"+t+"');\">"+deadline[0]+"</span>";else n='<span class="task-deadline-date">'+deadline[0]+"</span>"}}else{var n="&nbsp;"}return n},onColumnResize:function(e,t,s){var a={sessid:BX.message("bitrix_sessid"),mode:"resizeColumn",columnId:e,columnWidth:t,columnContextId:s};BX.ajax({method:"POST",dataType:"json",url:tasksListAjaxUrl,data:a,async:true,processData:false,onsuccess:function(){}})},onColumnMoved:function(e,t){var s,a,i,n,r,o,l,d,c,u;if(t==e)return;d=BX.findChild(this.table.rows[0].cells[t],{tagName:"input"},true,false);l=parseInt(d.value);if(t==1){c=0}else{u=BX.findChild(this.table.rows[0].cells[t-1],{tagName:"input"},true,false);c=parseInt(u.value)}a=Math.min(e,t);i=Math.max(e,t);n=this.table.rows[0];if(t>e){r=BX.findChild(n.cells[i],{tagName:"DIV"},false,false);for(s=a;s<i;++s){o=BX.findChild(n.cells[s],{tagName:"DIV"},false,false);r.style.width=n.cells[s].offsetWidth+"px";n.cells[s].insertBefore(r,o);r=o}r.style.width=n.cells[i].offsetWidth+"px";n.cells[i].appendChild(r)}else{r=BX.findChild(n.cells[a],{tagName:"DIV"},false,false);for(s=i;s>a;--s){o=BX.findChild(n.cells[s],{tagName:"DIV"},false,false);r.style.width=n.cells[s].offsetWidth+"px";n.cells[s].insertBefore(r,o);r=o}r.style.width=n.cells[a].offsetWidth+"px";n.cells[a].appendChild(r)}i=this.table.rows.length-1;for(s=0;s<=i;++s){n=this.table.rows[s];if(n.cells.length==1)continue;if(t<e)n.insertBefore(n.cells[e],n.cells[t]);else n.insertBefore(n.cells[e],n.cells[t+1])}var p={sessid:BX.message("bitrix_sessid"),mode:"moveColumnAfter",movedColumnId:l,movedAfterColumnId:c,columnContextId:this.columnsContextId};BX.ajax({method:"POST",dataType:"json",url:tasksListAjaxUrl,data:p,async:false,processData:false,onsuccess:function(e){return function(){window.setTimeout(function(){e.objResizer.reinit()},100)}}(this)})},onColumnAddRemove:function(e){var t;var s;if(this.initialColumnsMetaDataHash===JSON.stringify(this.columnsMetaData))return;s=[];for(t=0;t<this.columnsMetaData.length;++t){if(this.columnsMetaData[t].isSelected)s.push(this.columnsMetaData[t].id)}if(s.length==0)s.push(2);var a={sessid:BX.message("bitrix_sessid"),mode:"addRemoveColumns",selectedColumns:s,columnContextId:e};BX.ajax({method:"POST",dataType:"json",url:tasksListAjaxUrl,data:a,async:true,processData:false,onsuccess:function(){location.reload(false)}})},onResetToDefaultColumns:function(e){var t={sessid:BX.message("bitrix_sessid"),mode:"resetColumnsToDefault",columnContextId:e};BX.ajax({method:"POST",dataType:"json",url:tasksListAjaxUrl,data:t,async:true,processData:false,onsuccess:function(){location.reload(false)}})},isAnyCheckboxChecked:function(){var e,t;var s=false;if(this.groupActionSelectAll.checked)s=true;else{t=this.groupActionCheckboxes.length;for(e=0;e<t;++e){if(this.groupActionCheckboxes[e].checked){s=true;break}}}return s},onCheckboxChanged:function(e,t){if(!t)this.refreshCheckboxes();this.lastCheckboxIndex=null;if(this.isAnyCheckboxChecked()){BX.removeClass(BX("task-list-group-action-submit"),"task-noclass-disabled");BX.addClass(BX("task-table-footer"),"task-footer-btn-active")}else{BX.addClass(BX("task-list-group-action-submit"),"task-noclass-disabled");BX.removeClass(BX("task-table-footer"),"task-footer-btn-active")}},onCheckboxClick:function(e,t){var s,a,i=null,n;this.refreshCheckboxes();n=t.checked;a=this.groupActionCheckboxes.length;for(s=0;s<a;++s){if(this.groupActionCheckboxes[s].id==t.id){i=s;break}}if(e.shiftKey&&i&&this.lastCheckboxIndex!==null){a=Math.max(this.lastCheckboxIndex,i);s=Math.min(this.lastCheckboxIndex,i);for(;s<=a;++s){this.groupActionCheckboxes[s].checked=n}}this.onCheckboxChanged(t,true);this.lastCheckboxIndex=i},getColumnsOrder:function(){var e,t,s,a=[];if(!this.table)return[2,5,4,3];t=this.table.rows[0].cells.length-2;for(e=1;e<=t;++e){s=BX.findChild(this.table.rows[0].cells[e],{tagName:"input"},true,false);if(BX.type.isDomNode(s))a.push(parseInt(s.value))}return a},getColumnIndex:function(e){var t,s,a,i;i=this.getColumnsOrder();switch(e){case"title":a=2;break;default:a=0;break}if(a==0)return false;s=i.length;for(t=0;t<s;++t){if(i[t]==a)return t}return false},onPopupTaskChanged:function(e,t,s,a,i){var n,r,o;var l=null,d,c=null;var u=0;var p;var f;tasksMenuPopup[e.id]=e.menuItems;quickInfoData[e.id]=e;if(typeof i==="undefined"||!i){return}n=BX("task-"+e.id);if(!n)return;p=Depth(n);if(p>0&&(d=BX.findPreviousSibling(n,{className:"task-depth-"+(p-1)}))){l=d.id.replace("task-","")}o=n;if(BX("task-current-project")&&BX("task-current-project").value>0)c=BX("task-current-project").value;else{do{if(o.id.substr(0,13)=="task-project-"){c=o.id.replace("task-project-","")}o=BX.findPreviousSibling(o,{tagName:"tr"})}while(o&&!c)}if(i){tempDiv=document.createElement("div");tempDiv.innerHTML="<table>"+i+"</table>";r=tempDiv.firstChild.rows[0];scriptRaw=tempDiv.firstChild.getElementsByTagName("SCRIPT")[0];BX.removeClass(r,"task-depth-0");BX.addClass(r,"task-depth-"+p);if(BX.hasClass(n,"task-list-item-opened"))BX.addClass(r,"task-list-item-opened");n.parentNode.replaceChild(r,n);if(!BX.browser.IsIE()||!!document.documentMode&&document.documentMode>=10){script=BX.create("script",{props:{type:"text/javascript"},html:scriptRaw.innerHTML})}else{script=scriptRaw}this.table.appendChild(script);if(l!=e.parentTaskId){if(d){f=BX("task-children-count-"+l);f.innerHTML=parseInt(f.innerHTML)-1;if(parseInt(f.innerHTML)==0){BX.remove(f.parentNode);BX.removeClass(d,"task-list-item-opened")}}if(e.parentTaskId&&BX("task-"+e.parentTaskId))u=Depth(BX("task-"+e.parentTaskId))+1;else u=0;if(u!=p){BX.removeClass(r,"task-depth-"+p);BX.addClass(r,"task-depth-"+u)}}else u=p;if(l!=e.parentTaskId&&BX("task-"+e.parentTaskId)||u==0&&c!=e.projectId){beforeRow=__FindBeforeRow(this.table,e.parentTaskId,{id:e.projectId,title:e.projectName});if(beforeRow&&beforeRow!=r){beforeRow.parentNode.insertBefore(r,beforeRow)}else if(!beforeRow){this.table.appendChild(r)}}}},onPopupTaskAdded:function(e,t,s,a,i){var n,r,o,l;if(typeof detailTaksID=="undefined"||detailTaksID==e.parentTaskId){if(typeof i!="undefined"){tasksMenuPopup[e.id]=e.menuItems;quickInfoData[e.id]=e;BX.onCustomEvent("onTaskListTaskAdd",[e]);r=document.createElement("div");r.innerHTML="<table>"+i+"</table>";n=r.firstChild.rows[0];o=r.firstChild.getElementsByTagName("SCRIPT")[0];if(!BX(n.id)){beforeRow=__FindBeforeRow(this.table,e.parentTaskId,{id:e.projectId,title:e.projectName});if(beforeRow){beforeRow.parentNode.insertBefore(n,beforeRow)}else{this.table.appendChild(n)}if(!BX.browser.IsIE()||!!document.documentMode&&document.documentMode>=10){l=BX.create("script",{props:{type:"text/javascript"},html:o.innerHTML})}else{l=o}if(beforeRow){beforeRow.parentNode.insertBefore(l,beforeRow)}else{this.table.appendChild(l)}}if(typeof s=="object"&&s!==null){if(typeof s.callbackOnAfterAdd=="function")s.callbackOnAfterAdd()}}}if(BX("task-list-no-tasks"))BX("task-list-no-tasks").style.display="none"},refreshCheckboxes:function(){var e,t=[];e=BX.findChild(this.table,{tagName:"input"},true,true);for(i in e){if(!e.hasOwnProperty(i))continue;if(e[i].name===this.groupActionCheckboxesName)t.push(e[i])}this.groupActionCheckboxes=t},onActionSelect:function(e){var t,s;t=e.options[e.selectedIndex].value;BX("task-list-group-action-days_count-selector").disabled=true;BX("task-list-group-action-days_count-selector").style.display="none";BX("task-list-group-action-days_type-selector").disabled=true;BX("task-list-group-action-days_type-selector").style.display="none";BX("task-list-group-action-user-selector").disabled=true;BX("task-list-group-action-user-selector").style.display="none";BX("task-list-group-action-date-selector").disabled=true;BX("task-list-group-action-date-selector").parentNode.style.display="none";BX.removeClass(BX("task-list-group-action-date-selector").parentNode,"task-table-footer-inp-del");BX("task-list-group-action-group-selector").disabled=true;BX("task-list-group-action-group-selector").parentNode.style.display="none";BX.removeClass(BX("task-list-group-action-group-selector").parentNode,"task-table-footer-inp-del");BX("task-list-group-action-value").value="";if(t==="change_responsible"||t==="change_originator"||t==="add_auditor"||t==="add_accomplice"){if(this.userSelector===null){BX("task-list-group-action-user-selector").value=this.curUserName;BX("task-list-group-action-value").value=BX.message("USER_ID");BX.addClass(BX("task-list-group-action-submit"),"task-noclass-disabled");s=BX.Tasks.lwPopup.__initSelectors([{requestedObject:"intranet.user.selector.new",selectedUsersIds:BX.message("USER_ID"),anchorId:"task-list-group-action-user-selector",bindClickTo:"task-list-group-action-user-selector",userInputId:"task-list-group-action-user-selector",multiple:"N",GROUP_ID_FOR_SITE:0,callbackOnSelect:function(e){BX("task-list-group-action-value").value=e.id},onLoadedViaAjax:function(e){return function(){BX("task-list-group-action-user-selector").disabled=false;BX("task-list-group-action-user-selector").style.display="";e.refreshCheckboxes();if(e.isAnyCheckboxChecked())BX.removeClass(BX("task-list-group-action-submit"),"task-noclass-disabled")}}(this)}]);this.userSelector=s[0]}else{BX("task-list-group-action-user-selector").disabled=false;BX("task-list-group-action-user-selector").style.display=""}}else if(t==="adjust_deadline"||t==="substract_deadline"){if(BX("task-list-group-action-days_count-selector").value==""||BX("task-list-group-action-days_count-selector").value==0){BX.addClass(BX("task-list-group-action-submit"),"task-noclass-disabled")}else{self.refreshCheckboxes();if(this.isAnyCheckboxChecked())BX.removeClass(BX("task-list-group-action-submit"),"task-noclass-disabled")}BX("task-list-group-action-days_count-selector").disabled=false;BX("task-list-group-action-days_count-selector").style.display="";BX("task-list-group-action-days_type-selector").disabled=false;BX("task-list-group-action-days_type-selector").style.display=""}else if(t==="set_deadline"){BX("task-list-group-action-value").value="";BX("task-list-group-action-date-selector").value="";BX("task-list-group-action-date-selector").disabled=false;BX("task-list-group-action-date-selector").parentNode.style.display="";BX.bind(BX("task-list-group-action-date-delete"),"click",function(){BX("task-list-group-action-value").value="";BX("task-list-group-action-date-selector").value="";BX.removeClass(BX("task-list-group-action-date-selector").parentNode,"task-table-footer-inp-del")})}else if(t==="set_group"){BX("task-list-group-action-value").value="";if(this.groupSelector===null){BX("task-list-group-action-group-selector").disabled=true;BX("task-list-group-action-group-selector").parentNode.style.display="";BX("task-list-group-action-group-selector").value=BX.message("TASKS_LIST_GROUP_ACTION_PLEASE_WAIT");BX.addClass(BX("task-list-group-action-submit"),"task-noclass-disabled");BX.Tasks.lwPopup.__initSelectors([{requestedObject:"socialnetwork.group.selector",bindElement:"task-list-group-action-group-selector",callbackOnSelect:function(e,t){if(e&&e[0]){BX("task-list-group-action-value").value=e[0]["id"];BX("task-list-group-action-group-selector").value=e[0]["title"];BX.addClass(BX("task-list-group-action-group-selector").parentNode,"task-table-footer-inp-del")}else{BX("task-list-group-action-value").value=0;BX("task-list-group-action-group-selector").value="";BX.addClass(BX("task-list-group-action-group-selector").parentNode,"task-table-footer-inp-del")}},onLoadedViaAjax:function(e){return function(t){var s=function(a,i){if(typeof window[t]==="undefined"){if(i>0)window.setTimeout(function(){s(a,i-a)},a)}else{e.groupSelector=window[t];BX("task-list-group-action-group-selector").disabled=false;BX("task-list-group-action-group-selector").value="";e.refreshCheckboxes();if(e.isAnyCheckboxChecked())BX.removeClass(BX("task-list-group-action-submit"),"task-noclass-disabled");BX.bind(BX("task-list-group-action-group-selector"),"click",function(){e.groupSelector.show()});BX.bind(BX("task-list-group-action-group-delete"),"click",function(){BX("task-list-group-action-value").value=0;BX("task-list-group-action-group-selector").value="";BX.removeClass(BX("task-list-group-action-group-selector").parentNode,"task-table-footer-inp-del")})}};s(100,15e3)}}(this)}])}else{BX("task-list-group-action-group-selector").disabled=false;BX("task-list-group-action-group-selector").value="";BX("task-list-group-action-group-selector").parentNode.style.display=""}}},onGroupActionDaysChanged:function(){var e,t,s,a,i;s=BX("task-list-group-action-days_count-selector").value;e=BX("task-list-group-action-days_type-selector");if(s==0||s=="")BX.addClass(BX("task-list-group-action-submit"),"task-noclass-disabled");else BX.removeClass(BX("task-list-group-action-submit"),"task-noclass-disabled");for(t=0;t<e.options.length;++t){e.options[t].innerHTML=BX.Loc.getMessagePlural("TASKS_LIST_GROUP_ACTION_"+e.options[t].value.toUpperCase(),s)}i=e.options[e.selectedIndex].value;if(i==="days")a=s*3600*24;else if(i==="weeks")a=s*3600*24*7;else if(i==="monthes")a=s*3600*24*30;else a=s;BX("task-list-group-action-value").value=a},submitGroupAction:function(e,t,s,a){var i,n,r,o,l={},d,c;if(!this.groupActionCheckboxes){return}if(this.groupActionSelectAll.checked)n="all";else{n="0";o=this.groupActionCheckboxes.length;for(r=0;r<o;++r){if(this.groupActionCheckboxes[r].checked)n+=","+this.groupActionCheckboxes[r].value}if(n==="0")return}if(this.arFilter.hasOwnProperty("ONLY_ROOT_TASKS")){d=JSON.parse(JSON.stringify(this.arFilter));for(r in d){if(!d.hasOwnProperty(r))continue;if(r==="SAME_GROUP_PARENT"||r==="ONLY_ROOT_TASKS")continue;l[r]=d[r]}}else l=this.arFilter;if(t==="change_responsible"||t==="change_originator"||t==="add_auditor"||t==="add_accomplice"||t==="adjust_deadline"||t==="substract_deadline"||t==="set_deadline"||t==="set_group"){c=BX("task-list-group-action-value").value}else c=0;var u={method:"POST"};if(typeof a!="undefined")u.action=a;i=BX.create("form",{props:u,style:{display:"none"},children:[BX.create("input",{props:{name:"sessid",type:"hidden",value:BX.message("bitrix_sessid")}}),BX.create("input",{props:{name:"module",type:"hidden",value:"tasks"}}),BX.create("input",{props:{name:"arFilter",type:"hidden",value:JSON.stringify(l)}}),BX.create("input",{props:{name:"action",type:"hidden",value:"group_action"}}),BX.create("input",{props:{name:"subaction",type:"hidden",value:t}}),BX.create("input",{props:{name:"elements_ids",type:"hidden",value:n}}),BX.create("input",{props:{name:"value",type:"hidden",value:c}})]});if(typeof s!="undefined"){for(var p in s){BX.append(BX.create("input",{props:{name:p,type:"hidden",value:s[p]}}),i)}}document.body.appendChild(i);BX.submit(i)},onReady:function(e,t,s,a,i,n,r,o,l,d,c,u){var p,f,k;var m;var h;var g;var B=[];this.table=e;this.columnsContextId=r;this.arFilter=c;this.groupActionCheckboxesName=t;this.groupActionSelectAll=a;this.curUserName=u;m=l.length;h=d.length;for(p=0;p<m;++p){g=false;for(f=0;f<h;++f){if(d[f]==l[p]){g=true;break}}k={id:l[p],title:BX.message("TASKS_LIST_COLUMN_"+l[p]),isSelected:g};this.columnsMetaData.push(k);B.push({id:k.id,text:k.title,className:k.isSelected?"menu-popup-item-accept":"menu-popup-item-task-noclass",onclick:function(e,t,s){return function(){t.isSelected=!t.isSelected;if(t.isSelected)BX.addClass(e.menu.getMenuItem(s).layout.item,"menu-popup-item-accept");else BX.removeClass(e.menu.getMenuItem(s).layout.item,"menu-popup-item-accept")}}(this,k,k.id)})}this.initialColumnsMetaDataHash=JSON.stringify(this.columnsMetaData);if(typeof tasks_TableColumnResize!="undefined"){this.objResizer=new tasks_TableColumnResize(e,i,{lastColumnAsElastic:true,elasticColumnMinWidth:n,callbackOnStopResize:function(t){return function(s){var a=0;var i=null;if(e.rows[0].cells[s.columnIndex]){i=BX.findChild(e.rows[0].cells[s.columnIndex],{tagName:"input"},true,false);if(i)a=parseInt(i.value)}tasksListNS.onColumnResize(a,s.columnWidth,t)}}(r)})}if(typeof tasks_TableColumnMove!="undefined"){new tasks_TableColumnMove(e,false,function(e){return function(t,s){e.onColumnMoved(t,s)}}(this),"task-head-cell-wrap","task-list-th-draggable")}B.push({delimiter:true});B.push({text:BX.message("TASKS_LIST_MENU_RESET_TO_DEFAULT_PRESET"),onclick:function(e){return function(){tasksListNS.onResetToDefaultColumns(e)}}(r)});this.menu=BX.PopupMenu.create("task-list-controls-menu",o,B,{closeByEsc:false,zIndex:1010,autoHide:true,bindOptions:{position:"bottom"},events:{onPopupClose:function(e){return function(){tasksListNS.onColumnAddRemove(e)}}(r)}});BX.bind(o,"click",function(e){return function(){e.menu.popupWindow.show()}}(this));BX.bind(s,"click",function(e){return function(){var t,s;e.refreshCheckboxes();s=e.groupActionCheckboxes.length;if(this.checked){for(t=0;t<s;++t){if(e.groupActionCheckboxes[t].offsetWidth>0)e.groupActionCheckboxes[t].checked=true;else e.groupActionCheckboxes[t].checked=false}}else{for(t=0;t<s;++t){e.groupActionCheckboxes[t].checked=false}}e.onCheckboxChanged()}}(this));BX.bind(a,"click",function(e){return function(){if(a.checked&&!confirm(BX.message("TASKS_LIST_CONFIRM_ACTION_FOR_ALL_ITEMS")))a.checked=false;e.onCheckboxChanged()}}(this));this.isReady=true}};function __CreateProjectRow(e){var t=BX.message("TASKS_PATH_TO_TASK").replace("#action#","edit").replace("#task_id#",0);var s=BX.message("PATH_TO_GROUP_TASKS").replace("#group_id#",e.id);var a=9;if(typeof tasksListNS!=="undefined"&&tasksListNS.getColumnsOrder)a=2+tasksListNS.getColumnsOrder().length;return BX.create("tr",{props:{className:"task-list-item task-list-project-item task-depth-0",id:"task-project-"+e.id},attrs:{"data-project-id":e.id},children:[BX.create("td",{props:{className:"task-project-column",colSpan:a},html:'\t\t\t\t\t<div class="task-project-column-inner">\t\t\t\t\t\t<div class="task-project-name">\t\t\t\t\t\t\t<span class="task-project-folding" onclick="ToggleProjectTasks('+e.id+', event);"></span>\t\t\t\t\t\t\t<a class="task-project-name-link" href="'+s+'" onclick="ToggleProjectTasks('+e.id+', event);">'+BX.util.htmlspecialchars(e.title)+'</a>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="task-project-actions">\t\t\t\t\t\t\t<a onclick="AddQuickPopupTask(event, {GROUP_ID: '+e.id+'});" class="task-project-action-link" href="'+t+(t.indexOf("?")==-1?"?":"&")+"GROUP_ID="+e.id+'">\t\t\t\t\t\t\t\t<i class="task-project-action-icon"></i>\t\t\t\t\t\t\t\t<span class="task-project-action-text">'+BX.message("TASKS_ADD_TASK")+"</span>\t\t\t\t\t\t\t</a>\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t"})]})}function __FindBeforeRow(e,t,s){var a=BX("task-new-item-row");var i,n;if(t>0&&(n=BX("task-"+t))){i=BX.findNextSibling(n,{tagName:"tr"});if(BX.findChild(n,{tagName:"div",className:"task-title-folding"},true)){var r=BX.findChild(n,{tagName:"span"},true);r.innerHTML=parseInt(r.innerHTML)+1}else{var o='<div class="task-title-folding" onclick="ToggleSubtasks(this.parentNode.parentNode.parentNode, '+Depth(n)+", "+t+')"><span id="task-children-count-'+t+'">1</span></div>';var l=BX.findChild(n,{tagName:"div",className:"task-title-container"},true);l.innerHTML=o+l.innerHTML;BX.addClass(n,"task-list-item-opened");loadedTasks[t]=true}}else if(s&&s.id>0){if(BX("task-project-"+s.id)){i=BX.findNextSibling(BX("task-project-"+s.id),{tagName:"tr"})}else{i=null;for(var d=0,c=e.rows.length;d<c;d++){if(e.rows[d].id.substr(0,13)=="task-project-"){i=e.rows[d];break}}var u=__CreateProjectRow(s);if(i){i.parentNode.insertBefore(u,i)}else{e.appendChild(u)}}}else{if(e.firstChild.id=="task-new-item-row"){i=a.nextSibling}else{i=e.firstChild}}return i}function AddToFavorite(e,t){var s={mode:"favorite",add:1,sessid:BX.message("bitrix_sessid"),id:e};BX.ajax({method:"POST",dataType:"html",url:tasksListAjaxUrl,data:s,processData:false,onsuccess:function(e){return function(e){}}(e)})}function DeleteFavorite(e,t){var s={mode:"favorite",sessid:BX.message("bitrix_sessid"),id:e};BX.ajax({method:"POST",dataType:"html",url:tasksListAjaxUrl,data:s,processData:false,onsuccess:function(e){if(t.rowDelete){return function(s){TASKS_table_view_onDeleteClick_onSuccess(e,s,t)}}}(e)})}function DeleteTask(e,t){var s={mode:"delete",sessid:BX.message("bitrix_sessid"),id:e};BX.ajax({method:"POST",dataType:"html",url:tasksListAjaxUrl,data:s,processData:false,onsuccess:function(e){return function(s){TASKS_table_view_onDeleteClick_onSuccess(e,s,t)}}(e)})}function TASKS_table_view_onDeleteClick_onSuccess(e,t,s){if(t&&t.length>0){BX.Tasks.alert([BX.message("TASKS_LIST_GROUP_ACTION_DELETE_ERROR")])}else{__DeleteTaskRow(e,s);BX.onCustomEvent("onTaskListTaskDelete",[e])}}function GetRowIdByDomNode(e){var t=e.id;if(typeof e.id!="undefined"){return parseInt(e.id.toString().replace("task-",""))}else return false}function GetChildrenCountByRowId(e){try{return parseInt(BX("task-children-count-"+e).innerHTML)}catch(e){return false}}function SetChildrenCount(e,t,s){var a=BX("task-children-count-"+e);if(BX.type.isDomNode(a)){if(t<=0){var i=s.querySelector(".task-title-folding");if(BX.type.isDomNode(i))BX.remove(i);BX.removeClass(s,"task-list-item-opened")}else BX("task-children-count-"+e).innerHTML=t}}function __DeleteTaskRow(e,t){var s=BX("task-"+e);var a=Depth(s);var i=0;var n=0;var r=BX.findPreviousSibling(s,{tagName:"tr"});var o=BX.findNextSibling(s,{tagName:"tr"});var l=typeof t!="undefined"&&t["mode"]=="delete-subtree";if(l){var d=s;var c=null;while(d){if(Depth(d)<a){c=d;break}d=BX.findPreviousSibling(d,{tagName:"tr"})}d=BX.findNextSibling(s,{tagName:"tr"});var u=null;while(d){if(Depth(d)<=a)break;u=d;d=BX.findNextSibling(d,{tagName:"tr"});BX.remove(u)}BX.remove(s);if(c!==null){var p=GetRowIdByDomNode(c);if(p!==false){var f=GetChildrenCountByRowId(p);if(f!==false){if(f>0)SetChildrenCount(p,f-1,c)}}}if(document.querySelectorAll("#task-list-table tbody tr").length<=2)BX.style(BX("task-list-no-tasks"),"display","table-row")}else{while(o&&o.id!=="task-list-no-tasks"&&(i=Depth(o))>a){if(i==a+1){n++}BX.removeClass(o,"task-depth-"+i);BX.addClass(o,"task-depth-"+(i-1));o=BX.findNextSibling(o,{tagName:"tr"})}if(a>0){var c=BX.findPreviousSibling(s,{tagName:"tr",className:"task-depth-"+(a-1)});if(c){var k=BX.findChild(c,{tagName:"span"},true);k.innerHTML=parseInt(k.innerHTML)-1+n;if(parseInt(k.innerHTML)==0){BX.remove(k.parentNode);BX.removeClass(c,"task-list-item-opened")}}}var m=0;r=BX.findPreviousSibling(s,{tagName:"tr"});while(m==0&&r){if(r.id!=="task-list-no-tasks"&&r.id.substr(0,13)!=="task-project-"&&r.id!=="task-new-item-row"){m=m+1}r=BX.findPreviousSibling(r,{tagName:"tr"})}o=BX.findNextSibling(s,{tagName:"tr"});while(m==0&&o){if(o.id!=="task-list-no-tasks"&&o.id.substr(0,13)!=="task-project-"&&o.id!=="task-new-item-row"){m=m+1}o=BX.findNextSibling(o,{tagName:"tr"})}if(m==0){BX("task-list-no-tasks").style.display="";var h=false;var g=null;r=BX.findPreviousSibling(s,{tagName:"tr"});while(m==0&&r){if(r.id.substr(0,13)==="task-project-"){h=true;g=r}r=BX.findPreviousSibling(r,{tagName:"tr"});if(h){BX.remove(g);h=false}}o=BX.findNextSibling(s,{tagName:"tr"});while(m==0&&o){if(o.id.substr(0,13)==="task-project-"){h=true;g=o}o=BX.findNextSibling(o,{tagName:"tr"});if(h){BX.remove(g);h=false}}}BX.remove(s)}}function ToggleProjectTasks(e,t){if(!t)t=window.event;var s=BX.findNextSibling(BX("task-project-"+e,true),{tagName:"tr"});var a=BX.findChild(BX("task-project-"+e,true),{tag:"span",className:"task-project-folding"},true);var i=BX.hasClass(a,"task-project-folding-closed");if(i)BX.userOptions.save("tasks","opened_projects",e,true);else BX.userOptions.save("tasks","opened_projects",e,false);while(s&&!BX.hasClass(s.cells[0],"task-project-column")&&!BX.hasClass(s.cells[0],"task-new-item-column")){if(i)s.style.display="";else s.style.display="none";s=BX.findNextSibling(s,{tagName:"tr"})}BX.toggleClass(a,"task-project-folding-closed");BX.PreventDefault(t)}function SortTable(e,t){if(!t)t=window.event;window.location=e;BX.PreventDefault(t)}function onGroupSelect(e){if(e[0]){if(e[0].title.length>40){e[0].title=e[0].title.substr(0,40)+"..."}BX.adjust(BX("task-new-item-link-group"),{text:e[0].title});var t=BX.findChild(BX("task-new-item-link-group").parentNode,{tag:"span",className:"task-group-delete"});if(!t){t=BX.create("span",{props:{className:"task-group-delete"}});BX("task-new-item-link-group").parentNode.appendChild(t)}BX.adjust(t,{events:{click:function(t){if(!t)t=window.event;BX.cleanNode(this,true);BX.adjust(BX("task-new-item-link-group"),{text:BX.message("TASKS_QUICK_IN_GROUP")});groupsPopup.deselect(e[0].id);newTaskGroup=0;newTaskGroupObj=null}}});newTaskGroup=e[0].id;newTaskGroupObj=e[0]}}function onPopupTaskChanged(e,t,s,a,i){tasksListNS.onPopupTaskChanged(e,t,s,a,i)}function onPopupTaskAdded(e,t,s,a,i){tasksListNS.onPopupTaskAdded(e,t,s,a,i)}function onPopupTaskDeleted(e){__DeleteTaskRow(e)}function __renderMark(e){if((e.directorId==currentUser||e.isSubordinate)&&e.responsibleId!=currentUser){return'<a href="javascript: void(0)" class="task-grade-and-report'+(e.mark?" task-grade-"+(e.mark=="N"?"minus":"plus"):"")+(e.isInReport?" task-in-report":"")+'" onclick="return ShowGradePopup('+e.id+", this, {listValue : '"+(e.mark?e.mark:"NULL")+"'"+(e.isSubordinate?", report : "+(e.isInReport?"true":"false"):"")+'});" title="'+BX.message("TASKS_MARK")+": "+BX.message("TASKS_MARK_"+(e.mark?e.mark:"NONE"))+'"><span class="task-grade-and-report-inner"><i class="task-grade-and-report-icon"></i></span></a>'}else{return"&nbsp;"}}function __renderPriority(e){if(currentUser==e.directorId){return'<a href="javascript: void(0)" class="task-priority-box" onclick="return ShowPriorityPopup('+e.id+", this, "+e.priority+');" title="'+BX.message("TASKS_PRIORITY")+": "+BX.message("TASKS_PRIORITY_"+e.priority)+'"><i class="task-priority-icon task-priority-'+(e.priority==2?"high":e.priority==0?"low":"medium")+'"></i></a>'}else{return'<i class="task-priority-icon task-priority-'+(e.priority==2?"high":(e.priority==0?"low":"medium")+'" title="'+BX.message("TASKS_PRIORITY")+": "+BX.message("TASKS_PRIORITY_"+e.priority))+'"></i>'}}function __renderDeadline(e){var t=false;if(e.canEditDealine)t=true;return tasksListNS.renderDeadline(e.id,e.dateDeadline,t)}function __renderFlag(e){if(e.responsibleId==currentUser){return'<a href="javascript: void(0)" class="task-flag-begin-perform" onclick="StartTask('+e.id+')"  title="'+BX.message("TASKS_START")+'">'}else if(e.status=="new"){return'<span class="task-flag-waiting-confirm"  title="'+BX.message("TASKS_WAINTING_CONFIRM")+'" />'}else{return"&nbsp;"}}function CloseTask(e){var t,s,a,i=BX("task-"+e);if(i){SetCSSStatus(i,"completed","task-status-");t=tasksListNS.getColumnIndex("title");if(t!==false){s=i.getElementsByTagName("TD");a=BX.findChild(s[t],{tagName:"a"},true);BX.style(a,"text-decoration","line-through")}if(BX("task-title-btn-start-"+e))BX("task-title-btn-start-"+e).innerHTML="&nbsp;";var n=BX.findChild(i,{tagName:"a",className:"task-complete-action"},true);if(n){n.onclick=null;n.title=BX.message("TASKS_FINISHED")}}SetServerStatus(e,"close")}function StartTask(e){var t=BX("task-"+e);if(t){SetCSSStatus(t,"in-progress","task-status-");if(BX("task-title-btn-start-"+e))BX("task-title-btn-start-"+e).innerHTML='<span class="task-flag-in-progress"></span>'}SetServerStatus(e,"start")}function AcceptTask(e){var t=BX("task-"+e);if(t){SetCSSStatus(t,"accepted","task-status-");if(BX("task-title-btn-start-"+e))BX("task-title-btn-start-"+e).innerHTML="&nbsp;"}SetServerStatus(e,"accept")}function PauseTask(e){var t=BX("task-"+e);if(t){SetCSSStatus(t,"accepted","task-status-");if(BX("task-title-btn-start-"+e))BX("task-title-btn-start-"+e).innerHTML="&nbsp;"}SetServerStatus(e,"pause")}function RenewTask(e){var t=BX("task-"+e);if(t){SetCSSStatus(t,"new","task-status-");if(BX("task-title-btn-start-"+e))BX("task-title-btn-start-"+e).innerHTML='<span class="task-flag-waiting-confirm"></span>'}SetServerStatus(e,"renew")}function DeferTask(e){var t=BX("task-"+e);if(t){SetCSSStatus(t,"delayed","task-status-");if(BX("task-title-btn-start-"+e))BX("task-title-btn-start-"+e).innerHTML="&nbsp;"}SetServerStatus(e,"defer")}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:87:"/bitrix/components/bitrix/tasks.list/templates/.default/resizecolumns.js?16992580838378";s:6:"source";s:72:"/bitrix/components/bitrix/tasks.list/templates/.default/resizecolumns.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
/**
 * Bitrix Framework
 * @package bitrix
 * @subpackage tasks
 * @copyright 2001-2014 Bitrix
 */

function tasks_TableColumnResize(table, minWidth, params)
{
	var i                = 0;
	var resizableDiv     = null;
	var item             = null;
	var self             = this;
	var allTableColumns  = null;
	var resizableColumns = null;
	var resizableDivs    = null;
	var resizableColumnsCnt = null;
	var tableWidth       = 0;
	var curVirtualWidth  = null;	// cur "virtual" width of column (could be less then zero or less then minimalWidth)
	var curRealWidth     = null;	// cur real width of column
	var minimalWidth     = minWidth || 65;	

	var eventMouseX;                // prev. mouse position
	var curColumn;                  // currently resized column
	var curColumnIndex;             // index of currently reszied column
	var originalOnMouseUpHandler;
	var originalOnMouseMoveHandler;
	var originalOnWindowResizeHandler;

	// input params
	var callbackOnStopResize  = null;
	var lastColumnAsElastic   = false;
	var elasticColumnMinWidth = 50;

	// additional vars (its usage depends on input params)
	var elasticColumn       = null;
	var columnsWidthExceptElastic = null;
	var tableContainerWidth = null;	// width of container, where table is located

	if (params)
	{
		if (params.callbackOnStopResize)
			callbackOnStopResize = params.callbackOnStopResize;

		if (params.lastColumnAsElastic)
			lastColumnAsElastic = true;

		if (params.elasticColumnMinWidth)
			elasticColumnMinWidth = parseInt(params.elasticColumnMinWidth);
	}

	if (table.tagName != 'TABLE')
		return;

	this.id = table.id;
	this.table = table;

	if ( ! table.rows[0] )
		return;

	allTableColumns = table.rows[0].cells;

	if ( ! allTableColumns )
		return;


	this.changeColumnWidth = function(deltaWidth)
	{
		var realDeltaWidth = null;
		var widthToBeSet = null;
		var elasticColumnWidth = null;
		var newElasticColumnWidth = null;

		curVirtualWidth = curVirtualWidth + deltaWidth;

		// ignore 0px - 2px moving
		if (
			((curVirtualWidth - curRealWidth) <= 2)
			&& ((curVirtualWidth - curRealWidth) >= -2)
		)
		{
			return;
		}

		if (curVirtualWidth > minimalWidth)
		{
			widthToBeSet = curVirtualWidth;
		}
		else if (
			(curVirtualWidth <= minimalWidth)
			&& (curRealWidth > minimalWidth)
		)
		{
			widthToBeSet = minimalWidth;
		}

		if (widthToBeSet === null)
			return;

		realDeltaWidth = widthToBeSet - curRealWidth;

		elasticColumnWidth    = parseInt(elasticColumn.offsetWidth);
		newElasticColumnWidth = elasticColumnWidth - realDeltaWidth;

		if (newElasticColumnWidth < elasticColumnMinWidth)
			newElasticColumnWidth = elasticColumnMinWidth;

		tableWidth = tableWidth + realDeltaWidth - (elasticColumnWidth - newElasticColumnWidth);

		resizableDivs[curColumnIndex].style.width = widthToBeSet +'px';
		curColumn.style.width     = widthToBeSet +'px';
		elasticColumn.style.width = newElasticColumnWidth +'px';
		resizableDivs[resizableDivs.length - 1].style.width = newElasticColumnWidth +'px';
		table.style.width         = tableWidth + 'px';

		// sometimes, real width of column != style.width
		// handle this situation
		curRealWidth = parseInt(curColumn.offsetWidth);
		if (curRealWidth != widthToBeSet)
		{
			realDeltaWidth = curRealWidth - widthToBeSet;

			widthToBeSet = curRealWidth;

			elasticColumnWidth    = parseInt(elasticColumn.offsetWidth);
			newElasticColumnWidth = elasticColumnWidth - realDeltaWidth;

			if (newElasticColumnWidth < elasticColumnMinWidth)
				newElasticColumnWidth = elasticColumnMinWidth;

			tableWidth = tableWidth + realDeltaWidth - (elasticColumnWidth - newElasticColumnWidth);


			resizableDivs[curColumnIndex].style.width = widthToBeSet +'px';
			curColumn.style.width = widthToBeSet +'px';
			elasticColumn.style.width = newElasticColumnWidth +'px';
			resizableDivs[resizableDivs.length - 1].style.width = newElasticColumnWidth +'px';
			table.style.width     = tableWidth + 'px';
		}

		return;
	};


	this.columnResize = function(e)
	{
		var e = e || window.event;
		var X = e.clientX || e.pageX;
		var deltaWidth;

		if (X != eventMouseX)
		{
			self.changeColumnWidth(X - eventMouseX);
			eventMouseX = X;
		}

		BX.PreventDefault(e);

		return (false);
	};


	this.stopColumnResize = function(e)
	{
		var e = e || window.event;

		BX.removeClass(table, 'task-list-resize-column');

		document.onmouseup   = originalOnMouseUpHandler;
		document.onmousemove = originalOnMouseMoveHandler;

		if (callbackOnStopResize)
		{
			callbackOnStopResize({
				columnIndex : curColumnIndex,
				columnWidth : curRealWidth
			});
		}

		self.normalizeElasticColumnWidth();

		BX.PreventDefault(e);

		return (false);
	};


	this.startColumnResize = function(e)
	{
		var i;
		var widthes = [];
		var e = e || window.event;
		var target = e.target || e.srcElement;

		target = target.parentNode;

		while (target.tagName !== 'TH')
			target = target.parentNode;

		if ( ! resizableColumnsCnt )
			return false;

		if ((curColumnIndex < 0) || (curColumnIndex > resizableColumnsCnt))
			return false;

		curColumnIndex = target.cellIndex;
		curColumn      = resizableColumns[curColumnIndex];

		if ( ! curColumn )
			return false;

		// fix widthes of all columns
		tableWidth = 0;

		// Firstly, get real width of every column in the table
		for (i = 0; i < allTableColumns.length; i++)
		{
			widthes[i] = parseInt(allTableColumns[i].offsetWidth);
			tableWidth = tableWidth + widthes[i];
		}

		// Now, set it up in style.width
		for (i = 0; i < allTableColumns.length; i++)
		{
			allTableColumns[i].style.width = widthes[i] + 'px';
			if (resizableDivs[i])
				resizableDivs[i].style.width = widthes[i] +'px';
		}

		table.style.width = tableWidth + 'px';
		table.style.tableLayout = "fixed";

		curRealWidth = parseInt(curColumn.style.width);

		curVirtualWidth = curRealWidth;
		eventMouseX     = e.clientX || e.pageX;

		originalOnMouseUpHandler = document.onmouseup;
		document.onmouseup       = self.stopColumnResize;

		originalOnMouseMoveHandler = document.onmousemove;
		document.onmousemove       = self.columnResize;

		BX.addClass(table, 'task-list-resize-column');

		BX.PreventDefault(e);

		return (false);
	};


	this.expandElasticColumn = function()
	{
		var outerWidth;
		var delta;

		outerWidth = parseInt(table.parentNode.offsetWidth);
		tableWidth = parseInt(table.offsetWidth);

		delta = outerWidth - tableWidth;

		if (delta > 0)
		{
			tableWidth                = tableWidth + delta;
			table.style.width         = tableWidth + 'px';
			elasticColumn.style.width = (elasticColumnMinWidth + delta) + 'px';
			resizableDivs[resizableDivs.length - 1].style.width = (elasticColumnMinWidth + delta) +'px';
		}
	};


	this.normalizeElasticColumnWidth = function()
	{
		var delta;

		delta = parseInt(elasticColumn.offsetWidth) - elasticColumnMinWidth;

		// set minimal width for last column
		if (delta > 0)
		{
			tableWidth                = parseInt(table.offsetWidth) - delta;
			table.style.width         = tableWidth + 'px';
			elasticColumn.style.width = elasticColumnMinWidth + 'px';
			resizableDivs[resizableDivs.length - 1].style.width = elasticColumnMinWidth +'px';
		}

		self.expandElasticColumn();
	};


	this.reinit = function()
	{
		resizableDivs    = [];
		resizableColumns = [];
		resizableColumnsCnt = allTableColumns.length;
		for (i = 0; i < resizableColumnsCnt; i++)
		{
			if ( ! allTableColumns[i] )
				break;

			resizableDiv = BX.findChild(
				allTableColumns[i],
				{tagName: "div"},
				false,		// recursive
				false		// get_all
			);

			item = null;
			if (resizableDiv)
			{
				item = BX.findChild(
					resizableDiv,
					{tagName: "div", className: "task-head-drag-btn"},
					false,		// recursive
					false		// get_all
				);

				resizableDivs.push(resizableDiv);
			}
			else
				resizableDivs.push(null);

			if (resizableDiv && item)
			{
				resizableColumns.push(allTableColumns[i]);
				item.onmousedown = this.startColumnResize;
			}
			else
				resizableColumns.push(null);
		}
	}

	this.reinit();

	if (lastColumnAsElastic)
	{
		elasticColumn = allTableColumns[allTableColumns.length - 1];

		originalOnWindowResizeHandler = window.onresize;

		window.onresize = function(e)
		{
			var e = e || window.event;

			self.normalizeElasticColumnWidth();

			if (typeof originalOnWindowResizeHandler === 'function')
				originalOnWindowResizeHandler(e);
		};
	}
}

/* End */
;
; /* Start:"a:4:{s:4:"full";s:85:"/bitrix/components/bitrix/tasks.list/templates/.default/movecolumns.js?16992580837771";s:6:"source";s:70:"/bitrix/components/bitrix/tasks.list/templates/.default/movecolumns.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
/**
 * Bitrix Framework
 * @package bitrix
 * @subpackage tasks
 * @copyright 2001-2014 Bitrix
 * 
 * Expects that first column is not draggable
 */

function tasks_TableColumnMove(table, lastColumnNotDraggable, onColumnMoved, draggableDivClsName, draggedClsName)
{
	this.table         = table;
	this.onColumnMoved = onColumnMoved;
	this.columns       = [];
	this.bxblank       = null;
	this.deltaX        = null;
	this.objectWidth   = null;
	this.bxMovedDiv    = null;
	this.cellOffsets   = [];
	this.dragMap       = [];
	this.dragMapLength = 0;
	this.dragLock      = false;
	this.prevTargetCellIndex = null;
	this.dragReady     = false;
	this.draggedCell   = null;		// currently dragged cell
	this.draggedCellLeftOffset = null;
	this.leftDragMargin = 0;
	this.rightDragMargin = 0;

	this.draggableDivClsName = draggableDivClsName;
	this.draggedClsName  = draggedClsName;


	this.onDragStart = function(object)
	{
		var i, iMax, offset = 0;
		var x = null;
		var parentCell = null;
		var divWidth;
		var divHeight;
		var tableWidth;

		this.dragReady = false;

		tableWidth = this.fixTableWidth();

		this.rightDragMargin = tableWidth - 25;

		this.objectWidth = object.offsetWidth;

		divWidth  = this.objectWidth + 'px';
		divHeight = object.offsetHeight + 'px';

		this.draggedCell = parentCell = object.parentNode;

		if (window.event && window.event.pageX)
			x = window.event.pageX;

		this.bxblank = BX.create(
			'DIV',
			{
				style:
				{
					height : divHeight,
					width  : divWidth
				}
			}
		);

		iMax = table.rows[0].cells.length - 1;
		if (lastColumnNotDraggable)
			--iMax;

		this.cellOffsets = [];
		for (i = 0; i <= iMax; ++i)
		{
			offset += table.rows[0].cells[i].offsetWidth;
			this.cellOffsets.push(offset);
		}

		this.prevTargetCellIndex = parentCell.cellIndex;

		this.draggedCellLeftOffset = this.cellOffsets[parentCell.cellIndex - 1];

		this.bxMovedDiv = BX.create('DIV', {             //div to move
			style: {
				position : 'absolute',
				top      : '0px',
				left     : this.draggedCellLeftOffset + 'px',
				zIndex   : '100',
				height   : divHeight,
				width    : divWidth
			},
			children: [object]
		});

		BX.addClass(this.bxMovedDiv, this.draggedClsName);

		if (x !== null)
			this.deltaX = x - this.draggedCellLeftOffset;
		else
			this.deltaX = null;

		// prepare cells map (relative zero at left border of currently dragged cell)
		offset = 0;
		this.dragMap = [];
		for (i = 1; i < (iMax - 1); ++i)
			this.dragMap.push(this.cellOffsets[i]);

		this.dragMapLength = this.dragMap.length;

		parentCell.appendChild(this.bxblank);
		parentCell.appendChild(this.bxMovedDiv);

		this.dragReady = true;
	};

	this.onDrag = function(object, x, y)
	{
		var centerPosition, i, targetCellIndex, tmp;

		if ( ! this.dragReady )
			return;

		if (this.dragLock)
			return;

		if (this.deltaX === null)
			this.deltaX = x - this.draggedCellLeftOffset;

		this.dragLock = true;

		x -= this.deltaX;

		if (x < this.leftDragMargin)
			this.bxMovedDiv.style.left = this.leftDragMargin + 'px';
		else if (x > this.rightDragMargin)
			this.bxMovedDiv.style.left = this.rightDragMargin + 'px';
		else
			this.bxMovedDiv.style.left = x + 'px';

		centerPosition = x + 10;	// + this.objectWidth / 2;

	 	targetCellIndex = 1;
		for (i = 0; i < this.dragMapLength; ++i)
		{
			if (this.dragMap[i] < centerPosition)
				++targetCellIndex;
			else
				break;
		}

		if (targetCellIndex != this.prevTargetCellIndex)
		{
			this.onTargetChanged(
				this.draggedCell.cellIndex,
				this.prevTargetCellIndex,
				targetCellIndex,
				(function(self){
					return function(){
						self.prevTargetCellIndex = targetCellIndex;
						self.dragLock = false;
					};
				})(this)
			);
		}
		else
		{
			this.prevTargetCellIndex = targetCellIndex;
			this.dragLock = false;
		}
	};

	this.onTargetChanged = function(draggedCellIndex, prevTargetCellIndex, targetCellIndex, onReady)
	{
		var targetDiv, targetCell, blankCell, blankCellWidthWas, distance;

		targetCell = table.rows[0].cells[targetCellIndex];
		targetDiv  = BX.findChild(targetCell, {tagName: 'DIV', className: this.draggableDivClsName}, false, false);

		blankCell         = this.bxblank.parentNode;
		blankCellWidthWas = blankCell.offsetWidth;

		this.bxblank.style.width  = targetCell.offsetWidth + 'px';
		targetCell.insertBefore(this.bxblank, targetDiv);

		if (targetCellIndex > prevTargetCellIndex)
			distance = -1 * blankCellWidthWas;
		else
			distance = targetDiv.offsetWidth;

		targetDiv.style.position = 'absolute';

		this.animateMoving(
			0, 
			4, 
			targetDiv, 
			distance, 
			blankCellWidthWas - targetDiv.offsetWidth,
			function(){
				targetDiv.style.width = blankCellWidthWas + 'px';
				targetDiv.style.position = '';
				targetDiv.style.top = '';
				targetDiv.style.left = '';
				blankCell.insertBefore(targetDiv, null);
				onReady();
			}
		);
	};

	this.animateMoving = function(step, totalSteps, object, distance, deltaWidth, onReady)
	{
		var x, delta;

		if (step == (totalSteps - 1))
		{
			onReady();
			return;
		}

		if (step == 0)
		{
			object.style.width = object.offsetWidth + 'px';
			object.style.top = '0px';
			object.style.left = (this.cellOffsets[object.parentNode.cellIndex] - object.offsetWidth) + 'px';
		}

		object.style.left  = parseInt(object.style.left) + (distance / totalSteps) + 'px';
		object.style.width = parseInt(object.style.width) + (deltaWidth / totalSteps) + 'px';

		window.setTimeout(
			(function(self){
				return function(){
					self.animateMoving(step + 1, totalSteps, object, distance, deltaWidth, onReady);
				};
			})(this),
			140 / totalSteps
		);
	};

	this.onDragStop = function(object)
	{
		var dragContainer, prevCellIndex, newCellIndex;

		this.dragReady = false;

		dragContainer = object.parentNode;
		prevCellIndex = dragContainer.parentNode.cellIndex;

		BX.removeClass(dragContainer, this.draggedClsName);

		object.style.width = this.bxblank.offsetWidth + 'px';
		this.bxblank.parentNode.replaceChild(object, this.bxblank);

		dragContainer.parentNode.removeChild(dragContainer);

		newCellIndex = object.parentNode.cellIndex;
		this.onColumnMoved(prevCellIndex, newCellIndex);
	};

	this.fixTableWidth = function()
	{
		var allTableColumns, resizableDiv, tableWidth, widthes = [];

		allTableColumns = this.table.rows[0].cells;

		// fix widthes of all columns
		tableWidth = 0;

		// Firstly, get real width of every column in the table
		for (i = 0; i < allTableColumns.length; i++)
		{
			widthes[i] = parseInt(allTableColumns[i].offsetWidth);
			tableWidth = tableWidth + widthes[i];
		}

		// Now, set it up in style.width
		for (i = 0; i < allTableColumns.length; i++)
		{
			allTableColumns[i].style.width = widthes[i] + 'px';

			resizableDiv = BX.findChild(
				allTableColumns[i],
				{tagName: "div"},
				false,		// recursive
				false		// get_all
			);

			if (resizableDiv)
				resizableDiv.style.width = widthes[i] +'px';
		}

		this.table.style.width = tableWidth + 'px';
		this.table.style.tableLayout = "fixed";

		return (tableWidth);
	};

	// init
	(function(self){
		var i, iMax, div;

		window.jsDD.Enable();

		self.leftDragMargin = table.rows[0].cells[0].offsetWidth;

		table.style.position = 'relative';
		iMax = table.rows[0].cells.length - 1;

		if (lastColumnNotDraggable)
			--iMax;

		for (i = 0; i <= iMax; ++i)
		{
			div = BX.findChild(table.rows[0].cells[i], {tagName: 'DIV'}, false, false);

			if (i != 0)
			{
				div.onbxdragstart = function(){ self.onDragStart(this); };
				div.onbxdrag      = function(x, y){ self.onDrag(this, x, y); };
				div.onbxdraghover = function(dest, x, y){};
				div.onbxdragstop  = function(){ self.onDragStop(this); };
			}

			if (i != 0)
				jsDD.registerObject(div);

			self.columns.push(div);
		}
	})(this);
}

/* End */
;
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/tasks.widget.result/templates/.default/script.min.js?16992580825521";s:6:"source";s:74:"/bitrix/components/bitrix/tasks.widget.result/templates/.default/script.js";s:3:"min";s:78:"/bitrix/components/bitrix/tasks.widget.result/templates/.default/script.min.js";s:3:"map";s:78:"/bitrix/components/bitrix/tasks.widget.result/templates/.default/script.map.js";}"*/
this.BX=this.BX||{};(function(t,e,s){"use strict";var i=function(){function t(e){babelHelpers.classCallCheck(this,t);babelHelpers.defineProperty(this,"taskId",null);babelHelpers.defineProperty(this,"itemsContentNode",null);babelHelpers.defineProperty(this,"targetBtnDown",null);babelHelpers.defineProperty(this,"targetBtnUp",null);babelHelpers.defineProperty(this,"itemsNodes",null);babelHelpers.defineProperty(this,"itemsWrapperNode",null);this.init(e);this.setHeightAutoFunction=this.setHeightAuto.bind(this)}babelHelpers.createClass(t,[{key:"init",value:function t(e){this.taskId=e;this.initExpand();s.EventEmitter.subscribe("onPullEvent-tasks",this.onPushResult.bind(this));s.EventEmitter.subscribe("BX.Livefeed:recalculateComments",this.onRecalculateLivefeedComments.bind(this));s.EventEmitter.subscribe("SidePanel.Slider:onOpenComplete",this.blockResize.bind(this))}},{key:"scrollToResult",value:function t(){var s=this;var i=this.getResultIdFromRequest();if(i){var n=this.contentNode.querySelector('[data-id="'+i+'"]');if(n){var o=function t(){s.activateBlinking(n);var i=e.Dom.getPosition(n).top;window.scrollTo({top:i,behavior:"smooth"})};if(e.Dom.hasClass(n.parentElement,"tasks-widget-result__item-more")){e.Event.bindOnce(this.itemsWrapperNode,"transitionend",o);this.showResults()}else{o()}}}}},{key:"getResultIdFromRequest",value:function t(){var s=new e.Uri(window.location.href);var i=s.getQueryParam("RID");return i?parseInt(i,10):null}},{key:"blockResize",value:function t(){this.contentNode.style.height="".concat(this.containerNode.scrollHeight,"px");this.scrollToResult()}},{key:"initExpand",value:function t(){var e=this;this.initExpandButton();if(this.contentNode){this.blockResize()}this.targetBtnDown&&this.targetBtnDown.addEventListener("click",this.showResults.bind(this));this.targetBtnUp&&this.targetBtnUp.addEventListener("click",(function(){e.targetBtnUp.classList.remove("--visible");e.targetBtnDown.classList.add("--visible");e.itemsContentNode.classList.remove("--open");e.itemsWrapperNode.style.height="".concat(e.itemsWrapperNode.scrollHeight,"px");e.itemsWrapperNode.clientHeight;e.itemsWrapperNode.style.height=0;if(e.contentNode){e.contentNode.style.height="".concat(e.itemsNodes[0].offsetHeight+35,"px")}}))}},{key:"setHeightAuto",value:function t(){this.itemsWrapperNode.style.height="auto";this.itemsWrapperNode.removeEventListener("transitionend",this.setHeightAutoFunction)}},{key:"initExpandButton",value:function t(){this.contentNode=document.getElementById("tasks-result-list-container-".concat(this.taskId));this.containerNode=document.getElementById("tasks-result-list-wrapper-".concat(this.taskId));if(!this.containerNode){return}this.itemsContentNode=this.containerNode.querySelector('[data-role="tasks-widget--content"]');this.targetBtnDown=this.containerNode.querySelector('[data-role="tasks-widget--btn-down"]');this.targetBtnUp=this.containerNode.querySelector('[data-role="tasks-widget--btn-up"]');this.itemsNodes=this.containerNode.querySelectorAll('[data-role="tasks-widget--result-item"]');this.itemsWrapperNode=this.containerNode.querySelector('[data-role="tasks-widget--wrapper"]');if(!this.itemsWrapperNode||this.itemsNodes.length<=1){return}this.targetBtnDown.classList.add("--visible");this.itemsNodes.length===2?this.itemsContentNode.classList.add("--two-results"):this.itemsContentNode.classList.add("--many-results");s.EventEmitter.subscribe("BX.Forum.Spoiler:toggle",this.onSpoilerToggle.bind(this))}},{key:"onSpoilerToggle",value:function t(e){var s=e.getCompatData(),i=babelHelpers.slicedToArray(s,1),n=i[0];if(!n.node){return}var o=n.node.closest(".tasks-result-list-container");if(!o||!this.contentNode||o.id!==this.contentNode.id){return}this.blockResize()}},{key:"onPushResult",value:function t(e){var s=e.getData(),i=babelHelpers.slicedToArray(s,2),n=i[0],o=i[1];if(n!=="task_result_create"&&n!=="task_result_update"&&n!=="task_result_delete"){return}if(!o.result||!o.result.taskId||o.result.taskId!=this.taskId){return}this.reloadResults()}},{key:"onRecalculateLivefeedComments",value:function t(s){var i=s.getCompatData(),n=babelHelpers.slicedToArray(i,1),o=n[0];if(!e.Type.isDomNode(o.rootNode)){return}var r=o.rootNode.querySelector(".tasks-result-list-container");if(!r||r.id!==this.contentNode.id){return}this.blockResize()}},{key:"showResults",value:function t(){this.targetBtnDown.classList.remove("--visible");this.targetBtnUp.classList.add("--visible");this.itemsContentNode.classList.add("--open");this.itemsWrapperNode.style.height="".concat(this.itemsWrapperNode.scrollHeight,"px");this.itemsWrapperNode.addEventListener("transitionend",this.setHeightAutoFunction);if(this.contentNode){this.contentNode.style.height="".concat(this.itemsWrapperNode.scrollHeight+this.containerNode.scrollHeight,"px")}}},{key:"activateBlinking",value:function t(s){if(e.Type.isUndefined(IntersectionObserver)){return}var i=new IntersectionObserver((function(t){if(t[0].isIntersecting===true){e.Dom.addClass(s,"--blink");setTimeout((function(){e.Dom.removeClass(s,"--blink")}),300);i.disconnect()}}),{threshold:[0]});i.observe(s)}},{key:"reloadResults",value:function t(){var s=this;e.ajax.runComponentAction("bitrix:tasks.widget.result","getResults",{mode:"class",data:{taskId:this.taskId}}).then((function(t){if(!t.data){return}s.containerNode.innerHTML=t.data;e.Runtime.html(s.containerNode,t.data).then((function(){s.initExpand()}))}))}}]);return t}();t.TaskResult=i})(this.BX.Tasks=this.BX.Tasks||{},BX,BX.Event);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:87:"/bitrix/components/bitrix/forum.comments/templates/.default/script.min.js?1699257985319";s:6:"source";s:69:"/bitrix/components/bitrix/forum.comments/templates/.default/script.js";s:3:"min";s:73:"/bitrix/components/bitrix/forum.comments/templates/.default/script.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/forum.comments/templates/.default/script.map.js";}"*/
(function(E){E.__fcOnUCFormAfterShow=function(i,o,t){if(!BX(i.form)||!BX(this)){return}var r=t?t["UF"]:{};if(t&&t["FILES"]){r["FILES"]={USER_TYPE_ID:"file",FIELD_NAME:"FILE_NEW[]",VALUE:t["FILES"],CID:BX.message("FCCID")}}E.LHEPostForm.reinitData(i.getLHE().oEditorId,o,r)}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/main.post.list/templates/.default/script.min.js?169925794955869";s:6:"source";s:69:"/bitrix/components/bitrix/main.post.list/templates/.default/script.js";s:3:"min";s:73:"/bitrix/components/bitrix/main.post.list/templates/.default/script.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/main.post.list/templates/.default/script.map.js";}"*/
(function(){window["UC"]=window["UC"]||{};if(window["FCList"]){return}var quoteData=null,repo={listById:new Map,listByXmlId:new Map};window.FCList=function(t,e){this.exemplarId=t["EXEMPLAR_ID"];this.ENTITY_XML_ID=t["ENTITY_XML_ID"];this.template=t["template"];this.scope="web";this.node={main:t["mainNode"],navigation:t["navigationNode"],navigationLoader:t["navigationNodeLoader"],history:t["nodeForOldMessages"],newComments:t["nodeForNewMessages"],formHolder:t["nodeFormHolder"],writersBlock:BX.findChild(t["nodeFormHolder"],{attrs:{id:["record",this.getXmlId(),"writers-block"].join("-")}},true),writers:BX.findChild(t["nodeFormHolder"],{attrs:{id:["record",this.getXmlId(),"writers"].join("-")}},true)};this.ajax=t["ajax"]||null;this.eventNode=this.node.main;this.form=BX.type.isNotEmptyString(t["FORM_ID"])?UCForm.bindFormToEntity(t["FORM_ID"],this):null;this.order=t["order"];this.mid=parseInt(t["mid"]);this.operationIds=[];this.canCheckVisibleComments=true;this.status="ready";this.msg=this.node.navigation?this.node.navigation.innerHTML:"";this.params=e||{};this.rights=t["rights"];this.DATE_TIME_FORMAT=this.params["DATE_TIME_FORMAT"]||null;this.unreadComments=new Map;this.comments=new Map;this.blankComments=new Map;this.blankCommentsForAjax=new Map;this.bindEvents=[];this.registerNewComment=this.registerNewComment.bind(this);this.registerBlankComment=this.registerBlankComment.bind(this);this.privateEvents={onShowActions:function(t,e){fcShowActions(this.node.main,e,t)}.bind(this),OnUCCommentIsInDOM:this.registerNewComment,OnUCBlankCommentIsInDOM:this.registerBlankComment,onExpandComment:fcCommentExpand};this.windowEvents={OnUCCommentWasPulled:function(t,e,i){if(this.getXmlId()!==i["ENTITY_XML_ID"]||this.isOwnOperationId(i["OPERATION_ID"])){return}this.setOperationId(i["OPERATION_ID"]);this.add(t,e,null,null,{live:true});if(this.params["NOTIFY_TAG"]&&this.params["NOTIFY_TEXT"]){window["UC"]["Informer"].check(t,e,this.params["NOTIFY_TAG"],this.params["NOTIFY_TEXT"])}}.bind(this),OnUCommentWasDeleted:function(t,e,i){if(this.getXmlId()!==i["ENTITY_XML_ID"]||this.isOwnOperationId(i["OPERATION_ID"])||!this.getCommentNode(e[1])){return}this.setOperationId(i["OPERATION_ID"]);BX.hide(this.getCommentNode(e[1]));this.comments.delete(e[1])}.bind(this),OnUCommentWasHidden:function(t,e,i){if(this.getXmlId()!==i["ENTITY_XML_ID"]||this.isOwnOperationId(i["OPERATION_ID"])||!this.getCommentNode(e[1])){return}this.setOperationId(i["OPERATION_ID"]);if(this.rights["MODERATE"]==="Y"||this.rights["MODERATE"]==="ALL"||Number(i["USER_ID"])===Number(BX.message("USER_ID"))){var n=BX.findChild(this.getCommentNode(e[1]),{tagName:"DIV",className:"feed-com-block"});if(BX(n)){BX.addClass(n,"feed-com-block-hidden");BX.removeClass(n,"feed-com-block-approved")}}else{BX.hide(this.getCommentNode(e[1]))}}.bind(this),OnUCUserIsWriting:function(e,i){if(i.sent===true){return}if(this.form!==null&&this!==e){return}if(this.form===null&&e!==this.ENTITY_XML_ID){return}i.sent=true;BX.ajax({url:this.url.activity,method:"POST",data:{AJAX_POST:"Y",ENTITY_XML_ID:this.ENTITY_XML_ID,COMMENT_EXEMPLAR_ID:this.exemplarId,MODE:"PUSH&PULL",sessid:BX.bitrix_sessid(),sign:t["sign"],PATH_TO_USER:this.params["PATH_TO_USER"],AVATAR_SIZE:this.params["AVATAR_SIZE"],NAME_TEMPLATE:this.params["NAME_TEMPLATE"],SHOW_LOGIN:this.params["SHOW_LOGIN"]}})}.bind(this),OnUCAfterRecordAdd:function(t,e){if(this.ENTITY_XML_ID===e["messageId"][0]){this.add(e["messageId"],e,true,"simple")}}.bind(this),OnUCFormSubmit:BX.delegate((function(t,e,i,n){if(!i||this.form===null&&t!==this.getXmlId()||this.form!==null&&i.currentEntity!==this){return}n["EXEMPLAR_ID"]=this.exemplarId;n["OPERATION_ID"]=this.getOperationId()}),this),OnUCFormResponse:function(t,e,i){},OnUCFormBeforeShow:function(t){var e=0;if(this.form===null&&t.id[0]===this.getXmlId()){e=t.id[1]}else if(this.form!==null&&t.currentEntity===this){e=t.currentEntity.messageId}else{return}if(e<=0){BX.addClass(this.node.formHolder,"feed-com-add-box-outer-form-shown")}if(BX(this.node.writersBlock)){var i=BX("lhe_buttons_"+t.form.id);if(!i||i.style.display==="none"){i=t.form}if(!this.node.writersBlockPointer){this.node.writersBlockPointer=BX.create("DIV",{style:{display:"none"}});this.node.writersBlock.parentNode.insertBefore(this.node.writersBlockPointer,this.node.writersBlock)}i.appendChild(this.node.writersBlock)}}.bind(this),OnUCFormAfterShow:function(t){if(t.id[0]!==this.getXmlId()){return}var e=BX.findParent(this.node.main,{className:"feed-comments-block"});if(e){BX.addClass(e,"feed-comments-block-editor-shown")}}.bind(this),OnUCFormBeforeHide:function(t){if(this.form===null&&(!t.id||t.id[0]!==this.getXmlId())||this.form!==null&&t.currentEntity!==this){return}var e=BX.findParent(this.node.main,{className:"feed-comments-block"});if(e){BX.removeClass(e,"feed-comments-block-editor-shown")}}.bind(this),OnUCFormAfterHide:function(t){if(this.form===null&&(!t.id||t.id[0]!==this.getXmlId())||this.form!==null&&t.currentEntity!==this){return}BX.removeClass(this.node.formHolder,"feed-com-add-box-outer-form-shown");BX.focus(this.node.formHolder.firstChild);if(this.node.writersBlock&&this.node.writersBlockPointer){this.node.writersBlockPointer.parentNode.insertBefore(this.node.writersBlock,this.node.writersBlockPointer)}}.bind(this),OnUCUsersAreWriting:function(t,e,i,n,s){if(this.getXmlId()===t){this.addWriter(e,i,n,s)}}.bind(this),OnUCCommentRecalculate:function(t){if(this.getXmlId()!==t){return}var e;var i=BX.findChild(this.node.main,{attrs:{"bx-mpl-xml-id":this.ENTITY_XML_ID}},false,true);for(e=0;e<i.length;e++){this.recalcMoreButtonComment(i[e].getAttribute("bx-mpl-entity-id"))}}.bind(this),"BX.BXUrlPreview.onImageLoaded":function(t){if(!BX.type.isPlainObject(t)||!BX.type.isDomNode(t.imageNode)){return}var e=BX.findParent(t.imageNode,{className:"feed-com-block-cover"});if(BX.type.isDomNode(e)){this.recalcMoreButtonComment(e.getAttribute("bx-mpl-entity-id"))}}.bind(this)};if(this.params["NOTIFY_TAG"]&&this.params["NOTIFY_TEXT"]&&window["UC"]["Informer"]){window["UC"]["InformerTags"][this.params["NOTIFY_TAG"]]=window["UC"]["InformerTags"][this.params["NOTIFY_TAG"]]||[]}else{this.params["NOTIFY_TAG"]=null;this.params["NOTIFY_TEXT"]=null}this.initialize();this.checkHash();this.registerComments();BX.onCustomEvent(this.eventNode,"OnUCInitialized",[this.exemplarId]);BX.addCustomEvent(this.eventNode,"OnUCInitialized",this.destroy.bind(this));this.windowEvents["OnUCInitialized"]=this.checkAndDestroy.bind(this);BX.Event.EventEmitter.incrementMaxListeners("OnUCInitialized");BX.addCustomEvent(window,"OnUCInitialized",this.windowEvents["OnUCInitialized"]);BX.ready(function(){setTimeout(function(){BX.onCustomEvent(window,"OnUCHasBeenInitialized",[this.ENTITY_XML_ID,this])}.bind(this),100)}.bind(this));repo.listById.set(this.exemplarId,this);repo.listByXmlId.set(this.getXmlId(),this);return this};window.FCList.prototype={getId:function(){return this.exemplarId},getXmlId:function(){return this.ENTITY_XML_ID},getOperationId:function(){var t=BX.util.getRandomString(20);this.operationIds.push(t);return t},setOperationId:function(t){if(BX.type.isNotEmptyString(t)){this.operationIds.push(t)}},isOwnOperationId:function(t){for(var e=0;e<this.operationIds.length;e++){if(this.operationIds[e]===t){return true}}return false},initialize:function(){this.checkVisibleComments=this.checkVisibleComments.bind(this);this.recalcMoreButtonComment=this.recalcMoreButtonComment.bind(this);this.sendCommentAsBlank=this.sendCommentAsBlank.bind(this);BX.Event.EventEmitter.incrementMaxListeners(scrSpy,"onRead");BX.addCustomEvent(scrSpy,"onRead",this.checkVisibleComments);scrSpy.watchNode(this.node.main);this.initNavigationEvents();this.initPostFormActivity();for(var t=0;t<this.bindEvents.length;t++){BX.bind(this.bindEvents[t][0],this.bindEvents[t][1],this.bindEvents[t][2])}for(t in this.privateEvents){if(this.privateEvents.hasOwnProperty(t)){BX.Event.EventEmitter.incrementMaxListeners(this.eventNode,t);BX.addCustomEvent(this.eventNode,t,this.privateEvents[t])}}if(!BX.type.isBoolean(this.params["USE_LIVE"])||this.params["USE_LIVE"]){for(t in this.windowEvents){if(this.windowEvents.hasOwnProperty(t)){BX.Event.EventEmitter.incrementMaxListeners(t);BX.addCustomEvent(window,t,this.windowEvents[t])}}}if(BX.DD&&!this.node.main.hasAttribute("dropzone")){new BX.DD.dropFiles(this.node.main)}},initNavigationEvents:function(){if(!BX(this.node.navigation)){return}this.bindEvents.unshift([this.node.navigation,"click",function(t){BX.eventCancelBubble(t);t.preventDefault();this.getPagenavigation();return false}.bind(this)])},initPostFormActivity:function(){this.privateEvents["onAct"]=this.act.bind(this);if(this.params["SHOW_POST_FORM"]!=="Y"){return}this.privateEvents["onReply"]=this.reply.bind(this);this.privateEvents["onQuote"]=this.quote.bind(this);this.hideWriter=this.hideWriter.bind(this);this.quoteShow=this.quoteShow.bind(this);this.bindEvents.unshift([this.eventNode,"mouseup",this.privateEvents["onQuote"]]);var t=0;var e=function(e){if(e&&e.currentTarget.contains(e.relatedTarget)){return}if(t>0){clearTimeout(t);t=0}}.bind(this);var i=function(){e();this.reply.apply(this,arguments)}.bind(this);var n=function(){if(t<=0){t=setTimeout(i,200)}}.bind(this);this.bindEvents.unshift([this.node.main,"dragover",n]);this.bindEvents.unshift([this.node.main,"dragenter",n]);this.bindEvents.unshift([this.node.main,"dragleave",e]);this.bindEvents.unshift([this.node.main,"dragexit",e]);this.bindEvents.unshift([this.node.main,"drop",e])},url:{activity:"/bitrix/components/bitrix/main.post.list/activity.php"},destroy:function(){BX.removeCustomEvent(scrSpy,"onRead",this.checkVisibleComments);var t,e;while((e=this.bindEvents.pop())&&e){BX.unbindAll(e[0]);delete e[0];delete e[2]}for(t in this.privateEvents){if(this.privateEvents.hasOwnProperty(t)){BX.removeCustomEvent(this.eventNode,t,this.privateEvents[t]);BX.Event.EventEmitter.decrementMaxListeners(this.eventNode,t);this.privateEvents[t]=null}}this.privateEvents=null;for(t in this.windowEvents){if(this.windowEvents.hasOwnProperty(t)){BX.removeCustomEvent(window,t,this.windowEvents[t]);this.windowEvents[t]=null;BX.Event.EventEmitter.decrementMaxListeners(t)}}this.windowEvents=null;for(t in this.node){if(this.node.hasOwnProperty(t)){this.node[t]=null}}this.unreadComments.clear();this.comments.clear();BX.onCustomEvent(window,"OnUCHasBeenDestroyed",[this.ENTITY_XML_ID,this]);repo.listById.delete(this.exemplarId);if(repo.listByXmlId.get(this.ENTITY_XML_ID)===this){repo.listByXmlId.delete(this.ENTITY_XML_ID)}},checkAndDestroy:function(t){if(this.exemplarId===t||!document.body.contains(this.eventNode)){this.destroy()}},quotePopup:null,quoteCheck:function(){var t="";var e;var i=null;if(window.getSelection){e=window.getSelection();t=e.toString()}else if(document.selection){e=document.selection;t=e.createRange().text}if(t!==""){var n=BX.findParent(e.focusNode,{tagName:"DIV",className:"feed-com-block-cover"},this.node.main);var s=BX.findParent(e.anchorNode,{tagName:"DIV",className:"feed-com-block-cover"},this.node.main);if(n!==s||BX(n)&&!n.hasAttribute("id")){t=""}else if(BX(n)){var o=BX(n.getAttribute("id").replace(/\-cover$/,"-actions-reply"));if(o){i={id:parseInt(o.getAttribute("bx-mpl-author-id")),name:o.getAttribute("bx-mpl-author-name"),gender:o.getAttribute("bx-mpl-author-gender")}}}}if(t===""){if(this.quotePopup){this.quotePopup.hide()}return false}return{text:t,author:i}},quoteShow:function(t,e){e=e||this.quoteCheck()||{};if(!BX.type.isNotEmptyString(e["text"])){return}quoteData=e;if(this.quotePopup==null){this.__quoteShowClick=function(){if(this.form){BX.onCustomEvent(this.form,"onQuote",[this,e["author"],e["text"]])}else{BX.onCustomEvent(window,"OnUCQuote",[this.ENTITY_XML_ID,e["author"],e["text"],true])}}.bind(this);this.__quoteShowHide=function(){quoteData=null;BX.removeCustomEvent(this.quotePopup,"onQuote",this.__quoteShowClick);BX.removeCustomEvent(this.quotePopup,"onHide",this.__quoteShowHide);this.quotePopup=null}.bind(this);this.quotePopup=new MPLQuote;BX.addCustomEvent(this.quotePopup,"onQuote",this.__quoteShowClick);BX.addCustomEvent(this.quotePopup,"onHide",this.__quoteShowHide)}this.quotePopup.show(t)},displayPagenavigation:function(t,e){var i;var n=0;var s;var o=this.node.history;t=t=="hide"?"hide":"show";if(t=="hide"){i=parseInt(this.node.history.offsetHeight);s=i/2e3;s=s<.3?.3:s>.5?.5:s;o.style.overflow="hidden";new BX["easing"]({duration:s*1e3,start:{height:i,opacity:100},finish:{height:n,opacity:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){o.style.maxHeight=t.height+"px";o.style.opacity=t.opacity/100},complete:BX.proxy((function(){o.style.cssText="";o.style.display="none";BX.onCustomEvent(this,"OnUCListWasHidden",[this,[],o])}),this)}).animate()}else{i=parseInt(e||20);o.style.display="block";o.style.overflow="hidden";o.style.maxHeight=i;n=parseInt(this.node.history.offsetHeight);s=(n-i)/(2e3-i);s=s<.3?.3:s>.8?.8:s;new BX["easing"]({duration:s*1e3,start:{height:i,opacity:i>0?100:0},finish:{height:n,opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){o.style.maxHeight=t.height+"px";o.style.opacity=t.opacity/100},complete:BX.proxy((function(){o.style.cssText="";o.style.maxHeight="none";BX.onCustomEvent(this,"OnUCListWasShown",[this,[],o])}),this)}).animate()}},getPagenavigation:function(){if(this.status=="done"){if(this.node.navigation.getAttribute("bx-visibility-status")=="visible"){this.displayPagenavigation("hide");BX.adjust(this.node.navigation,{attrs:{"bx-visibility-status":"none"},html:this.msg})}else{this.displayPagenavigation("show");BX.adjust(this.node.navigation,{attrs:{"bx-visibility-status":"visible"},html:BX.message("BLOG_C_HIDE")})}}else if(this.status=="ready"){this.sendPagenavigation()}return false},sendPagenavigation:function(){this.status="busy";BX.addClass(this.node.navigation,"feed-com-all-hover");var t={AJAX_POST:"Y",ENTITY_XML_ID:this.ENTITY_XML_ID,EXEMPLAR_ID:this.exemplarId,MODE:"LIST",FILTER:this.order=="ASC"?{">ID":this.mid}:{"<ID":this.mid},sessid:BX.bitrix_sessid()},e=BX.util.htmlspecialcharsback(this.node.navigation.getAttribute("href"));e=e.indexOf("#")!==-1?e.substr(0,e.indexOf("#")):e;var i={url:e,data:t};BX.onCustomEvent(this,"OnUCListHasToBeEnlarged",[this,i]);e=i.url;t=i.data;t.scope=this.scope;var n=this.buildPagenavigation.bind(this);var s=this.completePagenavigation.bind(this);if(this.ajax["navigateComment"]===true){e=e.indexOf("?")>=0?e.substr(e.indexOf("?")+1):"";e.split("&").forEach((function(e){var i=e.split("=");t[i[0]]=i[1]}));BX.ajax.runComponentAction(this.ajax.componentName,"navigateComment",{mode:"class",data:t,signedParameters:this.ajax.params}).then(n,s)}else{BX.adjust(this.node.navigationLoader,{style:{display:"flex"}});BX.ajax({url:e+(e.indexOf("?")!==-1?"&":"?")+BX.ajax.prepareData(t),method:"GET",dataType:"json",data:"",onsuccess:n,onfailure:s})}},buildPagenavigation:function(t){if(t["status"]!=="success"){return this.completePagenavigation()}this.status="ready";this.wait("hide");BX.adjust(this.node.navigationLoader,{style:{display:"none"}});BX.removeClass(this.node.navigation,"feed-com-all-hover");var e=BX.processHTML(t["messageList"],false);var i=this.node.history.offsetHeight;var n=BX.create("DIV",{html:e.HTML});if(this.order==="ASC"||!this.node.history.firstChild){this.node.history.appendChild(n)}else{this.node.history.insertBefore(n,this.node.history.firstChild)}BX.onCustomEvent(window,"OnUCFeedChanged",[[this.ENTITY_XML_ID,this.mid]]);this.displayPagenavigation("show",i);if(BX.type.isNotEmptyString(t["navigation"])){var s=BX.create("DIV",{html:t["navigation"]}).firstChild;BX.adjust(this.node.navigation,{attrs:{href:s.getAttribute("href"),"bx-mpl-comments-count":s.getAttribute("bx-mpl-comments-count")},html:s.innerHTML})}else{BX.adjust(this.node.navigation,{attrs:{href:"#","bx-visibility-status":"visible","bx-mpl-comments-count":0},html:BX.message("BLOG_C_HIDE"),events:{click:function(t){BX.eventCancelBubble(t);t.preventDefault();return false}}});this.status="done"}var o=0;var a=function(){o++;if(o>100){return}if(n.childNodes.length<=0){setTimeout(a,500);return}BX.ajax.processScripts(e.SCRIPT);BX.onCustomEvent(this,"OnUCListWasBuilt",[this,t,n])}.bind(this);setTimeout(a,500)},completePagenavigation:function(){this.status="done";BX.removeClass(this.node.navigation,"feed-com-all-hover");this.wait("hide");BX.adjust(this.node.navigationLoader,{style:{display:"none"}})},getCommentsCount:function(){var t=0;if(BX(this.node.navigation)){t=Number(this.node.navigation.getAttribute("bx-mpl-comments-count"))}return this.comments.size+t},wait:function(t){t=t==="show"?"show":"hide";return t},quote:function(t,e){if(t.hasOwnProperty("UCDone")){return}t["UCDone"]=true;setTimeout(this.quoteShow,50,t,e)},reply:function(t){var e={id:undefined,name:undefined};if(BX.type.isElementNode(t)){e.id=t.getAttribute("bx-mpl-author-id");e.name=t.getAttribute("bx-mpl-author-name")}else if(BX.type.isPlainObject(t)){e.id=t.id;e.name=t.name}if(this.form){BX.onCustomEvent(this.form,"onReply",[this,e])}else{var i={caught:false};BX.onCustomEvent(window,"OnUCReply",[this.ENTITY_XML_ID,e.id,e.name,true,i])}},getPlaceholder:function(t){if(!this.node["placeholderFor"+t]||!document.body.contains(this.node["placeholderFor"+t])){this.node["placeholderFor"+t]=BX.findChild(this.node.main,{attrs:{id:["record",this.getXmlId(),t,"placeholder"].join("-")}},true)}return this.node["placeholderFor"+t]},addWriter:function(t,e,i,n){if(!this.node.writersBlock||!this.node.writers){return}t=t>0?t:0;if(t<=0){return}var s=["writer",this.exemplarId,t].join("-");var o=BX(s);var a=setTimeout(this.hideWriter,n>0?n:40500,t);if(o){clearTimeout(o.getAttribute("bx-check-timeout"))}else{o=BX.create("DIV",{attrs:{id:s,className:"feed-com-avatar ui-icon ui-icon-common-user ",title:e},children:[i&&i.length>0?BX.create("I",{style:{background:"url('"+i+"')",backgroundSize:"cover"}}):null]});this.node.writers.appendChild(o)}o.setAttribute("bx-check-timeout",a+"");BX.show(this.node.writersBlock);if(this.objAnswering&&this.objAnswering.name!=="show"){this.objAnswering.stop()}if(!this.objAnswering||this.objAnswering.name!=="show"){this.node.writersBlock.style.display="inline-block";this.objAnswering=new BX["easing"]({duration:500,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){this.node.writersBlock.style.opacity=t.opacity/100}.bind(this)});this.objAnswering.name="show";this.objAnswering.animate()}},hideWriter:function(t){if(!this.node.writers||!this.node.writersBlock){return}var e=["writer",this.exemplarId,t].join("-");var i=BX(e);if(this.node.writers.childNodes.length>1){new BX["easing"]({duration:500,start:{opacity:100},finish:{opacity:0},transition:BX["easing"].makeEaseOut(BX["easing"].transitions.quart),step:function(t){if(i)i.style.opacity=t.opacity/100},complete:function(){if(i&&i.parentNode){i.parentNode.removeChild(i)}}.bind(this)}).animate()}else{if(this.objAnswering&&this.objAnswering.name!=="hide"){this.objAnswering.stop()}if(!this.objAnswering||this.objAnswering.name!=="hide"){this.objAnswering=new BX["easing"]({duration:500,start:{opacity:100},finish:{opacity:0},transition:BX["easing"].makeEaseOut(BX.easing.transitions.quart),step:function(t){this.node.writersBlock.style.opacity=t.opacity/100}.bind(this),complete:function(){this.node.writersBlock.style.display="none";if(i&&i.parentNode){i.parentNode.removeChild(i)}}.bind(this)});this.objAnswering.name="hide";this.objAnswering.animate()}}},getCommentNode:function(t){if(!this.node[t]||!document.body.contains(this.node[t])){this.node[t]=BX.findChild(this.node.main,{attrs:{id:["record",this.getXmlId(),t,"cover"].join("-")}},true)}return this.node[t]},add:function(t,e,i,n,s){if(!t||!t[1]||!BX.type.isPlainObject(e)){return false}var o=e["AUTHOR"]||(e["messageFields"]?e["messageFields"]["AUTHOR"]:null);if(o){this.hideWriter(o["ID"])}var a=this.getCommentNode(t[1]);if(!a&&t[1]<this.mid){return false}var r=t.join("-");var d=e["message"]||window.fcParseTemplate({messageFields:e["messageFields"]},{EXEMPLAR_ID:this.exemplarId,RIGHTS:this.rights,DATE_TIME_FORMAT:this.DATE_TIME_FORMAT,VIEW_URL:this.params.VIEW_URL,EDIT_URL:this.params.EDIT_URL,MODERATE_URL:this.params.MODERATE_URL,DELETE_URL:this.params.DELETE_URL,AUTHOR_URL:this.params.AUTHOR_URL,AUTHOR_URL_PARAMS:this.params.AUTHOR_URL_PARAMS,NAME_TEMPLATE:this.params.NAME_TEMPLATE,SHOW_LOGIN:this.params.SHOW_LOGIN,CLASSNAME:BX.type.isPlainObject(s)&&s.live?"feed-com-block-live":""},this.getTemplate());var l=BX.processHTML(d,false);var h;var m=this.node.newComments;var c=["MODERATE","EDIT","DELETE"];var u=false;var p=0;for(var E in c){if(c.hasOwnProperty(E)&&this.rights[c[E]]==="OWNLAST"){u=true;break}}if(u){h=m.lastChild&&BX.hasClass(m.lastChild,"feed-com-block-cover")?[m.lastChild]:[];var f;var T;if(this.addCheckPreviousNodes!==true){h=BX.findChildren(this.node.main,{tagName:"DIV",className:"feed-com-block-cover"},false)||[];h.concat(BX.findChildren(m,{tagName:"DIV",className:"feed-com-block-cover"},false)||[]);this.addCheckPreviousNodes=true}while((f=h.pop())&&f){T=BX.findChild(f,{attrs:{id:f.id.replace("-cover","-actions")}},true);if(T){if(this.rights["EDIT"]==="OWNLAST"){T.setAttribute("bx-mpl-edit-show","N")}if(this.rights["MODERATE"]==="OWNLAST"){T.setAttribute("bx-mpl-moderate-show","N")}if(this.rights["DELETE"]==="OWNLAST"){T.setAttribute("bx-mpl-delete-show","N")}}}}var X=false;if(!a){a=BX.create("DIV",{attrs:{id:"record-"+r+"-cover",className:"feed-com-block-cover","bx-mpl-xml-id":this.getXmlId(),"bx-mpl-entity-id":t[1],"bx-mpl-read-status":Number(o["ID"])!==Number(BX.message("USER_ID"))?"new":"old","bx-mpl-block":"main"},style:{opacity:0,height:0,overflow:"hidden",marginBottom:0},html:l.HTML});m.appendChild(a);X=true}else{var B=BX.create("DIV",{attrs:{id:"record-"+r+"-cover",className:"feed-com-block-cover"},style:{display:"none"},html:l.HTML});var I=a;var A=BX.findChild(I,{tag:"div",className:"feed-com-text-inner"},true);var g=A&&A.classList.contains("feed-com-text-inner-expanded");if(g){A=BX.findChild(B,{tag:"div",className:"feed-com-text-inner"},true);if(A){A.classList.add("feed-com-text-inner-expanded")}}a.parentNode.insertBefore(B,a);a.removeAttribute("id");p=a.scrollHeight;BX.hide(a);BX.show(B);a=B;this.node[t[1]]=a;setTimeout((function(){BX.remove(I)}),1e3)}if(n!=="simple"&&BX.Type.isUndefined(window.BXMobileApp)&&!(window.top===window&&BX.getClass("BX.SidePanel.Instance")&&BX.SidePanel.Instance.isOpen())&&!(BX.type.isNotEmptyObject(BXRL)&&BX.type.isNotEmptyObject(BXRL.render)&&BX.type.isDomNode(BXRL.render.reactionsPopup)&&!BXRL.render.reactionsPopup.classList.contains("feed-post-emoji-popup-invisible"))){var v=BX.pos(a);var _=BX.GetWindowScrollPos();var b=BX.GetWindowInnerSize();new BX["easing"]({duration:1e3,start:{opacity:X?0:100,height:p},finish:{opacity:100,height:a.scrollHeight+10},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){a.style.height=t.height+"px";a.style.opacity=t.opacity/100;if(_.scrollTop>0&&v.top<_.scrollTop+b.innerHeight){window.scrollTo(0,_.scrollTop+t.height)}},complete:function(){a.style.cssText="";BX.onCustomEvent(this,"OnUCRecordWasShown",[this.ENTITY_XML_ID,r,a])}.bind(this)}).animate()}else{new BX["easing"]({duration:500,start:{opacity:X?0:100,height:p},finish:{opacity:100,height:a.scrollHeight+10},transition:BX.easing.makeEaseOut(BX.easing.transitions.cubic),step:function(t){a.style.height=t.height+"px";a.style.opacity=t.opacity/100},complete:BX.proxy((function(){a.style.cssText="";BX.onCustomEvent(this,"OnUCRecordWasShown",[this.ENTITY_XML_ID,r,a])}),this)}).animate()}var C=0,w=function(){if(100<++C){return}if(this.getCommentNode(t[1]).childNodes.length>0){BX.ajax.processScripts(l.SCRIPT);if(this.params["BIND_VIEWER"]==="Y"&&BX["viewElementBind"]){BX.viewElementBind(this.getCommentNode(t[1]),{},(function(t){return BX.type.isElementNode(t)&&(t.getAttribute("data-bx-viewer")||t.getAttribute("data-bx-image"))}))}}else{setTimeout(w,500)}BX.onCustomEvent(window,"OnUCRecordHasDrawn",[this.ENTITY_XML_ID,t,e["messageFields"]||e]);BX.onCustomEvent(window,"OnUCCommentWasAdded",[this.ENTITY_XML_ID,t,e["messageFields"]||e]);BX.onCustomEvent(window,"OnUCFeedChanged",[t])}.bind(this);setTimeout(w,500);return true},act:function(url,id,act){if(this.ajax["processComment"]!==true&&BX.type.isNotEmptyString(url)&&url.substr(0,1)!=="/"){try{eval(url);return false}catch(t){}if(BX.type.isFunction(url)){url(this,id,act);return false}}this.showWait(id);id=parseInt(id);var data={sessid:BX.bitrix_sessid(),MODE:"RECORD",NOREDIRECT:"Y",AJAX_POST:"Y",FILTER:{ID:id},ACTION:act==="EDIT"?"GET":act,ID:id,ENTITY_XML_ID:this.ENTITY_XML_ID,OPERATION_ID:this.getOperationId(),EXEMPLAR_ID:this.exemplarId,scope:this.scope};url=url.indexOf("#")!==-1?url.substr(0,url.indexOf("#")):url;var onsuccess=function(t){this.closeWait(id);if(t["status"]==="error"){this.showError(id,t["message"]||"Unknown error.");return}var e=this.getCommentNode(id);if(e){if(act==="DELETE"){BX.hide(e);this.comments.delete(id.toString());BX.onCustomEvent(window,"OnUCommentWasDeleted",[this.ENTITY_XML_ID,[this.ENTITY_XML_ID,id],t])}else if(act!=="EDIT"&&!!t["message"]){var i=BX.processHTML(t["message"],false);e.innerHTML=i.HTML;var n=0,s=function(){n++;if(n<100){if(e.childNodes.length>0)BX.ajax.processScripts(i.SCRIPT);else BX.defer(s)()}};BX.defer(s)();t["okMessage"]=""}}if(this.form!==null){BX.onCustomEvent(this.form,"onEdit",[this,id,t,act])}else{BX.onCustomEvent(window,"OnUCAfterRecordEdit",[this.ENTITY_XML_ID,id,t,act])}BX.onCustomEvent(window,"OnUCFeedChanged",[id])}.bind(this);var onfailure=function(t){this.closeWait(id);var e=t;if(BX.type.isNotEmptyObject(t)){if(BX.type.isArray(t.errors)&&BX.type.isNotEmptyString(t.errors[0].message)){e=t.errors[0].message}else if(BX.type.isNotEmptyObject(t.data)&&BX.type.isNotEmptyString(t.data.message)){e=t.data.message}}this.showError(id,e)}.bind(this);if(this.ajax["processComment"]===true){BX.ajax.runComponentAction(this.ajax.componentName,"processComment",{mode:"class",data:data,signedParameters:this.ajax.params}).then(onsuccess,onfailure)}else{BX.ajax({method:"GET",url:url+(url.indexOf("?")!==-1?"&":"?")+BX.ajax.prepareData(data),data:"",dataType:"json",onsuccess:onsuccess,onfailure:onfailure})}},showError:function(t,e){if(this.errorWindow){this.errorWindow.close()}this.errorWindow=new BX.PopupWindow("bx-comments-error",null,{autoHide:false,zIndex:200,overlay:{opacity:50,backgroundColor:"#000000"},buttons:[new BX.PopupWindowButton({text:BX.message("MPL_CLOSE"),events:{click:BX.delegate((function(){if(this.errorWindow)this.errorWindow.close()}),this)}})],closeByEsc:true,titleBar:{content:BX.create("span",{props:{className:"popup-window-titlebar-text feed-error-title"},html:'<div class="feed-error-icon"></div>'+BX.message("MPL_ERROR_OCCURRED")})},closeIcon:true,contentColor:"white",content:'<div class="feed-error-block">'+e+"</div>"});this.errorWindow.show()},checkHash:function(){if(repo["hashHasBeenFound"]===true){return}var t=/%23com(\d+)/gi.exec(location.href);var e=parseInt(location.hash&&location.hash.indexOf("#com")>=0?location.hash.replace("#com",""):t?t[1]:0);if(e>0){var i=BX.findChild(this.node.main,{attrs:{id:"record-"+[this.ENTITY_XML_ID,e].join("-")+"-cover"}},true,false);if(i){var n=BX.findParent(i,{attrs:{"data-bx-role":"collapsed-block"}},this.node.main);if(n){var s=n.querySelector("input[type=checkbox]");if(!s.checked){s.click(true)}}repo["hashHasBeenFound"]=true;var o=BX.pos(i);window.scrollTo(0,o["top"]);var a=BX.findChild(i,{className:"feed-com-main-content"},true,false);BX.removeClass(a,"feed-com-block-pointer-to-new feed-com-block-new");BX.addClass(a,"feed-com-block-pointer")}}},registerComments:function(){var t;var e=BX.findChild(this.node.main,{tag:"DIV",attrs:{"bx-mpl-block":"main","bx-mpl-xml-id":this.ENTITY_XML_ID}},true,true);for(t=0;t<e.length;t++){if(e[t].getAttribute("bx-mpl-blank-status")==="blank"){this.blankComments.set(e[t].getAttribute("bx-mpl-entity-id"),e[t]);scrSpy.set([this.getXmlId(),e[t].getAttribute("bx-mpl-entity-id")].join("-"))}else{if(e[t].getAttribute("bx-mpl-read-status")==="new"){this.unreadComments.set(e[t].getAttribute("bx-mpl-entity-id"),e[t]);scrSpy.set([this.getXmlId(),e[t].getAttribute("bx-mpl-entity-id")].join("-"))}this.recalcMoreButtonComment(e[t].getAttribute("bx-mpl-entity-id"));this.comments.set(e[t].getAttribute("bx-mpl-entity-id"),[])}}},registerBlankComment:function(t,e){if(e!==true){setTimeout(this.registerBlankComment,1e3,t,true);return}var i=this.getCommentNode(t);if(!i||this.comments.has(t)||this.blankComments.has(t)){return}this.blankComments.set(t,i);scrSpy.set([this.getXmlId(),t].join("-"))},registerNewComment:function(t,e){if(e!==true){setTimeout(this.registerNewComment,1e3,t,true);return}var i=this.getCommentNode(t);if(!i||this.comments.has(t)){return}this.comments.set(t,[]);if(i.getAttribute("bx-mpl-read-status")==="new"){scrSpy.set([this.getXmlId(),t].join("-"),i);this.unreadComments.set(t,i)}this.recalcMoreButtonComment(t)},recalcMoreButtonComment:function(t){var e=this.getCommentNode(t);if(!BX(e)){return}var i=e.bodyBlock||BX.findChild(e,{attrs:{"bx-mpl-block":"body"}},true);if(!i){return}e.bodyBlock=i;var n=e.textBlock||BX.findChild(i,{attrs:{"bx-mpl-block":"text"}},true);if(!n){return}e.textBlock=n;var s=e.moreButtonBlock||BX.findChild(e,{attrs:{"bx-mpl-block":"more-button"}},true);e.moreButtonBlock=s;var o=BX.pos(i);var a=BX.pos(n);if(o.height>=a.height){s.style.display="none"}else if(s.style.display!=="block"){s.style.display="block"}var r=null;var d=BX.findChildren(i,{attr:{"data-bx-onload":"Y"}},true);var l=function(){this.recalcMoreButtonComment(t)}.bind(this);if(BX.type.isArray(d)){for(r=0;r<d.length;r++){d[r].addEventListener("load",l);d[r].setAttribute("data-bx-onload","N")}}var h=i.querySelectorAll("video");for(r=0;r<h.length;r++){h[r].addEventListener("loadedmetadata",l)}if(!e.hasOwnProperty("__boundOnForumSpoilerToggle")){e.__boundOnForumSpoilerToggle=true;BX.addCustomEvent(e,"onForumSpoilerToggle",l)}},checkVisibleComments:function(t){if(!this.canCheckVisibleComments){return}var e=this.getVisibleCommentIds(this.unreadComments,t);var i;while(i=e.shift()){this.markCommentAsRead(i)}window.fclistdebug=true;e=this.getVisibleCommentIds(this.blankComments,t);while(i=e.shift()){this.markCommentAsBlank(i)}},getVisibleCommentIds:function(t,e){var i=[];if(t.size<=0){return i}var n=BX.pos(this.node.main);if(n.top>e.bottom||n.bottom<e.top||n.top===0&&n.bottom===0){return i}var s=t.keys();var o=s.next();var a;while(o.done!==true){a=t.get(o.value);if(a.offsetWidth||a.offsetHeight||a.getClientRects().length){n=a.pos||BX.pos(a);a.pos=n;if(e.top<=n.top&&n.top<=e.bottom&&a.offsetParent!==null){i.push(o.value)}}o=s.next()}return i},markCommentAsRead:function(t){if(!this.unreadComments.has(t)){return}var e=this.unreadComments.get(t);e.setAttribute("bx-mpl-read-status","old");this.unreadComments.delete(t);scrSpy.unset([this.getXmlId(),t].join("-"));if(this.node.newComments.contains(e)){this.sendCommentAsRead(t)}BX.removeClass(e,"comment-new-answer");if(this.__checkNodeCorner!==true){this.__checkNodeCorner=true;var i=BX.findChild(this.node.main,{className:"feed-com-corner"});if(i){BX.addClass(i,"feed-post-block-corner-fade")}}var n=BX.findChild(e,{className:"feed-com-main-content"},true,false);if(n){BX.removeClass(n,"feed-com-block-pointer-to-new feed-com-block-new");BX.addClass(n,"feed-com-block-read")}var s=BX.findChild(e,{className:"feed-com-block"},true);BX.onCustomEvent(window,"OnUCCommentWasRead",[this.getXmlId(),[this.getXmlId(),t],{live:s&&s.classList.contains("feed-com-block-live"),new:!n||!n.classList.contains("feed-com-block-old")}])},sendCommentAsRead:function(t){if(this.ajax["readComment"]!==true){return}if(!this.sendCommentAsReadData){this.sendCommentAsReadData={mid:0,timeoutId:0,func:function(){BX.unbind(window,"beforeunload",this.sendCommentAsReadData.func);BX.removeCustomEvent(window,"onHidePageBefore",this.sendCommentAsReadData.func);this.sendCommentAsReadData.timeoutId=0;BX.ajax.runComponentAction(this.ajax.componentName,"readComment",{mode:"class",data:{ID:this.sendCommentAsReadData.mid},signedParameters:this.ajax.params})}.bind(this)}}if(this.sendCommentAsReadData.mid>t){return}this.sendCommentAsReadData.mid=t;if(this.sendCommentAsReadData.timeoutId<=0){BX.bind(window,"beforeunload",this.sendCommentAsReadData.func);BX.addCustomEvent(window,"onHidePageBefore",this.sendCommentAsReadData.func);this.sendCommentAsReadData.timeoutId=setTimeout(this.sendCommentAsReadData.func,6e3)}},markCommentAsBlank:function(t){if(!this.blankComments.has(t)){return}var e=this.blankComments.get(t);var i=e.parentNode;if(i&&!i.bxwaiter){fcShowWait(i)}this.blankComments.delete(t);scrSpy.unset([this.getXmlId(),t].join("-"));this.blankCommentsForAjax.set(t,e);setTimeout(this.sendCommentAsBlank,1e3)},sendCommentAsBlank:function(){if(this.ajax["getComment"]!==true||this.blankCommentsForAjax.size<=0){return}var t=Array.from(this.blankCommentsForAjax.keys());var e=new Map(this.blankCommentsForAjax);this.blankCommentsForAjax.clear();var i=function(t){e.forEach(function(e,i){fcCloseWait(e.parentNode);var n=t["messageList"][i];if(!n){e.parentNode.removeChild(e)}else{var s=BX.processHTML(n["message"],false);e.innerHTML=s.HTML;var o=function(t){if(e.childNodes.length>0){BX.ajax.processScripts(s.SCRIPT)}else if(t<100){setTimeout(o,500,t+1)}};o(0)}}.bind(this))}.bind(this);BX.ajax.runComponentAction(this.ajax.componentName,"getComment",{mode:"class",data:{sessid:BX.bitrix_sessid(),MODE:"RECORDS",NOREDIRECT:"Y",AJAX_POST:"Y",FILTER:{ID:t},ACTION:"GET",ID:t,ENTITY_XML_ID:this.ENTITY_XML_ID,OPERATION_ID:this.getOperationId(),EXEMPLAR_ID:this.exemplarId,scope:this.scope},signedParameters:this.ajax.params}).then(i,i)},getTemplate:function(){return this.template},showWait:function(t){fcShowWait(BX("record-"+this.ENTITY_XML_ID+"-"+t+"-actions"))},closeWait:function(t){fcCloseWait(BX("record-"+this.ENTITY_XML_ID+"-"+t+"-actions")||null)}};window.FCList.getQuoteData=function(){return quoteData};window.FCList.getInstance=function(t,e){if(!repo.listByXmlId.has(t["ENTITY_XML_ID"])&&e!==undefined){new window.FCList(t,e)}return repo.listByXmlId.get(t["ENTITY_XML_ID"])};var lastWaitElement=null;var fcShowWait=function(t){if(t&&!BX.type.isElementNode(t)){t=null}t=t||this;if(BX.type.isElementNode(t)){BX.defer((function(){t.disabled=true}))();var e=BX.findParent(t,BX.is_relative);t.bxwaiter=(e||document.body).appendChild(BX.create("DIV",{props:{className:"feed-com-loader"},style:{position:"absolute"}}));lastWaitElement=t;return t.bxwaiter}return true};var fcCloseWait=function(t){if(t&&!BX.type.isElementNode(t)){t=null}t=t||lastWaitElement||this;if(BX.type.isElementNode(t)){if(t.bxwaiter&&t.bxwaiter.parentNode){t.bxwaiter.parentNode.removeChild(t.bxwaiter);delete t.bxwaiter}t.disabled=false;if(lastWaitElement==t)lastWaitElement=null}};var fcShowActions=function(t,e,i){var n=[];var s=BX.util.getRandomString(20);if(i.getAttribute("bx-mpl-view-show")=="Y"){n.push({text:BX.message("MPL_MES_HREF"),href:i.getAttribute("bx-mpl-view-url").replace(/\\#(.+)$/gi,"")+"#com"+e,target:"_top"});n.push({html:'<span id="record-popup-'+s+'-link-text">'+BX.message("B_B_MS_LINK")+"</span>"+'<span id="record-popup-'+s+'-link-icon-animate" class="comment-menu-link-icon-wrap">'+'<span class="comment-menu-link-icon" id="record-popup-'+s+'-link-icon-done" style="display: none;">'+"</span>"+"</span>",onclick:function(){var t="record-popup-"+s+"-link",n=i.getAttribute("bx-mpl-view-url").replace(/#(.+)$/gi,"")+"#com"+e,o=BX(t+"-text"),a=BX(t+"-icon-done");n=(n.indexOf("http")<0?location.protocol+"//"+location.host:"")+n;if(BX.clipboard.isCopySupported()){if(o&&o.getAttribute("data-block-click")=="Y"){return}BX.clipboard.copy(n);if(o&&a){a.style.display="inline-block";BX.removeClass(BX(t+"-icon-animate"),"comment-menu-link-icon-animate");BX.adjust(BX(t+"-text"),{attrs:{"data-block-click":"Y"}});setTimeout((function(){BX.addClass(BX(t+"-icon-animate"),"comment-menu-link-icon-animate")}),1);setTimeout((function(){BX.adjust(BX(t+"-text"),{attrs:{"data-block-click":"N"}})}),500)}return}var r=BX.proxy_context;var d=parseInt(!!r.getAttribute("bx-height")?r.getAttribute("bx-height"):r.offsetHeight);if(r.getAttribute("bx-status")!="shown"){r.setAttribute("bx-status","shown");if(!BX(t)&&!!BX(t+"-text")){var l=BX(t+"-text"),h=BX.pos(l),m=BX.pos(l.parentNode),c=BX.findChildren(l.parentNode.parentNode.parentNode,{className:"menu-popup-item-text"},true);h["height"]=m["height"]-1;if(c){var u=0,p;for(var E=0;E<c.length;E++){p=BX.pos(c[E]);u=Math.max(u,p["width"])}m["width"]=u}BX.adjust(r,{attrs:{"bx-height":r.offsetHeight},style:{overflow:"hidden",display:"block"},children:[BX.create("BR"),BX.create("DIV",{attrs:{id:t},children:[BX.create("SPAN",{attrs:{className:"menu-popup-item-left"}}),BX.create("SPAN",{attrs:{className:"menu-popup-item-icon"}}),BX.create("SPAN",{attrs:{className:"menu-popup-item-text"},children:[BX.create("INPUT",{attrs:{id:t+"-input",type:"text",value:n},style:{height:m["height"]+"px",width:m["width"]+"px"},events:{click:function(t){this.select();t.preventDefault()}}})]})]}),BX.create("SPAN",{className:"menu-popup-item-right"})]})}new BX["fx"]({time:.2,step:.05,type:"linear",start:d,finish:d*2,callback:BX.delegate((function(t){this.style.height=t+"px"}),r)}).start();BX.fx.show(BX(t),.2);BX(t+"-input").select()}else{r.setAttribute("bx-status","hidden");new BX["fx"]({time:.2,step:.05,type:"linear",start:r.offsetHeight,finish:d,callback:BX.delegate((function(t){this.style.height=t+"px"}),r)}).start();BX.fx.hide(BX(t),.2)}}})}if(i.getAttribute("bx-mpl-edit-show")=="Y"){n.push({text:BX.message("BPC_MES_EDIT"),onclick:function(){BX.onCustomEvent(t,"onAct",[i.getAttribute("bx-mpl-edit-url"),e,"EDIT"]);this.popupWindow.close();return false}})}if(i.getAttribute("bx-mpl-moderate-show")=="Y"){var o=i.getAttribute("bx-mpl-moderate-approved")=="hidden";n.push({text:o?BX.message("BPC_MES_SHOW"):BX.message("BPC_MES_HIDE"),onclick:function(){var n=i.getAttribute("bx-mpl-moderate-url").replace("#action#",o?"show":"hide").replace("#ACTION#",o?"SHOW":"HIDE");if(BX.type.isNotEmptyString(n)){n=BX.util.add_url_param(n,{b24statAction:o?"showComment":"hideComment"})}BX.onCustomEvent(t,"onAct",[n,e,o?"SHOW":"HIDE"]);this.popupWindow.close()}})}if(i.getAttribute("bx-mpl-delete-show")=="Y"){n.push({text:BX.message("BPC_MES_DELETE"),onclick:function(){if(window.confirm(BX.message("BPC_MES_DELETE_POST_CONFIRM"))){BX.onCustomEvent(t,"onAct",[i.getAttribute("bx-mpl-delete-url"),e,"DELETE"])}this.popupWindow.close();return false}})}var a=i.getAttribute("bx-mpl-post-entity-xml-id");if(i.getAttribute("bx-mpl-edit-show")=="Y"&&BX.Tasks&&BX.Tasks.ResultAction&&a.indexOf("TASK_")===0&&BX.Tasks.ResultAction.getInstance().canCreateResult(+/\d+/.exec(a))){var r=+/\d+/.exec(a);var d=BX.Tasks.ResultManager.getInstance().getResult(r);if(d&&d.context==="task"&&d.canUnsetAsResult&&d.canUnsetAsResult(parseInt(e,10))){n.push({text:BX.message("BPC_MES_DELETE_TASK_RESULT"),onclick:function(){BX.Tasks.ResultAction.getInstance().deleteFromComment(e);this.popupWindow.close();return false}})}else if(d&&d.context==="task"&&d.canSetAsResult&&d.canSetAsResult(parseInt(e,10))){n.push({text:BX.message("BPC_MES_CREATE_TASK_RESULT"),onclick:function(){BX.Tasks.ResultAction.getInstance().createFromComment(e);this.popupWindow.close();return false}})}}if(i.getAttribute("bx-mpl-createtask-show")==="Y"&&!BX.type.isUndefined(BX.Livefeed)){var l=i.getAttribute("bx-mpl-comment-entity-type");var h=i.getAttribute("bx-mpl-post-entity-type");n.push({text:BX.message("BPC_MES_CREATE_TASK"),onclick:function(){BX.Livefeed.TaskCreator.create({postEntityType:BX.type.isNotEmptyString(h)?h:"BLOG_POST",entityType:BX.type.isNotEmptyString(l)?l:"BLOG_COMMENT",entityId:e});this.popupWindow.close();return false}})}if(i.getAttribute("bx-mpl-createsubtask-show")==="Y"&&!BX.type.isUndefined(BX.Livefeed)){var m=i.getAttribute("bx-mpl-post-entity-xml-id");var c=m.match(/^TASK_(\d+)$/i);if(c){n.push({text:BX.message("BPC_MES_CREATE_SUBTASK"),onclick:function(){BX.Livefeed.TaskCreator.create({postEntityType:h,entityType:l,entityId:e,parentTaskId:parseInt(c[1])});this.popupWindow.close();return false}})}}if(n.length>0){for(var u in n){if(n.hasOwnProperty(u)){n[u]["className"]="blog-comment-popup-menu"}}var p={offsetLeft:-18,offsetTop:2,lightShadow:false,angle:{position:"top",offset:50},events:{onPopupClose:function(){this.destroy();BX.PopupMenu.Data["action-"+s]=null}}};BX.onCustomEvent("OnUCCommentActionsShown",[t,e,n,p]);BX.PopupMenu.show("action-"+s,i,n,p)}};var fcCommentExpand=function(t){BX.UI.Animations.expand({moreButtonNode:t,type:"comment",classBlock:"feed-com-block",classOuter:"feed-com-text-inner",classInner:"feed-com-text-inner-inner",heightLimit:200,callback:function(t){BX.onCustomEvent(window,"OnUCRecordWasExpanded",[t]);t.classList.add("feed-com-text-inner-expanded");var e=t.getAttribute("bx-content-view-xml-id");if(BX.type.isNotEmptyString(e)){BX.onCustomEvent(window,"OnUCFeedChanged",[e.split("-")])}}})};window["fcParseTemplate"]=function(t,e,i){e=e||{};e["RIGHTS"]=e["RIGHTS"]||{};for(var n=0,s=["MODERATE","EDIT","DELETE"];n<s.length;n++){e["RIGHTS"][s[n]]=BX.util.in_array(e["RIGHTS"][s[n]],["Y","ALL","OWN","OWNLAST"])?e["RIGHTS"][s[n]]:"N"}e["DATE_TIME_FORMAT"]=!!e["DATE_TIME_FORMAT"]?e["DATE_TIME_FORMAT"]:"d F Y G:i";e["TIME_FORMAT"]=!!e["DATE_TIME_FORMAT"]&&e["DATE_TIME_FORMAT"].indexOf("a")>=0?"g:i a":"G:i";e["VIEW_URL"]=e["VIEW_URL"]||"";e["EDIT_URL"]=e["EDIT_URL"]||"";e["MODERATE_URL"]=e["MODERATE_URL"]||"";e["DELETE_URL"]=e["DELETE_URL"]||"";e["AUTHOR_URL"]=e["AUTHOR_URL"]||"";e["NAME_TEMPLATE"]=e["NAME_TEMPLATE"]||"";e["SHOW_LOGIN"]=e["SHOW_LOGIN"]||"";var o=t&&t["messageFields"]?t["messageFields"]:t;var a={ID:"",FULL_ID:"",CONTENT_ID:"",ENTITY_XML_ID:"",EXEMPLAR_ID:"",NEW:"old",APPROVED:"Y",DATE:"",TEXT:"",CLASSNAME:"",VIEW_URL:"",VIEW_SHOW:"N",EDIT_URL:"",EDIT_SHOW:"N",MODERATE_URL:"",MODERATE_SHOW:"N",DELETE_URL:"",DELETE_SHOW:"N",CREATETASK_SHOW:"N",BEFORE_HEADER:"",BEFORE_ACTIONS:"",AFTER_ACTIONS:"",AFTER_HEADER:"",BEFORE:"",AFTER:"",BEFORE_RECORD:"",AFTER_RECORD:"",AUTHOR_ID:0,AUTHOR_AVATAR_IS:"N",AUTHOR_AVATAR:"",AUTHOR_URL:"",AUTHOR_NAME:"",AUTHOR_EXTRANET_STYLE:"",SHOW_POST_FORM:"Y",SHOW_MENU:"Y",VOTE_ID:"",AUTHOR_TOOLTIP_PARAMS:"","background:url('') no-repeat center;":"",LIKE_REACT:"",RATING_NONEMPTY_CLASS:""};if(!!o&&!!t["messageFields"]){o["AUTHOR"]=!!o["AUTHOR"]?o["AUTHOR"]:{};var r=parseInt(o["POST_TIMESTAMP"])+parseInt(BX.message("USER_TZ_OFFSET"))+parseInt(BX.message("SERVER_TZ_OFFSET"));var d=[["today",e["TIME_FORMAT"]],["yesterday",e["TIME_FORMAT"].indexOf("yesterday")<0?"yesterday, "+e["TIME_FORMAT"]:e["TIME_FORMAT"]],["",e["DATE_TIME_FORMAT"]]];var l="";if(!BX.Type.isUndefined(o["AUTHOR"]["TYPE"])){if(o["AUTHOR"]["TYPE"]==="EMAIL"){l=" feed-com-name-email"}else if(o["AUTHOR"]["TYPE"]==="EXTRANET"){l=" feed-com-name-extranet"}}else if(o["AUTHOR"]["IS_EXTRANET"]=="Y"){l=" feed-com-name-extranet"}var h=o["POST_MESSAGE_TEXT"].replace(/\001/gi,"").replace(/#/gi,"\x01");o.AUX_LIVE_PARAMS=BX.type.isPlainObject(o.AUX_LIVE_PARAMS)?o.AUX_LIVE_PARAMS:{};if(!!o.AUX&&(BX.util.in_array(o.AUX,["createentity","createtask","fileversion"])||o.AUX==="TASKINFO"&&BX.type.isNotEmptyObject(o.AUX_LIVE_PARAMS))){h=BX.CommentAux.getLiveText(o.AUX,o.AUX_LIVE_PARAMS)}a={ID:o["ID"],FULL_ID:o["FULL_ID"].join("-"),CONTENT_ID:o["RATING"]&&o["RATING"]["ENTITY_TYPE_ID"]&&o["RATING"]["ENTITY_ID"]?o["RATING"]["ENTITY_TYPE_ID"]+"-"+o["RATING"]["ENTITY_ID"]:"",ENTITY_XML_ID:o["ENTITY_XML_ID"],EXEMPLAR_ID:e["EXEMPLAR_ID"],NEW:o["NEW"]=="Y"?"new":"old",APPROVED:o["APPROVED"]!="Y"?"hidden":"approved",DATE:BX.date.format(d,r,parseInt(Date.now()/1e3)+parseInt(BX.message("USER_TZ_OFFSET"))+parseInt(BX.message("SERVER_TZ_OFFSET")),true),TEXT:h,CLASSNAME:(o["CLASSNAME"]?" "+o["CLASSNAME"]:"")+(BX.type.isNotEmptyString(e["CLASSNAME"])?" "+e["CLASSNAME"]:""),VIEW_URL:e["VIEW_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]),VIEW_SHOW:e["VIEW_URL"]!==""?"Y":"N",EDIT_URL:e["EDIT_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]),EDIT_SHOW:(!o.AUX||o.AUX.length<=0)&&(e["RIGHTS"]["EDIT"]=="Y"||e["RIGHTS"]["EDIT"]=="ALL"||e["RIGHTS"]["EDIT"]=="OWN"&&BX.message("USER_ID")==o["AUTHOR"]["ID"])?"Y":"N",MODERATE_URL:e["MODERATE_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]),MODERATE_SHOW:e["RIGHTS"]["MODERATE"]=="Y"||e["RIGHTS"]["MODERATE"]=="ALL"||e["RIGHTS"]["MODERATE"]=="OWN"&&BX.message("USER_ID")==o["AUTHOR"]["ID"]?"Y":"N",DELETE_URL:e["DELETE_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]),DELETE_SHOW:(!o["CAN_DELETE"]||o["CAN_DELETE"]==="Y")&&(e["RIGHTS"]["DELETE"]=="Y"||e["RIGHTS"]["DELETE"]=="ALL"||e["RIGHTS"]["DELETE"]=="OWN"&&BX.message("USER_ID")==o["AUTHOR"]["ID"]?"Y":"N"),CREATETASK_SHOW:(!o.AUX||o.AUX.length<=0)&&e["RIGHTS"]["CREATETASK"]=="Y"?"Y":"N",CREATESUBTASK_SHOW:(!o.AUX||o.AUX.length<=0)&&BX.type.isNotEmptyString(e.RIGHTS.CREATESUBTASK)&&e.RIGHTS.CREATESUBTASK==="Y"?"Y":"N",BEFORE_HEADER:o["BEFORE_HEADER"],BEFORE_ACTIONS:o["BEFORE_ACTIONS"],AFTER_ACTIONS:o["AFTER_ACTIONS"],AFTER_HEADER:o["AFTER_HEADER"],BEFORE:o["BEFORE"],AFTER:o["AFTER"],BEFORE_RECORD:o["BEFORE_RECORD"],AFTER_RECORD:o["AFTER_RECORD"],AUTHOR_ID:o["AUTHOR"]["ID"],AUTHOR_AVATAR_IS:!!o["AUTHOR"]["AVATAR"]?"Y":"N",AUTHOR_AVATAR:!!o["AUTHOR"]["AVATAR"]?o["AUTHOR"]["AVATAR"]:"/bitrix/images/1.gif",AUTHOR_AVATAR_BG:!!o["AUTHOR"]["AVATAR"]?"background-image:url('"+o["AUTHOR"]["AVATAR"]+"')":"",AUTHOR_URL:e["AUTHOR_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]).replace("#USER_ID#",o["AUTHOR"]["ID"]).replace("#user_id#",o["AUTHOR"]["ID"])+(!BX.Type.isUndefined(o["AUTHOR"]["EXTERNAL_AUTH_ID"])&&o["AUTHOR"]["EXTERNAL_AUTH_ID"]==="email"&&!BX.Type.isUndefined(e["AUTHOR_URL_PARAMS"])?(e["AUTHOR_URL"].indexOf("?")>=0?"&":"?")+"entityType="+e["AUTHOR_URL_PARAMS"]["entityType"]+"&entityId="+e["AUTHOR_URL_PARAMS"]["entityId"]:""),AUTHOR_NAME:BX.formatName(o["AUTHOR"],e["NAME_TEMPLATE"],e["SHOW_LOGIN"]),AUTHOR_EXTRANET_STYLE:l,VOTE_ID:o["RATING"]&&o["RATING"]["VOTE_ID"]?o["RATING"]["VOTE_ID"]:"",AUTHOR_PERSONAL_GENDER:BX.type.isNotEmptyString(o["AUTHOR"]["PERSONAL_GENDER"])?o["AUTHOR"]["PERSONAL_GENDER"]:"",AUTHOR_TOOLTIP_PARAMS:!BX.Type.isUndefined(o["AUTHOR_TOOLTIP_PARAMS"])?o["AUTHOR_TOOLTIP_PARAMS"]:"{}","background:url('') no-repeat center;":"",LIKE_REACT:!!o["LIKE_REACT"]?o["LIKE_REACT"]:"",RATING_NONEMPTY_CLASS:o["RATING"]&&o["RATING"]["TOTAL_VOTES"]?"comment-block-rating-nonempty":"",POST_ENTITY_TYPE:!!e["POST_CONTENT_TYPE_ID"]?e["POST_CONTENT_TYPE_ID"]:"",COMMENT_ENTITY_TYPE:!!e["COMMENT_CONTENT_TYPE_ID"]?e["COMMENT_CONTENT_TYPE_ID"]:""}}else{for(n in a){if(a.hasOwnProperty(n)){a[n]=!!t[n]?t[n]:a[n]}}}for(n in a){if(a.hasOwnProperty(n)){a[n]=!!a[n]?a[n]:""}}a["SHOW_POST_FORM"]=BX("record-"+a["ENTITY_XML_ID"]+"-0-placeholder")?"Y":"N";for(var m in a){if(a.hasOwnProperty(m)){i=i.replace(new RegExp("#"+m+"#","g"),function(){return a[this]}.bind(m))}}return i.replace("background:url('') no-repeat center;","").replace(/\001/gi,"#")};window["fcPull"]=function(t,e){BX.ajax({url:"/bitrix/components/bitrix/main.post.list/templates/.default/component_epilog.php",method:"POST",data:{AJAX_POST:"Y",ENTITY_XML_ID:t,MODE:"PUSH&PULL",sessid:BX.bitrix_sessid(),DATA:e}})};var MPLQuote=function(){this.closeByEsc=true;this.autoHide=true;this.autoHideTimeout=5e3;this.node=document.createElement("A");BX.adjust(this.node,{style:{zIndex:BX.PopupWindow.getOption("popupZindex")+1,position:"absolute",display:"none",top:"0px",left:"0px"},attrs:{className:"mpl-quote-block",href:"#"},events:{click:this.fire.bind(this)}});this.checkEsc=this.checkEsc.bind(this);this.hide=this.hide.bind(this);document.body.appendChild(this.node)};MPLQuote.prototype={show:function(t){var e=this.getPosition(this.node,t);BX.adjust(this.node,{style:{top:e.y+"px",left:e.x+"px",display:"block"}});BX.addClass(this.node,"mpl-quote-block-show");if(this.closeByEsc&&this.closeByEscBound!==true){this.closeByEscBound=true;BX.bind(document,"keyup",this.checkEsc)}if(this.autoHide&&this.autoHideBound!==true){this.autoHideBound=true;setTimeout(function(){BX.bind(document,"click",this.hide)}.bind(this),10)}if(this.autoHideTimeoutPointer>0){clearTimeout(this.autoHideTimeoutPointer);this.autoHideTimeoutPointer=0}if(this.autoHideTimeout>0&&this.autoHideTimeoutBound!==true){this.autoHideTimeoutBound=true;this.autoHideTimeoutPointer=setTimeout(this.hide,this.autoHideTimeout)}},fire:function(t){t.preventDefault();if(!this.isShown()){return}if(t&&!(BX.getEventButton(t)&BX.MSLEFT)){return}this.cancelBubble(t);this.node.style.display="none";BX.onCustomEvent(this,"onQuote",[t,this]);setTimeout(this.hide,50);return false},hide:function(){BX.unbind(document,"keyup",this.checkEsc);this.closeByEscBound=false;BX.unbind(document,"click",this.hide);this.autoHideBound=false;if(this.autoHideTimeoutPointer>0){clearTimeout(this.autoHideTimeoutPointer)}this.autoHideTimeoutPointer=0;this.autoHideTimeoutBound=false;BX.onCustomEvent(this,"onHide",[this]);BX.remove(this.node)},getPosition:function(t,e){var i;if(e.pageX==null){var n=document.documentElement,s=document.body;var o=e.clientX+(n&&n.scrollLeft||s&&s.scrollLeft||0)-(n.clientLeft||0);var a=e.clientY+(n&&n.scrollTop||s&&s.scrollTop||0)-(n.clientTop||0);i={x:o,y:a}}else{i={x:e.pageX,y:e.pageY}}return{x:i.x+5,y:i.y-16}},isShown:function(){return this.node.style.display==="block"},cancelBubble:function(t){if(!t){t=window.event}if(t.stopPropagation){t.stopPropagation()}else{t.cancelBubble=true}},checkEsc:function(t){t=t||window.event;if(t.keyCode==27){this.hide(t)}}};var checkEntitiesActuality=function(t){var e=repo.listById.values();var i=e.next();while(i.done!==true){if(i.value.getXmlId()===t&&!document.body.contains(i.value.node.main)){BX.onCustomEvent(window,"OnUCInitialized",[i.value.getId()])}i=e.next()}};var getActiveEntitiesByXmlId=function(t){checkEntitiesActuality(t);var e=repo.listById.values();var i=e.next();var n=new Map;while(i.done!==true){if(i.value.getXmlId()===t){n.set(i.value.getId(),i.value)}i=e.next()}return n};window.mplCheckForQuote=function(t,e,i,n){t=document.all?window.event:t;var s="",o,a=null;if(window.getSelection){o=window.getSelection();s=o.toString()}else if(document.selection){o=document.selection;s=o.createRange().text}if(s.length<=0){return}var r=BX.findParent(o.focusNode,{tagName:e.tagName,className:e.className},e),d=BX.findParent(o.anchorNode,{tagName:e.tagName,className:e.className},e);if(r!==d||r!==e){return}var l=getActiveEntitiesByXmlId(i);if(l.size<=0){return}if(n&&BX(n,true)){var h=BX(n,true);if(h&&h.hasAttribute("bx-post-author-id")){a={id:parseInt(h.getAttribute("bx-post-author-id")),gender:h.getAttribute("bx-post-author-gender"),name:h.innerHTML}}}var m=null;if(e.__boundXmlCheckQuote===true){m=repo.listById.get(e.__boundXmlEntityId)||null}if(m===null){e.__boundXmlCheckQuote=true;var c=e;while(c){l.forEach((function(t,e){if(m===null&&c.contains(t.node.main)){m=t;return true}}));if(m!==null){break}c=c.parentNode}if(m===null){m=l.values().next().value}e.__boundXmlEntityId=m.getId();BX.addCustomEvent(window,"OnUCHasBeenDestroyed",(function(t,i){if(i.getId()===e.__boundXmlEntityId){delete e.__boundXmlEntityId;delete e.__boundXmlCheckQuote}}))}if(m!==null){BX.onCustomEvent(m.eventNode,"onQuote",[t,{text:s,author:a}])}};window.mplReplaceUserPath=function(t){if(!BX.Type.isStringFilled(t)){return""}if(BX("MPL_IS_EXTRANET_SITE")==="Y"){t=t.replace("/company/personal/user/","/extranet/contacts/personal/user/")}else{t=t.replace("/extranet/contacts/personal/user/","/company/personal/user/")}t=t.replace(new RegExp("[\\w/]*/mobile/users/\\?user_id=(\\d+)","igm"),BX("MPL_IS_EXTRANET_SITE")=="Y"?"/extranet/contacts/personal/user/$1/":"/company/personal/user/$1/");return t};BX.addCustomEvent(window,"BX.Livefeed:recalculateComments",(function(t){if(!BX.type.isPlainObject(t)||!BX.type.isDomNode(t.rootNode)){return}var e=t.rootNode.querySelectorAll(".feed-comments-block");var i=null;for(var n=0;n<e.length;n++){i=e[n].getAttribute("data-bx-comments-entity-xml-id");if(BX.type.isNotEmptyString(i)){BX.onCustomEvent(window,"OnUCCommentRecalculate",[i])}}}));BX.addCustomEvent(window,"BX.Forum.Spoiler:toggle",(function(t){if(!t.node){return}var e=BX.findParent(t.node,{attrs:{"bx-mpl-block":"main"}});if(e){BX.onCustomEvent(e,"onForumSpoilerToggle",[e.getAttribute("bx-mpl-entity-id")])}}));var ScreenSpy=function(){this.timeoutSec=2e3;this.check=this.check.bind(this);this.change=this.change.bind(this);this.scroll=this.scroll.bind(this);this.nodes=new Map;this.timeout=0;this.ready=true;this.window=BX.GetWindowInnerSize();this.screen={top:this.window.scrollTop,bottom:this.window.scrollTop+this.window.innerHeight};this.watchDimensionNodes=new WeakMap};ScreenSpy.prototype={watchNode:function(t){if(!this.watchDimensionNodes.has(t)){this.watchDimensionNodes.set(t,false);BX.bind(t,"click",this.check)}},set:function(t,e){this.nodes.set(t,e);this.start()},unset:function(t){this.nodes.delete(t);if(this.nodes.size<=0){this.stop()}},start:function(){if(this.ready!==true){return}this.ready=false;BX.bind(window,"resize",this.change);BX.bind(window,"scroll",this.scroll);this.scroll()},stop:function(){if(this.timeout>0){clearTimeout(this.timeout)}this.timeout=0;BX.unbind(window,"resize",this.change);BX.unbind(window,"scroll",this.scroll);this.ready=true},check:function(){this.timeout=0;var t=BX.GetWindowScrollPos();if(this.screen.bottom>t.scrollTop){var e={top:t.scrollTop,bottom:this.screen.bottom};BX.onCustomEvent(this,"onRead",[e])}if(this.screen.top!==t.scrollTop){this.scroll()}},change:function(){this.window=BX.GetWindowInnerSize()},scroll:function(){if(this.timeout<=0){var t=BX.GetWindowScrollPos();this.screen={top:t.scrollTop,bottom:t.scrollTop+this.window.innerHeight};this.timeout=setTimeout(this.check,this.timeoutSec)}}};var scrSpy=new ScreenSpy;BX.ready((function(){BX.addCustomEvent(window,"onPullEvent-unicomments",(function(t,e){if(e["AUX"]&&!BX.util.in_array(e["AUX"].toLowerCase(),BX.CommentAux.getLiveTypesList())||getActiveEntitiesByXmlId(e["ENTITY_XML_ID"]).size<=0){return}if(t==="comment"){if(e["NEED_REQUEST"]==="Y"){if(e["URL"]["LINK"].indexOf("#GROUPS_PATH#")>=0&&!!BX.message("MPL_WORKGROUPS_PATH")){e["URL"]["LINK"]=e["URL"]["LINK"].replace("#GROUPS_PATH#",BX.message("MPL_WORKGROUPS_PATH"))}var i=BX.ajax.prepareData({AJAX_POST:"Y",ENTITY_XML_ID:e["ENTITY_XML_ID"],MODE:"RECORD",FILTER:{ID:e["ID"]},sessid:BX.bitrix_sessid()});var n=e["URL"]["LINK"];n=n.indexOf("#")!==-1?n.substr(0,n.indexOf("#")):n;BX.ajax({url:n+(n.indexOf("?")!==-1?"&":"?")+i,method:"GET",dataType:"json",data:"",onsuccess:function(t){BX.onCustomEvent(window,"OnUCCommentWasPulled",[[e["ENTITY_XML_ID"],e["ID"]],t,e])}})}else if(e["ACTION"]==="DELETE"){BX.onCustomEvent(window,"OnUCommentWasDeleted",[e["ENTITY_XML_ID"],[e["ENTITY_XML_ID"],e["ID"]],e]);BX.onCustomEvent(window,"OnUCFeedChanged",[e["ID"]])}else if(e["ACTION"]==="HIDE"){BX.onCustomEvent(window,"OnUCommentWasHidden",[e["ENTITY_XML_ID"],[e["ENTITY_XML_ID"],e["ID"]],e]);BX.onCustomEvent(window,"OnUCFeedChanged",[e["ID"]])}else{if(e["ACTION"]==="REPLY"){e["NEW"]=!e["AUTHOR"]||e["AUTHOR"]["ID"]!=BX.message("USER_ID")?"Y":"N"}BX.onCustomEvent(window,"OnUCCommentWasPulled",[[e["ENTITY_XML_ID"],e["ID"]],{messageFields:e},e])}}else if(t==="answer"&&Number(e["USER_ID"])!==Number(BX.message("USER_ID"))){BX.onCustomEvent(window,"OnUCUsersAreWriting",[e["ENTITY_XML_ID"],e["USER_ID"],e["NAME"],e["AVATAR"]])}}));BX.addCustomEvent(window,"OnUCUserReply",(function(t,e,i){var n=getActiveEntitiesByXmlId(t);if(n.size<=0){return}n.values().next().value.reply({id:e,name:i})}))}));BX.onCustomEvent("main.post.list/default",[])})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:99:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form.min.js?169925794912332";s:6:"source";s:79:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form.js";s:3:"min";s:83:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form.min.js";s:3:"map";s:83:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form.map.js";}"*/
(function(){window["UC"]=window["UC"]||{};if(!!window["FCForm"])return;window.FCForm=function(e){this.url="";this.lhe="";this.entitiesId={};this.form=BX(e["formId"]);this.handler=window.LHEPostForm.getHandler(e["editorId"]);this.editorName=e["editorName"];this.editorId=e["editorId"];this.windowEvents={OnUCUnlinkForm:BX.delegate(function(e){if(!!e&&!!this.entitiesId[e]){var t={},i=true;for(var s in this.entitiesId){if(this.entitiesId.hasOwnProperty(s)&&s!=e){i=false;t[s]=this.entitiesId[s]}}this.entitiesId=t;if(i&&!!this.windowEvents){for(s in this.windowEvents){if(this.windowEvents.hasOwnProperty(s)&&s)BX.removeCustomEvent(window,s,this.windowEvents[s])}this.windowEventsSet=false}}},this),OnUCQuote:BX.delegate(function(e,t,i){if(!this.entitiesId[e]||!this._checkTextSafety([e,0])){return}this.show([e,0]);var s=0;var n=function(){s++;if(s>10){return}if(!this.handler.oEditor||!this.handler.oEditor.action){return setTimeout(n,10)}if(!this.handler.oEditor.toolbar.controls.Quote){return}if(!t&&!i){return this.handler.oEditor.action.Exec("quote")}var e="";if(t){e=t.gender?BX.message("MPL_HAVE_WRITTEN_"+t.gender):BX.message("MPL_HAVE_WRITTEN");if(this.handler.oEditor.GetViewMode()==="wysiwyg"){if(t.id>0){t='<span id="'+this.handler.oEditor.SetBxTag(false,{tag:"postuser",userId:t.id,userName:t.name})+'" class="bxhtmled-metion">'+t.name.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")+"</span>"}else{t="<span>"+t.name.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")+"</span>"}e=t+e+"<br/>"}else if(this.handler.oEditor.bbCode){if(t.id>0){t="[USER="+t.id+"]"+t.name+"[/USER]"}else{t=t.name}e=t!==""?t+e+"\n":""}}if(this.handler.oEditor.action.actions.quote.setExternalSelectionFromRange){this.handler.oEditor.action.actions.quote.setExternalSelectionFromRange();var o=this.handler.oEditor.action.actions.quote.getExternalSelection();if(o===""&&i!==""){o=i}o=e+o;if(BX.type.isNotEmptyString(o)){this.handler.oEditor.action.actions.quote.setExternalSelection(o)}}else{this.handler.oEditor.action.actions.quote.setExternalSelection(i)}this.handler.oEditor.action.Exec("quote")}.bind(this);this.handler.exec(n)},this),OnUCReply:function(e,t,i,s,n){if(!this.entitiesId[e]||!this._checkTextSafety([e,0])||n.caught===true){return false}n.caught=true;this.show([e,0]);if(t>0){this.handler.exec(window.BxInsertMention,[{item:{entityId:t,name:i},type:"user",formID:this.form.id,editorId:this.editorId,bNeedComa:true,insertHtml:true}])}}.bind(this),OnUCAfterRecordEdit:BX.delegate(function(e,t,i,s){if(!!this.entitiesId[e]){if(s==="EDIT"){this.show([e,t],i["messageBBCode"],i["messageFields"]);this.editing=true}else{this.hide(true);if(!!i["errorMessage"]){this.id=[e,t];this.showError(i["errorMessage"])}else if(!!i["okMessage"]){this.id=[e,t];this.showNote(i["okMessage"]);this.id=null}}}},this)};this.linkEntity(e["entitiesId"]);BX.remove(BX("micro"+e["editorName"]));BX.remove(BX("micro"+e["editorId"]));this.eventNode=this.handler.eventNode;if(this.eventNode){BX.addCustomEvent(this.eventNode,"OnBeforeHideLHE",BX.delegate(function(){BX.removeClass(document.documentElement,"bx-ios-fix-frame-focus");if(top&&top["document"])BX.removeClass(top["document"]["documentElement"],"bx-ios-fix-frame-focus");if(!!this.id&&!!BX("uc-writing-"+this.form.id+"-"+this.id[0]+"-area")){BX.hide(BX("uc-writing-"+this.form.id+"-"+this.id[0]+"-area"))}},this));BX.addCustomEvent(this.eventNode,"OnAfterHideLHE",BX.delegate(function(){var e=this._getPlacehoder();if(e){BX.hide(e)}e=this._getSwitcher();if(e){BX.show(e);BX.focus(e.firstChild)}this.__content_length=0;if(!!this.id){BX.onCustomEvent(this.eventNode,"OnUCFormAfterHide",[this])}clearTimeout(this._checkWriteTimeout);this._checkWriteTimeout=0;this.clear();BX.onCustomEvent(window,"OnUCFeedChanged",[this.id])},this));BX.addCustomEvent(this.eventNode,"OnBeforeShowLHE",BX.delegate(function(){if(BX.browser.IsIOS()&&BX.browser.IsMobile()){BX.addClass(window["document"]["documentElement"],"bx-ios-fix-frame-focus");if(top&&top["document"])BX.addClass(top["document"]["documentElement"],"bx-ios-fix-frame-focus")}var e=this._getPlacehoder();if(e){BX.removeClass(e,"feed-com-add-box-no-form");BX.removeClass(e,"feed-com-add-box-header");BX.show(e)}e=this._getSwitcher();if(e){BX.hide(e)}if(!!this.id&&!!BX("uc-writing-"+this.form.id+"-"+this.id[0]+"-area")){BX.hide(BX("uc-writing-"+this.form.id+"-"+this.id[0]+"-area"))}},this));BX.addCustomEvent(this.eventNode,"OnAfterShowLHE",function(e,t){this._checkWrite(e,t);BX.onCustomEvent(window,"OnUCFeedChanged",[this.id])}.bind(this));BX.addCustomEvent(this.eventNode,"OnClickSubmit",BX.delegate(this.submit,this));BX.addCustomEvent(this.eventNode,"OnClickCancel",BX.delegate(this.cancel,this));BX.onCustomEvent(this.eventNode,"OnUCFormInit",[this])}this.id=null;this.jsCommentId=null;BX.addCustomEvent(window,"OnImageDataUriHandle",BX.delegate(this.showWait,this));BX.addCustomEvent(window,"OnImageDataUriCaughtUploaded",BX.delegate(this.closeWait,this));BX.addCustomEvent(window,"OnImageDataUriCaughtFailed",BX.delegate(this.closeWait,this))};window.FCForm.prototype={linkEntity:function(e){if(!!e){for(var t in e){if(e.hasOwnProperty(t)){BX.onCustomEvent(window,"OnUCUnlinkForm",[t]);this.entitiesId[t]=e[t]}}}if(!this.windowEventsSet&&!!this.entitiesId){BX.addCustomEvent(window,"OnUCUnlinkForm",this.windowEvents.OnUCUnlinkForm);BX.addCustomEvent(window,"OnUCReply",BX.debounce(this.windowEvents.OnUCReply,10));BX.addCustomEvent(window,"OnUCQuote",BX.debounce(this.windowEvents.OnUCQuote,10));BX.addCustomEvent(window,"OnUCAfterRecordEdit",this.windowEvents.OnUCAfterRecordEdit);this.windowEventsSet=true}},_checkTextSafety:function(e){if(this.id&&this.id.join("-")!==e.join("-")&&this.handler.editorIsLoaded&&this.handler.oEditor.IsContentChanged()){return window.confirm(BX.message("MPL_SAFE_EDIT"))}return true},_checkWrite:function(){if(this.handler.editorIsLoaded&&this._checkWriteTimeout!==false){this.__content_length=this.__content_length>0?this.__content_length:0;var e=this.handler.oEditor.GetContent(),t=2e3;if(e.length>=4&&this.__content_length!=e.length&&!!this.id){BX.onCustomEvent(window,"OnUCUserIsWriting",[this.id[0],{sent:false}]);t=3e4}this._checkWriteTimeout=setTimeout(this._checkWrite.bind(this),t);this.__content_length=e.length}},_getPlacehoder:function(e){e=!!e?e:this.id;return!!e?BX("record-"+e.join("-")+"-placeholder"):null},_getSwitcher:function(e){e=!!e?e:this.id;return!!e?BX("record-"+e[0]+"-switcher"):null},hide:function(e){if(this.eventNode.style.display!="none"){BX.onCustomEvent(this.eventNode,"OnShowLHE",[e===true?false:"hide"])}if(e){document.body.appendChild(this.form)}},clear:function(){this.editing=false;var e=this._getPlacehoder();if(!!e)BX.hide(e);this.clearNotification(e,"feed-add-error");BX.onCustomEvent(this.eventNode,"OnUCFormClear",[this]);var t=BX.findChild(this.form,{className:"wduf-placeholder-tbody"},true,false);if(t!==null&&typeof t!="undefined")BX.cleanNode(t,false);t=BX.findChild(this.form,{className:"wduf-selectdialog"},true,false);if(t!==null&&typeof t!="undefined")BX.hide(t);t=BX.findChild(this.form,{className:"file-placeholder-tbody"},true,false);if(t!==null&&typeof t!="undefined")BX.cleanNode(t,false);this.id=null;this.jsCommentId=null},show:function(e,t,i){if(this.id&&!!e&&this.id.join("-")==e.join("-")){var s=this._getPlacehoder(e);this.handler.oEditor.Focus();setTimeout(function(){var e=BX.pos(s);var t=BX.GetWindowSize(document);if(t.scrollTop>e.top){s.scrollIntoView()}else if(t.scrollTop+t.innerHeight<e.top){s.scrollIntoView(false)}},100);return true}else{this.hide(true)}this.id=e;this.jsCommentId=BX.util.getRandomString(20);var n=this._getPlacehoder();BX.removeClass(n,"feed-com-add-box-no-form");BX.removeClass(n,"feed-com-add-box-header");n.appendChild(this.form);BX.onCustomEvent(this.eventNode,"OnUCFormBeforeShow",[this,t,i]);BX.onCustomEvent(this.eventNode,"OnShowLHE",["show",null,this.id]);BX.onCustomEvent(this.eventNode,"OnUCFormAfterShow",[this,t,i]);return true},submit:function(){if(this.busy===true)return"busy";var e=this.handler.editorIsLoaded?this.handler.oEditor.GetContent():"";if(!e){this.showError(BX.message("JERROR_NO_MESSAGE"));return false}this.showWait();this.busy=true;var t={};window.convertFormToArray(this.form,t);t["REVIEW_TEXT"]=e;t["NOREDIRECT"]="Y";t["MODE"]="RECORD";t["AJAX_POST"]="Y";t["id"]=this.id;if(this.jsCommentId!==null)t["COMMENT_EXEMPLAR_ID"]=this.jsCommentId;t["SITE_ID"]=BX.message("SITE_ID");t["LANGUAGE_ID"]=BX.message("LANGUAGE_ID");t["ACTION"]="ADD";if(this.editing===true){t["REVIEW_ACTION"]="EDIT";t["FILTER"]={ID:this.id[1]};t["ACTION"]="EDIT";t["ID"]=this.id[1]}BX.onCustomEvent(this.eventNode,"OnUCFormSubmit",[this,t]);BX.onCustomEvent(window,"OnUCFormSubmit",[this.id[0],this.id[1],this,t]);var i=this.form.action;i=BX.util.remove_url_param(i,["b24statAction"]);i=BX.util.add_url_param(i,{b24statAction:this.id[1]>0?"editComment":"addComment"});this.form.action=i;BX.ajax({method:"POST",url:this.form.action,data:t,dataType:"json",onsuccess:BX.proxy(function(e){this.closeWait();var t=e,i=this.id[0];BX.onCustomEvent(this.eventNode,"OnUCFormResponse",[this,e]);if(!!this.OnUCFormResponseData)e=this.OnUCFormResponseData;if(!!e){if(e["errorMessage"]){this.showError(e["errorMessage"])}else if(e["status"]=="error"){this.showError(BX.type.isNotEmptyString(e["message"])?e["message"]:"")}else{BX.onCustomEvent(window,"OnUCAfterRecordAdd",[this.id[0],e,t]);this.hide(true)}}this.busy=false;BX.onCustomEvent(window,"OnUCFormResponse",[i,e["messageId"],this,e])},this),onfailure:BX.delegate(function(){this.closeWait();this.busy=false;BX.onCustomEvent(window,"OnUCFormResponse",[this.id[0],this.id[1],this,[]])},this)})},cancel:function(){},clearNotification:function(e,t){var i=BX.findChildren(e,{tagName:"DIV",className:t},true);if(!!i){var s=i.pop();do{BX.remove(s);BX.remove(s)}while((s=i.pop())&&!!s)}},showError:function(e){if(!e)return;var t=this._getPlacehoder();this.clearNotification(t,"feed-add-error");BX.addClass(t,!t.firstChild?"feed-com-add-box-no-form":"feed-com-add-box-header");t.insertBefore(BX.create("div",{attrs:{class:"feed-add-error"},html:'<span class="feed-add-info-text"><span class="feed-add-info-icon"></span>'+"<b>"+BX.message("FC_ERROR")+"</b><br />"+e+"</span>"}),t.firstChild);BX.show(t)},showNote:function(e){if(!e)return;var t=this._getPlacehoder();this.clearNotification(t,"feed-add-error");this.clearNotification(t,"feed-add-successfully");BX.addClass(t,!t.firstChild?"feed-com-add-box-no-form":"feed-com-add-box-header");t.insertBefore(BX.create("div",{attrs:{class:"feed-add-successfully"},html:'<span class="feed-add-info-text"><span class="feed-add-info-icon"></span>'+e+"</span>"}),t.firstChild);BX.addClass(t,"comment-deleted");BX.show(t)},showWait:function(){var e=BX("lhe_button_submit_"+this.form.id);this.busy=true;if(!!e){BX.addClass(e,"ui-btn-clock");BX.defer(function(){e.disabled=true})()}},closeWait:function(){var e=BX("lhe_button_submit_"+this.form.id);this.busy=false;if(!!e){e.disabled=false;BX.removeClass(e,"ui-btn-clock")}}};window.convertFormToArray=function(e,t){t=!!t?t:[];if(!!e){var i,s=[],n=e.elements.length;for(i=0;i<n;i++){var o=e.elements[i];if(o.disabled)continue;switch(o.type.toLowerCase()){case"text":case"textarea":case"password":case"hidden":case"select-one":s.push({name:o.name,value:o.value});break;case"radio":case"checkbox":if(o.checked)s.push({name:o.name,value:o.value});break;case"select-multiple":for(var d=0;d<o.options.length;d++){if(o.options[d].selected)s.push({name:o.name,value:o.options[d].value})}break;default:break}}var r=t;i=0;while(i<s.length){var a=s[i].name.indexOf("[");if(a==-1){r[s[i].name]=s[i].value;r=t;i++}else{var h=s[i].name.substring(0,a);var l=s[i].name.substring(a+1);if(!r[h])r[h]=[];var c=l.indexOf("]");if(c==-1){r=t;i++}else if(c===0){r=r[h];s[i].name=""+r.length}else{r=r[h];s[i].name=l.substring(0,c)+l.substring(c+1)}}}}return t};window["fRefreshCaptcha"]=function(e){var t=null,i=BX.findChild(e,{attr:{name:"captcha_code"}},true),s=BX.findChild(e,{attr:{name:"captcha_word"}},true),n=BX.findChild(e,{className:"comments-reply-field-captcha-image"},true);if(n)t=BX.findChild(n,{tag:"img"});if(i&&s&&t){s.value="";BX.ajax.getCaptcha(function(e){i.value=e["captcha_sid"];t.src="/bitrix/tools/captcha.php?captcha_code="+e["captcha_sid"]})}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:100:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form2.min.js?169925794914615";s:6:"source";s:80:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form2.js";s:3:"min";s:84:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form2.min.js";s:3:"map";s:84:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form2.map.js";}"*/
(function(){if(!!window.UCForm)return;var t={};window.UCForm=function(t){this.formId=t;this.form=BX(this.formId);this.entities=new Map;this.xmls=new Map;if(t===""){}else{this.initialize()}this.startCheckWriting=this.startCheckWriting.bind(this);this.id=null;this.currentEntity=null;this.onSubmitSuccess=this.onSubmitSuccess.bind(this);this.onSubmitFailed=this.onSubmitFailed.bind(this)};window.UCForm.prototype={initialize:function(){this.bindWindowEvents();this.bindPrivateEvents();this.__bindLHEEvents=function(t,e){if(e===this.formId){this.handler=t;this.bindLHEEvents()}}.bind(this);BX.addCustomEvent(window,"onInitialized",this.__bindLHEEvents);if(this.getLHE())this.bindLHEEvents();BX.onCustomEvent(this.form,"OnUCFormInit",[this])},bindWindowEvents:function(){this.windowEvents={OnImageDataUriHandle:this.showWait.bind(this),OnImageDataUriCaughtUploaded:this.closeWait.bind(this),OnImageDataUriCaughtFailed:this.closeWait.bind(this)};for(var t in this.windowEvents){if(this.windowEvents.hasOwnProperty(t)){BX.addCustomEvent(window,t,this.windowEvents[t])}}},unbindWindowEvents:function(){for(var t in this.windowEvents){if(this.windowEvents.hasOwnProperty(t)){BX.removeCustomEvent(window,t,this.windowEvents[t])}}},bindPrivateEvents:function(){this.privateEvents={onQuote:this.onQuote.bind(this),onReply:this.onReply.bind(this),onEdit:this.onEdit.bind(this)};for(var t in this.privateEvents){if(this.privateEvents.hasOwnProperty(t)){BX.addCustomEvent(this,t,this.privateEvents[t])}}},bindLHEEvents:function(){if(!this.getLHE()){return}this.getLHE().exec(function(){BX.removeAllCustomEvents(this.getLHE().oEditor,"OnCtrlEnter");BX.addCustomEvent(this.getLHE().oEditor,"OnCtrlEnter",function(){this.getLHE().oEditor.SaveContent();BX.onCustomEvent(t,"OnButtonClick",["submit"])}.bind(this))}.bind(this));var t=this.getLHEEventNode();BX.addCustomEvent(t,"OnBeforeHideLHE",function(){BX.removeClass(document.documentElement,"bx-ios-fix-frame-focus");if(top&&top["document"]){BX.removeClass(top["document"]["documentElement"],"bx-ios-fix-frame-focus")}BX.onCustomEvent(this.form,"OnUCFormBeforeHide",[this,this.currentEntity])}.bind(this));BX.addCustomEvent(t,"OnAfterHideLHE",function(){if(this.currentEntity!==null){var t=this.currentEntity.getPlaceholder(this.currentEntity.messageId);if(t)BX.hide(t)}BX.onCustomEvent(this.form,"OnUCFormAfterHide",[this,this.currentEntity]);this.stopCheckWriting();this.clear();BX.onCustomEvent(window,"OnUCFeedChanged",[this.id])}.bind(this));BX.addCustomEvent(t,"OnBeforeShowLHE",function(){if(BX.browser.IsIOS()&&BX.browser.IsMobile()){BX.addClass(window["document"]["documentElement"],"bx-ios-fix-frame-focus");if(top&&top["document"])BX.addClass(top["document"]["documentElement"],"bx-ios-fix-frame-focus")}}.bind(this));BX.addCustomEvent(t,"OnAfterShowLHE",function(){this.startCheckWriting();BX.onCustomEvent(window,"OnUCFeedChanged",[this.id])}.bind(this));BX.addCustomEvent(t,"OnClickSubmit",this.submit.bind(this));BX.addCustomEvent(t,"OnClickCancel",this.cancel.bind(this));BX.removeCustomEvent(window,"onInitialized",this.__bindLHEEvents);delete this.__bindLHEEvents},getLHE:function(){if(!this.handler){this.handler=LHEPostForm.getHandlerByFormId(this.formId)}return this.handler},getLHEEventNode:function(){if(!this.handlerEventNode&&this.getLHE()){this.handlerEventNode=this.getLHE().eventNode}return this.handlerEventNode},bindEntity:function(t){if(this.entities.has(t.getId())){BX.onCustomEvent(this.form,"onUnbindEntity",[t]);this.entities.delete(t.getId())}this.entities.set(t.getId(),t);this.xmls.set(t.getXmlId(),t)},onInitEditorFrame:function(t){this.getLHE().exec(function(){BX.addCustomEvent(this.getLHE().oEditor,"OnAfterIframeInit",(()=>{t();BX.removeAllCustomEvents(this.getLHE().oEditor,"OnAfterIframeInit")}))}.bind(this))},onQuote:function(t,e,i,n,s){if(this.isFormOccupied(t)){return}const o=()=>{var t=BX.util.htmlspecialchars(i);if(!this.getLHE().oEditor.toolbar.controls.Quote){BX.DoNothing()}else if(!e&&!i){this.getLHE().oEditor.action.Exec("quote")}else{i=t;var n=e&&e.gender?BX.message("MPL_HAVE_WRITTEN_"+e.gender):BX.message("MPL_HAVE_WRITTEN");if(this.getLHE().oEditor.GetViewMode()=="wysiwyg"){i=i.replace(/\n/g,"<br/>");if(e){if(e.id>0){e='<span id="'+this.getLHE().oEditor.SetBxTag(false,{tag:"postuser",userId:e.id,userName:e.name})+'" class="bxhtmled-metion">'+e.name.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")+"</span>"}else{e="<span>"+e.name.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")+"</span>"}e=e!==""?e+n+"<br/>":"";i=e+i}}else if(this.getLHE().oEditor.bbCode){if(e){if(e.id>0){e="[USER="+e.id+"]"+e.name+"[/USER]"}else{e=e.name}e=e!==""?e+n+"\n":"";i=e+i}}if(this.getLHE().oEditor.action.actions.quote.setExternalSelectionFromRange){this.getLHE().oEditor.action.actions.quote.setExternalSelectionFromRange();var s=this.getLHE().oEditor.action.actions.quote.getExternalSelection();let i=BX.create("DIV",{html:s});let n=i.querySelector(".feed-post-emoji-container");if(n){i.removeChild(n);s=i.innerHTML}if(s===""&&t!==""){s=t}s=(BX.type.isNotEmptyString(e)?e:"")+s;if(BX.type.isNotEmptyString(s))this.getLHE().oEditor.action.actions.quote.setExternalSelection(s)}else{this.getLHE().oEditor.action.actions.quote.setExternalSelection(i)}this.getLHE().oEditor.action.Exec("quote")}};const r=this.currentEntity&&parseInt(this.currentEntity.messageId,10);if(this.currentEntity&&!r){this.show(t);o()}else{this.show(t);this.onInitEditorFrame(o)}},onReply:function(t,e){if(this.isFormOccupied(t)){return}if(this.currentEntity){this.show(t);this.insertMention(e)}else{this.show(t);this.onInitEditorFrame(this.insertMention.bind(this,e))}},onEdit:function(t,e,i,n){if(n==="EDIT"){this.show(t,e,i["messageBBCode"],i["messageFields"]);return}this.hide(true);this.setCurrentEntity(t,e);if(i["errorMessage"]){this.showError(i["errorMessage"])}else if(i["okMessage"]){this.showNote(i["okMessage"]);this.nullCurrentEntity()}},isFormOccupied:function(t){if(this.currentEntity!==null&&this.currentEntity!==t&&this.isFormChanged()){return!window.confirm(BX.message("MPL_SAFE_EDIT"))}return false},isFormChanged:function(){if(this.getLHE()&&this.getLHE().editorIsLoaded&&this.getLHE().oEditor.IsContentChanged()){return true}return false},insertMention:function(t){if(t.id>0){this.getLHE().exec(window.BxInsertMention,[{item:{entityId:t.id,name:t.name},type:"user",formID:this.formId,editorId:this.getLHE().oEditorId,bNeedComa:true,insertHtml:true}])}},startCheckWriting:function(){if(!this.getLHE().editorIsLoaded||this._checkWriteTimeout===false){return}this.__content_length=this.__content_length>0?this.__content_length:0;var t=this.getLHE().oEditor.GetContent(),e=2e3;if(t.length>=4&&this.__content_length!==t.length&&this.id){BX.onCustomEvent(this.form,"OnUCUserIsWriting",[this.currentEntity,{sent:false}]);e=3e4}this._checkWriteTimeout=setTimeout(this.startCheckWriting,e);this.__content_length=t.length},stopCheckWriting:function(){clearTimeout(this._checkWriteTimeout);this._checkWriteTimeout=false;this.__content_length=0},setCurrentEntity:function(t,e){this.currentEntity=t;this.currentEntity.messageId=e;this.currentEntity.operationId=BX.util.getRandomString(20);this.id=[this.currentEntity.getXmlId(),e]},nullCurrentEntity:function(){delete this.currentEntity.messageId;this.currentEntity=null;this.id=null},hide:function(t){if(this.getLHEEventNode()&&this.getLHEEventNode().style.display!=="none"){BX.onCustomEvent(this.getLHEEventNode(),"OnShowLHE",[t===true?false:"hide"])}if(t){document.body.appendChild(this.form)}},clear:function(){var t=this.currentEntity?this.currentEntity.getPlaceholder(this.currentEntity.messageId):null;if(t){BX.hide(t);this.clearNotification(t,"feed-add-error")}BX.onCustomEvent(this.form,"OnUCFormClear",[this]);var e=BX.findChild(this.form,{className:"wduf-placeholder-tbody"},true,false);if(e!==null&&typeof e!="undefined")BX.cleanNode(e,false);e=BX.findChild(this.form,{className:"wduf-selectdialog"},true,false);if(e!==null&&typeof e!="undefined")BX.hide(e);e=BX.findChild(this.form,{className:"file-placeholder-tbody"},true,false);if(e!==null&&typeof e!="undefined")BX.cleanNode(e,false);this.nullCurrentEntity()},show:function(t,e,i,n){e=parseInt(e>0?e:0);var s=t.getPlaceholder(e);if(this.currentEntity===t&&this.currentEntity.messageId===e){this.getLHE().oEditor.Focus();setTimeout(function(){if(!this.isElementCompletelyVisibleOnScreen(s)){s.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})}}.bind(this),100);return true}if(this.getLHEEventNode()&&this.getLHEEventNode().style.display!=="none"&&BX.Dom.getPosition(s).y>BX.Dom.getPosition(this.getLHEEventNode()).y){window.scrollTo(window.scrollX,window.scrollY-this.getLHEEventNode().offsetHeight+10)}this.hide(true);this.setCurrentEntity(t,e);BX.removeClass(s,"feed-com-add-box-no-form");BX.removeClass(s,"feed-com-add-box-header");s.appendChild(this.form);BX.onCustomEvent(this.form,"OnUCFormBeforeShow",[this,i,n]);BX.show(s);BX.onCustomEvent(this.getLHEEventNode(),"OnShowLHE",["show",null,this.id]);BX.onCustomEvent(this.form,"OnUCFormAfterShow",[this,i,n]);return true},isElementCompletelyVisibleOnScreen:function(t){var e=BX.LazyLoad.getElementCoords(t);var i=window.pageYOffset||document.documentElement.scrollTop;var n=i+document.documentElement.clientHeight;e.bottom=e.top+t.offsetHeight;return e.top>i&&e.top<n&&e.bottom<n&&e.bottom>i},onSubmitSuccess:function(t){this.closeWait();var e=t,i=this.id[0];BX.onCustomEvent(this.form,"OnUCFormResponse",[this,t]);if(!!this.OnUCFormResponseData)t=this.OnUCFormResponseData;if(!!t){if(t["errorMessage"]){this.showError(t["errorMessage"])}else if(t["status"]=="error"){this.showError(BX.type.isNotEmptyString(t["message"])?t["message"]:"")}else{BX.onCustomEvent(this.form,"OnUCAfterRecordAdd",[this.id[0],t,e]);this.hide(true)}}this.busy=false;BX.onCustomEvent(window,"OnUCFormResponse",[i,t["messageId"],this,t])},onSubmitFailed:function(t){this.closeWait();if(BX.type.isPlainObject(t)){var e="Unknown error.";if(BX.type.isPlainObject(t["data"])&&BX.type.isPlainObject(t["data"]["ajaxRejectData"])&&BX.type.isNotEmptyString(t["data"]["ajaxRejectData"]["message"])){e=t["data"]["ajaxRejectData"]["message"]}else if(BX.type.isArray(t["errors"])){e=t["errors"].map((function(t){return t.message})).join("<br >")}this.showError(e)}this.busy=false;BX.onCustomEvent(window,"OnUCFormResponse",[this.id[0],this.id[1],this,[]])},submit:function(){if(this.busy===true){return"busy"}var t=this.getLHE().editorIsLoaded?this.getLHE().oEditor.GetContent():"";if(!t){this.showError(BX.message("JERROR_NO_MESSAGE"));return false}this.showWait();this.busy=true;var e={};convertFormToArray(this.form,e);e["REVIEW_TEXT"]=t;e["NOREDIRECT"]="Y";e["MODE"]="RECORD";e["AJAX_POST"]="Y";e["id"]=this.id;e["SITE_ID"]=BX.message("SITE_ID");e["LANGUAGE_ID"]=BX.message("LANGUAGE_ID");e["ACTION"]="ADD";if(this.currentEntity!==null&&this.currentEntity.messageId>0){e["REVIEW_ACTION"]="EDIT";e["FILTER"]={ID:this.id[1]};e["ACTION"]="EDIT";e["ID"]=this.id[1]}BX.onCustomEvent(this.form,"OnUCFormSubmit",[this,e]);BX.onCustomEvent(window,"OnUCFormSubmit",[this.id[0],this.id[1],this,e]);if(this.currentEntity!==null&&this.currentEntity.ajax["processComment"]===true){BX.ajax.runComponentAction(this.currentEntity.ajax.componentName,"processComment",{mode:"class",data:e,signedParameters:this.currentEntity.ajax.params}).then(this.onSubmitSuccess,this.onSubmitFailed)}else{var i=this.form.action;i=BX.util.remove_url_param(i,["b24statAction"]);i=BX.util.add_url_param(i,{b24statAction:this.id[1]>0?"editComment":"addComment"});this.form.action=i;BX.ajax({method:"POST",url:this.form.action,data:e,dataType:"json",onsuccess:this.onSubmitSuccess,onfailure:this.onSubmitFailed})}return false},cancel:function(){},clearNotification:function(t,e){var i=BX.findChildren(t,{tagName:"DIV",className:e},true);if(i){var n=i.pop();do{BX.remove(n)}while((n=i.pop())&&!!n)}},showError:function(t){if(!t||this.currentEntity===null)return;var e=this.currentEntity.getPlaceholder(this.currentEntity.messageId);this.clearNotification(e,"feed-add-error");BX.addClass(e,!e.firstChild?"feed-com-add-box-no-form":"feed-com-add-box-header");e.insertBefore(BX.create("div",{attrs:{class:"feed-add-error"},html:'<span class="feed-add-info-text"><span class="feed-add-info-icon"></span>'+"<b>"+BX.message("FC_ERROR")+"</b><br />"+t+"</span>"}),e.firstChild);BX.show(e)},showNote:function(t){if(!t||this.currentEntity===null)return;var e=this.currentEntity.getPlaceholder(this.currentEntity.messageId);this.clearNotification(e,"feed-add-error");this.clearNotification(e,"feed-add-successfully");BX.addClass(e,!e.firstChild?"feed-com-add-box-no-form":"feed-com-add-box-header");e.insertBefore(BX.create("div",{attrs:{class:"feed-add-successfully"},html:'<span class="feed-add-info-text"><span class="feed-add-info-icon"></span>'+t+"</span>"}),e.firstChild);BX.addClass(e,"comment-deleted");BX.show(e)},showWait:function(){var t=BX("lhe_button_submit_"+this.form.id);this.busy=true;if(!!t){BX.addClass(t,"ui-btn-clock");BX.defer((function(){t.disabled=true}))()}},closeWait:function(){var t=BX("lhe_button_submit_"+this.form.id);this.busy=false;if(!!t){t.disabled=false;BX.removeClass(t,"ui-btn-clock")}}};window.UCForm.bindFormToEntity=function(e,i){var n=t[e]||new UCForm(e);n.bindEntity(i);t[e]=n;return n};window.convertFormToArray=function(t,e){e=!!e?e:[];if(!!t){var i,n=[],s=t.elements.length;for(i=0;i<s;i++){var o=t.elements[i];if(o.disabled)continue;switch(o.type.toLowerCase()){case"text":case"textarea":case"password":case"hidden":case"select-one":n.push({name:o.name,value:o.value});break;case"radio":case"checkbox":if(o.checked)n.push({name:o.name,value:o.value});break;case"select-multiple":for(var r=0;r<o.options.length;r++){if(o.options[r].selected)n.push({name:o.name,value:o.options[r].value})}break;default:break}}var a=e;i=0;while(i<n.length){var d=n[i].name.indexOf("[");if(d==-1){a[n[i].name]=n[i].value;a=e;i++}else{var h=n[i].name.substring(0,d);var c=n[i].name.substring(d+1);if(!a[h])a[h]=[];var u=c.indexOf("]");if(u==-1){a=e;i++}else if(u===0){a=a[h];n[i].name=""+a.length}else{a=a[h];n[i].name=c.substring(0,u)+c.substring(u+1)}}}}return e};window["fRefreshCaptcha"]=function(t){var e=null,i=BX.findChild(t,{attr:{name:"captcha_code"}},true),n=BX.findChild(t,{attr:{name:"captcha_word"}},true),s=BX.findChild(t,{className:"comments-reply-field-captcha-image"},true);if(s)e=BX.findChild(s,{tag:"img"});if(i&&n&&e){n.value="";BX.ajax.getCaptcha((function(t){i.value=t["captcha_sid"];e.src="/bitrix/tools/captcha.php?captcha_code="+t["captcha_sid"]}))}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_im.min.js?16992579498220";s:6:"source";s:77:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_im.js";s:3:"min";s:81:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_im.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_im.map.js";}"*/
(function(){window["UC"]=!!window["UC"]?window["UC"]:{};if(!!window["UC"]["Informer"])return;window.SPC=function(){this.stack=[];this.stackTimeout=null;this.stackPopup={};this.stackPopupTimeout={};this.stackPopupTimeout2={};this.stackPopupId=0;this.stackOverflow=false;this.notifyShow=0;this.notifyHideTime=5e3;this.notifyHeightCurrent=10;this.notifyHeightMax=0;this.notifyGarbageTimeout=null;this.notifyAutoHide=true;this.notifyAutoHideTimeout=null};var t=window.SPC;t.prototype.add=function(t){if(typeof t!="object"||!t.html)return false;if(BX.type.isDomNode(t.html))t.html=t.html.outerHTML;this.stack.push(t);if(!this.stackOverflow)this.setShowTimer(300);return true};t.prototype.remove=function(t){delete this.stack[t]};t.prototype.show=function(){this.notifyHeightMax=document.body.offsetHeight;var t=BX.GetWindowInnerSize();for(var e=0;e<this.stack.length;e++){if(typeof this.stack[e]=="undefined")continue;var i=new BX.PopupWindow("bx-sbpc-notify-flash-"+this.stackPopupId,{top:0,left:0},{lightShadow:true,zIndex:200,events:{onPopupClose:BX.delegate(function(){BX.proxy_context.popupContainer.style.opacity=0;this.notifyShow--;this.notifyHeightCurrent-=BX.proxy_context.popupContainer.offsetHeight+10;this.stackOverflow=false;setTimeout(BX.delegate(function(){this.destroy()},BX.proxy_context),1500)},this),onPopupDestroy:BX.delegate(function(){BX.unbindAll(BX.findChild(BX.proxy_context.popupContainer,{className:"bx-spbc-notifier-item-delete"},true));BX.unbindAll(BX.proxy_context.popupContainer);delete this.stackPopup[BX.proxy_context.uniquePopupId];delete this.stackPopupTimeout[BX.proxy_context.uniquePopupId];delete this.stackPopupTimeout2[BX.proxy_context.uniquePopupId]},this)},bindOnResize:false,content:BX.create("div",{props:{className:"bx-notifyManager-item-sbpc"},html:this.stack[e].html})});i.notifyParams=this.stack[e];i.notifyParams.id=e;i.show();BX.removeClass(i.popupContainer.firstChild,"popup-window");i.popupContainer.style.left=10+"px";i.popupContainer.style.opacity=0;if(this.notifyHeightMax<this.notifyHeightCurrent+i.popupContainer.offsetHeight+10){if(this.notifyShow>0){i.destroy();this.stackOverflow=true;break}}BX.addClass(i.popupContainer,"bx-notifyManager-animation-spbc");new BX.easing({duration:500,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){if(BX(i)&&BX(i.popupContainer))i.popupContainer.style.opacity=t.opacity/100}}).animate();i.popupContainer.style.top=t.innerHeight-this.notifyHeightCurrent-i.popupContainer.offsetHeight-10+"px";this.notifyHeightCurrent=this.notifyHeightCurrent+i.popupContainer.offsetHeight+10;this.stackPopupId++;this.notifyShow++;this.remove(e);this.stackPopupTimeout[i.uniquePopupId]=null;BX.bind(i.popupContainer,"mouseover",BX.delegate(function(){this.clearAutoHide()},this));BX.bind(i.popupContainer,"mouseout",BX.delegate(function(){this.setAutoHide(this.notifyHideTime/2)},this));BX.bind(i.popupContainer,"contextmenu",BX.delegate(function(t){if(this.stackPopup[BX.proxy_context.id].notifyParams.tag)this.closeByTag(this.stackPopup[BX.proxy_context.id].notifyParams.tag);else this.stackPopup[BX.proxy_context.id].close();return BX.PreventDefault(t)},this));var o=BX.findChildren(i.popupContainer,{tagName:"a"},true);for(var s=0;s<o.length;s++){if(o[s].href!="#")o[s].target="_blank"}BX.bind(BX.findChild(i.popupContainer,{className:"bx-spbc-notifier-item-delete"},true),"click",BX.delegate(function(t){var e=BX.proxy_context.parentNode.parentNode.parentNode.parentNode.id.replace("popup-window-content-","");if(this.stackPopup[e].notifyParams.close)this.stackPopup[e].notifyParams.close(this.stackPopup[e]);this.stackPopup[e].close();if(this.notifyAutoHide===false){this.clearAutoHide();this.setAutoHide(this.notifyHideTime/2)}return BX.PreventDefault(t)},this));if(i.notifyParams.click){i.popupContainer.style.cursor="pointer";BX.bind(i.popupContainer,"click",BX.delegate(function(t){this.notifyParams.click(this);return BX.PreventDefault(t)},i))}this.stackPopup[i.uniquePopupId]=i}if(this.stack.length>0){this.clearAutoHide(true);this.setAutoHide(this.notifyHideTime)}this.garbage()};t.prototype.closeByTag=function(t){for(var e=0;e<this.stack.length;e++){if(typeof this.stack[e]!="undefined"&&this.stack[e].tag==t){delete this.stack[e]}}for(e in this.stackPopup){if(this.stackPopup.hasOwnProperty(e))if(this.stackPopup[e].notifyParams.tag==t)this.stackPopup[e].close()}};t.prototype.setShowTimer=function(t){clearTimeout(this.stackTimeout);this.stackTimeout=setTimeout(BX.delegate(this.show,this),t)};t.prototype.setAutoHide=function(t){this.notifyAutoHide=true;clearTimeout(this.notifyAutoHideTimeout);this.notifyAutoHideTimeout=setTimeout(BX.delegate(function(){for(var e in this.stackPopupTimeout){if(this.stackPopupTimeout.hasOwnProperty(e)){this.stackPopupTimeout[e]=setTimeout(BX.delegate(function(){this.close()},this.stackPopup[e]),t-1e3);this.stackPopupTimeout2[e]=setTimeout(BX.delegate(function(){this.setShowTimer(300)},this),t-700)}}},this),1e3)};t.prototype.clearAutoHide=function(t){clearTimeout(this.notifyGarbageTimeout);this.notifyAutoHide=false;t=t===true;var e;if(t){clearTimeout(this.stackTimeout);for(e in this.stackPopupTimeout){if(this.stackPopupTimeout.hasOwnProperty(e)){clearTimeout(this.stackPopupTimeout[e]);clearTimeout(this.stackPopupTimeout2[e])}}}else{clearTimeout(this.notifyAutoHideTimeout);this.notifyAutoHideTimeout=setTimeout(BX.delegate(function(){clearTimeout(this.stackTimeout);for(var t in this.stackPopupTimeout){if(this.stackPopupTimeout.hasOwnProperty(t)){clearTimeout(this.stackPopupTimeout[t]);clearTimeout(this.stackPopupTimeout2[t])}}},this),300)}};t.prototype.garbage=function(){clearTimeout(this.notifyGarbageTimeout);this.notifyGarbageTimeout=setTimeout(BX.delegate(function(){var t=[];for(var e=0;e<this.stack.length;e++){if(typeof this.stack[e]!="undefined")t.push(this.stack[e])}this.stack=t},this),1e4)};t.prototype.check=function(t,e,i,o){if(t[1]<=0||!window["UC"]["Informer"]||!BX.type.isNotEmptyString(o))return;var s=/(\d+)/g.exec(t[0]),n=BX("record-"+t.join("-")+"-cover");s=!!s?parseInt(s):0;if(s<=0||!n)return false;else if(BX.util.in_array(s,window["UC"]["InformerTags"][i]))return true;window["UC"]["InformerTags"][i].push(s);var a=!!e&&!!e["messageFields"]?e["messageFields"]:false;if(!a)return;var r=BX.pos(n),p=BX.GetWindowScrollPos(),u=BX.GetWindowInnerSize();if(r.top<p.scrollTop||r.top>p.scrollTop+u.innerHeight-20){setTimeout(function(){if(parseInt(a["AUTHOR"]["ID"])!=parseInt(BX.message("USER_ID"))){var e=BX.create("div",{props:{className:"bx-spbc-notifier-item"},children:[BX.create("span",{props:{className:"bx-spbc-notifier-item-content"},children:[BX.create("span",{props:{className:"bx-spbc-notifier-item-avatar"},children:[!!a["AUTHOR"]["AVATAR"]?BX.create("img",{props:{className:"bx-spbc-notifier-item-avatar-img"},attrs:{src:a["AUTHOR"]["AVATAR"]}}):""]}),BX.create("a",{attrs:{href:"#"},props:{className:"bx-spbc-notifier-item-delete"}}),BX.create("span",{props:{className:"bx-spbc-notifier-item-name"},html:a["AUTHOR"]["NAME"]}),BX.create("span",{props:{className:"bx-spbc-notifier-item-time"},html:a["POST_TIME"]}),BX.create("span",{props:{className:"bx-spbc-notifier-item-text"}}),BX.create("span",{props:{className:"bx-spbc-notifier-item-text2"},html:'"'+o+'"'})]})]}),i=BX.GetWindowScrollPos();window["UC"]["Informer"].add({html:e,tag:"im-record-"+t.join("-"),click:BX.delegate(function(){var e=BX.pos(BX("record-"+t.join("-")));new BX.easing({duration:500,start:{scroll:i.scrollTop},finish:{scroll:e.top-100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){window.scrollTo(0,t.scroll)}}).animate()},this)})}},50)}};t.NativeNotify=function(){return window.webkitNotifications&&window.webkitNotifications.checkPermission()==0};window["UC"]["Informer"]=new t;window["UC"]["InformerTags"]={};t.notifyManagerShow=function(){BX.ready(function(){BX.addCustomEvent("onNotifyManagerShow",function(t){if(t.originalTag){var e=t.originalTag.lastIndexOf("|"),i=t.originalTag.substr(0,e);if(!!window["UC"]["InformerTags"][i]){var o=parseInt(t.originalTag.substr(e+1));window["UC"]["InformerTags"][i].push(o)}}})})}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/main.post.form/templates/.default/script.min.js?169925795070830";s:6:"source";s:69:"/bitrix/components/bitrix/main.post.form/templates/.default/script.js";s:3:"min";s:73:"/bitrix/components/bitrix/main.post.form/templates/.default/script.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/main.post.form/templates/.default/script.map.js";}"*/
(function(){if(window["LHEPostForm"]){return}this.BX=this.BX||{};(function(e,t,i,n,r){"use strict";var a=function(){function e(t,i){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"id","SomeParser");babelHelpers.defineProperty(this,"buttonParams",{name:"Some parser name",iconClassName:"some-parser-class",disabledForTextarea:false,src:"/icon.png",toolbarSort:205});this.editor=t;this.htmlEditor=i;this.handler=this.handler.bind(this)}babelHelpers.createClass(e,[{key:"handler",value:function e(){}},{key:"parse",value:function e(t){return t}},{key:"unparse",value:function e(t,i){return""}},{key:"hasButton",value:function e(){return this.buttonParams!==null}},{key:"getButton",value:function e(){if(this.buttonParams===null){return null}return{id:this.id,name:this.buttonParams.name,iconClassName:this.buttonParams.iconClassName,disabledForTextarea:this.buttonParams.disabledForTextarea,src:this.buttonParams.src,toolbarSort:this.buttonParams.toolbarSort,handler:this.handler}}},{key:"getParser",value:function e(){var t=this;return{name:this.id,obj:{Parse:function e(i,n){return t.parse(n)},UnParse:this.unparse.bind(this)}}}}]);return e}();var o=function(e){babelHelpers.inherits(t,e);function t(){var e;var i;babelHelpers.classCallCheck(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++){a[o]=arguments[o]}i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(a)));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"id","spoiler");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"buttonParams",{name:r.Loc.getMessage("MPF_SPOILER"),iconClassName:"spoiler",disabledForTextarea:false,src:r.Loc.getMessage("MPF_TEMPLATE_FOLDER")+"/images/lhespoiler.svg",toolbarSort:205});return i}babelHelpers.createClass(t,[{key:"handler",value:function e(){var t;if(!this.htmlEditor.bbCode||!this.htmlEditor.synchro.IsFocusedOnTextarea()){t=this.htmlEditor.action.actions.formatBlock.exec("formatBlock","blockquote","bx-spoiler",false,{bxTagParams:{tag:"spoiler"}})}else{t=this.htmlEditor.action.actions.formatBbCode.exec("quote",{tag:"SPOILER"})}return t}},{key:"parse",value:function e(t,i){if(/\[spoiler(([^\]])*)\]/gi.test(t)){t=t.replace(/[\x01-\x02]/gi,"").replace(/\[spoiler([^\]]*)\]/gi,"\x01$1\x01").replace(/\[\/spoiler]/gi,"\x02");var n=/(?:\x01([^\x01]*)\x01)([^\x01-\x02]+)\x02/gi;while(t.match(n)){t=t.replace(n,function(e,t,i){t=t.replace(/^(="|='|=)/gi,"").replace(/("|')?$/gi,"");return'<blockquote class="bx-spoiler" id="'.concat(this.htmlEditor.SetBxTag(false,{tag:"spoiler"}),'" title="').concat(t,'">').concat(i,"</blockquote>")}.bind(this))}}t=t.replace(/\001([^\001]*)\001/gi,"[spoiler$1]").replace(/\002/gi,"[/spoiler]");return t}},{key:"unparse",value:function e(t,i){var n="";for(var r=0;r<i.node.childNodes.length;r++){n+=this.htmlEditor.bbParser.GetNodeHtml(i.node.childNodes[r])}n=n.trim();if(n!==""){return"[SPOILER"+(i.node.hasAttribute("title")?"="+i.node.getAttribute("title"):"")+"]"+n+"[/SPOILER]"}return""}}]);return t}(a);var s=function(e){babelHelpers.inherits(i,e);function i(e,n){var r;babelHelpers.classCallCheck(this,i);r=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,e,n));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"id","postuser");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"buttonParams",null);t.EventEmitter.subscribe(n,"OnIframeKeydown",(function(e){var t=babelHelpers.slicedToArray(e.compatData,1),i=t[0];if(window.onKeyDownHandler){window.onKeyDownHandler(i,n,n.formID)}}));t.EventEmitter.subscribe(n,"OnIframeKeyup",(function(e){var t=babelHelpers.slicedToArray(e.compatData,1),i=t[0];if(window.onKeyUpHandler){window.onKeyUpHandler(i,n,n.formID)}}));t.EventEmitter.subscribe(n,"OnIframeClick",(function(){if(window["BXfpdStopMent"+n.formID]){window["BXfpdStopMent"+n.formID]()}}));t.EventEmitter.subscribe(n,"OnTextareaKeyup",(function(e){var t=babelHelpers.slicedToArray(e.compatData,1),i=t[0];if(n.textareaView&&n.textareaView.GetCursorPosition&&window.onTextareaKeyUpHandler){window.onTextareaKeyUpHandler(i,n,n.formID)}}));t.EventEmitter.subscribe(n,"OnTextareaKeydown",(function(e){var t=babelHelpers.slicedToArray(e.compatData,1),i=t[0];if(n.textareaView&&n.textareaView.GetCursorPosition&&window.onTextareaKeyDownHandler){window.onTextareaKeyDownHandler(i,n,n.formID)}}));return r}babelHelpers.createClass(i,[{key:"parse",value:function e(t,i){var n=this;t=t.replace(/\[USER\s*=\s*(\d+)\](.*?)\[\/USER\]/gi,(function(e,t,i){i=i.trim();if(i===""){return""}var r=n.htmlEditor.SetBxTag(false,{tag:n.id,userId:t,userName:i});return'<span id="'.concat(r,'" class="bxhtmled-metion">').concat(i,"</span>")})).replace(/\[PROJECT\s*=\s*(\d+)\](.*?)\[\/PROJECT\]/gi,(function(e,t,i){i=i.trim();if(i===""){return""}var r=n.htmlEditor.SetBxTag(false,{tag:n.id,projectId:t,projectName:i});return'<span id="'.concat(r,'" class="bxhtmled-metion">').concat(i,"</span>")})).replace(/\[DEPARTMENT\s*=\s*(\d+)\](.*?)\[\/DEPARTMENT\]/gi,(function(e,t,i){i=i.trim();if(i===""){return""}var r=n.htmlEditor.SetBxTag(false,{tag:n.id,departmentId:t,departmentName:i});return'<span id="'.concat(r,'" class="bxhtmled-metion">').concat(i,"</span>")}));return t}},{key:"unparse",value:function e(t,i){var n=this;var a="";i.node.childNodes.forEach((function(e){a+=n.htmlEditor.bbParser.GetNodeHtml(e)}));a=String(a).trim();var o="";if(r.Type.isStringFilled(a)){if(!r.Type.isUndefined(t.userId)){o="[USER=".concat(t.userId,"]").concat(a,"[/USER]")}else if(!r.Type.isUndefined(t.projectId)){o="[PROJECT=".concat(t.projectId,"]").concat(a,"[/PROJECT]")}else if(!r.Type.isUndefined(t.departmentId)){o="[DEPARTMENT=".concat(t.departmentId,"]").concat(a,"[/DEPARTMENT]")}}return o}}]);return i}(a);var l=function(){function e(i,n,r){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"actionPool",[]);this.cid=i;this.container=n;this.editor=r;t.EventEmitter.subscribe(r.getEventObject(),"onShowControllers",(function(e){var i=e.data;t.EventEmitter.emit(n.parentNode,"BFileDLoadFormController",new t.BaseEvent({compatData:[i]}))}));t.EventEmitter.subscribe(r.getEventObject(),"onCollectControllers",(function(e){e.data[i]={values:[]}}))}babelHelpers.createClass(e,[{key:"exec",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(t){this.actionPool.push(t)}if(this.isReady){try{var i;while((i=this.actionPool.shift())&&i){i.apply(this)}}catch(e){console.log("error in attachments controllers: ",e)}}}},{key:"getId",value:function e(){return this.cid}},{key:"getFieldName",value:function e(){return null}},{key:"reinitFrom",value:function e(t){var i=this;this.exec((function(){if(!i.getFieldName()){return}i.container.querySelector('inptut[name="'.concat(i.getFieldName(),'"]')).forEach((function(e){e.parentNode.removeChild(e)}))}))}},{key:"isReady",get:function e(){return true}}]);return e}();var d=function(e){babelHelpers.inherits(i,e);function i(e,n,r){var a;babelHelpers.classCallCheck(this,i);a=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,e,n,r));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"diskUfUploader",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"diskUfHandler",null);var o=function e(i){a.diskUfUploader=i;a.exec();var n=function e(i){t.EventEmitter.emit(r.getEventObject(),"onUploadsHasBeenChanged",i)};t.EventEmitter.subscribe(a.diskUfUploader,"onFileIsInited",n);t.EventEmitter.subscribe(a.diskUfUploader,"ChangeFileInput",n)};if(BX.UploaderManager.getById(e)){o(BX.UploaderManager.getById(e))}t.EventEmitter.subscribeOnce(n.parentNode,"DiskDLoadFormControllerInit",(function(t){var i=babelHelpers.slicedToArray(t.compatData,1),n=i[0];a.diskUfHandler=n;if(e===n.CID&&!a.diskUfUploader){o(n.agent)}}));t.EventEmitter.subscribe(r.getEventObject(),"onShowControllers",(function(e){var i=e.data;t.EventEmitter.emit(n.parentNode,"DiskLoadFormController",new t.BaseEvent({compatData:[i]}))}));return a}babelHelpers.createClass(i,[{key:"getFieldName",value:function e(){if(this.diskUfHandler){return this.diskUfHandler.params.controlName}return null}},{key:"reinitFrom",value:function e(t){var i=this;this.exec((function(){if(!i.getFieldName()){return}Array.from(i.container.querySelectorAll('inptut[name="'.concat(i.getFieldName(),'"]'))).forEach((function(e){e.parentNode.removeChild(e)}));var e=null;for(var n in t){if(t.hasOwnProperty(n)&&t[n]&&t[n]["USER_TYPE_ID"]==="disk_file"&&t[n]["FIELD_NAME"]===i.getFieldName()){e=t[n]["VALUE"]}}if(e){var r={};e.forEach((function(e){var t=document.querySelector("#disk-attach-"+e);if(t.tagName!=="A"){t=t.querySelector("img")}if(t){r["E"+e]={type:"file",id:e,name:t.getAttribute("data-bx-title")||t.getAttribute("data-title"),size:t.getAttribute("data-bx-size")||"",sizeInt:t.getAttribute("data-bx-size")||"",width:t.getAttribute("data-bx-width"),height:t.getAttribute("data-bx-height"),storage:"disk",previewUrl:t.tagName==="A"?"":t.getAttribute("data-bx-src")||t.getAttribute("data-src"),fileId:t.getAttribute("bx-attach-file-id")};if(t.hasAttribute("bx-attach-xml-id"))r["E"+e]["xmlId"]=t.getAttribute("bx-attach-xml-id");if(t.hasAttribute("bx-attach-file-type"))r["E"+e]["fileType"]=t.getAttribute("bx-attach-file-type")}}));i.diskUfHandler.selectFile({},{},r)}}))}},{key:"isReady",get:function e(){return!!this.diskUfUploader}}]);return i}(l);var c;var u=function(e){babelHelpers.inherits(i,e);function i(e,n){var a;babelHelpers.classCallCheck(this,i);a=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,e,n));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"id","uploadfile");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"buttonParams",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"regexp",/\[FILE ID=((?:\s|\S)*?)?\]/gi);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"values",new Map);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"controllers",new Map);a.checkButtonsDebounced=r.Runtime.debounce(a.checkButtons,500,babelHelpers.assertThisInitialized(a));a.init();t.EventEmitter.subscribe(e.getEditor(),"OnContentChanged",a.checkButtons.bind(babelHelpers.assertThisInitialized(a)));t.EventEmitter.subscribe(e.getEventObject(),"onReinitializeBefore",(function(e){var t=babelHelpers.slicedToArray(e.data,2),i=t[0],n=t[1];a.reinit(i,n)}));return a}babelHelpers.createClass(i,[{key:"init",value:function e(){var i=this;Array.from(this.editor.getContainer().querySelectorAll(".file-selectdialog")).forEach((function(e,n){var r=e.id.replace("file-selectdialog-","");var a=i.controllers.get(r);if(!a){a=new l(r,e,i.editor);t.EventEmitter.subscribe(e.parentNode,"OnFileUploadSuccess",(function(t){var n=babelHelpers.slicedToArray(t.data,2),a=n[0].element_id,o=n[1],s=o.id,l=o.doc_prefix,d=o.CID;if(r===s){var c=document.querySelector("#"+i.editor.getFormId())?document.querySelector("#"+i.editor.getFormId()).querySelector("#upload-cid"):null;if(c){c.value=d}var u=i.parseFile(e.querySelector("#"+l+a)),f=babelHelpers.slicedToArray(u,2),p=f[0],h=f[1];i.values.set(p,h)}}));t.EventEmitter.subscribe(e.parentNode,"OnFileUploadRemove",(function(e){var t=babelHelpers.slicedToArray(e.compatData,2),n=t[0],a=t[1].id;if(r===a&&i.values.has(n)){i.values["delete"](n);i.deleteFile([n])}}));if(n===0){t.EventEmitter.subscribe(i.editor.getEventObject(),"onFilesHaveCaught",(function(e){e.stopImmediatePropagation();if(window["BfileFD"+r]){window["BfileFD"+r].agent.UploadDroppedFiles(babelHelpers.toConsumableArray(e.getData()))}}))}}if(e.querySelector("table.files-list")){Array.from(e.querySelector("table.files-list").querySelectorAll("tr")).forEach((function(e){var t=i.parseFile(e),n=babelHelpers.slicedToArray(t,2),r=n[0],a=n[1];i.values.set(r,a)}))}}))}},{key:"parseFile",value:function e(t){var i=this;var n=t.id.replace("wd-doc","");var a={id:n,name:t.querySelector('[data-role="name"]')?t.querySelector('[data-role="name"]').innerHTML:t.querySelector("span.f-wrap").innerHTML,node:t,buttonNode:t.querySelector('[data-role="button-insert"]'),image:{src:null,lowsrc:null,width:null,height:null}};var o=function e(){i.insertFile(n,t)};var s=t.querySelector(".f-wrap");if(s){s.addEventListener("click",o);s.style.cursor="pointer";s.title=r.Loc.getMessage("MPF_FILE")}var l=t.querySelector("img");if(l){l.addEventListener("click",o);l.title=r.Loc.getMessage("MPF_FILE");l.style.cursor="pointer";a.image.lowsrc=l.lowsrc||l.src;a.image.src=l.rel||l.src;a.image.width=l.getAttribute("data-bx-full-width");a.image.height=l.getAttribute("data-bx-full-height")}if(t instanceof HTMLTableRowElement&&t.querySelector(".files-info")){if(!a.buttonNode){a.buttonNode=r.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n<span type="button" onclick="','" data-role="button-insert" class="insert-btn">\n\t<span data-role="insert-btn" class="insert-btn-text">','</span>\n\t<span data-role="in-text-btn" class="insert-btn-text">',"</span>\n</span>"])),o,r.Loc.getMessage("MPF_FILE_INSERT_IN_TEXT"),r.Loc.getMessage("MPF_FILE_IN_TEXT"));t.querySelector(".files-info").appendChild(a.buttonNode);this.checkButtonsDebounced()}}return[n,a]}},{key:"buildHTML",value:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var r=this.htmlEditor.SetBxTag(false,{tag:this.id,fileId:t});var a='<span data-bx-file-id="'.concat(t,'" id="').concat(r,'" style="color: #2067B0; border-bottom: 1px dashed #2067B0; margin:0 2px;">').concat(i.name,"</span>");if(i.image.src){var o=[];if(n){o.push('style="width:'.concat(n.width,"px;height:").concat(n.height,'px;"'))}else if(i.image.width&&i.image.height){o.push('style="width:'.concat(i.image.width,"px;height:").concat(i.image.height,'px;" '));o.push("onload=\"this.style.width='auto';this.style.height='auto';\"")}a='<img style="max-width: 90%;"  data-bx-file-id="'.concat(t,'" id="').concat(r,'" src="').concat(i.image.src,'" lowsrc="').concat(i.image.lowsrc,'" ').concat(o.join(" "),"/>")}return a}},{key:"buildText",value:function e(t,i){return"[FILE ID=".concat(t).concat(i||"","]")}},{key:"insertFile",value:function e(i,n){var r=this.values.get(String(i));if(r){t.EventEmitter.emit(this.editor.getEventObject(),"OnInsertContent",[this.buildText(i),this.buildHTML(i,r)])}}},{key:"deleteFile",value:function e(t){var i=this.htmlEditor.GetContent();if(this.htmlEditor.GetViewMode()==="wysiwyg"){var n=this.htmlEditor.GetIframeDoc();for(var r in this.htmlEditor.bxTags){if(this.htmlEditor.bxTags.hasOwnProperty(r)&&babelHelpers["typeof"](this.htmlEditor.bxTags[r])==="object"&&this.htmlEditor.bxTags[r]["tag"]===this.id&&t.indexOf(String(this.htmlEditor.bxTags[r]["fileId"]))>=0&&n.getElementById(r)){var a=n.getElementById(r);a.parentNode.removeChild(a)}}this.htmlEditor.SaveContent()}else{var o=i.replace(this.regexp,(function(e,i){return t.indexOf(i)>=0?"":e}));this.htmlEditor.SetContent(o);this.htmlEditor.Focus()}}},{key:"checkButtons",value:function e(t){var i=t?t.compatData[0]:this.htmlEditor.GetContent();var n=babelHelpers.toConsumableArray(i.matchAll(this.regexp)).map((function(e){var t=babelHelpers.slicedToArray(e,2),i=t[0],n=t[1];return n}));this.values.forEach((function(e,t){if(!e.buttonNode){return}var i=n.indexOf(t)>=0;if(i===true&&e.buttonNode.className!=="insert-text"){e.buttonNode.className="insert-text";e.buttonNode.querySelector('[data-role="insert-btn"]').style.display="none";e.buttonNode.querySelector('[data-role="in-text-btn"]').style.display=""}else if(i!==true&&e.buttonNode.className!=="insert-btn"){e.buttonNode.className="insert-btn";e.buttonNode.querySelector('[data-role="insert-btn"]').style.display="";e.buttonNode.querySelector('[data-role="in-text-btn"]').style.display="none"}}))}},{key:"reinit",value:function e(t,i){this.values.forEach((function(e,t){if(e.node&&e.node.parentNode){e.node.parentNode.removeChild(e.node)}}));this.values.clear();this.controllers.forEach((function(e){e.reinitFrom(i)}))}},{key:"parse",value:function e(t){if(!this.regexp.test(t)){return t}t=t.replace(this.regexp,function(e,t,i,n){if(this.values.has(t)){return this.buildHTML(t,this.values.get(t),i>0&&n>0?{width:i,height:n}:null)}return e}.bind(this));return t}},{key:"unparse",value:function e(t,i){var n=i.node;var r=parseInt(n.hasAttribute("width")?n.getAttribute("width"):0);var a=parseInt(n.hasAttribute("height")?n.getAttribute("height"):0);var o="";if(r>0&&a>0){o=" WIDTH="+r+" HEIGHT="+a}var s=n.getAttribute("data-bx-file-id");return this.buildText(s,o)}}]);return i}(a);var f=function(e){babelHelpers.inherits(i,e);function i(e,n){var r;babelHelpers.classCallCheck(this,i);r=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,e,n));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"id","uploadimage");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"buttonParams",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"regexp",/\[IMAGE ID=((?:\s|\S)*?)?\]/gi);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"values",new Map);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"controllers",new Map);r.init();console.log("PostImage: ");t.EventEmitter.subscribe(e.getEventObject(),"onReinitializeBefore",(function(e){var t=babelHelpers.slicedToArray(e.data,2),i=t[0],n=t[1];r.reinit(i,n)}));return r}babelHelpers.createClass(i,[{key:"init",value:function e(){var i=this;Array.from(this.editor.getContainer().querySelectorAll(".file-selectdialog")).forEach((function(e){var n=e.id.replace("file-selectdialog-","");var r=i.controllers.get(n);if(!r){r=new l(n,e,i.editor);t.EventEmitter.subscribe(e.parentNode,"OnFileUploadSuccess",(function(t){var r=babelHelpers.slicedToArray(t.data,2),a=r[0].element_id,o=r[1],s=o.id,l=o.doc_prefix,d=o.CID;if(n===s){var c=document.querySelector("#"+i.editor.getFormId())?document.querySelector("#"+i.editor.getFormId()).querySelector("#upload-cid"):null;if(c){c.value=d}var u=i.parseFile(e.querySelector("#"+l+a)),f=babelHelpers.slicedToArray(u,2),p=f[0],h=f[1];i.values.set(p,h)}}));t.EventEmitter.subscribe(e.parentNode,"OnFileUploadRemove",(function(e){var t=babelHelpers.slicedToArray(e.compatData,2),r=t[0],a=t[1].id;if(n===a&&i.values.has(r)){i.values["delete"](r)}}))}if(e.querySelector("table.files-list")){Array.from(e.querySelector("table.files-list").querySelectorAll("tr")).forEach((function(e){var t=i.parseFile(e),n=babelHelpers.slicedToArray(t,2),r=n[0],a=n[1];i.values.set(r,a)}))}}))}},{key:"parseFile",value:function e(t){var i=t.id.replace("wd-doc","");var n={id:i,name:t.querySelector('[data-role="name"]')?t.querySelector('[data-role="name"]').innerHTML:t.querySelector("span.f-wrap").innerHTML,node:t,image:{src:null,lowsrc:null,width:null,height:null}};return[i,n]}},{key:"reinit",value:function e(t,i){this.values.forEach((function(e,t){if(e.node&&e.node.parentNode){e.node.parentNode.removeChild(e.node)}}));this.values.clear();this.controllers.forEach((function(e){e.reinitFrom(i)}))}},{key:"parse",value:function e(t){return t}},{key:"unparse",value:function e(t,i){var n=i.node;return""}}]);return i}(a);var p;var h=function(e){babelHelpers.inherits(i,e);function i(){var e;var t;babelHelpers.classCallCheck(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++){r[a]=arguments[a]}t=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(i)).call.apply(e,[this].concat(r)));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"id","diskfile");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"regexp",/\[(?:DOCUMENT ID|DISK FILE ID)=([n0-9]+)\]/gi);return t}babelHelpers.createClass(i,[{key:"init",value:function e(){var i=this;Array.from(this.editor.getContainer().querySelectorAll(".diskuf-selectdialog")).forEach((function(e,n){var r=e.id.replace("diskuf-selectdialog-","");var a=i.controllers.get(r);if(!a){a=new d(r,e,i.editor);i.controllers.set(r,a);t.EventEmitter.subscribe(e.parentNode,"OnFileUploadSuccess",(function(t){var n=babelHelpers.slicedToArray(t.data,3),r=n[0].element_id,o=n[1].CID,s=n[2];if(a.getId()!==o||i.values.has(r)){return}var l=i.parseFile(e.querySelector("#disk-edit-attach"+r)),d=babelHelpers.slicedToArray(l,3),c=d[0],u=d[1],f=d[2];i.values.set(c,f);if(c!==u){i.values.set(u,f)}if(s&&s["insertImageAfterUpload"]&&f.image.src){i.insertFile(c,f.node)}}));t.EventEmitter.subscribe(e.parentNode,"OnFileUploadRemove",(function(e){var t=babelHelpers.slicedToArray(e.compatData,2),n=t[0],r=t[1].CID;if(a.getId()===r&&i.values.has(n)){var o=i.values.get(n);i.values["delete"](o.id);i.values["delete"](o.fileId);i.deleteFile([o.id,o.fileId])}}));t.EventEmitter.subscribe(e.parentNode,"OnFileUploadFailed",(function(e){var t=babelHelpers.slicedToArray(e.compatData,3),n=t[0],r=t[1].CID,o=t[2];if(a.getId()===r&&o&&o["referrerToEditor"]){BX.onCustomEvent(o["referrerToEditor"],"OnImageDataUriCaughtFailed",[]);BX.onCustomEvent(i.editor,"OnImageDataUriCaughtFailed",[o["referrerToEditor"]])}}));if(n===0){b(i,a,e,i.editor);m(i,a,e,i.editor);t.EventEmitter.subscribe(i.editor.getEventObject(),"onFilesHaveCaught",(function(e){e.stopImmediatePropagation();a.diskUfUploader.onChange(babelHelpers.toConsumableArray(e.getData()))}))}}if(e.querySelector("table.files-list")){Array.from(e.querySelector("table.files-list").querySelectorAll("tr")).forEach((function(e){var t=i.parseFile(e),n=babelHelpers.slicedToArray(t,3),r=n[0],a=n[1],o=n[2];i.values.set(r,o);if(r!==a){i.values.set(a,o)}}))}}))}},{key:"parseFile",value:function e(t){var i=this;var n=String(t.id.replace("disk-edit-attach",""));var a={id:n,name:t.querySelector('[data-role="name"]')?t.querySelector('[data-role="name"]').innerHTML:t.querySelector("span.f-wrap").innerHTML,fileId:t.getAttribute("bx-attach-file-id"),node:t,buttonNode:t.querySelector('[data-role="button-insert"]'),image:{src:null,lowsrc:null,width:null,height:null}};var o=t.querySelector(".f-wrap");var s=function e(){i.insertFile(n,t)};if(o){o.addEventListener("click",s);o.style.cursor="pointer";o.title=r.Loc.getMessage("MPF_FILE")}var l=t.querySelector("img.files-preview");if(l&&(l.src.indexOf("bitrix/tools/disk/uf.php")>=0||l.src.indexOf("/disk/showFile/")>=0)){l.addEventListener("click",s);l.title=r.Loc.getMessage("MPF_FILE");l.style.cursor="pointer";a.image.lowsrc=l.lowsrc||l.src;a.image.src=(l.rel||l.getAttribute("data-bx-src")||l.src).replace(/&(width|height)=\d+/gi,"");var d=function e(){a.image.width=l.getAttribute("data-bx-full-width");a.image.height=l.getAttribute("data-bx-full-height")};l.addEventListener("load",d);if(l.complete){d()}}if(t instanceof HTMLTableRowElement&&!a.buttonNode){a.buttonNode=r.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['\n<span class="insert-btn" data-role="button-insert" onclick="','">\n\t<span data-role="insert-btn" class="insert-btn-text">','</span>\n\t<span data-role="in-text-btn" class="insert-btn-text" style="display: none;">',"</span>\n</span>"])),s,r.Loc.getMessage("MPF_FILE_INSERT_IN_TEXT"),r.Loc.getMessage("MPF_FILE_IN_TEXT"));setTimeout((function(){if(t.querySelector(".files-info")){t.querySelector(".files-info").appendChild(a.buttonNode);i.checkButtonsDebounced()}}))}return[n,a.fileId,a]}},{key:"buildText",value:function e(t,i){return"[DISK FILE ID=".concat(t).concat(i||"","]")}}]);return i}(u);function b(e,i,n,r){t.EventEmitter.subscribe(r.getEventObject(),"OnVideoHasCaught",(function(r){var a=r.getData();var o=function i(r){var o=babelHelpers.slicedToArray(r.data,3),s=o[0].element_id;babelHelpers.objectDestructuringEmpty(o[1]);var l=o[2];if(a===l&&e.values.has(s)){t.EventEmitter.unsubscribe(n.parentNode,"OnFileUploadSuccess",i);e.insertFile(s,e.values.get(s).node)}};t.EventEmitter.subscribe(n.parentNode,"OnFileUploadSuccess",o);i.exec((function(){i.diskUfUploader.onChange([a])}));r.stopImmediatePropagation()}))}function m(e,i,n,r){t.EventEmitter.subscribe(r.getEventObject(),"OnImageHasCaught",(function(r){r.stopImmediatePropagation();var a=r.getData();return new Promise((function(o,s){var l=function i(r){var s=babelHelpers.slicedToArray(r.data,3),l=s[0].element_id;babelHelpers.objectDestructuringEmpty(s[1]);var c=s[2];if(a===c&&e.values.has(l)){t.EventEmitter.unsubscribe(n.parentNode,"OnFileUploadSuccess",i);t.EventEmitter.unsubscribe(n.parentNode,"OnFileUploadFailed",d);var u=e.values.get(l);var f=e.buildHTML(l,u);o({image:u.image,html:f})}};var d=function e(i){var r=babelHelpers.slicedToArray(i.data,3),o=r[0];babelHelpers.objectDestructuringEmpty(r[1]);var d=r[2];if(a===d){t.EventEmitter.unsubscribe(n.parentNode,"OnFileUploadSuccess",l);t.EventEmitter.unsubscribe(n.parentNode,"OnFileUploadFailed",e);s()}};t.EventEmitter.subscribe(n.parentNode,"OnFileUploadSuccess",l);t.EventEmitter.subscribe(n.parentNode,"OnFileUploadFailed",d);i.exec((function(){i.diskUfUploader.onChange([r.getData()])}))}))}))}function v(e,t,i){if(e==="Spoiler"){return new o(t,i)}else if(e==="MentionUser"){return new s(t,i)}else if(e==="UploadImage"){return new f(t,i)}else if(e==="UploadFile"){return new u(t,i)}else if(babelHelpers["typeof"](e)==="object"&&e["disk_file"]){return new h(t,i)}return null}function E(e,t){if(!t){return}BX.addCustomEvent(t,"onAutoSavePrepare",(function(t){t.FORM.setAttribute("bx-lhe-autosave-prepared","Y");setTimeout((function(){BX.addCustomEvent(e,"OnContentChanged",(function(e){t["mpfTextContent"]=e;t.Init()}))}),1500)}));BX.addCustomEvent(t,"onAutoSave",(function(e,t){if(BX.type.isNotEmptyString(e["mpfTextContent"]))t["text"]=e["mpfTextContent"]}));BX.addCustomEvent(t,"onAutoSaveRestore",(function(t,i){if(i["text"]&&/[^\s]+/gi.test(i["text"])){e.CheckAndReInit(i["text"])}}));if(t.hasAttribute("bx-lhe-autosave-prepared")&&t.BXAUTOSAVE){t.removeAttribute("bx-lhe-autosave-prepared");setTimeout(t.BXAUTOSAVE.Prepare,100)}}function g(e,t,i){var n=false;if(i.showPanelEditor!==true&&i.showPanelEditor!==false){i.showPanelEditor=!t.toolbar.IsShown();n=true}e.exec((function(){var n=e.getContainer().querySelector('[data-bx-role="button-show-panel-editor"]');if(i.showPanelEditor){t.dom.toolbarCont.style.opacity="inherit";t.toolbar.Show();if(n){n.classList.add("feed-add-post-form-btn-active")}}else{t.toolbar.Hide();if(n){n.classList.remove("feed-add-post-form-btn-active")}}}));if(n!==false){BX.userOptions.save("main.post.form","postEdit","showBBCode",i.showPanelEditor?"Y":"N")}}function y(e,t){if(!(t.urlPreviewId&&window["BXUrlPreview"]&&BX(t.urlPreviewId))){return}var i=new BXUrlPreview(BX(t.urlPreviewId));var n=function e(t){i.attachUrlPreview({url:t})};var r=function e(t,n,r,a){if(n==="createLink"&&BX.type.isPlainObject(a)&&a.hasOwnProperty("href")){i.attachUrlPreview({url:a.href})}};BX.addCustomEvent(e,"OnAfterUrlConvert",n);BX.addCustomEvent(e,"OnAfterLinkInserted",n);BX.addCustomEvent(e,"OnBeforeCommandExec",r);BX.addCustomEvent(e,"OnReinitialize",(function(e,t){i.detachUrlPreview();var n;for(var r in t){if(t.hasOwnProperty(r)&&t[r].hasOwnProperty("USER_TYPE_ID")&&t[r]["USER_TYPE_ID"]==="url_preview"){n=t[r]["VALUE"];break}}if(n){i.attachUrlPreview({id:n})}}))}function w(e,t){e.exec((function(){t.contextMenu.items["postimage"]=t.contextMenu.items["postdocument"]=t.contextMenu.items["postfile"]=[{TEXT:r.Loc.getMessage("BXEdDelFromText"),bbMode:true,ACTION:function e(){var i=t.contextMenu.GetTargetItem("postimage");if(!i)i=t.contextMenu.GetTargetItem("postdocument");if(!i)i=t.contextMenu.GetTargetItem("postfile");if(i&&i.element){t.selection.RemoveNode(i.element)}t.contextMenu.Hide()}}];if(t.toolbar.controls&&t.toolbar.controls.FontSelector){t.toolbar.controls.FontSelector.SetWidth(45)}}))}function B(e){var i=document.querySelector("#lhe_button_submit_"+e.getFormId());if(i){i.addEventListener("click",(function(i){t.EventEmitter.emit(e.getEventObject(),"OnButtonClick",["submit"]);i.preventDefault();i.stopPropagation()}))}var n=document.querySelector("#lhe_button_cancel_"+e.getFormId());if(n){n.addEventListener("click",(function(i){t.EventEmitter.emit(e.getEventObject(),"OnButtonClick",["cancel"]);i.preventDefault();i.stopPropagation()}))}}function I(e,i){var n=e.getContainer().querySelector('[data-bx-role="toolbar"]');if(n.querySelector('[data-id="file"]')){var r=n.querySelector('[data-id="file"]');if(r){r.addEventListener("click",(function(){t.EventEmitter.emit(e.getEventObject(),"onShowControllers",r.hasAttribute("data-bx-button-status")?"hide":"show")}));t.EventEmitter.subscribe(e.getEventObject(),"onShowControllers",(function(e){var t=e.data;if(t.toString()==="show"){r.setAttribute("data-bx-button-status","active")}else{r.removeAttribute("data-bx-button-status")}}));r.setAttribute("data-bx-files-count",0);t.EventEmitter.subscribe(e.getEventObject(),"onShowControllers:File:Increment",(function(e){var t=e.data;var i=t>0?t:1;var n=Math.max(parseInt(r.getAttribute("data-bx-files-count")||0)+i,0);if(n>0){if(!r["counterObject"]){r["counterObject"]=new BX.UI.Counter({value:n,color:BX.UI.Counter.Color.GRAY,animate:true});var a=r.querySelector("span");a.appendChild(r["counterObject"].getContainer())}else{r["counterObject"].update(n)}}r.setAttribute("data-bx-files-count",n)}));t.EventEmitter.subscribe(e.getEventObject(),"onShowControllers:File:Decrement",(function(e){var t=e.data;var i=t>0?t:1;var n=Math.max(parseInt(r.getAttribute("data-bx-files-count")||0)-i,0);r.setAttribute("data-bx-files-count",n);if(r["counterObject"]){r["counterObject"].update(n)}}))}}if(n.querySelector('[data-id="search-tag"]')){window["BXPostFormTags_"+e.getFormId()]=new BXPostFormTags(e.getFormId(),n.querySelector('[data-id="search-tag"]'))}if(n.querySelector('[data-id="create-link"]')){n.querySelector('[data-id="create-link"]').addEventListener("click",(function(e){i.toolbar.controls.InsertLink.OnClick(e)}))}if(n.querySelector('[data-id="video"]')){n.querySelector('[data-id="video"]').addEventListener("click",(function(e){i.toolbar.controls.InsertVideo.OnClick(e)}))}if(n.querySelector('[data-id="quote"]')){var a=n.querySelector('[data-id="quote"]');a.setAttribute("data-bx-type","action");a.setAttribute("data-bx-action","quote");a.addEventListener("mousedown",(function(e){i.toolbar.controls.Quote.OnMouseDown.apply(i.toolbar.controls.Quote,[e]);i.CheckCommand(a)}))}if(e.getContainer().querySelector('[data-bx-role="button-show-panel-editor"]')){e.getContainer().querySelector('[data-bx-role="button-show-panel-editor"]').addEventListener("click",(function(){e.showPanelEditor()}))}}var S;var C;function T(e,t){if(!C){C=new IntersectionObserver((function(e){e.forEach((function(e){if(e.isIntersecting){C.unobserve(e.target);var t=e.target.observedCallback;delete e.target.observedCallback;setTimeout(t)}}))}),{threshold:0})}e.observedCallback=t;C.observe(e)}var P=0;var O=function(){function e(t,i){babelHelpers.classCallCheck(this,e);this.container=i.querySelector('[data-bx-role="toolbar"]');this.adjustMorePosition=this.adjustMorePosition.bind(this);this.moreItem=i.querySelector('[data-bx-role="toolbar-item-more"]');this.moreItem.addEventListener("click",this.showSubmenu.bind(this));T(this.container,this.adjustMorePosition);window.addEventListener("resize",this.adjustMorePosition)}babelHelpers.createClass(e,[{key:"insertAfter",value:function e(t,i){if(!r.Type.isElementNode(t["BODY"])&&!r.Type.isStringFilled(t["BODY"])){return}var n=r.Tag.render(S||(S=babelHelpers.taggedTemplateLiteral(['<div class="main-post-form-toolbar-button" data-bx-role="toolbar-item"></div>'])));if(r.Type.isElementNode(t["BODY"])){n.appendChild(t["BODY"])}else{n.innerHTML=t["BODY"]}if(t["ID"]){n.setAttribute("data-id",t["ID"])}if(i!==null){var a=false;var o=null;Array.from(this.container.querySelectorAll('[data-bx-role="toolbar-item"]')).forEach((function(e){if(a===true&&o===null){o=e}else if(a===false&&e&&e.dataset&&e.dataset.id===i){a=true}}));if(o){o.parentNode.insertBefore(n,o)}}if(!n.parentNode){this.container.appendChild(n)}this.adjustMorePosition()}},{key:"getItems",value:function e(){return Array.from(this.container.querySelectorAll('[data-bx-role="toolbar-item"]'))}},{key:"getVisibleItems",value:function e(){var t=this;var i=[];Array.from(this.container.querySelectorAll('[data-bx-role="toolbar-item"]')).forEach((function(e){if(e.offsetTop>t.container.clientHeight/2){i.push(e)}}));return i}},{key:"getHiddenItems",value:function e(){var t=[];Array.from(this.container.querySelectorAll('[data-bx-role="toolbar-item"]')).forEach((function(e){if(e.offsetTop>0){t.push(e)}}));return t}},{key:"adjustMorePosition",value:function e(){var t=this.getVisibleItems().length;if(t<=0||t>=this.getItems().length){this.moreItem.style.display="none"}else{this.moreItem.style.display=""}}},{key:"getPopup",value:function e(){var t=this;if(!this.popup){this.popup=n.PopupManager.create({id:"main_post_form_toolbar_"+P++,className:"main-post-form-toolbar-popup",cacheable:false,content:this.getPopupContainer(),closeByEsc:true,autoHide:true,angle:true,bindElement:this.moreItem,offsetTop:-5,offsetLeft:5,events:{onClose:function e(){Array.from(t.getPopupContainer().querySelectorAll('[data-bx-role="toolbar-item"]')).forEach((function(e){t.container.appendChild(e)}));delete t.popup}}})}return this.popup}},{key:"getPopupContainer",value:function e(){if(!this.popupContainer){this.popupContainer=document.createElement("DIV")}return this.popupContainer}},{key:"showSubmenu",value:function e(){var t=this;var i=this.getHiddenItems();if(i.length<=0){return}i.forEach((function(e){t.getPopupContainer().appendChild(e)}));this.getPopup().show()}}]);return e}();var x=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"showPopup",value:function e(t){var i=n.PopupManager.getPopupById(this.getPopupId());if(!i){i=new n.Popup(this.getPopupId(),null,{content:this.getTasksLimitPopupContent(),lightShadow:false,offsetLeft:20,autoHide:false,angle:{position:"bottom"},closeByEsc:false,closeIcon:true})}i.setBindElement(t.bindPosition);i.show()}},{key:"getPopupId",value:function e(){return"bx-post-mention-tasks-limit-popup"}},{key:"getTasksLimitPopupContent",value:function e(){return r.Dom.create("DIV",{style:{width:"400px",padding:"10px"},children:[r.Dom.create("SPAN",{html:r.Loc.getMessage("MPF_MENTION_TASKS_LIMIT").replace("#A_BEGIN#",'<a href="javascript:void(0);" onclick="BX.Main.PostFormTasksLimit.onClickTasksLimitPopupSlider();">').replace("#A_END#","</a>")})]})}},{key:"onClickTasksLimitPopupSlider",value:function e(){this.hidePopup();BX.UI.InfoHelper.show("limit_tasks_observers_participants",{isLimit:true,limitAnalyticsLabels:{module:"tasks",source:"postForm",subject:"auditor"}})}},{key:"hidePopup",value:function e(){var t=n.PopupManager.getPopupById(this.getPopupId());if(t){t.close()}}}]);return e}();function X(e,t,i){H(e,t);k(i,"get");return F(e,i)}function k(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function H(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function F(e,t){if(t.get){return t.get.call(e)}return t.value}var A=function(){function e(i,n){var a=this;babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"jobs",new Map);babelHelpers.defineProperty(this,"editorParams",{height:100,ctrlEnterHandler:null,parsers:null,showPanelEditor:false,lazyLoad:true,urlPreviewId:null,tasksLimitExceeded:false});babelHelpers.defineProperty(this,"actionQueue",[]);this.id=i["id"];this.name=i["name"];this.formId=i["formId"];this.eventNode=i.eventNode||document.querySelector("#div"+(this.name||this.id));this.eventNode.dataset.bxHtmlEditable="Y";this.formEntityType=null;e.repo.set(this.getId(),this);if(!r.Type.isArray(n.parsers)&&r.Type.isPlainObject(n.parsers)){n.parsers=Object.values(n.parsers)}this.setEditorParams(n);this.bindEvents(window["BXHtmlEditor"]?window["BXHtmlEditor"].Get(this.getId()):null);this.toolbar=new O(this.getEventObject(),this.getContainer());this.inited=true;if(this.name!==null){window[this.name]=this}BX.onCustomEvent(this,"onInitialized",[this,this.getFormId()]);t.EventEmitter.subscribe(this.getEventObject(),"OnFileUploadSuccess",(function(e){var t=e.compatData;BX.onCustomEvent(a.getEventObject(),"onFileIsAdded",t)}));t.EventEmitter.subscribe(this.getEventObject(),"onBusy",(function(e){var i=e.data;if(a.jobs.size<=0){t.EventEmitter.emit(a.getEventObject(),"onLHEIsBusy")}a.jobs.set(i,(a.jobs.get(i)||0)+1)}));t.EventEmitter.subscribe(this.getEventObject(),"onReady",(function(e){var i=e.data;if(a.jobs.size<=0||!a.jobs.has(i)){return}var n=a.jobs.get(i);if(n<=1){a.jobs["delete"](i);if(a.jobs.size<=0){t.EventEmitter.emit(a.getEventObject(),"onLHEIsReady")}}else{a.jobs.set(i,--n)}}))}babelHelpers.createClass(e,[{key:"setEditorParams",value:function e(t){this.editorParams=Object.assign(this.editorParams,t)}},{key:"bindEvents",value:function e(){var i=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;this.events={};[["OnEditorInitedBefore",this.OnEditorInitedBefore.bind(this)],["OnCreateIframeAfter",this.OnCreateIframeAfter.bind(this)],["OnEditorInitedAfter",this.OnEditorInitedAfter.bind(this)]].forEach((function(e){var t=babelHelpers.slicedToArray(e,2),r=t[0],a=t[1];if(!n){i.events[r]=function(e){if(e.id===i.getId()){
//!it important to use deprecated eventEmitter
BX.removeCustomEvent(r,i.events[r]);delete i.events[r];a(e)}};//!it important to use deprecated eventEmitter
BX.addCustomEvent(r,i.events[r])}else{a(n)}}));t.EventEmitter.subscribe(this.getEventObject(),"OnShowLHE",this.OnShowLHE.bind(this));t.EventEmitter.subscribe(this.getEventObject(),"OnButtonClick",this.OnButtonClick.bind(this));t.EventEmitter.subscribe(this.getEventObject(),"OnParserRegister",(function(e){var t=e.data;i.addParser(t)}));t.EventEmitter.subscribe(this.getEventObject(),"OnGetHTMLEditor",(function(e){var t=e.data;t.htmlEditor=i.getEditor()}));t.EventEmitter.subscribe(this.getEventObject(),"OnInsertContent",(function(e){var t=babelHelpers.slicedToArray(e.data,2),n=t[0],r=t[1];i.insertContent(n,r)}));t.EventEmitter.subscribe(this.getEventObject(),"OnAddButton",(function(e){var t=babelHelpers.slicedToArray(e.data,2),n=t[0],r=t[1];i.getToolbar().insertAfter(n,r)}));B(this)}},{key:"getId",value:function e(){return this.id}},{key:"setEditor",value:function i(n){var a=this;if(this.htmlEditor===n){return}this.htmlEditor=n;n.formID=this.getFormId();t.EventEmitter.subscribe(n,"OnCtrlEnter",(function(){n.SaveContent();if(r.Type.isFunction(a.editorParams.ctrlEnterHandler)){a.editorParams.ctrlEnterHandler()}else if(r.Type.isStringFilled(a.editorParams.ctrlEnterHandler)&&window[a.editorParams.ctrlEnterHandler]){window[a.editorParams.ctrlEnterHandler]()}else if(document.forms[a.getFormId()]){BX.submit(document.forms[a.getFormId()])}}));this.editorParams["height"]=n.config["height"];console.groupCollapsed("main.post.form: parsers: ",this.getId());this.editorParams.parsers.forEach((function(e){var t=v(e,a,n);if(t){console.groupCollapsed(e);console.log(t);if(t.hasButton()){n.AddButton(t.getButton())}n.AddParser(t.getParser());console.groupEnd(e)}}));console.groupEnd("main.post.form: parsers: ",this.getId());t.EventEmitter.subscribe(n,"OnImageDataUriHandle",(function(e){var i=babelHelpers.slicedToArray(e.compatData,2),r=i[0],o=i[1];var s=BX.UploaderUtils.dataURLToBlob(o.src);if(s&&s.size>0&&s.type.indexOf("image/")===0){t.EventEmitter.emit(a.getEventObject(),"onShowControllers","show");s.name=s.name||o.title||"image."+s.type.substr(6);s.referrerToEditor=o;t.EventEmitter.emit(a.getEventObject(),"OnImageHasCaught",new t.BaseEvent({data:s})).forEach((function(e){e.then((function(e){var i=e.image,r=e.html;t.EventEmitter.emit(n,"OnImageDataUriCaughtUploaded",new t.BaseEvent({compatData:[o,i,{replacement:r}]}))}))["catch"]((function(){t.EventEmitter.emit(n,"OnImageDataUriCaughtFailed",new t.BaseEvent({compatData:[o]}))}))}))}}));t.EventEmitter.subscribe(t.EventEmitter.GLOBAL_TARGET,"onAddVideoMessage",(function(e){var i=babelHelpers.slicedToArray(e.compatData,2),n=i[0],r=i[1];if(!r||a.getFormId()!==r){return}t.EventEmitter.emit(a.getEventObject(),"onShowControllers","show");t.EventEmitter.emit(a.getEventObject(),"OnVideoHasCaught",new t.BaseEvent({data:n}))}));(function(){var i=BX("micro"+(a.name||a.id));var n=false;var r=0;var o=function e(t){t.preventDefault();t.stopPropagation();if(r>0){clearTimeout(r);r=0}if(n===true){return}var o=t&&t["dataTransfer"]&&t["dataTransfer"]["types"]&&t["dataTransfer"]["types"].indexOf("Files")>=0;if(o){n=true;a.getContainer().classList.add("feed-add-post-dnd-over");if(i){i.classList.add("feed-add-post-micro-dnd-ready")}}return true};var s=function e(t){t.preventDefault();t.stopPropagation();if(r>0){clearTimeout(r)}r=setTimeout((function(){n=false;a.getContainer().classList.remove("feed-add-post-dnd-over");if(i){i.classList.remove("feed-add-post-micro-dnd-ready")}}),100);return false};var l=function e(i){s(i);if(i&&i["dataTransfer"]&&i["dataTransfer"]["types"]&&i["dataTransfer"]["types"].indexOf("Files")>=0&&i["dataTransfer"]["files"]&&i["dataTransfer"]["files"].length>0){t.EventEmitter.emit(a.getEventObject(),"OnShowLHE",new t.BaseEvent({compatData:["justShow",{onShowControllers:"show"}]}));t.EventEmitter.emit(a.getEventObject(),"onFilesHaveCaught",new t.BaseEvent({data:i["dataTransfer"]["files"]}))}return false};a.getContainer().addEventListener("dragover",o);a.getContainer().addEventListener("dragenter",o);a.getContainer().addEventListener("dragleave",s);a.getContainer().addEventListener("dragexit",s);a.getContainer().addEventListener("drop",l);a.getContainer().setAttribute("dropzone","copy f:*/*");if(!document.body.hasAttribute("dropzone")){document.body.setAttribute("dropzone","copy f:*/*");document.body.addEventListener("dragover",(function(e){e.preventDefault();e.stopPropagation();return true}));document.body.addEventListener("drop",function(i){i.preventDefault();i.stopPropagation();if(i&&i["dataTransfer"]&&i["dataTransfer"]["types"]&&i["dataTransfer"]["types"].indexOf("Files")>=0&&i["dataTransfer"]["files"]&&i["dataTransfer"]["files"].length>0){var n;var r;var a=X(this.constructor,e,D).keys();while((r=a.next())&&r.done!==true&&r.value){n=r.value}if(n){t.EventEmitter.emit(n.getEventObject(),"OnShowLHE",new t.BaseEvent({compatData:["justShow",{onShowControllers:"show"}]}));t.EventEmitter.emit(n.getEventObject(),"onFilesHaveCaught",new t.BaseEvent({data:i["dataTransfer"]["files"]}))}}return false}.bind(a))}if(i){i.addEventListener("dragenter",(function(e){o(e);t.EventEmitter.emit(a.getEventObject(),"OnShowLHE",new t.BaseEvent({compatData:["justShow",{onShowControllers:"show"}]}))}))}t.EventEmitter.subscribe(a.getEditor(),"OnIframeDrop",(function(e){var t=babelHelpers.slicedToArray(e.data,1),i=t[0];return l(i)}));t.EventEmitter.subscribe(a.getEditor(),"OnIframeDragOver",(function(e){var t=babelHelpers.slicedToArray(e.data,1),i=t[0];return o(i)}));t.EventEmitter.subscribe(a.getEditor(),"OnIframeDragLeave",(function(e){var t=babelHelpers.slicedToArray(e.data,1),i=t[0];return s(i)}))})();t.EventEmitter.subscribe(n,"OnInsertContent",(function(e){var t=babelHelpers.slicedToArray(e.data,2),i=t[0],n=t[1];a.insertContent(i,n)}));g(this,n,this.editorParams);y(n,this.editorParams);w(this,n);E(n,BX(this.getFormId()));I(this,n);t.EventEmitter.subscribe(this.getEventObject(),"OnAfterShowLHE",(function(){a.getEditor().AllowBeforeUnloadHandler()}));t.EventEmitter.subscribe(this.getEventObject(),"OnAfterHideLHE",(function(){x.hidePopup();a.getEditor().DenyBeforeUnloadHandler()}));t.EventEmitter.subscribe(n,"OnIframeClick",(function(){var e=new MouseEvent("click",{bubbles:true,cancelable:true,view:window});n.iframeView.container.dispatchEvent(e)}))}},{key:"getEditor",value:function e(){return this.htmlEditor}},{key:"getFormId",value:function e(){return this.formId}},{key:"getEventObject",value:function e(){return this.eventNode}},{key:"getContainer",value:function e(){return this.eventNode}},{key:"getToolbar",value:function e(){return this.toolbar}},{key:"OnEditorInitedBefore",value:function e(t){this.setEditor(t)}},{key:"OnCreateIframeAfter",value:function e(){if(this.editorIsLoaded!==true){this.editorIsLoaded=true;this.exec();t.EventEmitter.emit(this,"OnEditorIsLoaded",[])}}},{key:"OnEditorInitedAfter",value:function e(i){if(!this.editorParams.lazyLoad){t.EventEmitter.emit(this.getEventObject(),"OnShowLHE",new t.BaseEvent({compatData:["justShow",i,false]}))}if(i.sandbox&&i.sandbox.inited){this.OnCreateIframeAfter()}}},{key:"addParser",value:function e(t){var i=this;this.exec((function(){t.init(i.getEditor());i.getEditor().AddParser({name:t.id,obj:{Parse:function e(i,n){return t.parse(n)},UnParse:t.unparse}});if(!i["addParserAfterDebounced"]){i.addParserAfterDebounced=r.Runtime.debounce((function(){i.getEditor().SetContent(i.getEditor().GetContent().replace(/&#91;/gi,"[").replace(/&#93;/gi,"]"),true)}),100)}i.addParserAfterDebounced()}))}},{key:"insertContent",value:function e(t){var i=this;var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;this.exec((function(){var e=i.getEditor().GetViewMode();if(e==="wysiwyg"){i.getEditor().InsertHtml(n||t);setTimeout(i.getEditor().AutoResizeSceleton.bind(i.getEditor()),500);setTimeout(i.getEditor().AutoResizeSceleton.bind(i.getEditor()),1e3)}else{i.getEditor().textareaView.Focus();if(!i.getEditor().bbCode){var r=i.getEditor().GetIframeDoc();var a=r.createElement("DIV");a.style.display="none";a.innerHTML=t;r.body.appendChild(a);t=i.getEditor().Parse(t,true,false);a.parentNode.removeChild(a)}i.getEditor().textareaView.WrapWith("","",t)}}))}},{key:"reinit",value:function e(i,n){var a="hide";if(r.Type.isPlainObject(n)&&Object.values(n).length){Object.values(n).forEach((function(e){if(e&&e["VALUE"]){a="show"}}))}t.EventEmitter.emit(this.getEventObject(),"onShowControllers",a);t.EventEmitter.emit(this.getEventObject(),"onReinitializeBefore",[i,n]);this.getEditor().CheckAndReInit(r.Type.isString(i)?i:"");BX.onCustomEvent(this.getEditor(),"onReinitialize",[this,i,n]);if(this.editorParams["height"]){this.oEditor.SetConfigHeight(this.editorParams["height"]);this.oEditor.ResizeSceleton()}}},{key:"OnShowLHE",value:function i(n){var a=this;var o=n.data,s=n.compatData;var l=o||s,d=babelHelpers.slicedToArray(l,3),c=d[0],u=d[1],f=d[2];if(!this.getEditor()&&window["BXHtmlEditor"]){window["BXHtmlEditor"].Get(this.getId()).Init()}c=c===false||c==="hide"||c==="justShow"?c:true;var p=BX("micro"+(this.name||this.id));if(p){p.style.display=c===true||c==="justShow"?"none":"block"}if(c==="hide"){X(this.constructor,e,D)["delete"](this);t.EventEmitter.emit(this.getEventObject(),"OnBeforeHideLHE");if(this.getContainer().style.display==="none"){t.EventEmitter.emit(this.getEventObject(),"OnAfterHideLHE");t.EventEmitter.emit(this.getEventObject(),"onShowControllers","hide")}else{new BX["easing"]({duration:200,start:{opacity:100,height:this.getContainer().scrollHeight},finish:{opacity:0,height:20},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function e(t){a.getContainer().style.height=t.height+"px";a.getContainer().style.opacity=t.opacity/100},complete:function e(){a.getContainer().style.cssText="";a.getContainer().style.display="none";t.EventEmitter.emit(a.getEventObject(),"OnAfterHideLHE");t.EventEmitter.emit(a.getEventObject(),"onShowControllers","hide")}}).animate()}}else if(c){X(this.constructor,e,D).set(this);this.formEntityType=r.Type.isArray(f)&&r.Type.isStringFilled(f[0])&&f[0].match(/^TASK_(\d+)$/i)?"task":null;if(u&&r.Type.isPlainObject(u)){if(u["onShowControllers"]){t.EventEmitter.emit(this.getEventObject(),"onShowControllers",u["onShowControllers"])}}t.EventEmitter.emit(this.getEventObject(),"OnBeforeShowLHE");if(c==="justShow"||this.getContainer().style.display==="block"){this.getContainer().style.display="block";t.EventEmitter.emit(this.getEventObject(),"OnAfterShowLHE");if(u!==false){this.getEditor().Focus()}}else{r.Dom.adjust(this.getContainer(),{style:{display:"block",overflow:"hidden",height:"20px",opacity:.1}});new BX["easing"]({duration:200,start:{opacity:10,height:20},finish:{opacity:100,height:this.getContainer().scrollHeight},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function e(t){a.getContainer().style.height=t.height+"px";a.getContainer().style.opacity=t.opacity/100},complete:function e(){t.EventEmitter.emit(a.getEventObject(),"OnAfterShowLHE");a.getEditor().Focus();a.getContainer().style.cssText=""}}).animate()}}else{X(this.constructor,e,D)["delete"](this);t.EventEmitter.emit(this.getEventObject(),"OnBeforeHideLHE");t.EventEmitter.emit(this.getEventObject(),"onShowControllers","hide");this.getContainer().style.display="none";t.EventEmitter.emit(this.getEventObject(),"OnAfterHideLHE")}}},{key:"OnButtonClick",value:function e(i){var n=babelHelpers.slicedToArray(i.data,1),r=n[0];if(r!=="cancel"){var a={result:true};t.EventEmitter.emit(this.getEventObject(),"OnClickBeforeSubmit",new t.BaseEvent({compatData:[this,a]}));if(a["result"]!==false){t.EventEmitter.emit(this.getEventObject(),"OnClickSubmit",new t.BaseEvent({compatData:[this]}))}}else{t.EventEmitter.emit(this.getEventObject(),"OnClickCancel",new t.BaseEvent({compatData:[this]}));t.EventEmitter.emit(this.getEventObject(),"OnShowLHE",new t.BaseEvent({compatData:["hide"]}))}}},{key:"exec",value:function e(t,i){if(typeof t=="function"){this.actionQueue.push([t,i])}if(this.editorIsLoaded===true){var n;while((n=this.actionQueue.shift())&&n){n[0].apply(this,n[1])}}}},{key:"showPanelEditor",value:function e(){g(this,this.getEditor(),{})}},{key:"getContent",value:function e(){return this.oEditor?this.oEditor.GetContent():""}},{key:"setContent",value:function e(t){if(this.getEditor()){this.getEditor().SetContent(t)}}},{key:"controllerInit",value:function e(i){t.EventEmitter.emit(this.getEventObject(),"onShowControllers",i==="hide"?"hide":"show")}},{key:"isReady",get:function e(){return this.editorIsLoaded}},{key:"oEditor",get:function e(){return this.getEditor()}},{key:"oEditorId",get:function e(){return this.getId()}},{key:"formID",get:function e(){return this.getFormId()}},{key:"params",get:function e(){return{formID:this.getFormId()}}},{key:"controllers",get:function e(){var i=new t.BaseEvent;var n={};i.setData(n);t.EventEmitter.emit(this.getEventObject(),"onCollectControllers",i);var a={};Object.keys(n).forEach((function(e){a[e]=Object.assign({},n[e]);a[e]["values"]={};if(r.Type.isArray(n[e]["values"])){n[e]["values"].forEach((function(t){a[e]["values"][t]={id:t}}))}else if(r.Type.isPlainObject(n[e]["values"])){a[e]["values"]=Object.assign({},n[e]["values"])}}));return a}},{key:"arFiles",get:function e(){var i=new t.BaseEvent;var n={};i.setData(n);t.EventEmitter.emit(this.getEventObject(),"onCollectControllers",i);var r={};Object.keys(n).forEach((function(e){if(n[e]["values"]){n[e]["values"].forEach((function(t){r[t]=[e]}))}}));return r}}]);return e}();babelHelpers.defineProperty(A,"repo",new Map);var D={writable:true,value:new Map};window["LHEPostForm"]={getEditor:function e(t){return window["BXHtmlEditor"]?window["BXHtmlEditor"].Get(babelHelpers["typeof"](t)=="object"?t.id:t):null},getHandler:function e(t){var i=r.Type.isStringFilled(t)?t:t.id;return A.repo.get(i)},getHandlerByFormId:function e(t){var i=null;A.repo.forEach((function(e){if(e.getFormId()===t){i=e}}));return i},reinitData:function e(t,i,n){var a={};if(!r.Type.isPlainObject(n)){n={}}Object.entries(n).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),i=t[0],n=t[1];if(r.Type.isPlainObject(n)&&n["USER_TYPE_ID"]&&n["VALUE"]&&Object.values(n["VALUE"]).length>0){a[i]=n}}));var o=this.getHandler(t);if(o&&(o.isReady||r.Type.isStringFilled(i)||Object.values(a).length>0)){o.exec(o.reinit,[i,a])}return false},reinitDataBefore:function e(i){var n=A.repo.get(i);if(n&&n.getEventObject()){t.EventEmitter.emit(n.getEventObject(),"onReinitializeBefore",[n])}}};e.PostForm=A;e.PostFormTasksLimit=x})(this.BX.Main=this.BX.Main||{},BX.Event,BX,BX.Main,BX);(function(){if(window["BXPostFormTags"])return;var e={selector:{},mentionParams:{}};window.BXPostFormTags=function(e,t){this.popup=null;this.formID=e;this.buttonID=t;this.sharpButton=null;this.addNewLink=null;this.tagsArea=null;this.hiddenField=null;this.popupContent=null;BX.ready(BX.proxy(this.init,this))};window.BXPostFormTags.prototype.init=function(){this.sharpButton=BX(this.buttonID);this.addNewLink=BX("post-tags-add-new-"+this.formID);this.tagsArea=BX("post-tags-block-"+this.formID);this.tagsContainer=BX("post-tags-container-"+this.formID);this.hiddenField=BX("post-tags-hidden-"+this.formID);this.popupContent=BX("post-tags-popup-content-"+this.formID);this.popupInput=BX.findChild(this.popupContent,{tag:"input"});var e=BX.findChildren(this.tagsContainer,{className:"feed-add-post-del-but"},true);for(var t=0,i=e.length;t<i;t++){BX.bind(e[t],"click",BX.proxy(this.onTagDelete,{obj:this,tagBox:e[t].parentNode,tagValue:e[t].parentNode.getAttribute("data-tag")}))}BX.bind(this.sharpButton,"click",BX.proxy(this.onButtonClick,this));BX.bind(this.addNewLink,"click",BX.proxy(this.onAddNewClick,this))};window.BXPostFormTags.prototype.onTagDelete=function(){BX.remove(this.tagBox);this.obj.hiddenField.value=this.obj.hiddenField.value.replace(this.tagValue+",","").replace("  "," ")};window.BXPostFormTags.prototype.show=function(){if(this.popup===null){this.popup=new BX.PopupWindow("bx-post-tag-popup",this.addNewLink,{content:this.popupContent,lightShadow:false,offsetTop:8,offsetLeft:10,autoHide:true,angle:true,closeByEsc:true,zIndex:-840,buttons:[new BX.PopupWindowButton({text:BX.message("TAG_ADD"),events:{click:BX.proxy(this.onTagAdd,this)}})]});BX.bind(this.popupInput,"keydown",BX.proxy(this.onKeyPress,this));BX.bind(this.popupInput,"keyup",BX.proxy(this.onKeyPress,this))}this.popup.show();BX.focus(this.popupInput)};window.BXPostFormTags.prototype.addTag=function(e){var t=BX.type.isNotEmptyString(e)?e.split(","):this.popupInput.value.split(",");var i=[];for(var n=0;n<t.length;n++){var r=BX.util.trim(t[n]);if(r.length>0){var a=this.hiddenField.value.split(",");if(!BX.util.in_array(r,a)){var o;var s=BX.create("span",{children:[o=BX.create("span",{attrs:{class:"feed-add-post-del-but"}})],attrs:{class:"feed-add-post-tags"}});s.insertBefore(document.createTextNode(r),o);this.tagsContainer.insertBefore(s,this.addNewLink);BX.bind(o,"click",BX.proxy(this.onTagDelete,{obj:this,tagBox:s,tagValue:r}));this.hiddenField.value+=r+",";i.push(r)}}}return i};window.BXPostFormTags.prototype.onTagAdd=function(){this.addTag();this.popupInput.value="";this.popup.close()};window.BXPostFormTags.prototype.onAddNewClick=function(e){e=e||window.event;this.show();BX.PreventDefault(e)};window.BXPostFormTags.prototype.onButtonClick=function(e){e=e||window.event;BX.show(this.tagsArea);this.show();BX.PreventDefault(e)};window.BXPostFormTags.prototype.onKeyPress=function(e){e=e||window.event;var t=e.keyCode?e.keyCode:e.which?e.which:null;if(t==13){setTimeout(BX.proxy(this.onTagAdd,this),0)}};window.BXPostFormImportant=function(e,t,i){if(i){this.formID=e;this.buttonID=t;this.inputName=i;this.fireButton=null;this.activeBlock=null;this.hiddenField=null;BX.ready(BX.proxy(this.init,this))}return false};window.BXPostFormImportant.prototype.init=function(){this.fireButton=BX(this.buttonID);this.activeBlock=BX(this.buttonID+"-active");var e=BX(this.formID);if(e){this.hiddenField=e[this.inputName];if(this.hiddenField&&this.hiddenField.value==1){this.showActive()}}BX.bind(this.fireButton,"click",BX.proxy((function(e){e=e||window.event;this.showActive();BX.PreventDefault(e)}),this));BX.bind(this.activeBlock,"click",BX.proxy((function(e){e=e||window.event;this.hideActive();BX.PreventDefault(e)}),this))};window.BXPostFormImportant.prototype.showActive=function(e){BX.hide(this.fireButton);BX.show(this.activeBlock,"inline-block");if(this.hiddenField){this.hiddenField.value=1}return false};window.BXPostFormImportant.prototype.hideActive=function(e){BX.hide(this.activeBlock);BX.show(this.fireButton,"inline-block");if(this.hiddenField){this.hiddenField.value=0}return false};var t=null;window.MPFbuttonShowWait=function(e){if(e&&!BX.type.isElementNode(e)){e=null}e=e||this;e=e?e.tagName=="A"?e:e.parentNode:e;if(e){BX.addClass(e,"ui-btn-clock");t=e;BX.defer((function(){e.disabled=true}))()}};var i={listen:false,plus:false,text:"",bSearch:false,node:null,mode:null};BX.addCustomEvent(window,"onInitialized",(function(e){if(e&&e.eventNode){BX.onCustomEvent(e.eventNode,"OnClickCancel",(function(){i.node=null}))}}));BX.addCustomEvent(window,"BX.MPF.MentionSelector:open",(function(t){var i=BX.Type.isStringFilled(t.formId)?t.formId:"";if(!BX.Type.isStringFilled(i)||BX.Type.isUndefined(e.mentionParams[i])){return}var n=BX.Type.isDomNode(t.bindNode)?t.bindNode:null;var r=BX.type.isNotEmptyObject(t.bindPosition)?t.bindPosition:null;var a=window.MPFgetSelectorId("bx-mention-"+i+"-id")+(n?"-withsearch":"");var o=BX.UI.EntitySelector.Dialog.getById(a);if(!o){window.MPFcreateSelectorDialog({formId:i,selectorId:a,enableSearch:!!n,params:e.mentionParams[i]});o=BX.UI.EntitySelector.Dialog.getById(a)}if(!o){return}o.deselectAll();o.search("");o.show();var s={};if(BX.Type.isDomNode(n)){o.focusSearch();o.popup.setBindElement(n);s.position="top"}else if(BX.type.isNotEmptyObject(r)){r.top-=5;o.popup.setBindElement(r)}o.popup.adjustPosition(s)}));window.onKeyDownHandler=function(e,t,r){var a=e.keyCode;if(!window["BXfpdStopMent"+r]){return true}var o=window.MPFgetSelectorId("bx-mention-"+r+"-id");if(a===t.KEY_CODES["backspace"]&&i.node){var s=BX.util.trim(t.util.GetTextContent(i.node));if(s==="+"||s==="@"||i.mode=="button"&&s.length==1){window["BXfpdStopMent"+r]()}else if(i.mode=="button"&&s.length==1){window["BXfpdStopMent"+r]()}}if(BX.util.in_array(a,[107,187])||(e.shiftKey||e.modifiers>3)&&BX.util.in_array(a,[50,43,61])||e.altKey&&BX.util.in_array(a,[76])||e.altKey&&e.ctrlKey&&BX.util.in_array(a,[81])&&e.key==="@"||e.altKey&&BX.util.in_array(a,[71,81])&&e.key==="@"||e.altKey&&BX.util.in_array(a,[50])&&e.key==="@"||BX.Type.isFunction(e.getModifierState)&&!!e.getModifierState("AltGraph")&&BX.util.in_array(a,[81,50,48])&&!BX.Type.isUndefined(e.key)&&e.key==="@"||BX.util.in_array(a,[192])&&e.key==="@"){setTimeout((function(){var e=t.selection.GetRange();var a=t.GetIframeDoc();var s=e?e.endContainer.textContent:"";var l=s?s.slice(e.endOffset-1,e.endOffset):"";var d=s?s.slice(e.endOffset-2,e.endOffset-1):"";if((l=="@"||l=="+")&&(!d||BX.util.in_array(d,["+","@",",","("])||d.length==1&&BX.util.trim(d)==="")){i.listen=true;i.listenFlag=true;i.text="";i.leaveContent=true;i.mode="plus";e.setStart(e.endContainer,e.endOffset-1);e.setEnd(e.endContainer,e.endOffset);t.selection.SetSelection(e);i.node=BX.create("SPAN",{props:{id:"bx-mention-node"}},a);t.selection.Surround(i.node,e);e.setStart(i.node,1);e.setEnd(i.node,1);t.selection.SetSelection(e);if(BX.Type.isStringFilled(o)){BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{formId:r,bindPosition:n(i.node,t)}])}}}),10)}if(i.listen){var l=null;var d=BX.Type.isStringFilled(o)?BX.UI.EntitySelector.Dialog.getById(o):null;if(d&&d.getActiveTab()){l=d.getActiveTab().getId()}var c=null;switch(a){case t.KEY_CODES.enter:c="Enter";break;case 9:c="Tab";break;case t.KEY_CODES.up:c="ArrowUp";break;case t.KEY_CODES.down:c="ArrowDown";break;case t.KEY_CODES.left:if(l==="departments"){c="ArrowLeft"}break;case t.KEY_CODES.right:if(l==="departments"){c="ArrowRight"}break}if(c){var u=new KeyboardEvent("keydown",{key:c,keyCode:a,bubbles:true,cancelable:true,view:window});if(!document.dispatchEvent(u)){t.iframeKeyDownPreventDefault=true;e.stopPropagation();e.preventDefault()}}}if(!i.listen&&i.listenFlag&&a===t.KEY_CODES["enter"]){var f=t.selection.GetRange();if(f.collapsed){var p=f.endContainer;var h=t.GetIframeDoc();if(p){if(p.className!=="bxhtmled-metion"){p=BX.findParent(p,(function(e){return e.className=="bxhtmled-metion"}),h.body)}if(p&&p.className=="bxhtmled-metion"){t.selection.SetAfter(p)}}}}};window.onKeyUpHandler=function(e,t,n){var r=e.keyCode;var a;var o;if(!window["BXfpdStopMent"+n]){return true}if(i.listen===true){if(r==t.KEY_CODES.escape){var s=new KeyboardEvent("keyup",{key:"Escape",keyCode:r,bubbles:true,cancelable:true,view:window});if(!document.dispatchEvent(s)){e.stopPropagation();e.preventDefault()}window["BXfpdStopMent"+n]()}else if(r!==t.KEY_CODES.enter&&r!==t.KEY_CODES.left&&r!==t.KEY_CODES.right&&r!==t.KEY_CODES.up&&r!==t.KEY_CODES.down){if(BX(i.node)){o=BX.util.trim(t.util.GetTextContent(i.node));var l=o;o=o.replace(/^[\+@]*/,"");i.bSearch=BX.Type.isStringFilled(o);var d=window.MPFgetSelectorId("bx-mention-"+n+"-id");var c=BX.UI.EntitySelector.Dialog.getById(d);if(BX.Type.isStringFilled(o)&&c){c.search(o)}if(i.leaveContent&&i._lastText){if(l===""){window["BXfpdStopMent"+n]()}else if(l!==""&&o===""){i.bSearch=false;if(c){c.search("")}}}i.lastText=o;i._lastText=l}else{window["BXfpdStopMent"+n]()}}}else{if(!e.shiftKey&&(r===t.KEY_CODES["space"]||r===t.KEY_CODES["escape"]||r===188||r===190)){a=t.selection.GetRange();if(a.collapsed){var u=a.endContainer;var f=t.GetIframeDoc();if(u){if(u.className!=="bxhtmled-metion"){u=BX.findParent(u,(function(e){return e.className=="bxhtmled-metion"}),f.body)}if(u&&u.className=="bxhtmled-metion"){o=t.util.GetTextContent(u);var p=o.match(/[\s\.\,]$/);if(p||r===t.KEY_CODES["escape"]){u.innerHTML=o.replace(/[\s\.\,]$/,"");var h=BX.create("SPAN",{html:p||t.INVISIBLE_SPACE},f);t.util.InsertAfter(h,u);t.selection.SetAfter(h)}}}}}}};window.onTextareaKeyDownHandler=function(e,t,n){var r=e.keyCode;if(i.listen&&r==t.KEY_CODES.enter){t.textareaKeyDownPreventDefault=true;e.stopPropagation();e.preventDefault()}};window.onTextareaKeyUpHandler=function(e,t,n){var r=null;var a="";var o=e.keyCode;var s=window.MPFgetSelectorId("bx-mention-"+n+"-id");if(i.listen===true){if(o==27){window["BXfpdStopMent"+n]()}else if(o!==13){a=t.textareaView.GetValue(false);r=t.textareaView.GetCursorPosition();var l="";var d="";if(a.indexOf("+")!==-1||a.indexOf("@")!==-1){var c=a.substr(0,r);var u=Math.max(c.lastIndexOf("+"),c.lastIndexOf("@"));if(u>=0){l=c.substr(u);d=l;l=l.replace(/^[\+@]*/,"");i.bSearch=BX.Type.isStringFilled(l);var f=BX.UI.EntitySelector.Dialog.getById(s);if(BX.Type.isStringFilled(l)&&f){f.search(l)}}}if(i._lastText){if(d===""){window["BXfpdStopMent"+n]()}else if(d!==""&&l===""){i.bSearch=false;if(f){f.search("")}}}i.lastText=l;i._lastText=d}}else{if(o==16){var p=this;this.shiftPressed=true;if(this.shiftTimeout){this.shiftTimeout=clearTimeout(this.shiftTimeout)}this.shiftTimeout=setTimeout((function(){p.shiftPressed=false}),100)}if(o==107||(e.shiftKey||e.modifiers>3||this.shiftPressed)&&BX.util.in_array(o,[187,50,107,43,61])){r=t.textareaView.element.selectionStart;if(r>0){a=t.textareaView.element.value;var h=a.substr(r-1,1);if(h&&(h==="+"||h==="@")){i.listen=true;i.listenFlag=true;i.text="";i.textarea=true;i.bSearch=false;i.mode="plus";BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{formId:n,bindPosition:BX.pos(document.getElementById("bx-b-mention-"+n))}])}}}}};var n=function(e,t){var i=BX.pos(e);var n=BX.pos(t.dom.areaCont);var r=BX.GetWindowScrollPos(t.GetIframeDoc());var a=n.top+i.bottom-r.scrollTop+2;var o=n.left+i.right-r.scrollLeft;return{top:a,left:o}};window.BxInsertMention=function(e){var t=e.item;var r=e.type;var a=e.formID;var o=e.editorId;var s=e.bNeedComa;var l=LHEPostForm.getEditor(o);var d;if((r==="user"||r==="project"||r==="department")&&t&&t.entityId>0&&l){if(l.GetViewMode()=="wysiwyg"){var c=l.GetIframeDoc();var u=l.selection.GetRange();var f=BX.create("SPAN",{props:{className:"bxhtmled-metion"},text:BX.util.htmlspecialcharsback(t.name)},c);d=BX.create("SPAN",{html:s?",&nbsp;":"&nbsp;"},c);var p={tag:"postuser",params:{value:t.entityId}};switch(r){case"project":p.projectId=t.entityId;p.projectName=t.name;break;case"department":p.departmentId=t.entityId;p.departmentName=t.name;break;default:p.userId=t.entityId;p.userName=t.name}l.SetBxTag(f,p);if(BX(i.node)&&i.node.parentNode){l.util.ReplaceNode(i.node,f)}else{l.selection.InsertNode(f,u)}if(f&&f.parentNode){var h=BX.findParent(f,{className:"bxhtmled-metion"},c.body);if(h){l.util.InsertAfter(f,h)}}if(f&&f.parentNode){l.util.InsertAfter(d,f);l.selection.SetAfter(d)}}else if(l.GetViewMode()=="code"&&l.bbCode){l.textareaView.Focus();var b=l.textareaView.GetValue(false);var m=l.textareaView.GetCursorPosition();var v=b.substr(0,m);var E=Math.max(v.lastIndexOf("+"),v.lastIndexOf("@"));if(E>=0&&m>E){l.textareaView.SetValue(b.substr(0,E)+b.substr(m));l.textareaView.element.setSelectionRange(E,E)}var g="";switch(r){case"user":g="USER";break;case"project":g="PROJECT";break;case"department":g="DEPARTMENT";break;default:}l.textareaView.WrapWith(false,false,"["+g+"="+t.entityId+"]"+t.name+"[/"+g+"]"+(s?", ":" "))}if(e.fireAddEvent===true){BX.onCustomEvent(window,"onMentionAdd",[t,r])}if(window["BXfpdStopMent"+a]){window["BXfpdStopMent"+a]()}i["text"]="";if(l.GetViewMode()=="wysiwyg"){l.Focus();l.selection.SetAfter(d)}var y=LHEPostForm.getHandler(o);if(y&&y.formEntityType==="task"&&y.editorParams.tasksLimitExceeded){BX.Main.PostFormTasksLimit.showPopup({bindPosition:n(i.node,l)})}}};window.MPFgetSelectorId=function(e){var t=false;var i=BX(e);if(!i){return t}t=i.getAttribute("data-bx-selector-id");return t};window.MPFcreateSelectorDialog=function(e){new BX.UI.EntitySelector.Dialog({targetNode:"mpf-mention-"+e.formId,id:e.selectorId,context:"MENTION",multiple:false,enableSearch:e.enableSearch,clearSearchOnSelect:true,hideOnSelect:true,hideByEsc:true,entities:e.params.entities,height:300,width:400,compactView:true,events:{onShow:function(){window.BXfpdOnDialogOpen()},onHide:function(){window.BXfpdOnDialogClose({editorId:e.params.editorId})},"Item:onSelect":function(t){var i=t.getData().item;if(i){window["BXfpdSelectCallbackMent"+e.formId]({item:{name:i.getTitle(),entityId:i.getId()},entityType:i.getEntityId()})}}}})};window.MPFMentionInit=function(t,n){e.mentionParams[t]=n;if(n.initDestination===true){BX.addCustomEvent("onAutoSaveRestoreDestination",(function(e){if(BX.type.isNotEmptyObject(e)&&BX.type.isNotEmptyObject(e.data)&&BX.type.isNotEmptyString(e.data.DEST_DATA)&&BX.type.isNotEmptyString(e.formId)&&e.formId==t&&BX.UI.EntitySelector){var i=JSON.parse(e.data.DEST_DATA);if(!Array.isArray(i)){return}var n=BX.UI.EntitySelector.Dialog.getById("oPostFormLHE_blogPostForm");if(!BX.type.isNotEmptyObject(n)){return}n.preselectedItems=i;n.setPreselectedItems(i)}}));BX.addCustomEvent(window,"onMentionAdd",(function(e,t){var i=BX.UI.EntitySelector.Dialog.getById("oPostFormLHE_blogPostForm");if(!BX.type.isNotEmptyObject(i)){return}var n="";if(t==="user"){if(e.isExtranet==="Y"){n="extranet"}else if(e.isEmail==="Y"){n="email"}else{n="employee"}}else if(t==="project"){if(e.isExtranet==="Y"){n="extranet"}}i.addItem({avatar:e.avatar,customData:{email:BX.Type.isStringFilled(e.email)?e.email:""},entityId:t,entityType:n,id:e.entityId,title:e.name}).select()}))}window["BXfpdSelectCallbackMent"+t]=function(e){window.BxInsertMention({item:e.item,type:e.entityType.toLowerCase(),formID:t,editorId:n.editorId,fireAddEvent:n.initDestination})};window["BXfpdStopMent"+t]=function(){var e=window.MPFgetSelectorId("bx-mention-"+t+"-id");var i=BX.UI.EntitySelector.Dialog.getById(e);if(i){i.hide()}};if(BX(t)){BX.addCustomEvent(BX(t),"OnUCFormAfterShow",(function(e){if(!BX.type.isNotEmptyObject(e)||!BX.type.isArray(e.id)||!BX.Type.isStringFilled(e.id[0])){return}var t=new RegExp("EVENT_(\\d+)","i");if(!t.test(e.id[0])){return}}))}var r=LHEPostForm.getHandlerByFormId(t);if(r){r.exec()}BX.ready((function(){var e=BX("bx-b-mention-"+t);BX.bind(e,"click",(function(r){if(i.listen!==true){var a=LHEPostForm.getEditor(n.editorId);var o=a.GetIframeDoc();if(a.GetViewMode()=="wysiwyg"&&o){i.listen=true;i.listenFlag=true;i.text="";i.leaveContent=false;i.mode="button";var s=a.selection.GetRange();if(BX(i.node)){BX.remove(BX(i.node))}a.InsertHtml('<span id="bx-mention-node">'+a.INVISIBLE_SPACE+"</span>",s);setTimeout((function(){BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{formId:t,bindNode:e}]);i.node=o.getElementById("bx-mention-node");if(i.node){s.setStart(i.node,0);if(i.node.firstChild&&i.node.firstChild.nodeType==3&&i.node.firstChild.nodeValue.length>0){s.setEnd(i.node,1)}else{s.setEnd(i.node,0)}a.selection.SetSelection(s)}a.Focus()}),100)}else if(a.GetViewMode()=="code"){i.listen=true;i.listenFlag=true;i.text="";i.leaveContent=false;i.mode="button";setTimeout((function(){BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{formId:t,bindNode:e}])}),100)}BX.onCustomEvent(e,"mentionClick")}}))}))};window.BXfpdOnDialogOpen=function(){i.listen=true;i.listenFlag=true};window.BXfpdOnDialogClose=function(e){i.listen=false;setTimeout((function(){i.listenFlag=false;if(!i.listen){var t=LHEPostForm.getEditor(e.editorId);if(t){t.Focus()}}}),100)};MPFEntitySelector=function(t){this.selector=null;this.inputNode=null;this.messages={};if(!BX.Type.isStringFilled(t.id)){return null}if(e.selector[t.id]){return e.selector[t.id]}e.selector[t.id]=this.init(t)};MPFEntitySelector.prototype.init=function(e){if(!BX.type.isPlainObject(e)){e={}}if(!BX.Type.isStringFilled(e.id)||!BX.Type.isStringFilled(e.tagNodeId)||!BX(e.tagNodeId)){return null}if(BX.Type.isStringFilled(e.inputNodeId)&&BX(e.inputNodeId)){this.inputNode=BX(e.inputNodeId)}if(BX.type.isNotEmptyObject(e.messages)){this.messages=e.messages}this.selector=new BX.UI.EntitySelector.TagSelector({id:e.id,dialogOptions:{id:e.id,context:BX.Type.isStringFilled(e.context)?e.context:null,preselectedItems:BX.type.isArray(e.preselectedItems)?e.preselectedItems:[],events:{"Item:onSelect":function(){this.recalcValue(this.selector.getDialog().getSelectedItems())}.bind(this),"Item:onDeselect":function(){this.recalcValue(this.selector.getDialog().getSelectedItems())}.bind(this)},entities:[{id:"meta-user",options:{"all-users":{title:this.messages.allUsersTitle,allowView:BX.type.isBoolean(e.allowToAll)&&e.allowToAll}}},{id:"user",options:{emailUsers:BX.type.isBoolean(e.allowSearchEmailUsers)?e.allowSearchEmailUsers:false,inviteGuestLink:BX.type.isBoolean(e.allowSearchEmailUsers)?e.allowSearchEmailUsers:false,myEmailUsers:true}},{id:"project",options:{features:{blog:["premoderate_post","moderate_post","write_post","full_post"]}}},{id:"department",options:{selectMode:"usersAndDepartments",allowFlatDepartments:false}}]},addButtonCaption:BX.message("BX_FPD_LINK_1"),addButtonCaptionMore:BX.message("BX_FPD_LINK_2")});this.selector.renderTo(document.getElementById(e.tagNodeId));return this.selector};MPFEntitySelector.prototype.recalcValue=function(e){if(!BX.type.isArray(e)||!this.inputNode){return}var t=[];e.forEach((function(e){t.push([e.entityId,e.id])}));this.inputNode.value=JSON.stringify(t)};window.MPFEntitySelector=MPFEntitySelector})()})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:71:"/bitrix/components/bitrix/system.field.edit/script.min.js?1699257951814";s:6:"source";s:53:"/bitrix/components/bitrix/system.field.edit/script.js";s:3:"min";s:57:"/bitrix/components/bitrix/system.field.edit/script.min.js";s:3:"map";s:57:"/bitrix/components/bitrix/system.field.edit/script.map.js";}"*/
function addElement(e,n){if(document.getElementById("main_"+e)){var d=document.getElementById("main_"+e).getElementsByTagName("div");if(d&&d.length>0&&d[0]){var t=d[0].parentNode;t.appendChild(d[d.length-1].cloneNode(true))}}}function addElementFile(e,n){var d=document.getElementById("main_"+e);var t=document.getElementById("main_add_"+e);if(d&&t){t=t.cloneNode(true);t.id="";t.style.display="";d.appendChild(t)}}function addElementDate(e,n){var d=document.getElementById("date_container_"+n);var t=document.getElementById("hidden_"+n).innerHTML;if(d&&t){var a=e[n].fieldName;var i=e[n].index;t=t.replace(/[#]FIELD_NAME[#]/g,a+"["+i+"]");t=t.replace(/[\%]23FIELD_NAME[\%]23/g,escape(a+"["+i+"]"));var l=d.appendChild(document.createElement("DIV"));l.innerHTML+=t;e[n].index++}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/time/logic.min.js?16992580838048";s:6:"source";s:78:"/bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/time/logic.js";s:3:"min";s:82:"/bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/time/logic.min.js";s:3:"map";s:82:"/bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/time/logic.map.js";}"*/
BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TaskElapsedTime!="undefined"){return}BX.Tasks.Component.TaskElapsedTime=function(e,t){this.container=BX(e);if(!this.container){return}this.parameters=t||{};this.messages=this.parameters.messages||{};this.template=this.parameters.template||"";this.nameTemplate=this.parameters.nameTemplate||"";this.pathToUserProfile=this.parameters.pathToUserProfile||"";this.ajaxPendingResponse=false;this.records={};var s=BX.type.isArray(this.parameters.records)?this.parameters.records:[];for(var a=0;a<s.length;a++){var i=s[a];var o=BX(i.rowId);this.addRecord(i.id,o,i.date,i.time,i.comment)}this.layout={addLinkRow:BX.findChildByClassName(this.container,"task-time-add-link-row",true),addLink:BX.findChildByClassName(this.container,"task-dashed-link",true),sendButton:BX.findChildByClassName(this.container,"task-table-edit-ok",true),cancelButton:BX.findChildByClassName(this.container,"task-table-edit-remove",true),formRow:BX.findChildByClassName(this.container,"task-time-form-row",true),lastRow:null};this.form={};var r=this.layout.formRow.getElementsByTagName("input");for(a=0;a<r.length;a++){var n=r[a];var d=n.getAttribute("name");this.form[d]=n;BX.bind(n,"keypress",BX.proxy(this.catchEnterKey,this))}BX.bind(this.layout.addLink,"click",BX.proxy(this.add,this));BX.bind(this.layout.sendButton,"click",BX.proxy(this.send,this));BX.bind(this.layout.cancelButton,"click",BX.proxy(this.cancel,this));BX.bind(this.form.date,"click",(function(){BX.calendar({node:this,field:this,form:"",bTime:true,value:this.value,bHideTime:false})}));BX.bind(this.container,"click",BX.proxy(this.captureClick,this))};BX.Tasks.Component.TaskElapsedTime.prototype.add=function(){this.moveForm(this.layout.addLinkRow);this.setForm("","","1","00","00","")};BX.Tasks.Component.TaskElapsedTime.prototype.edit=function(e){var t=this.getRecordById(e);if(t){this.moveForm(t.row);this.setForm(t.id,t.date,t.hours,t.minutes,t.seconds,t.comment)}};BX.Tasks.Component.TaskElapsedTime.prototype.getRecordById=function(e){if(this.records[e]){return this.records[e]}return null};BX.Tasks.Component.TaskElapsedTime.prototype.getRecordByRow=function(e){for(var t in this.records){if(this.records.hasOwnProperty(t)&&this.records[t].row===e){return this.records[t]}}return null};BX.Tasks.Component.TaskElapsedTime.prototype.addRecord=function(e,t,s,a,i){if(!e||!BX.type.isDomNode(t)){return}a=parseInt(a,10);a=BX.type.isNumber(a)?a:0;var o=this.getTime(a);this.records[e]={row:t,id:e,date:s,hours:o.hours,minutes:o.minutes,seconds:o.seconds,time:a,comment:i}};BX.Tasks.Component.TaskElapsedTime.prototype.deleteRecord=function(e){delete this.records[e]};BX.Tasks.Component.TaskElapsedTime.prototype.delete=function(e){if(this.ajaxPendingResponse){return}this.ajaxPendingResponse=true;BX.ajax.runComponentAction("bitrix:tasks.task","deleteElapsedTime",{mode:"class",data:{taskId:this.parameters.taskId,id:e}}).then(function(t){this.ajaxPendingResponse=false;var s=this.getRecordById(e);if(s){s.row.parentNode.removeChild(s.row);this.deleteRecord(s.id)}}.bind(this)).catch(function(e){if(e.errors){BX.Tasks.alert(e.errors);this.ajaxPendingResponse=false}}.bind(this))};BX.Tasks.Component.TaskElapsedTime.prototype.send=function(){if(this.ajaxPendingResponse){return}var e=parseInt(this.form.id.value,10);var t=parseInt(this.form.hours.value,10);var s=parseInt(this.form.minutes.value,10);var a=parseInt(this.form.seconds.value,10);t=BX.type.isNumber(t)?t:0;s=BX.type.isNumber(s)?s:0;a=BX.type.isNumber(a)?a:0;var i={COMMENT_TEXT:BX.util.trim(this.form.comment.value),CREATED_DATE:this.form.date.value,SECONDS:t*3600+s*60+a};this.enable(false);var o="addElapsedTime";var r={data:i};if(e>0){o="updateElapsedTime";r.id=e}else{r.taskId=this.parameters.taskId}this.ajaxPendingResponse=true;BX.ajax.runComponentAction("bitrix:tasks.task",o,{mode:"class",data:r}).then(function(e){this.ajaxPendingResponse=false;this.onElapsedTimeUpdate(e)}.bind(this)).catch(function(e){if(e.errors){this.ajaxPendingResponse=false;BX.Tasks.alert(e.errors)}}.bind(this))};BX.Tasks.Component.TaskElapsedTime.prototype.onElapsedTimeUpdate=function(e){this.cancel();this.enable();var t=e.data["DATA"];var s=e.data["CAN"];var a="";if(s["MODIFY"]){a+=" task-time-table-edit"}if(s["REMOVE"]){a+=" task-time-table-remove"}var i=t["SOURCE"];var o="";if(i==2){o=this.messages.sourceManual;a+=" task-time-table-manually"}else if(i==1){o=this.messages.sourceUndefined;a+=" task-time-table-unknown"}var r=BX.formatName({NAME:t["USER_NAME"],LAST_NAME:t["USER_LAST_NAME"],SECOND_NAME:t["USER_SECOND_NAME"],LOGIN:t["USER_LOGIN"]},this.nameTemplate,"Y");var n=t["ID"];var d=t["CREATED_DATE"];var l=t["COMMENT_TEXT"];var m=t["SECONDS"];m=this.getTime(m);var p=this.pathToUserProfile.replace("#user_id#",t["USER_ID"]);var h=BX.Tasks.Util.Template.compile(this.template);var u=h.getNode({rowId:"",rowClass:a,sourceNote:o,userName:r,date:d,timeFormatted:BX.Tasks.Util.formatTimeAmount(m.time),comment:l,pathToUserProfile:p});var f=this.getRecordById(n);var c=this.layout.addLinkRow;if(f){c=BX.findNextSibling(f.row);BX.remove(f.row)}this.addRecord(n,u[0],d,m.time,l);c.parentNode.insertBefore(u[0],c);var T=this.getSummary();BX.onCustomEvent("TaskElapsedTimeUpdated",[T.hours,T.minutes,this.records,T])};BX.Tasks.Component.TaskElapsedTime.prototype.getTime=function(e){var t=e>=0?1:-1;var s=Math.floor(t*Math.floor(Math.abs(e)/3600));var a=t*Math.floor(Math.abs(e)/60)%60;return{hours:s,minutes:a,seconds:e-s*3600-a*60,time:e}};BX.Tasks.Component.TaskElapsedTime.prototype.getSummary=function(){var e=0;for(var t in this.records){if(this.records.hasOwnProperty(t)){e+=this.records[t].time}}return this.getTime(e)};BX.Tasks.Component.TaskElapsedTime.prototype.showError=function(){var e=new BX.PopupWindow("task-elapsed-time-error-popup",null,{lightShadow:true,overlay:true,buttons:[new BX.PopupWindowButton({text:BX.message("JS_CORE_WINDOW_CLOSE"),className:"",events:{click:function(){BX.reload();this.popupWindow.close()}}})]});var t=[];for(var s=0;s<arguments.length;s++){var a=arguments[s];if(BX.type.isArray(a)){t=BX.util.array_merge(t,a)}else if(BX.type.isString(a)){t.push(a)}}var i="";for(s=0;s<t.length;s++){i+=(typeof t[s].MESSAGE!=="undefined"?t[s].MESSAGE:t[s])+"<br>"}e.setContent("<div class='task-detail-error-popup' style='width: 300px; margin: 15px; color: red; word-wrap: break-word;'>"+i+"</div>");e.show()};BX.Tasks.Component.TaskElapsedTime.prototype.cancel=function(){if(this.layout.lastRow){this.layout.lastRow.style.display=""}this.layout.formRow.style.display="none";this.layout.addLinkRow.style.display=""};BX.Tasks.Component.TaskElapsedTime.prototype.setForm=function(e,t,s,a,i,o){this.form.id.value=e;this.form.date.value=t;this.form.hours.value=s;this.form.minutes.value=a;this.form.seconds.value=i;this.form.comment.value=o;this.layout.formRow.style.display="";this.form.hours.focus();this.form.hours.select()};BX.Tasks.Component.TaskElapsedTime.prototype.moveForm=function(e){var t=BX.findNextSibling(e,{tag:"tr"});if(t){e.parentNode.insertBefore(this.layout.formRow,t)}else{e.parentNode.appendChild(this.layout.formRow)}if(this.layout.lastRow){this.layout.lastRow.style.display=""}this.layout.lastRow=e;this.layout.lastRow.style.display="none"};BX.Tasks.Component.TaskElapsedTime.prototype.captureClick=function(e){e=e||window.event;var t=e.target||e.srcElement;if(!BX.type.isDomNode(t)){return}if(BX.hasClass(t,"task-table-edit")||BX.hasClass(t,"task-table-remove")){var s=BX.findParent(t,{tagName:"tr"});var a=this.getRecordByRow(s);a=a||{};if(BX.hasClass(t,"task-table-edit")){this.edit(a.id)}else if(BX.hasClass(t,"task-table-remove")){this.delete(a.id)}BX.PreventDefault(e)}};BX.Tasks.Component.TaskElapsedTime.prototype.catchEnterKey=function(e){e=e||window.event;if(e.keyCode===13){this.send();BX.PreventDefault(e)}};BX.Tasks.Component.TaskElapsedTime.prototype.enable=function(e){var t=e===false;for(var s in this.form){if(this.form.hasOwnProperty(s)){this.form[s].disabled=t}}}}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/ui.button.panel/templates/.default/script.min.js?16992580961189";s:6:"source";s:70:"/bitrix/components/bitrix/ui.button.panel/templates/.default/script.js";s:3:"min";s:74:"/bitrix/components/bitrix/ui.button.panel/templates/.default/script.min.js";s:3:"map";s:74:"/bitrix/components/bitrix/ui.button.panel/templates/.default/script.map.js";}"*/
(function(){"use strict";BX.namespace("BX.UI");var t=function(){this.layout={container:null}};t.prototype={init:function(t){this.layout.container=BX(t.containerId);this.isFrame=t.isFrame||false;this.hasHints=t.hasHints||false;this.pinnerContainer=t.pinnerContainer||false;this.pinner=new BX.UI.Pinner(this.layout.container,{fixBottom:this.isFrame,fullWidth:this.isFrame,anchorBottom:this.pinnerContainer});if(this.hasHints){BX.UI.Hint.init(this.layout.container)}t.buttons.forEach(this.initButton,this)},getContainer:function(){return this.layout.container},hide:function(){if(!this.layout.container){return}this.layout.container.classList.add("ui-button-panel-wrapper-hide")},show:function(){this.layout.container.classList.remove("ui-button-panel-wrapper-hide")},initButton:function(t){if(!t.ID){return}t.node=BX(t.ID);if(!t.node){return}BX.bind(t.node,"click",this.onButtonClick.bind(this,t))},onButtonClick:function(t,n){BX.onCustomEvent(this,"button-click",[t]);if(t.WAIT){BX.addClass(BX(t.ID),"ui-btn-wait")}if(this.isFrame&&(t.TYPE==="close"||t.TYPE==="cancel")){n.preventDefault();top.BX.SidePanel.Instance.close()}}};BX.UI.ButtonPanel=new t})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:101:"/bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/sidebar/logic.min.js?169925808312683";s:6:"source";s:81:"/bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/sidebar/logic.js";s:3:"min";s:85:"/bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/sidebar/logic.min.js";s:3:"map";s:85:"/bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/sidebar/logic.map.js";}"*/
BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TaskViewSidebar!="undefined"){return}BX.Tasks.Component.TaskViewSidebar=function(t){this.layout={stagesWrap:BX("tasksStagesWrap"),stages:BX("tasksStages"),epicTitle:BX("tasksEpicTitle"),epicContainer:BX("tasksEpicContainer")};this.parameters=t||{};this.taskId=this.parameters.taskId;this.parentId=this.parameters.parentId;this.groupId=parseInt(this.parameters.groupId,10);this.messages=this.parameters.messages||{};this.workingTime=this.parameters.workingTime||{start:{hours:0,minutes:0},end:{hours:0,minutes:0}};this.can=this.parameters.can||{};this.allowTimeTracking=this.parameters.allowTimeTracking===true;this.user=this.parameters.user||{};this.isAmAuditor=this.parameters.iAmAuditor;this.showIntranetControl=this.parameters.showIntranetControl;this.auditorCtrl=null;this.pathToTasks=this.parameters.pathToTasks;this.stageId=parseInt(this.parameters.stageId);this.stages=this.parameters.stages||{};this.taskLimitExceeded=this.parameters.taskLimitExceeded;this.calendarSettings=this.parameters.calendarSettings?this.parameters.calendarSettings:{};this.isScrumTask=this.parameters.isScrumTask==="Y";this.initDeadline();this.initReminder();this.initMark();this.initTime();this.initAuditorThing();this.initStages();this.initIntranetControlButton();BX.addCustomEvent(window,"tasksTaskEvent",BX.delegate(this.onTaskEvent,this));BX.addCustomEvent(window,"onChangeProjectLink",BX.delegate(this.onChangeProjectLink,this))};BX.Tasks.Component.TaskViewSidebar.prototype.initIntranetControlButton=function(){if(!this.showIntranetControl){return}BX.loadExt("intranet.control-button").then(function(){if(BX.Intranet.ControlButton){new BX.Intranet.ControlButton({container:BX("task-detail-sidebar-item-videocall"),entityType:"task",entityId:this.taskId})}}.bind(this))};BX.Tasks.Component.TaskViewSidebar.prototype.initAuditorThing=function(){if(!this.can.EDIT){BX.Tasks.Util.Dispatcher.find("auditor-selector").then(function(t){this.auditorCtrl=t;t.bindControl("header-button","click",this.onToggleImAuditor.bind(this))}.bind(this))}};BX.Tasks.Component.TaskViewSidebar.prototype.initStages=function(){if(this.layout.stages&&this.stages){var t=this.parameters.can.SORT;var e=this.stages.length>0;BX.cleanNode(this.layout.stages);for(var s=0,i=this.stages.length;s<i;s++){this.layout.stages.appendChild(this.stages[s].TEXT_LAYOUT=BX.create("div",{attrs:{"data-stageId":this.stages[s].ID,title:this.stages[s].TITLE},props:{className:"task-section-status-step"},text:this.stages[s].TITLE,events:t?{click:BX.delegate(this.setStageHadnler,this)}:null,style:!t?{cursor:"default"}:null}))}if(e){BX.show(this.layout.stagesWrap);if(this.stageId>0){this.setStage(this.stageId)}else{this.setStage(this.stages[0].ID)}}else{BX.hide(this.layout.stagesWrap)}}};BX.Tasks.Component.TaskViewSidebar.prototype.hideEpicSelector=function(){if(!this.layout.epicTitle||!this.layout.epicContainer){return}BX.hide(this.layout.epicTitle);BX.hide(this.layout.epicContainer)};BX.Tasks.Component.TaskViewSidebar.prototype.showEpicSelector=function(){if(!this.layout.epicTitle||!this.layout.epicContainer){return}BX.show(this.layout.epicTitle);BX.show(this.layout.epicContainer)};BX.Tasks.Component.TaskViewSidebar.prototype.onChangeProjectLink=function(t,e){t=parseInt(t);this.stageId=0;if(t===0){this.stages=[];this.initStages();this.hideEpicSelector();return}BX.ajax.runComponentAction("bitrix:tasks.task","needShowEpicField",{mode:"class",data:{groupId:t}}).then(function(t){if(t.data&&t.data===true){this.showEpicSelector()}}.bind(this));BX.ajax.runComponentAction("bitrix:tasks.task","canMoveStage",{mode:"class",data:{entityId:t,entityType:"G"}}).then(function(t){if(t.data&&t.data===true){this.parameters.can.SORT=true}}.bind(this));BX.ajax.runComponentAction("bitrix:tasks.task","getStages",{mode:"class",data:{entityId:t,isNumeric:1}}).then(function(t){if(t.data){this.stages=t.data;this.initStages()}}.bind(this))};BX.Tasks.Component.TaskViewSidebar.prototype.getStageData=function(t){t=parseInt(t);if(this.stages){for(var e in this.stages){if(parseInt(this.stages[e].ID)===t){return this.stages[e]}}}return null};BX.Tasks.Component.TaskViewSidebar.prototype.setStageHadnler=function(){var t=new BX.Promise;var e=parseInt(BX.data(BX.proxy_context,"stageId"),10);if(e===this.stageId){return}var s=null;var i=false;if(this.isScrumTask&&BX.type.isArray(this.stages)){var a=this.stageId;var n=false;var r=false;for(var o in this.stages){var d=this.stages[o];if(parseInt(d.ID)===e&&d.SYSTEM_TYPE==="FINISH"){n=true}else if(parseInt(d.ID)===a&&d.SYSTEM_TYPE==="FINISH"){r=true}}if(n||r){top.BX.loadExt("tasks.scrum.task-status").then(function(){if(!BX.type.isUndefined(top.BX.Tasks.Scrum)&&!BX.type.isUndefined(top.BX.Tasks.Scrum.TaskStatus)){s=new top.BX.Tasks.Scrum.TaskStatus({groupId:this.groupId,parentTaskId:this.parentId,taskId:this.taskId,action:n?"complete":"renew",performActionOnParentTask:true});s.isParentScrumTask(this.parentId).then(function(e){i=e;if(i){t.fulfill()}else{if(n){s.showDod(this.taskId).then(function(){t.fulfill()}.bind(this)).catch(function(){t.reject()}.bind(this))}else{t.fulfill()}}}.bind(this))}else{t.fulfill()}}.bind(this))}else{t.fulfill()}}else{t.fulfill()}t.then(function(){this.setStage(e);this.saveStage(e).then(function(){if(s&&i){s.update()}}.bind(this))}.bind(this))};BX.Tasks.Component.TaskViewSidebar.prototype.saveStage=function(t){this.stageId=t;return BX.ajax.runComponentAction("bitrix:tasks.task","moveStage",{mode:"class",data:{taskId:this.taskId,stageId:t}}).then(function(e){if(e&&e.errors&&e.errors.length===0){BX.Tasks.Util.fireGlobalTaskEvent("UPDATE_STAGE",{ID:this.taskId,STAGE_ID:t},{STAY_AT_PAGE:true},{id:this.taskId});return true}return false}.bind(this))};BX.Tasks.Component.TaskViewSidebar.prototype.setStage=function(t){var e=this.getStageData(t);t=parseInt(t);if(this.stages&&e){var s="#"+e["COLOR"];var i=true;var a;for(var n=0,r=this.stages.length;n<r;n++){a=this.stages[n].TEXT_LAYOUT;if(i){a.style.color=this.calculateTextColor(s);a.style.backgroundColor=s;a.style.borderBottomColor=s}else{a.style.backgroundColor="";a.style.borderBottomColor="#"+this.stages[n].COLOR}if(parseInt(this.stages[n].ID)===t){i=false}}}};BX.Tasks.Component.TaskViewSidebar.prototype.calculateTextColor=function(t){var e=["00c4fb","47d1e2","75d900","ffab00","ff5752","468ee5","1eae43"];var s,i,a;if(BX.util.in_array(t.toLowerCase(),e)){return"#fff"}else{var n=t.split("");if(n.length==3){n=[n[0],n[0],n[1],n[1],n[2],n[2]]}n="0x"+n.join("");s=n>>16&255;i=n>>8&255;a=n&255}var r=.21*s+.72*i+.07*a;return r<145?"#fff":"#333"};BX.Tasks.Component.TaskViewSidebar.prototype.onToggleImAuditor=function(){if(this.isAmAuditor){BX.Tasks.confirm(BX.message("TASKS_TTDP_TEMPLATE_USER_VIEW_LEAVE_AUDITOR_CONFIRM")).then(function(){this.syncAuditor()}.bind(this))}else if(this.taskLimitExceeded){BX.UI.InfoHelper.show("limit_tasks_observers_participants",{isLimit:true,limitAnalyticsLabels:{module:"tasks",source:"sidebar",subject:"auditor"}})}else{this.syncAuditor()}};BX.Tasks.Component.TaskViewSidebar.prototype.syncAuditor=function(){var t=this.isAmAuditor?"leaveAuditor":"enterAuditor";BX.ajax.runComponentAction("bitrix:tasks.widget.member.selector",t,{mode:"class",data:{taskId:this.taskId,context:""}}).then(function(t){this.user.entityType="U";if(this.isAmAuditor){this.auditorCtrl.deleteItem(this.user)}else{this.auditorCtrl.addItem(this.user)}this.isAmAuditor=!this.isAmAuditor;this.auditorCtrl.setHeaderButtonLabelText(this.isAmAuditor?BX.message("TASKS_TTDP_TEMPLATE_USER_VIEW_LEAVE_AUDITOR"):BX.message("TASKS_TTDP_TEMPLATE_USER_VIEW_ENTER_AUDITOR"))}.bind(this)).catch(function(t){if(t.errors){BX.Tasks.alert(t.errors)}}.bind(this));BX.ajax.runComponentAction("bitrix:tasks.task","checkCanRead",{mode:"class",data:{taskId:this.taskId}}).then(function(t){if(!t.data||!t.data.READ){if(this.pathToTasks){window.document.location=this.pathToTasks}else{BX.reload()}}}.bind(this)).catch(function(t){if(t.errors){BX.Tasks.alert(t.errors)}}.bind(this))};BX.Tasks.Component.TaskViewSidebar.prototype.onTaskEvent=function(t,e){e=e||{};var s=e.task||{};if(t=="UPDATE"&&s.ID==this.parameters.taskId){if(BX.type.isNotEmptyString(s.REAL_STATUS)&&BX.type.isNotEmptyString(s.STATUS_CHANGED_DATE)){this.setStatus(s.REAL_STATUS,s.STATUS_CHANGED_DATE)}}};BX.Tasks.Component.TaskViewSidebar.prototype.setStatus=function(t,e){var s=BX("task-detail-status-name");var i=BX("task-detail-status-date");s.innerHTML=BX.message("TASKS_STATUS_"+t);i.innerHTML=(t!=4&&t!=5?BX.message("TASKS_SIDEBAR_START_DATE")+" ":"")+BX.util.htmlspecialchars(e)};BX.Tasks.Component.TaskViewSidebar.prototype.initDeadline=function(){this.deadline=BX.type.isNotEmptyString(this.parameters.deadline)?this.parameters.deadline:"";this.layout.deadline=BX("task-detail-deadline");this.layout.deadlineClear=BX("task-detail-deadline-clear");if(!this.layout.deadline){return}BX.bind(this.layout.deadline,"click",BX.proxy(this.onDeadlineClick,this));BX.bind(this.layout.deadlineClear,"click",BX.proxy(this.clearDeadline,this))};BX.Tasks.Component.TaskViewSidebar.prototype.onDeadlineClick=function(t){var e=new Date;var s=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),this.workingTime.end.hours,this.workingTime.end.minutes));BX.calendar({node:this.layout.deadline,field:"",form:"",bTime:true,value:this.deadline?this.deadline:s,bHideTimebar:false,bCompatibility:true,bCategoryTimeVisibilityOption:"tasks.bx.calendar.deadline",bTimeVisibility:this.calendarSettings?this.calendarSettings.deadlineTimeVisibility==="Y":false,callback_after:BX.proxy((function(t,e){this.setDeadline(t)}),this)})};BX.Tasks.Component.TaskViewSidebar.prototype.setDeadline=function(t){this.deadline=BX.calendar.ValueToString(t,true,false);this.layout.deadline.innerHTML=BX.date.format(BX.date.convertBitrixFormat(BX.message("FORMAT_DATETIME").replace(":SS","").replace("/SS","")),t,null,false);this.layout.deadlineClear.style.display="";this.updateDeadline()};BX.Tasks.Component.TaskViewSidebar.prototype.clearDeadline=function(){this.deadline="";this.layout.deadline.innerHTML=this.messages.emptyDeadline;this.layout.deadlineClear.style.display="none";this.updateDeadline()};BX.Tasks.Component.TaskViewSidebar.prototype.updateDeadline=function(){BX.ajax.runComponentAction("bitrix:tasks.task","setDeadline",{mode:"class",data:{taskId:this.taskId,date:this.deadline}}).then(function(t){BX.onCustomEvent(window,"tasksTaskEventChangeDeadline",[this.taskId,this.deadline]);BX.Tasks.Util.fireGlobalTaskEvent("UPDATE",{ID:this.taskId},{STAY_AT_PAGE:true},{id:this.taskId,deadline:this.deadline})}.bind(this)).catch(function(t){if(t.errors){BX.Tasks.alert(t.errors)}}.bind(this))};BX.Tasks.Component.TaskViewSidebar.prototype.addReminder=function(){BX.onCustomEvent(window,"tasksTaskEventAddReminder",[this.layout.reminderAdd])};BX.Tasks.Component.TaskViewSidebar.prototype.initReminder=function(){this.layout.reminderAdd=BX("task-detail-reminder-add");BX.bind(this.layout.reminderAdd,"click",BX.delegate(this.addReminder,this))};BX.Tasks.Component.TaskViewSidebar.prototype.initMark=function(){if(!this.can["RATE"]){return}this.mark=this.parameters.mark||"NULL";this.layout.mark=BX("task-detail-mark");if(this.layout.mark){BX.bind(this.layout.mark,"click",BX.proxy(this.onMarkClick,this))}};BX.Tasks.Component.TaskViewSidebar.prototype.onMarkClick=function(){if(this.taskLimitExceeded){BX.UI.InfoHelper.show("limit_tasks_rate",{isLimit:true,limitAnalyticsLabels:{module:"tasks",source:"taskSidebar"}});return}BX.TaskGradePopup.show(this.taskId,this.layout.mark,{listValue:this.mark},{events:{onPopupChange:BX.proxy(this.onMarkChange,this)}})};BX.Tasks.Component.TaskViewSidebar.prototype.onMarkChange=function(){var t=BX.proxy_context;this.layout.mark.className="task-detail-sidebar-item-mark-"+t.listValue.toLowerCase();this.layout.mark.innerHTML=t.listItem.name;BX.ajax.runComponentAction("bitrix:tasks.task","setMark",{mode:"class",data:{taskId:this.taskId,mark:t.listValue==="NULL"?"":t.listValue}}).then(function(t){BX.Tasks.Util.fireGlobalTaskEvent("UPDATE",{ID:this.taskId},{STAY_AT_PAGE:true},{id:this.taskId})}.bind(this)).catch(function(t){if(t.errors){BX.Tasks.alert(t.errors)}}.bind(this))};BX.Tasks.Component.TaskViewSidebar.prototype.initTime=function(){if(!this.allowTimeTracking){return}BX.Tasks.Util.Dispatcher.bindEvent("buttons-dayplan","task-timer-tick",BX.delegate(this.onTaskTimerTick,this))};BX.Tasks.Component.TaskViewSidebar.prototype.onTaskTimerTick=function(t,e){if(t!=this.taskId){return}var s=BX("task-detail-spent-time-"+this.taskId);if(s){s.innerHTML=BX.Tasks.Util.formatTimeAmount(e)}}}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:101:"/bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/reminder/logic.min.js?16992580839380";s:6:"source";s:82:"/bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/reminder/logic.js";s:3:"min";s:86:"/bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/reminder/logic.min.js";s:3:"map";s:86:"/bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/reminder/logic.map.js";}"*/
BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TaskDetailPartsReminder!="undefined"){return}BX.Tasks.Component.TaskDetailPartsReminder=BX.Tasks.Util.ItemSet.extend({sys:{code:"reminder"},constants:{UNIT_DAY:"D",UNIT_HOUR:"H"},methods:{construct:function(){this.callConstruct(BX.Tasks.Util.ItemSet);this.vars.editItemValue=0;this.instances.windows={};this.instances.form=new e({scope:this.control("form"),id:this.id()+"-form",parent:this});this.setTaskId(this.option("taskId"));this.setTaskDeadLine(this.option("taskDeadline"));this.instances.form.bindEvent("save",BX.delegate(this.onItemApply,this));this.bindEvent("setTaskDeadLine",BX.delegate(this.setTaskDeadLine,this));BX.addCustomEvent(window,"tasksTaskEventChangeDeadline",BX.delegate(this.onTaskDeadLineChange,this));BX.addCustomEvent(window,"tasksTaskEventAddReminder",BX.delegate(this.openAddForm,this))},extractItemValue:function(){return this.vars.idOffset++},extractItemDisplay:function(){return"1"},openUpdateForm:function(t){var e=this.vars.items[t];this.vars.editItemValue=t;this.instances.form.open(e.scope(),e.vars.data)},createItem:function(e){e=t.prepareData(e);var i=this.getNodeByTemplate("item",e)[0];BX.append(i,this.control("items"));var s=new t({scope:i,data:e,auxData:this.option("auxData"),parent:this});return s},setTaskId:function(t){this.vars.taskId=t?t:0},setTaskDeadLine:function(t){var e=0;if(BX.type.isNotEmptyString(t)){e=this.dateStringToStamp(t)}this.instances.form.setDeadLineStamp(e)},openAddForm:function(t){this.vars.editItemValue=0;this.instances.form.open(t)},onTaskDeadLineChange:function(t,e){if(t==this.vars.taskId){this.setTaskDeadLine(e)}},onItemApply:function(t){if(this.vars.editItemValue!=0){this.vars.items[this.vars.editItemValue].update(t);this.syncAllIfCan()}else{this.addItem(t)}},fireChangeEvent:function(t){this.callMethod(BX.Tasks.Util.ItemSet,"fireChangeEvent",arguments);if(!t.load){this.syncAllIfCan()}},getDateDiff:function(t,e){if(!BX.type.isNumber(t)){t=this.dateStringToStamp(t)}if(!BX.type.isNumber(e)){e=this.dateStringToStamp(e)}var i=e-t;var s=this.UNIT_HOUR;if(i%86400==0){s=this.UNIT_DAY;i=Math.floor(i/86400)}else{i=Math.floor(i/3600)}return{diff:i,unit:s}},dateStampToString:function(t,e){var i=new Date(t*1e3);return BX.date.format(e,i,false,true)},dateStringToStamp:function(t){var e=BX.parseDate(t,true);if(e!=null){return Math.floor(parseInt(e.getTime())/1e3)}return 0},syncAll:function(){var t=parseInt(this.option("taskId"));if(!t){return}var e=[];for(var i in this.vars.items){e.push(this.vars.items[i].data())}BX.ajax.runComponentAction("bitrix:tasks.task","setReminder",{mode:"class",data:{taskId:t,data:e}}).then(function(t){}.bind(this)).catch(function(t){if(t.errors){BX.Tasks.alert(t.errors)}}.bind(this))}}});var t=BX.Tasks.Util.ItemSet.Item.extend({sys:{code:"item"},methods:{construct:function(){this.callConstruct(BX.Tasks.Util.ItemSet.Item);this.vars.data=this.option("data");this.vars.randomTag=Math.round(Math.random()*1e5);this.bindEvents()},bindEvents:function(){this.bindDelegateControl("edit","click",BX.delegate(this.onEditClick,this))},data:function(){return{TRANSPORT:this.vars.data.TRANSPORT,TYPE:this.vars.data.TYPE,REMIND_DATE:this.vars.data.REMIND_DATE,RECEPIENT_TYPE:this.vars.data.RECEPIENT_TYPE}},value:function(){return this.vars.data.VALUE},display:function(){return this.vars.data.DISPLAY},update:function(e){e=t.prepareData(e);this.control("transport").value=e.TRANSPORT;this.control("type").value=e.TYPE;this.control("remind-date").value=e.REMIND_DATE;this.control("recipient-type").value=e.RECEPIENT_TYPE;this.control("edit").innerHTML=e.REMINDER_TEXT;BX[e.TRANSPORT=="J"?"addClass":"removeClass"](this.control("info"),"transport-j");this.vars.data=BX.mergeEx(this.vars.data,e)},delete:function(){var t=this.value();BX.remove(this.sys.scope);this.sys.scope=null;this.ctrls=null;this.vars.data=null;return t},onEditClick:function(t){this.parent().openUpdateForm(this.value());BX.PreventDefault(t)},onDeleteClick:function(t){this.parent().deleteItem(this.value());BX.PreventDefault(t)}}});t.prepareData=function(t){var e="";if(t.RECEPIENT_TYPE=="R"||t.RECEPIENT_TYPE=="O"||t.RECEPIENT_TYPE=="S"){e=BX.message("TASKS_TTDP_TEMPLATE_REMINDER_RECEPIENT_TYPE_"+t.RECEPIENT_TYPE)}t.REMINDER_TEXT=t.REMIND_DATE+" "+e;t.TRANSPORT_CLASS=t.TRANSPORT=="J"?"transport-j":"";return t};var e=BX.Tasks.Util.Widget.extend({sys:{code:"form"},constants:{REMINDER_TYPE_DEADLINE:"D",REMINDER_TYPE_COMMON:"A"},methods:{construct:function(){this.callConstruct(BX.Tasks.Util.Widget);this.vars.data={TYPE:"A",RECEPIENT_TYPE:"R",REMIND_DATE:"",TRANSPORT:"J"};this.vars.deadLine=0;this.vars.formatValue=BX.date.convertBitrixFormat(BX.message("FORMAT_DATETIME"))},load:function(t){if(!BX.type.isNotEmptyString(t.REMIND_DATE)){return}this.setType(t.TYPE);this.setRecipientType(t.RECEPIENT_TYPE);this.setTransportType(t.TRANSPORT);if(t.TYPE==this.REMINDER_TYPE_DEADLINE){var e=this.parent().getDateDiff(t.REMIND_DATE,this.vars.deadLine);this.setUnit(e.unit);this.setMultiplier(e.diff)}else{this.setDate(t.REMIND_DATE,true)}},reset:function(){this.setType("A");this.setRecipientType("R");this.setDate("",true);this.setTransportType("J");this.setMultiplier(1);this.setUnit(this.parent().UNIT_DAY)},open:function(t,e){var i=this.getWindow(t);if(typeof e!="undefined"){this.load(e)}else{this.reset()}this.changeCSSFlag("mode-update",typeof e!="undefined");i.show()},close:function(){this.getWindow().close();this.reset()},getWindow:function(t){if(typeof this.instances.window=="undefined"){this.instances.window=new BX.PopupWindow(this.id(),t,{autoHide:true,closeByEsc:true,content:this.scope(),overlay:false,lightShadow:true,closeIcon:true,draggable:false,titleBar:false,angle:{position:"top"},offsetTop:12,offsetLeft:45,events:{onPopupClose:BX.delegate(this.onFormClose,this)}});this.bindControl("change-type","click",this.passCtx(this.onChangeType));this.bindControl("change-recipient","change",this.passCtx(this.onChangeRecipientType));this.bindDelegateControl("change-transport","click",this.passCtx(this.onChangeTransportType));this.bindControl("submit","click",BX.delegate(this.onSubmit,this))}if(typeof this.instances.datepicker=="undefined"){var e=this.control("date");if(BX.type.isElementNode(e)){var i=new BX.Tasks.Util.DatePicker({scope:e,defaultTime:this.optionP("auxData").COMPANY_WORKTIME.HOURS.START,calendarSettings:this.optionP("auxData").CALENDAR_SETTINGS});i.bindEvent("change",BX.delegate(this.onChangeRemindDate,this));i.bindEvent("open",BX.delegate(this.closeTypeSubWindow,this));this.instances.datepicker=i}}if(BX.type.isElementNode(t)){this.instances.window.setBindElement(t)}return this.instances.window},setDeadLineStamp:function(t){this.vars.deadLine=t;this.toggleDeadLineMode()},onChangeRemindDate:function(t,e){this.setDate(e,false)},setMultiplier:function(t){this.control("time-multiplier").value=t},setUnit:function(t){this.control("time-unit").value=t},setDate:function(t,e){if(typeof t=="undefined"){return}this.vars.data.REMIND_DATE=t;if(e){this.instances.datepicker.setValue(t)}},setType:function(t){if(!t){return}this.vars.data.TYPE=t;this.setCSSMode("type",t.toLowerCase())},setRecipientType:function(t){if(!t){return}this.vars.data.RECEPIENT_TYPE=t;this.control("change-recipient").value=t},setTransportType:function(t){if(!t){return}this.vars.data.TRANSPORT=t;this.setCSSMode("transport",t.toLowerCase())},toggleDeadLineMode:function(){var t=this.vars.deadLine<=0;if(t){if(this.vars.data.TYPE==this.REMINDER_TYPE_DEADLINE){this.setType(this.REMINDER_TYPE_COMMON);this.setDate(0,"")}}this.changeCSSFlag("no-deadline",t)},getDeadLineOffset:function(){var t=parseInt(this.control("time-multiplier").value);if(isNaN(t)){t=0}var e=this.control("time-unit").value=="D"?86400:3600;return this.parent().dateStampToString(this.vars.deadLine-t*e,this.vars.formatValue)},onSubmit:function(){if(this.vars.data.TYPE==this.REMINDER_TYPE_DEADLINE){this.vars.data.REMIND_DATE=this.getDeadLineOffset()}if(this.vars.data.REMIND_DATE.length==""){return}this.fireEvent("save",[BX.clone(this.vars.data)]);this.close()},onFormClose:function(){this.closeTypeSubWindow();this.closeCalendarSubWindow()},closeTypeSubWindow:function(){if(typeof this.instances.typeWindow!="undefined"&&this.instances.typeWindow!=null){this.instances.typeWindow.popupWindow.close()}},closeCalendarSubWindow:function(){if(typeof this.instances.datepicker!="undefined"&&this.instances.datepicker!=null){this.instances.datepicker.closeCalendar()}},onChangeTransportType:function(t){var e=BX.data(t,"transport");if(typeof e!="undefined"&&e!=null){this.setTransportType(e)}},onChangeRecipientType:function(t){this.setRecipientType(t.value)},onChangeType:function(t){var e=this;var i=[{text:BX.message("TASKS_TTDP_TEMPLATE_REMINDER_TYPE_A"),title:BX.message("TASKS_TTDP_TEMPLATE_REMINDER_TYPE_A_EX"),className:"menu-popup-no-icon",onclick:function(){e.setType("A");this.popupWindow.close()}},{text:BX.message("TASKS_TTDP_TEMPLATE_REMINDER_TYPE_D"),title:BX.message("TASKS_TTDP_TEMPLATE_REMINDER_TYPE_D_EX"),className:"menu-popup-no-icon",onclick:function(){e.setType("D");this.popupWindow.close()}}];var s=this.id()+"-form-transport";BX.PopupMenu.show(s,t,i,{offsetTop:0,events:{onPopupShow:BX.delegate(this.closeCalendarSubWindow,this)}});this.instances.typeWindow=BX.PopupMenu.getMenuById(s)}}})})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/tasks.widget.member.selector/templates/view/logic.min.js?16992580828364";s:6:"source";s:78:"/bitrix/components/bitrix/tasks.widget.member.selector/templates/view/logic.js";s:3:"min";s:82:"/bitrix/components/bitrix/tasks.widget.member.selector/templates/view/logic.min.js";s:3:"map";s:82:"/bitrix/components/bitrix/tasks.widget.member.selector/templates/view/logic.map.js";}"*/
"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksWidgetMemberSelectorView!="undefined"){return}BX.Tasks.Component.TasksWidgetMemberSelectorView=BX.Tasks.Component.extend({sys:{code:"mem-sel"},methods:{construct:function(){this.callConstruct(BX.Tasks.Component);this.switchDeleteButtonShow()},bindEvents:function(){this.getManager();var e={AUDITORS:"auditor",ACCOMPLICES:"accomplice",RESPONSIBLE:"responsible",RESPONSIBLES:"responsible"};var t=this;if(this.option("role")==="AUDITORS"||this.option("role")==="ACCOMPLICES"){BX.Event.EventEmitter.subscribe("BX.Tasks.CheckListItem:"+e[this.option("role")]+"Added",(function(e){t.getManager().onSelectorItemSelected(e.data);t.onChangeByUser()}))}if(e[this.option("role")]){BX.Event.EventEmitter.subscribe("BX.Tasks.MemberSelector:"+e[this.option("role")]+"Selected",(function(e){t.getManager().onSelectorItemSelected(e.data);t.onChangeByUser()}));BX.Event.EventEmitter.subscribe("BX.Tasks.MemberSelector:"+e[this.option("role")]+"Deselected",(function(e){t.getManager().onSelectorItemDeselected(e.data);if(t.option("context")==="template"||t.option("role")==="AUDITORS"||t.option("role")==="ACCOMPLICES"){t.onChangeByUser()}}))}},setHeaderButtonLabelText:function(e){this.control("header-button").innerHTML=BX.util.htmlspecialchars(e)},getManager:function(){return this.subInstance("mgr",(function(){var e=new this.constructor.Manager({scope:this.scope(),data:this.option("data"),nameTemplate:this.option("nameTemplate"),min:this.option("min"),max:this.option("max"),path:this.option("path"),role:this.option("role"),taskLimitExceeded:this.option("taskLimitExceeded"),networkEnabled:this.option("networkEnabled")});e.bindEvent("change-by-user",this.onChangeByUser.bind(this));return e}))},onChangeByUser:function(){if(this.option("enableSync")){var e=parseInt(this.option("entityId"));var t=this.option("entityRoute");var i=this.option("fieldName");if(!e||!t||!i){return}var n={id:e,data:{}};var s=[];var r=[];this.getManager().each((function(e){r.push(e.value());s.push({ID:e.value(),NAME:e.data().NAME,LAST_NAME:e.data().LAST_NAME,EMAIL:e.data().EMAIL})}));var o=this.getManager();BX.ajax.runComponentAction("bitrix:tasks.widget.member.selector","isAbsence",{mode:"class",data:{userIds:r}}).then(function(e){if(!e.status||e.status!=="success"){return}if(!e.data.length){return}var t=e.data.reduce((function(e,t){return e+"<br />"+t}));var i=BX.PopupWindowManager.create("popupMenuOptions",BX(o.scope()),{content:t,darkMode:true,autoHide:true,width:200});i.show()}.bind(this),function(e){}.bind(this));n.data[i]=s;this.sendSetMembersRequest(s);this.switchDeleteButtonShow()}},sendSetMembersRequest:function(e){var t={AUDITORS:"setAuditors",ACCOMPLICES:"setAccomplices",RESPONSIBLE:"setResponsible",RESPONSIBLES:"setResponsible"};var i=this.option("entityId");var n=t[this.option("role")];BX.ajax.runComponentAction("bitrix:tasks.widget.member.selector",n,{mode:"class",data:{taskId:i,context:this.option("context")??"",data:e}}).then(function(e){BX.Tasks.Util.fireGlobalTaskEvent("UPDATE",{ID:i},{STAY_AT_PAGE:true},{id:i})}.bind(this)).catch(function(e){if(e.errors){BX.Tasks.alert(e.errors)}}.bind(this))},addItem:function(e){this.getManager().addItem(e)},deleteItem:function(e){this.getManager().deleteItem(this.getManager().extractItemValue(e))},switchDeleteButtonShow:function(e){if(this.option("min")!==1){return}var t=document.getElementsByClassName("js-id-mem-sel-is-i-delete");if(e){if(t.length===2){Object.keys(t).forEach((function(e){BX.addClass(t[e],"hidden")}))}}else{if(t.length===1){BX.addClass(t[0],"hidden")}else{Object.keys(t).forEach((function(e){BX.removeClass(t[e],"hidden")}))}}}}});BX.Tasks.Component.TasksWidgetMemberSelectorView.Manager=BX.Tasks.UserItemSet.extend({dialog:null,sys:{code:"mem-sel-is"},options:{preRendered:true,autoSync:true,role:false,multiple:false,useSearch:true,forceTop:true,useAdd:true,controlBind:"class",itemFx:"vertical",useSmartCodeNaming:true},methods:{construct:function(){this.callConstruct(BX.Tasks.UserItemSet);this.fireUserTriggeredChangeDebounce=BX.debounce(this.fireUserTriggeredChangeDebounce,800);this.initDialog()},getDialog:function(){if(this.dialog){return this.dialog}this.dialog=new BX.UI.EntitySelector.Dialog({enableSearch:true,multiple:this.option("max")>1,context:"TASKS_MEMBER_SELECTOR_VIEW_"+this.option("role"),entities:this.getDialogEntities(),preselectedItems:this.getDialogSelectedItems(),undeselectedItems:this.getDialogUndeselectedItems(),events:{"Item:onSelect":function(e){var t=e.getData().item;var i=this.prepareUserData(t);var n={ACCOMPLICES:"accomplice",AUDITORS:"auditor",RESPONSIBLE:"responsible",RESPONSIBLES:"responsible"};BX.Event.EventEmitter.emit("BX.Tasks.MemberSelector:"+n[this.option("role")]+"Selected",i)}.bind(this),"Item:onDeselect":function(e){var t=e.getData().item;var i=this.prepareUserData(t);var n={ACCOMPLICES:"accomplice",AUDITORS:"auditor",RESPONSIBLE:"responsible",RESPONSIBLES:"responsible"};BX.Event.EventEmitter.emit("BX.Tasks.MemberSelector:"+n[this.option("role")]+"Deselected",i)}.bind(this)}});return this.dialog},initDialog:function(){var e=this.scope().getElementsByClassName("js-id-mem-sel-is-control");for(var t=0;t<e.length;t++){var i=e[t];i.addEventListener("click",function(e){var t=this.option("role");var i=this.option("taskLimitExceeded");if((t==="ACCOMPLICES"||t==="AUDITORS")&&i){BX.UI.InfoHelper.show("limit_tasks_observers_participants",{isLimit:true,limitAnalyticsLabels:{module:"tasks",source:"sidebar",subject:t==="AUDITORS"?"auditor":"accomplice"}});return}this.getDialog().setTargetNode(e);this.getDialog().show()}.bind(this))}},getDialogUndeselectedItems:function(){var e=this.option("data");var t=[];if(this.option("min")!==1||this.option("max")!==1){return}var i=null;for(var n in e){i=this.prepareItemData(e[n]);if(i){t.push(i)}}return t},getDialogSelectedItems:function(){var e=this.option("data");var t=[];var i=null;for(var n in e){i=this.prepareItemData(e[n]);if(i){t.push(i)}}return t},prepareItemData:function(e){var t=0;if(e.ID){t=e.ID}else if(e.id){t=e.id}if(t<=0){return null}var i=this.option("mode");return[i==="group"?"project":"user",t]},getDialogEntities:function(){var e=this.option("mode");var t=this.option("networkEnabled");var i=[];if(e==="user"){i=[{id:"user",options:{emailUsers:true,networkUsers:t,extranetUsers:true,inviteGuestLink:true,myEmailUsers:true}},{id:"department"}]}else if(e==="group"){i=[{id:"project"}]}return i},prepareUserData:function(e){var t=this.option("role");var i=e.getCustomData();var n=e.getEntityType();var s=this.option("mode");var r={ACCOMPLICES:"A",AUDITORS:"U",RESPONSIBLE:"R"};return{AVATAR:e.avatar,DESCRIPTION:"",entityType:r[t],id:e.getId(),name:i.get("name"),lastName:i.get("lastName"),email:i.get("email"),nameFormatted:BX.Text.encode(e.getTitle()),networkId:"",url:e.getLink(),user_type:n,type:{crmemail:false,extranet:n==="extranet",email:n==="email",network:n==="network"},VALUE:(s==="group"?"SG":"U")+e.getId()}},prepareData:function(e){e=this.callMethod(BX.Tasks.UserItemSet,"prepareData",arguments);e.AVATAR_CSS=e.AVATAR?"background: url('"+encodeURI(e.AVATAR)+"') center no-repeat; background-size: 35px;":"";return e},openAddForm:function(){var e=this.option("role");var t=this.option("taskLimitExceeded");if((e==="ACCOMPLICES"||e==="AUDITORS")&&t){BX.UI.InfoHelper.show("limit_tasks_observers_participants",{isLimit:true,limitAnalyticsLabels:{module:"tasks",source:"sidebar",subject:e==="AUDITORS"?"auditor":"accomplice"}});return}this.callMethod(BX.Tasks.UserItemSet,"openAddForm")},onClose:function(){if(this.vars.changed){this.fireUserTriggeredChange()}this.vars.changed=false},onItemDeleteClicked:function(e){this.parent().switchDeleteButtonShow(true);var t=this.doOnItem(e,this.deleteItem);if(t){this.fireUserTriggeredChangeDebounce()}},fireUserTriggeredChangeDebounce:function(){this.fireUserTriggeredChange()},fireUserTriggeredChange:function(){this.fireEvent("change-by-user")},deleteItem:function(e,t){if(this.callMethod(BX.Tasks.UserItemSet,"deleteItem",arguments)){this.unselectDialogItem(e);return true}return false},unselectDialogItem:function(e){if(typeof e!=="object"){return}if(!this.getDialog()){return}e=this.prepareItemData(e.data());if(!e){return}var t=this.getDialog().getItem(e);t&&t.deselect()}}})}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:99:"/bitrix/components/bitrix/tasks.scrum.epic.selector/templates/.default/script.min.js?16992580838941";s:6:"source";s:80:"/bitrix/components/bitrix/tasks.scrum.epic.selector/templates/.default/script.js";s:3:"min";s:84:"/bitrix/components/bitrix/tasks.scrum.epic.selector/templates/.default/script.min.js";s:3:"map";s:84:"/bitrix/components/bitrix/tasks.scrum.epic.selector/templates/.default/script.map.js";}"*/
this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};(function(e,t,i,r){"use strict";var n,s,a;var o=function(){function e(t){babelHelpers.classCallCheck(this,e);this.groupId=t.groupId;this.taskId=t.taskId;this.epic=t.epic;this.canEdit=t.canEdit;this.dialog=null;this.node=null;this.nameNode=null;this.selectorNode=null;i.EventEmitter.subscribe("onChangeProjectLink",this.onChangeTaskProject.bind(this))}babelHelpers.createClass(e,[{key:"renderTo",value:function e(i){t.Dom.append(this.render(),i)}},{key:"render",value:function e(){this.node=t.Tag.render(n||(n=babelHelpers.taggedTemplateLiteral(["\n\t\t\t<div>\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),this.renderName(),this.renderSelector());return this.node}},{key:"onChangeTaskProject",value:function e(t){var i=t.getCompatData(),r=babelHelpers.slicedToArray(i,2),n=r[0],s=r[1];this.groupId=parseInt(n,10);this.taskId=parseInt(s,10);this.epic=null;this.dialog=null;this.updateSelector(null)}},{key:"renderName",value:function e(){if(t.Type.isNull(this.epic)){return""}var i=this.convertHexToRGBA(this.epic.color,.7);var r=this.convertHexToRGBA(this.epic.color,.3);this.nameNode=t.Tag.render(s||(s=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div\n\t\t\t\tclass="tasks-scrum__epic-selector--epic"\n\t\t\t\tstyle="background: ',"; border-color: ",';"\n\t\t\t>\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),r,i,t.Text.encode(this.epic.name));return this.nameNode}},{key:"renderSelector",value:function e(){this.selectorNode=t.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div>\n\t\t\t\t<div class="ui-btn-link tasks-scrum__epic-selector--link">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),this.getButtonText());var i=this.selectorNode.firstElementChild;t.Event.bind(i,"click",this.onClick.bind(this,i));return this.selectorNode}},{key:"onClick",value:function e(i){var n=this;if(this.dialog){if(this.dialog.isOpen()){this.dialog.hide()}else{this.dialog.show()}return}var s=[];if(!t.Type.isNull(this.epic)){s.push(["epic-selector",this.epic.id])}this.dialog=new r.Dialog({id:t.Text.getRandom(),targetNode:this.selectorNode,width:350,height:300,multiple:false,dropdownMode:true,enableSearch:true,compactView:true,hideOnDeselect:true,context:"epic-selector-"+this.groupId,preselectedItems:s,entities:[{id:"epic-selector",options:{groupId:this.groupId},dynamicLoad:true,dynamicSearch:true}],searchOptions:{allowCreateItem:true,footerOptions:{label:t.Loc.getMessage("TSE_SELECTOR_SEARCHER_EPIC_ADD")}},events:{"Search:onItemCreateAsync":function e(t){return new Promise((function(e){var i=t.getData(),r=i.searchQuery;n.createEpic(r.getQuery()).then((function(t){var i=n.getEpicDialogItem(t);i.selected=true;i.sort=1;n.dialog.addItem(i);n.dialog.hide();e()}))}))}},tagSelectorOptions:{textBoxWidth:300}});this.dialog.subscribe("onHide",(function(){var e=n.dialog.getSelectedItems();var t=e.length?e[0].getId():0;n.changeTaskEpic(t).then((function(e){return n.updateSelector(e)}))}));this.dialog.show()}},{key:"updateSelector",value:function e(i){this.epic=i;this.selectorNode.firstElementChild.textContent=this.getButtonText();if(t.Type.isNull(i)){t.Dom.remove(this.nameNode);this.nameNode=null}else{if(t.Type.isNull(this.nameNode)){t.Dom.insertBefore(this.renderName(),this.selectorNode)}else{t.Dom.replace(this.nameNode,this.renderName())}}}},{key:"getEpicDialogItem",value:function e(t){return{id:t.id,entityId:"epic-selector",title:t.name,tabs:"recents",avatarOptions:{bgColor:t.color,bgImage:"none",borderRadius:"12px"}}}},{key:"changeTaskEpic",value:function e(i){var r=this;return t.ajax.runComponentAction("bitrix:tasks.scrum.epic.selector","changeTaskEpic",{mode:"class",data:{taskId:this.taskId,epicId:i}}).then((function(e){return e.data}))["catch"]((function(e){return r.showErrorAlert(e)}))}},{key:"createEpic",value:function e(i){var r=this;return t.ajax.runAction("bitrix:tasks.scrum.epic.createEpic",{data:{groupId:this.groupId,name:i}}).then((function(e){return e.data}))["catch"]((function(e){return r.showErrorAlert(e)}))}},{key:"getButtonText",value:function e(){if(t.Type.isNull(this.epic)){return t.Loc.getMessage("TSE_SELECTOR_ADD")}else{return t.Loc.getMessage("TSE_SELECTOR_EDIT")}}},{key:"convertHexToRGBA",value:function e(t,i){var r=t.replace("#","");if(r.length===3){r="".concat(r[0]).concat(r[0]).concat(r[1]).concat(r[1]).concat(r[2]).concat(r[2])}var n=parseInt(r.substring(0,2),16);var s=parseInt(r.substring(2,4),16);var a=parseInt(r.substring(4,6),16);return"rgba(".concat(n,",").concat(s,",").concat(a,",").concat(i,")")}},{key:"showErrorAlert",value:function e(i,r){if(t.Type.isUndefined(i.errors)){return}if(i.errors.length){var n=i.errors.shift();if(n){var s=n.code?n.code:"";var a=n.message+" "+s;var o=r?r:t.Loc.getMessage("TSE_SELECTOR_ERROR_POPUP_TITLE");top.BX.UI.Dialogs.MessageBox.alert(a,o)}}}}]);return e}();var c;var l=function(){function e(t){babelHelpers.classCallCheck(this,e);this.groupId=t.groupId;this.taskId=t.taskId;this.savedEpic=t.epic;this.inputName=t.inputName;this.selector=null;this.node=null;this.inputNode=null;i.EventEmitter.subscribe("BX.Tasks.MemberSelector:projectSelected",this.onProjectSelected.bind(this));i.EventEmitter.subscribe("BX.Tasks.Component.Task:projectPreselected",this.onProjectPreselected.bind(this))}babelHelpers.createClass(e,[{key:"renderTo",value:function e(i){this.node=i;t.Dom.addClass(this.node,"tasks-scrum-epic-edit-selector");if(this.inputName){t.Dom.append(this.renderInput(),this.node)}this.buildSelector().renderTo(this.node)}},{key:"renderInput",value:function e(){var i=this.savedEpic?parseInt(this.savedEpic.id,10):0;this.inputNode=t.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<input type="hidden" name="','" value="','">\n\t\t'])),t.Text.encode(this.inputName),i);return this.inputNode}},{key:"buildSelector",value:function e(){var i=this;var n=[];if(this.savedEpic){n.push(["epic-selector",this.savedEpic.id]);this.updateInputValue(this.savedEpic.id)}this.selector=new r.TagSelector({multiple:false,textBoxWidth:200,dialogOptions:{width:350,height:240,dropdownMode:true,compactView:true,multiple:false,hideOnDeselect:true,context:"epic-selector-"+this.groupId,preselectedItems:n,entities:[{id:"epic-selector",options:{groupId:this.groupId},dynamicLoad:true,dynamicSearch:true}],searchOptions:{allowCreateItem:true,footerOptions:{label:t.Loc.getMessage("TSE_SELECTOR_SEARCHER_EPIC_ADD")}},items:[],events:{"Search:onItemCreateAsync":function e(t){return new Promise((function(e){var r=t.getData(),n=r.searchQuery;var s=t.getTarget();i.createEpic(n.getQuery()).then((function(t){var r=i.getEpicDialogItem(t);r.selected=true;r.sort=1;s.addItem(r);i.updateInputValue(r.id);e()}))}))},"Item:onSelect":function e(t){var r=t.getData().item;i.updateInputValue(r.getId())},"Item:onDeselect":function e(t){var r=t.getTarget();setTimeout((function(){if(r.getSelectedItems().length===0){i.updateInputValue(0)}}),50)}}}});this.selector.subscribe("onMetaEnter",(function(e){var t=e.getTarget();if(t.getDialog().isOpen()){var i=e.getData(),r=i.event;r.stopPropagation()}}));return this.selector}},{key:"onProjectSelected",value:function e(i){var r=i.getData();this.groupId=parseInt(r.ID,10);this.updateInputValue(0);this.savedEpic=null;t.Dom.clean(this.node);this.renderTo(this.node)}},{key:"onProjectPreselected",value:function e(i){var r=i.getData();this.groupId=parseInt(r.groupId,10);t.Dom.clean(this.node);this.renderTo(this.node)}},{key:"updateInputValue",value:function e(t){this.inputNode.value=parseInt(t,10)}},{key:"getEpicDialogItem",value:function e(t){return{id:t.id,entityId:"epic-selector",title:t.name,tabs:"recents",avatarOptions:{bgColor:t.color,bgImage:"none",borderRadius:"12px"}}}},{key:"createEpic",value:function e(i){var r=this;return t.ajax.runAction("bitrix:tasks.scrum.epic.createEpic",{data:{groupId:this.groupId,name:i}}).then((function(e){return e.data}))["catch"]((function(e){return r.showErrorAlert(e)}))}},{key:"showErrorAlert",value:function e(i,r){if(t.Type.isUndefined(i.errors)){return}if(i.errors.length){var n=i.errors.shift();if(n){var s=n.code?n.code:"";var a=n.message+" "+s;var o=r?r:t.Loc.getMessage("TSE_SELECTOR_ERROR_POPUP_TITLE");top.BX.UI.Dialogs.MessageBox.alert(a,o)}}}}]);return e}();var d=function(){function e(i){babelHelpers.classCallCheck(this,e);this.groupId=parseInt(i.groupId,10);this.taskId=parseInt(i.taskId,10);this.epic=t.Type.isPlainObject(i.epic)?i.epic:null;this.canEdit=i.canEdit==="Y";this.mode=i.mode==="edit"?"edit":"view";this.inputName=i.inputName}babelHelpers.createClass(e,[{key:"renderTo",value:function e(t){if(this.mode==="view"){new o({groupId:this.groupId,taskId:this.taskId,epic:this.epic,canEdit:this.canEdit}).renderTo(t)}else{new l({groupId:this.groupId,taskId:this.taskId,epic:this.epic,inputName:this.inputName}).renderTo(t)}}}]);return e}();e.EpicSelector=d})(this.BX.Tasks.Scrum=this.BX.Tasks.Scrum||{},BX,BX.Event,BX.UI.EntitySelector);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/tasks.tags.selector/templates/selector/script.min.js?16992580826463";s:6:"source";s:74:"/bitrix/components/bitrix/tasks.tags.selector/templates/selector/script.js";s:3:"min";s:78:"/bitrix/components/bitrix/tasks.tags.selector/templates/selector/script.min.js";s:3:"map";s:78:"/bitrix/components/bitrix/tasks.tags.selector/templates/selector/script.map.js";}"*/
this.BX=this.BX||{};(function(t){"use strict";BX.namespace("BX.Tasks");BX.Tasks.TagsSelector=function(t){this.tagsAreConverting=t.tagsAreConverting;this.groupId=t.groupId||0;this.taskId=t.taskId||0;this.isScrumTask=t.isScrumTask==="Y";this.templateId=t.templateId||0;this.tags=t.tags;this.userId=t.userId||0;this.entity={id:"task-tag"};if(this.taskId){this.entity.options={taskId:this.taskId};this.tags=[]}if(this.groupId){this.entity.options.groupId=this.groupId}this.bindEvents()};BX.Tasks.TagsSelector.prototype={constructor:BX.Tasks.TagsSelector,show:function t(){this.getSelector()&&this.getSelector().show()},bindEvents:function t(){var e=function t(){this.dialog.hide();this.dialog=null};var a=function t(e){this.dialog=null;this.groupId=0;if(e){this.groupId=e.data}};BX.addCustomEvent("onProjectChanged",a.bind(this));BX.PULL.subscribe({type:BX.PullClient.SubscriptionType.Server,moduleId:"tasks",command:"tag_changed",callback:e.bind(this)})},getSelector:function t(){if(!this.dialog){var e={status:false};var a=function t(){var e=BX.UI.EntitySelector.Dialog.getById("tasks-selector-task-tag-widget");e.getFooterContainer().querySelector("#tags-widget-custom-footer-add-new").hidden=false;e.getFooterContainer().querySelector("#tags-widget-custom-footer-conjunction").hidden=false};var s=function t(){var e=BX.UI.EntitySelector.Dialog.getById("tasks-selector-task-tag-widget");e.getFooterContainer().querySelector("#tags-widget-custom-footer-add-new").hidden=true;e.getFooterContainer().querySelector("#tags-widget-custom-footer-conjunction").hidden=true};var i=function t(e){var i=e.getData().query;if(i.trim()!==""){a()}else{s()}};var n=function t(e,a){var s=BX.UI.EntitySelector.Dialog.getById("tasks-selector-task-tag-widget");if(s.getContainer().querySelector("div.".concat(e))){return}var i=document.createElement("div");i.className=e;i.innerHTML="\n\t\t\t\t<div class='ui-alert ui-alert-xs ui-alert-danger'  \n\t\t\t\t\t<span class='ui-alert-message'>\n\t\t\t\t\t\t".concat(a,"\n\t\t\t\t\t</span> \n\t\t\t\t</div>\n\t\t\t\t");s.getFooterContainer().before(i)};var o=function t(a){var s=a.getTarget();var i=["click","keydown"];var o=function t(a){if(a.type==="keydown"){if(!((a.ctrlKey||a.metaKey)&&a.keyCode===13)){return}}var i=s.getSelectedItems().map((function(t){return t.getTitle()}));var o=s.getTagSelectorQuery();if(o.trim()===""){return}BX.ajax.runComponentAction("bitrix:tasks.tags.selector","updateTags",{mode:"class",data:{taskId:r,tagIds:i,newTag:o}}).then((function(t){if(t.data.success){e.status=true;var a=s.addItem({id:o,entityId:"task-tag",title:o,sort:1,badges:[{title:t.data.owner}]});s.getTab("all").getRootNode().addItem(a);a.select()}else{var i="tasks-selector-tag-already-exists-alert";n(i,t.data.error);var r=function t(){var e=s.getContainer().querySelector("div.".concat(i));e&&e.remove()};setTimeout(r,2e3)}}))};i.forEach((function(t){if(t==="click"){s.getFooterContainer().querySelector("#tags-widget-custom-footer-add-new").addEventListener(t,o)}else{s.getContainer().addEventListener(t,o)}}))};var r=this.taskId;var d=this.groupId;var c=this.templateId;if(r!==0){if(this.tagsAreConverting){var l=new top.BX.UI.Dialogs.MessageBox({title:BX.message("TASKS_TAG_SELECTOR_TAGS_ARE_CONVERTING_TITLE"),message:BX.message("TASKS_TAG_SELECTOR_TAGS_ARE_CONVERTING_TEXT"),buttons:top.BX.UI.Dialogs.MessageBoxButtons.OK,okCaption:BX.message("TASKS_TAG_SELECTOR_TAGS_ARE_CONVERTING_COME_BACK_LATER"),onOk:function t(){l.close()}});l.show();return}this.dialog=new BX.UI.EntitySelector.Dialog({id:"tasks-selector-task-tag-widget",targetNode:BX("task-tags-link"),enableSearch:true,width:350,height:400,multiple:true,dropdownMode:true,compactView:true,entities:[{id:"task-tag",options:{taskId:this.taskId,groupId:d}}],selectedItems:this.tags.map((function(t){return{id:BX.util.htmlspecialcharsback(t),entityId:"task-tag",title:BX.util.htmlspecialcharsback(t),tabs:"all"}})),searchOptions:{allowCreateItem:false},footer:BX.Tasks.EntitySelector.Footer,footerOptions:{userId:this.userId,taskId:this.taskId,groupId:d},clearUnavailableItems:true,events:{onLoad:function(t){t.getTarget().getFooterContainer().style.zIndex=1;o(t)}.bind(this),"Item:onSelect":function(t){this.onTagsChange(t,e)}.bind(this),onSearch:function(t){i(t)}.bind(this),"Item:onDeselect":function(t){this.onTagsChange(t,e)}.bind(this)}})}if(c!==0){this.dialog=new BX.UI.EntitySelector.Dialog({id:"tasks-widget-tag-selector-template-detail",targetNode:BX("task-tags-link"),enableSearch:true,width:350,height:400,multiple:true,dropdownMode:true,compactView:true,context:"TEMPLATE_TAG",entities:[{id:"template-tag",options:{},dynamicLoad:true,dynamicSearch:true}],selectedItems:this.tags.map((function(t){return{id:BX.util.htmlspecialcharsback(t),entityId:"template-tag",title:BX.util.htmlspecialcharsback(t),tabs:"all"}})),searchOptions:{allowCreateItem:true},events:{"Search:onItemCreateAsync":function t(e){var a=new BX.Promise;var s=e.getData().searchQuery;var i=e.getTarget();setTimeout((function(){var t=i.addItem({id:s.getQuery(),entityId:"template-tag",title:s.getQuery(),tabs:"all"});if(t){t.select()}a.fulfill()}),1e3);return a},"Item:onSelect":function(t){this.onTagsChange(t)}.bind(this),"Item:onDeselect":function(t){this.onTagsChange(t)}.bind(this)}})}}return this.dialog},onTagsChange:function t(e,a){var s=e.getData().item;s.setSort(1);this.dialog.getTab("all").getRootNode().addItem(s);var i=this.getSelector().getSelectedItems();var n=i.map((function(t){return t.getTitle()}));var o=n.join(", ");this.updateNode(o);var r=n.map((function(t){return{name:t}}));BX.onCustomEvent("onTaskTagSelect",[r]);if(typeof a!=="undefined"&&a.status){a.status=false;this.dialog.clearSearch();this.dialog.getFooterContainer().querySelector("#tags-widget-custom-footer-add-new").hidden=true;this.dialog.getFooterContainer().querySelector("#tags-widget-custom-footer-conjunction").hidden=true;return}if(this.taskId){this.updateTask(n)}},updateNode:function t(e){var a=BX("task-tags-line");var s=BX("task-tags-link");BX.cleanNode(a);BX.adjust(a,{text:e});if(e.length>0){a.innerHTML+="&nbsp;&nbsp;";s.innerHTML=BX.message("TAGS_BUTTON_CHANGE")}else{s.innerHTML=BX.message("TAGS_BUTTON_ADD")}},updateTask:function t(e){BX.ajax.runComponentAction("bitrix:tasks.tags.selector","updateTags",{mode:"class",data:{taskId:this.taskId,tagIds:e}})["catch"]((function(t){if(t.errors){BX.Tasks.alert(t.errors)}}))}}})(this.BX.Tasks=this.BX.Tasks||{});
/* End */
;; /* /bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js?16992580712527*/
; /* /bitrix/components/bitrix/tasks.iframe.popup/templates/wrap/logic.min.js?16992580841319*/
; /* /bitrix/components/bitrix/tasks.task/templates/view/logic.min.js?169925808216157*/
; /* /bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/script.min.js?169925808360*/
; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?169925794962259*/
; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.js?16992579501940*/
; /* /bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/logic.min.js?16992580834013*/
; /* /bitrix/components/bitrix/tasks.interface.filter.buttons/templates/.default/script.min.js?16992580822944*/
; /* /bitrix/components/bitrix/disk.uf.file/templates/.default/script.min.js?169925797466406*/
; /* /bitrix/components/bitrix/tasks.widget.checklist.new/templates/.default/logic.min.js?169925808316242*/
; /* /bitrix/components/bitrix/tasks.widget.member.selector/templates/projectlink/logic.min.js?16992580822273*/
; /* /bitrix/components/bitrix/app.placement/templates/menu/script.min.js?1699258043580*/
; /* /bitrix/components/bitrix/tasks.widget.buttons/templates/task/logic.min.js?16992580829719*/
; /* /bitrix/components/bitrix/tasks.list/templates/.default/script.min.js?169925808315265*/
; /* /bitrix/components/bitrix/tasks.list/templates/.default/table-view.min.js?169925808333530*/
; /* /bitrix/components/bitrix/tasks.list/templates/.default/resizecolumns.js?16992580838378*/
; /* /bitrix/components/bitrix/tasks.list/templates/.default/movecolumns.js?16992580837771*/
; /* /bitrix/components/bitrix/tasks.widget.result/templates/.default/script.min.js?16992580825521*/
; /* /bitrix/components/bitrix/forum.comments/templates/.default/script.min.js?1699257985319*/
; /* /bitrix/components/bitrix/main.post.list/templates/.default/script.min.js?169925794955869*/
; /* /bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form.min.js?169925794912332*/
; /* /bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form2.min.js?169925794914615*/
; /* /bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_im.min.js?16992579498220*/
; /* /bitrix/components/bitrix/main.post.form/templates/.default/script.min.js?169925795070830*/
; /* /bitrix/components/bitrix/system.field.edit/script.min.js?1699257951814*/
; /* /bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/time/logic.min.js?16992580838048*/
; /* /bitrix/components/bitrix/ui.button.panel/templates/.default/script.min.js?16992580961189*/
; /* /bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/sidebar/logic.min.js?169925808312683*/
; /* /bitrix/components/bitrix/tasks.task.detail.parts/templates/flat/reminder/logic.min.js?16992580839380*/
; /* /bitrix/components/bitrix/tasks.widget.member.selector/templates/view/logic.min.js?16992580828364*/
; /* /bitrix/components/bitrix/tasks.scrum.epic.selector/templates/.default/script.min.js?16992580838941*/
; /* /bitrix/components/bitrix/tasks.tags.selector/templates/selector/script.min.js?16992580826463*/

//# sourceMappingURL=page_b869e57cfd149a6ba86de28c1e2dfd9c.map.js